<project name="build-portal-web" default="package.portal.web" basedir=".">
	
	<property name="navportlet.classdir"
		value="${basedir}/src/main/portalbeans/navigationportlet/WEB-INF/classes"/>
	<property name="contactHP.classdir"
		value="${basedir}/src/main/componenttypes/secondarypagetype/contactHP/WEB-INF/classes"/>
	<property name="loginpreprocess.classdir"
		value="${basedir}/src/main/componenttypes/secondarypagetype/loginpreprocess/WEB-INF/classes"/>
	<property name="startsimulation.classdir"
		value="${basedir}/src/main/componenttypes/secondarypagetype/startsimulation/WEB-INF/classes"/>
	<property name="stopsimulation.classdir"
		value="${basedir}/src/main/componenttypes/secondarypagetype/stopsimulation/WEB-INF/classes"/>
	<property name="pagedisplay.classdir"
		value="${basedir}/src/main/components/secondarypage/spp_pagedisplay/WEB-INF/classes"/>
	
	<target name="package.portal.web"
		depends="move.classes, package.car, delete.classes"/>
	
	<target name="move.classes">
		<mkdir dir="${navportlet.classdir}"/>
		<mkdir dir="${contactHP.classdir}"/>
		<mkdir dir="${loginpreprocess.classdir}"/>
		<mkdir dir="${startsimulation.classdir}"/>
		<mkdir dir="${stopsimulation.classdir}"/>
		<mkdir dir="${pagedisplay.classdir}"/>
		<move file="${target.dir}/classes/com/hp/sesame/navportlet"
			todir="${navportlet.classdir}/com/hp/sesame/"/>
		<move file="${target.dir}/classes/com/hp/spp/portal/secondarypagetype/contactHP"
			todir="${contactHP.classdir}/com/hp/spp/portal/secondarypagetype"/>
		<move file="${target.dir}/classes/com/hp/spp/portal/secondarypagetype/loginpreprocess"
			todir="${loginpreprocess.classdir}/com/hp/spp/portal/secondarypagetype"/>
		<move file="${target.dir}/classes/com/hp/spp/portal/secondarypagetype/startsimulation"
			todir="${startsimulation.classdir}/com/hp/spp/portal/secondarypagetype"/>
		<move file="${target.dir}/classes/com/hp/spp/portal/secondarypagetype/stopsimulation"
			todir="${stopsimulation.classdir}/com/hp/spp/portal/secondarypagetype"/>
		<move file="${target.dir}/classes/com/hp/spp/portal/secondarypage/pagedisplay"
			todir="${pagedisplay.classdir}/com/hp/spp/portal/secondarypage"/>
		<delete dir="${target.dir}/classes/com/hp/spp/portal/secondarypagetype"/>
		<delete dir="${target.dir}/classes/com/hp/spp/portal/secondarypage"/>
	</target>
	
	<target name="delete.classes">
		<delete dir="${navportlet.classdir}"/>
		<delete dir="${contactHP.classdir}"/>
		<delete dir="${loginpreprocess.classdir}"/>
		<delete dir="${startsimulation.classdir}"/>
		<delete dir="${stopsimulation.classdir}"/>
		<delete dir="${pagedisplay.classdir}"/>
	</target>
	
	<target name="package.car">
		<description>Create a car file per component, then a global car file containing all
			the components</description>
		
		
		<foreach param="cardir" target="component.car">
			<param name="target.car.dir" value="${target.dir}/cars/components"/> 
			<path>
				<dirset dir="${basedir}/src/main/components/">
					<!-- Iterate over the directories two levels below
						the components directory
						
						i.e. below, the contents of mygrid1, mygrid2, 
							mystyle1 and mystyle1 will be packaged as car files
						
						|-components
							|- grids (level 0)
								|- mygrid1 (level 1)
								|- mygrid2 (level 1)
							|- styles (level 0)
								|- mystyle1 (level 1)
								|- mystyle2 (level 1)			
						-->
					<depth min="1" max="1"/>
				</dirset>
			</path>
		</foreach>
		
		<foreach param="cardir" target="component.car">
			<param name="target.car.dir" value="${target.dir}/cars/componenttypes"/> 
			<path>
				<dirset dir="${basedir}/src/main/componenttypes/">
					<depth min="1" max="1"/>
				</dirset>
			</path>
		</foreach>
		
		<foreach param="cardir" target="component.car">
			<param name="target.car.dir" value="${target.dir}/cars/portalbeans"/> 
			<path>
				<dirset dir="${basedir}/src/main/portalbeans/">
					<depth min="0" max="0"/>
				</dirset>
			</path>
		</foreach>
		
		<echo>creating components car file: ${target.dir}/components.car</echo>
		<zip destfile="${target.dir}/components.car"
			basedir="${target.dir}/cars/components"/>
		
		<echo>creating components car file: ${target.dir}/componenttypes.car</echo>
		<zip destfile="${target.dir}/componenttypes.car"
			basedir="${target.dir}/cars/componenttypes"/>
		
	</target>
	
	<target name="component.car">
		<description>Create a car file containing the contents of the directory cardir and
			put the car in target/cars</description>
		<echo>cardir: ${cardir}</echo>
		<mkdir dir="${target.car.dir}"/>
		<basename property="carname" file="${cardir}"/>
		<property name="carfile" value="${target.car.dir}/${carname}.car"/>
		<echo>creating car file: ${carfile}</echo>
		<zip destfile="${carfile}" basedir="${cardir}"/>
	</target>
	
</project>