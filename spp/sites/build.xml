<project name="build-portal-web" default="package.sites" basedir=".">
	
	<target name="package.sites">
		<description>Packages the site components, creating a car file per 
			component, then a site car file containing all the components 
			for the site</description>
		
		<foreach param="sitedir" target="package.car">
			<path>
				<dirset dir="${basedir}/src/main/">
					<depth min= "0" max="0"/>
				</dirset>
			</path>

		</foreach>
	</target>
	
	<target name="package.car">
		
		<basename property="sitename" file="${sitedir}"/>

		<foreach param="cardir" target="component.car">
			<param name="target.car.dir" value="${target.dir}/${sitename}/cars/components"/> 
			<path>
				<dirset dir="${sitedir}/components/">
					<!-- Iterate over the directories two levels below
						the components directory
						
						i.e. below, the contents of mygrid1, mygrid2, 
							mystyle1 and mystyle1 will be packaged as car files
						
						|-components
							|- grids (level 0)
								|- mygrid1 (level 1)
								|- mygrid2 (level 1)
							|- styles (level 0)
								|- mystyle1 (level 1)
								|- mystyle2 (level 1)			
						-->
					<depth min="1" max="1"/>
				</dirset>
			</path>
		</foreach>
				
		<echo>creating components car file: ${target.dir}/components.car</echo>
		<zip destfile="${target.dir}/${sitename}components.car"
			basedir="${target.dir}/${sitename}/cars/components"/>
		
	</target>
	
	<target name="component.car">
		<description>Create a car file containing the contents of the directory cardir and
			put the car in target/cars</description>
		<echo>cardir: ${cardir}</echo>
		<mkdir dir="${target.car.dir}"/>
		<basename property="carname" file="${cardir}"/>
		<property name="carfile" value="${target.car.dir}/${carname}.car"/>
		<echo>creating car file: ${carfile}</echo>
		<zip destfile="${carfile}" basedir="${cardir}"/>
	</target>
	
</project>