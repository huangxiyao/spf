<html>
<body>
<p>This artifact contains utilities (Java API's and JSP tags) for
Java portlets built using the Shared Portal Framework (SPF).</p>

<style type="text/css">
body {
	padding: 0;
	font-family: Verdana, Sans-serif;
	font-size: small;
}

h1 {
	font-family: Georgia, Serif;
	font-size: 200%;
	color: #404040;
	margin-top: 5px;
}

h2 {
	font-family: Georgia, Serif;
	font-size: 175%;
	color: #404040;
	page-break-before: always;
}

h3 {
	font-family: Verdana, Sans-serif;
	font-size: 150%;
	font-weight: bold;
	color: #404040;
	margin-top: 20px;
}

h4 {
	font-family: Verdana, Sans-serif;
	font-size: 125%;
	font-weight: bold;
	color: #404040;
	margin-top: 20px;
}

li {
	margin-left: -10px;
}

ol li {
	margin-bottom: 20px;
}

code {
	color: #990000;
	font-size: 110%
}

pre {
	color: #990000;
	font-size: 110%;
}

.byline {
	font-style: italic;
	font-size: 90%;
	color: gray;
	margin-top: -10px;
	border-bottom: solid black 1px;
}

.codeSample {
	color: #990000;
	font-family: 'Courier New', Courier, monospace;
	font-size: small;
	border: solid #990000 1px;
	padding: 5px;
}

.leftFloatingImage {
	float: left;
	margin: 0 10px 10px 0;
}

.rightFloatingImage {
	float: right;
	margin: 0 0 10px 10px;
}

.toc {
	list-style-type: none;
}

ul.toc ul {
	list-style-type: none;
}

table.props td,table.props th {
	padding: 5px;
	background-color: #F0F0F0
}

table.props th {
	font-size: 11px;
	font-weight: bold;
	text-align: right;
}

table.props td {
	font-family: 'Courier New', Courier, monospace;
}

.style1 {
	border-style: solid;
	border-width: 1px;
}
</style>

<a name="top">
<h1>Shared Portal Framework - Portlet Utilities - Developer's Guide<br>
<font color="red">WORK IN PROGRESS</font></h1>
</a>

<a name="toc">
<h2>Table of Contents</h2>
</a>

<ul class="toc">
	<li>1. <a href="#overview">Overview</a>
	<ul>
		<li>1.1. <a href="#overview.installation">Installation</a>
		<ul>
			<li>1.1.1. <a href="#overview.installation.jar">Installation
			of the SPF portlet utilities JAR</a></li>
			<li>1.1.2. <a href="#overview.installation.i18n_portlet_config">Installation
			of <code>i18n_portlet_config.properties</code> (optional)</a></li>
			<li>1.1.3. <a href="#overview.installation.init_relay">Installation
			of <code>init_relay.properties</code> (optional)</a></li>
		</ul>
		</li>
		<li>1.2. <a href="#overview.dependencies">Dependencies</a></li>
		<li>1.3. <a href="#overview.other">Other libraries for SPF
		portlet developers</a>
		<ul>
			<li>1.3.1. <a href="#overview.other.wpap">WPA Portlet
			Edition</a></li>
			<li>1.3.2. <a href="#overview.other.spring">Spring Portlet
			MVC</a></li>
			<li>1.3.3. <a href="#overview.other.spf.common">SPF Common
			Utilities</a></li>
			<li>1.3.4. <a href="#overview.other.spf.htmlviewer">SPF <code>html-viewer</code>
			Portlet</a></li>
		</ul>
		</li>
	</ul>
	</li>
	<li>2. <a href="#i18n">Internationalization</a>
	<ul>
		<li>2.1. <a href="#i18n.resources">Kinds of resources</a>
		<ul>
			<li>2.1.1. <a href="#i18n.resources.message">Message
			resources (message properties)</a></li>
			<li>2.1.2. <a href="#i18n.resources.supporting">Supporting
			resources (images, HTML, PDF, etc)</a></li>
			<li>2.1.3. <a href="#i18n.resources.bundles">Resource
			bundles</a></li>
		</ul>
		</li>
		<li>2.2. <a href="#i18n.location">Where to put your resources</a>
		<ul>
			<li>2.2.1. <a href="#i18n.location.internal">Internal
			resources (portlet application)</a></li>
			<li>2.2.2. <a href="#i18n.location.external">External
			resources (portlet resource bundle folder)</a></li>
			<li>2.2.3. <a href="#i18n.location.both">Mixing internal and
			external resources</a></li>
		</ul>
		</li>
		<li>2.3. <a href="#i18n.messages.java">Accessing message
		resources using Java code</a>
		<ul>
			<li>2.3.1. <a href="#i18n.messages.java.spring.getMessage">Using
			Spring (<code>ApplicationContext.getMessage</code>)</a></li>
			<li>2.3.2. <a href="#i18n.messages.java.spf.getMessage">Using
			SPF (<code>I18nUtility.getMessage</code>)</a></li>
		</ul>
		</li>
		<li>2.4. <a href="#i18n.messages.tags">Accessing message
		resources using JSP tag libraries</a>
		<ul>
			<li>2.4.1. <a href="#i18n.messages.jsp.spring.message">Using
			Spring (<code>&lt;spring:message&gt;</code>)</a></li>
			<li>2.4.2. <a href="#i18n.messages.jsp.spf.message">Using
			SPF (<code>&lt;spf-i18n-portlet:message&gt;</code>, <code>&lt;spf-i18n-portlet:param&gt;</code>,
			and <code>&lt;spf-i18n-portlet:classicContextualHelpParam&gt;</code>)</a></li>
		</ul>
		</li>
		<li>2.5. <a href="#i18n.supporting.java">Accessing supporting
		resources using Java code</a>
		<ul>
			<li>2.5.1. <a href="#i18n.supporting.java.getLocalizedFileURL">Using
			<code>I18nUtility.getLocalizedFileURL</code></a></li>
			<li>2.5.2. <a
				href="#i18n.supporting.java.getLocalizedFileStream">Using <code>I18nUtility.getLocalizedFileStream</code></a></li>
			<li>2.5.3. <a href="#i18n.supporting.java.getLocalizedFileName">Using
			<code>I18nUtility.getLocalizedFileName</code></a></li>
		</ul>
		</li>
		<li>2.6. <a href="#i18n.supporting.jsp">Accessing supporting
		resources using JSP tag libraries</a>
		<ul>
			<li>2.6.1. <a href="#i18n.supporting.jsp.localizedFileURL">Using
			<code>&lt;spf-i18n-portlet:localizedFileURL&gt;</code></a></li>
		</ul>
		</li>
		<li>2.7. <a href="#i18n.supporting.relay">Providing download
		service for external resources using <code>RelayServlet</code></a></li>
		<li>2.8. <a href="#i18n.l10n">Localizing your resources</a>
		<ul>
			<li>2.8.1 <a href="#i18n.l10n.spf">The SPF localization
			process</a></li>
		</ul>
		</li>
		<li>2.9. <a href="#i18n.other">Other internationalization
		topics</a>
		<ul>
			<li>2.9.1. <a href="#i18n.other.locale.get">Getting the
			locale</a></li>
			<li>2.9.2. <a href="#i18n.other.locale.set">Setting the
			locale</a></li>
			<li>2.9.3. <a href="#i18n.other.i18n_portlet_config">Configuring
			<code>i18n_portlet_config.properties</code> (optional)</a></li>
			<li>2.9.4. <a href="#i18n.other.init_relay">Configuring <code>init_relay.properties</code>
			(optional)</a></li>
			<li>2.9.5. <a href="#i18n.other.common">Using the common <code>I18nUtility</code></a></li>
		</ul>
		</li>
	</ul>
	</li>
	<li>3. <a href="#help">Online Help</a>
	<ul>
		<li>3.1. <a href="#help.kinds">About online help</a>
		<ul>
			<li>3.1.1. <a href="#help.kinds.contextual">Contextual help
			(classic and custom; standalone and injected)</a></li>
			<li>3.1.2. <a href="#help.kinds.portlet">Portlet help (help
			mode)</a></li>
			<li>3.1.3. <a href="#help.kinds.global">Portal help (global
			help)</a></li>
		</ul>
		</li>
		<li>3.2. <a href="#help.contextual.java">Producing contextual
		help using Java code </a>
		<ul>
			<li>3.2.1. <a
				href="#help.contextual.java.classicContextualHelpProvider">Using
			<code>ClassicContextualHelpProvider</code></a></li>
			<li>3.2.2. <a
				href="#help.contextual.java.contextualHelpProvider">Extending <code>ContextualHelpProvider</code>
			to create a custom rendition</a></li>
		</ul>
		</li>
		<li>3.3. <a href="#help.contextual.jsp">Producing contextual
		help using JSP tag libraries</a>
		<ul>
			<li>3.3.1. <a
				href="#help.contextual.jsp.classicContextualHelpProvider">Using
			<code>&lt;spf-help-portlet:classicContextualHelpProvider&gt;</code>
			for standalone classic contextual help</a></li>
			<li>3.3.2. <a
				href="#help.contextual.jsp.classicContextualHelpProviderParam">Using
			<code>&lt;spf-i18n-portlet:classicContextualHelpProviderParam&gt;</code>
			for injected classic contextual help</a></li>
			<li>3.3.3. <a href="#help.contextual.jsp.contextualHelpProvider">Creating
			a tag library for a custom contextual help rendition</a></li>
		</ul>
		</li>
		<li>3.4. <a href="#help.portlet.java">Producing portlet help
		(help mode) using <code>FileDisplayPortletController</code></a></li>
	</ul>
	</li>
	<li>4. <a href="#file">File Display</a>
	<ul>
		<li>4.1. <a href="#file.about">About file display</a></li>
		<li>4.2. <a href="#file.display">Displaying file content
		using Java code</a>
		<ul>
			<li>4.2.1. <a href="#file.display.fileInterpolator">Using <code>FileInterpolator</code>
			to read and interpolate file content</a></li>
			<li>4.2.2. <a href="#file.display.fileDisplayPortletController">Using
			<code>FileDisplayPortletController</code> to display interpolated
			file content</a></li>
			<li>4.2.3. <a href="#file.display.htmlViewer">Using the <code>html-viewer</code>
			portlet to display interpolated file content</a></li>
		</ul>
		<li>4.3. <a href="#file.author">Authoring file content and
		using interpolation tokens</a>
		<ul>
			<li>4.3.1. <a href="#file.author.token.url">Including URLs
			for supporting resources like images and CSS (<code>&lt;CONTENT-URL:<i>path</i>&gt;</code>,
			<code>&lt;LOCALIZED-CONTENT-URL:<i>path</i>&gt</code>) </a></li>
			<li>4.3.2. <a href="#file.author.token.user">Displaying user
			information (<code>&lt;NAME&gt;</code>, <code>&lt;EMAIL&gt;</code>, <code>&lt;LANGUAGE-CODE&gt;</code>,
			<code>LANGUAGE-TAG&gt;</code>, <code>&lt;USER-PROPERTY:<i>key</i>&gt;</code>)</a></li>
			<li>4.3.3. <a href="#file.author.token.auth">Permissioning
			content for authorized users (<code>&lt;ROLE:<i>role-names</i>&gt;</code>,
			<code>&lt;GROUP:<i>group-names</i>&gt;</code>)</a></li>
			<li>4.3.4. <a href="#file.author.token.consolidate">Consolidating
			content for easier administration (<code>&lt;PORTLET:<i>friendly-ids</i>&gt;</code>,
			<code>&lt;SITE:<i>site-names</i></code>, <code>&lt;TOKEN:<i>key</i>&gt;</code>)</a></li>
			<li>4.3.5. <a href="#file.author.token.misc">Miscellaneous (<code>&lt;SITE&gt;</code>)</a></li>
		</ul>
		</li>
	</ul>
	</li>
	<li>5. <a href="#portal">Portal Data</a>
	<ul>
		<li>5.1. <a href="#portal.kinds">Kinds of portal provided
		data</a>
		<ul>
			<li>5.1.1. <a href="#portal.user">User data (profile
			attributes, groups and roles)</a></li>
			<li>5.1.2. <a href="#portal.prefs">Portlet preferences</a></li>
			<li>5.1.3. <a href="#portal.request">Portal request data
			(site name, friendly ID, and URLs)</a></li>
		</ul>
		</li>
		<li>5.2. <a href="#portal.user.get">Accessing user data using
		Java code</a>
		<ul>
			<li>5.2.1. <a href="#portal.user.props">Accessing user
			profile attributes (<code>Utils.getUserProperty</code>)</a></li>
			<li>5.2.2. <a href="#portal.user.groups">Accessing user
			groups (<code>Utils.getGroups</code>)</a></li>
		</ul>
		</li>
		<li>5.3. <a href="#portal.request.get">Accessing portal
		request data</a>
		<ul>
			<li>5.3.1. <a href="#portal.request.site">Accessing the
			portal site name (<code>Utils.getSiteName</code>)</a></li>
			<li>5.3.2. <a href="#portal.request.portlet">Accessing the
			portlet friendly ID (<code>Utils.getPortletID</code>)</a></li>
			<li>5.3.3. <a href="#portal.request.url">Accessing portal
			URL's (<code>Utils.getRequestURL</code>, <code>Utils.getSiteRootURL</code>)</a></li>
		</ul>
		</li>
	</ul>
	</li>
	<li>6. <a href="#error">Error Handling</a>
	<ul>
		<li>6.1. <a href="#error.about">About error handling</a></li>
		<li>6.2. <a href="#error.categorization">Categorizing
		exceptions using the <code>SPFException</code> hierarchy</a></li>
		<li>6.3. <a href="#error.handling">Handling exceptions using
		<code>ExceptionUtil</code> and <code>SimpleMappingExceptionResolver</code></a></li>
	</ul>
	</li>
</ul>

<hr>

<a name="overview">
<h2>1. Overview</h2>
</a>

<p>This is the developer's guide for the <b>Shared Portal
Framework (SPF) portlet utilities</b>. The SPF portlet utilities are a
collection of Java classes and JSP tag libraries providing useful
functionality for SPF Java portlet developers in the following areas:</p>

<ul>
	<li><a href="#i18n">Internationalization</a> - the SPF portlet
	utilities provide Java classes and JSP tags for handling all kinds of
	UI resources in your code (messages, images, etc) so that they can be
	localized</li>
	<li><a href="#help">Online Help</a> - the SPF portlet utilities
	provide Java classes and JSP tags which make it easier for you to
	develop online help</li>
	<li><a href="#file">File Display</a> - the SPF portlet utilities
	provide Java classes for interpolating and displaying file content to
	users (saving you time when developing portlets that mostly display
	static text)</li>
	<li><a href="#portal">Portal Data</a> - the SPF portlet utilities
	provide Java classes for accessing data passed by the SPF (Vignette)
	portal</li>
	<li><a href="#error">Error Handling</a> - the SPF portlet
	utilities provide Java classes to assist you with error handling,
	especially system error handling (saving you time developing rote
	handlers for system errors)</li>
</ul>

<p>The SPF portlet utilities augment HP IT's WPAP (Web Presentation
Architecture - Portlet Edition) framework, which in turn augments the
Spring consortium's Portlet MVC framework. These are all among the
several SPF artifacts for SPF developers. See <a href="#overview.other">other
libraries</a>.</p>

<hr>

<a name="overview.installation">
<h3>1.1. Installation</h3>
</a>

<a name="overview.installation.jar">
<h4>1.1.1 Installation of the SPF portlet utilities JAR</h4>
</a>

<p>The SPF portlet utilities are distributed in Java JAR format. The
base JAR filename is <code>spf-portlet-utilities.jar</code>; typically a
version number is included (for example, <code>spf-portlet-utilities-1.0.0.jar</code>).
The SPF portlet utilities are distributed through Maven 2:</p>

<ul>
	<li>The current Maven 2 repository is <a
		href="http://samson.atl.hp.com:8081/nexus/content/groups/public/com/hp/it/spf/xa/spf-portlet-utilities/"><code>http://samson.atl.hp.com:8081/nexus/content/groups/public/com/hp/it/spf/xa/spf-portlet-utilities/</code></a></li>
	<li>The group ID is <code>com.hp.it.spf.xa</code>
	<li>The artifact ID is <code>spf-portlet-utilities</code>
</ul>

<p>To get the SPF portlet utilities, download the latest released
version from the repository. As usual with any JAR file, include it in
your portlet application's <code>/WEB-INF/lib</code> folder.</p>

<a name="overview.installation.i18n_portlet_config">
<h4>1.1.2 Installation of <code>i18n_portlet_config.properties</code>
(optional)</h4>
</a>

<blockquote>
<p><b>Note:</b> You only need to concern yourself with <code>i18n_portlet_config.properties</code>
if you have <a href="#i18n.location.external">external supporting
resources</a> <b>and</b> you are either putting the <i>portlet resource
bundle folder</i> in a non-default location, <b>or</b> you are deploying the
<i>file relay servlet</i> in a non-default location.</p>
</blockquote>

<p>To install this file:</p>

<ul>
	<li>
	<p>Download the template for <code>i18n_portlet_config.properties</code>
	from <b><font color="blue">TBD</font></b>.</p>
	</li>

	<li>
	<p>Customize the properties in the file as needed - see
	instructions for <a href="#i18n.other.i18n_portlet_config">configuring
	the <code>i18n_portlet_config.properties</code></a>.</p>
	</li>

	<li>
	<p>Include the customized file, named <code>i18n_portlet_config.properties</code>,
	with your portlet application. You can put the file anywhere that the
	system classloader searches: inside your portlet application (eg in <code>/WEB-INF/classes</code>)
	or in any folder outside of the WAR which is named in the classpath for
	your JVM. If you need to make the configuration easily performable by
	an administrator, we recommend the latter; otherwise the former is
	easier because it is one-time setup.</p>

	<p>If you are interested in externalizing the <code>i18n_portlet_config.properties</code>
	from the portlet WAR, check how your application server is configured.
	If you are using an application server hosting environment, like DASH
	or SASU, they probably will have provided you a "global resources"
	folder on the server filesystem and in the JVM classpath. You would put
	the <code>i18n_portlet_config.properties</code> file there, if you
	wanted it to be external to your portlet WAR (eg so the administrator
	can easily customize it).</p>

	<blockquote>
	<p><b>Note:</b> Depending on the search order performed by your
	system classloader, you may be able to do <b>both</b>: include a <code>i18n_portlet_config.properties</code>
	inside your application, and also let the administrator optionally
	override it when needed, by putting an <code>i18n_portlet_config.properties</code>
	outside of the WAR. For this to work, your classloader must search the
	external folders in the classpath <b>before</b> searching inside the
	WAR. If you are interested in this "mixed" deployment of <code>i18n_portlet_config.properties</code>,
	be sure to test it out first, as actual behavior may vary by
	environment (application server, etc).</p>
	</blockquote>
	</li>
</ul>

<a name="overview.installation.init_relay">
<h4>1.1.3 Installation of <code>init_relay.properties</code>
(optional)</h4>
</a>

<blockquote>
<p><b>Note:</b> You only need to concern yourself with <code>init_relay.properties</code>
if you have <a href="#i18n.location.external">external supporting
resources</a> <b>and</b> you are dis-satisfied with the configuration in <code>init_relay_default.properties</code>
(which is delivered inside the SPF portlet utilities JAR). See the
discussion in the <a
	href="com/hp/it/spf/xa/relay/servlet/package-summary.html#init_relay.properties">package
description</a> for the relay servlet.</p>
</blockquote>

<p>To install this file:</p>

<ul>
	<li>
	<p>Download the template for <code>init_relay.properties</code>
	from <b><font color="blue">TBD</font></b>.</p>
	</li>

	<li>
	<p>Customize the properties in the file as needed - see
	instructions for <a href="#i18n.other.init_relay">configuring the <code>init_relay.properties</code></a>.</p>
	</li>

	<li>
	<p>Include the customized file, named <code>init_relay.properties</code>,
	with your relay servlet application (eg, your portlet application, if
	that is where you are deploying the relay servlet). You can put the
	file anywhere that the system classloader searches: inside your portlet
	application (eg in <code>/WEB-INF/classes</code>) or in any folder
	outside of the WAR which is named in the classpath for your JVM. See
	the discussion on this point above, in regard to <a
		href="#overview.installation.i18n_portlet_config"><code>i18n_portlet_config.properties</code></a>
	- the same comments apply to <code>init_relay.properties</code>.</p>
	</li>
</ul>

<hr>

<a name="overview.dependencies">
<h3>1.2. Dependencies</h3>
</a>

<p>The SPF portlet utilities depend on WPAP and all of the various
technologies upon which WPAP in turn depends:</p>

<ul>
	<li>Spring Portlet MVC</li>
	<li>Java Portlet</li>
	<li>Java Servlet</li>
	<li>JSP</li>
</ul>

<p>In addition, the SPF portlet utilities depend on the SPF commmon
utilities (common utilities for both portlet and portal components in
the Shared Portal Framework).</p>

<p>All of these dependencies are managed through Maven. For a list
of the exact current dependencies, see the Maven POM for the SPF portlet
utilities. You can download it from the Maven repository mentioned
above. As usual, all of these JAR dependencies also need to be included
when you build your portlet application's <code>/WEB-INF/lib</code>.</p>

<hr>

<a name="overview.other">
<h3>1.3. Other libraries for SPF portlet developers</h3>
</a>

<a name="overview.other.wpap">
<h4>1.3.1 WPA Portlet Edition</h4>
</a>

<p>The SPF portlet utilities augment HP IT's WPA Portlet Edition
framework. Several facilities which SPF portlet developers will use
(such as Timber for logging) are provided by WPAP. See the developer's
site for WPA Portlet Edition here: <a
	href="http://intranet.hp.com/Sites/SOA/TechnicalDocs/WPAPortlet/Pages/framework.aspx"><code>http://intranet.hp.com/Sites/SOA/TechnicalDocs/WPAPortlet/Pages/framework.aspx</code></a></p>

<blockquote>
<p><b>Note:</b> At this time, only the Portlet 1.0 (JSR-168)
compliant version of WPAP is available and documented at the above link.
The Portlet 2.0 (JSR-286) version is <font color="blue"><b>TBD</b></font>.</p>
</blockquote>

<a name="overview.other.spring">
<h4>1.3.2 Spring Portlet MVC</h4>
</a>

<p>WPAP in turn augments the open-source Spring Portlet MVC
framework. The basic workflow of an SPF portlet, for example, is
typically provided by Spring Portlet MVC. See the Spring Portlet MVC
developer's site here: <a
	href="http://static.springframework.org/spring/docs/2.0.x/reference/portlet.html"><code>http://static.springframework.org/spring/docs/2.0.x/reference/portlet.html</code></a></p>

<blockquote>
<p><b>Note:</b> The above link is for the Portlet 1.0 (JSR-168)
version of Spring Portlet MVC. The Portlet 2.0 (JSR-286) Spring Portlet
MVC documentation is <font color="blue"><b>TBD</b></font>.</p>
</blockquote>

<a name="overview.other.spf.common">
<h4>1.3.3 SPF Common Utilities</h4>
</a>

<p>The SPF common utilities, used both by SPF portlets and portal
components (ie Vignette components), contain a number of useful API's
for SPF portlet developers, including:</p>

<ul>
	<li>building portal page URLs, including portal page URLs which
	target portlets on those pages and pass them parameters</li>
	<li>managing your application's configuration properties using
	hot-reloadable external files</li>
	<li>performing miscellaneous
	internationalization/localization-related tasks such as localized
	display of names (user, locale, timezone) in SPF-standard format, and
	transformation between locales, HP Passport language codes, and RFC
	3066 language tags</li>
	<li>and more</li>
</ul>

<p>These functionalities are in a separate package so that they can
be used by SPF's Vignette portal components as well. In some cases they
are inherited into the SPF portlet utilities (so you get them too when
you import the SPF portlet utility class), and in other cases you have
to import them directly.</p>

<p>See the SPF Common Utilities Developer's Guide here: <a
	href="http://samson.atl.hp.com:8080/hudson/job/spf-common-utilities/site/apidocs/overview-summary.html#top"><code>http://samson.atl.hp.com:8080/hudson/job/spf-common-utilities/site/apidocs/overview-summary.html</code></p>

<a name="overview.other.spf.htmlviewer">
<h4>1.3.4 SPF <code>html-viewer</code> Portlet</h4>
</a>

<p>The Shared Portal Framework includes a portlet application, <code>html-viewer</code>,
which you can use with minimal customization. This portlet renders a
text file, such as an HTML file (containing arbitrary HTML, JavaScript,
and/or CSS), to the user. The file rendered is the best-fit localized
version available for the user amongst a bundle of files located inside
the application WAR, or on the server filesystem outside of it (eg where
deposited an administrator). The file may also include substitution
tokens for certain dynamic functionality supported by the SPF portlet
utilities' {@link com.hp.it.spf.xa.interpolate.portlet.FileInterpolator}
- for example, you can permission content in the file by group or role,
include possibly-localized images and other static resources, etc. The <code>html-viewer</code>
portlet's <code>view</code> mode renders the file, and its <code>config</code>
mode lets the portlet administrator configure the portlet (eg specify
which bundle of HTML files to render).</p>

<p>The <code>html-viewer</code> portlet is often a quick and easy
basis for developing a simple, static or mostly-static portlet for your
SPF portal site. You don't write any code or configure any Spring or
portlet XML files; you just supply the text files for it to display.
Furthermore, the <code>html-viewer</code> code is extensible (it is
actually included inside the SPF portlet utilities) if you need rather
to build upon it for your own portlet application.</p>

<p>Although the SPF portlet utilities include the classes for <code>html-viewer</code>,
it is a separate application with its own SPF HTML Viewer Portlet
Developer's Guide here: <a
	href="http://samson.atl.hp.com:8080/hudson/job/html-viewer/site/apidocs/overview-summary.html"><code>http://samson.atl.hp.com:8080/hudson/job/html-viewer/site/apidocs/overview-summary.html</code></a></p>

<hr>

<a name="i18n">
<h2>2. Internationalization</h2>
</a>

<p>Spring Portlet MVC (the basis of the SPF portlet utilities and
WPAP) provides basic support for internationalizing text strings
(message resources) in your portlet application. The SPF portlet
utilities (primarily the {@link
com.hp.it.spf.xa.i18n.portlet.I18nUtility} class) extend the Spring
functionality primarily in these directions:</p>

<ul>
	<li>
	<p>internationalizing access to other static resources (images,
	PDF's, etc)</p>
	</li>
	<li>
	<p>injecting contextual help into your message resources</p>
	</li>
	<li>
	<p>placing no-localization reminders into your message resources</p>
	</li>
	<li>
	<p>miscellaneous useful methods, inherited from the {@link
	com.hp.it.spf.xa.i18n.I18nUtility} class (see <a
		href="#i18n.other.common">using the common <code>I18nUtility</code></a>
	at the end of this section)</p>
	</li>
</ul>

<hr>

<a name="i18n.resources">
<h3>2.1. Kinds of resources</h3>
</a>

<p>With the SPF portlet utilities, you can internationalize access
to your text strings (message resources) and other static resources
(supporting resources like images, HTML, PDF, etc), so that they can be
localized.</p>

<a name="i18n.resources.message">
<h4>2.1.1. Message resources (message properties)</h4>
</a>

<p><i>Message resources</i> (sometimes just called messages) are
text strings used in your UI. They are managed in Java message property
files as per the usual Java {@link ResourceBundle} standard. If your
application's messages are going to be sourced elsewhere - in a
database, an XML file, etc - you will have to arrange to export them
into Java message property format before they can be accessed through
SPF (or Spring).</p>

<p>SPF has a well-defined process for localizing your message
resources: translating them from a <i>base locale</i> (typically US
English) into the various other locales you need. See <a
	href="#i18n.l10n">localizing your resources</a>, below.</p>

<a name="i18n.resources.supporting">
<h4>2.1.2. Supporting resources (images, HTML, PDF, etc)</h4>
</a>

<p>In addition to message resources, the SPF portlet utilities
provide a solution for internationalized access to <i>supporting
resources</i>: static files like images, HTML, PDF, MS Word documents, etc.</p>

<p>SPF's localization process works for these files too, letting you
get them translated from a <i>base locale</i> (again, typically US
English) into the various other locales you need. See the discussion
around the <a href="#i18n.l10n.spf">SPF localization process</a>, below.</p>

<a name="i18n.resources.bundles">
<h4>2.1.3 Resource bundles</h4>
</a>

<p>Whether message property files, or supporting files, in SPF you
organize them into <i>resource bundles</i>. These are collections of
files containing identical content, just localized for different
locales. The <i>base file</i> contains the content for the base locale
(typically US English). The other files in the bundle each contain a
translation of that content for another locale. As with the Java
standard for {@link ResourceBundle}, the base file should <b>not</b>
have any locale tag, while the other files should be tagged according to
their locale, as follows:</p>

<blockquote><pre>
<i>base-filename</i>_<i>lang</i>_<i>CC</i>.<i>extension</i>
</pre></blockquote>

<ul>
	<li><i><code>lang</code></i> is the 2-character <a
		href="http://www.loc.gov/standards/iso639-2/php/English_list.php">ISO
	639-1</a> language code for the locale (lowercase)</li>
	<li><i><code>CC</code></i> is the 2-character <a
		href="http://www.iso.org/iso/country_codes/iso_3166_code_lists/english_country_names_and_code_elements.htm">ISO
	3166-1</a> country code for the locale (uppercase)</li>
</ul>

<p>For example, here is a collection of files constituting a message
resource bundle, where <code>messages.properties</code> is the <i>base
filename</i>:</p>

<blockquote><pre>
messages.properties         &lt;-- the base file
messages_ja_JP.properties   &lt;-- the same file localized for Japan - Japanese
messages_zh_CN.properties   &lt;-- the same file localized for China - Chinese
messages_zh_TW.properties   &lt;-- the same file localized for Taiwan - Chinese
</pre></blockquote>

<p>Here is a collection of files constituting an image resource
bundle, where <code>picture.jpg</code> is the base filename:</p>

<blockquote><pre>
picture.jpg         &lt;-- the base file
picture_ja_JP.jpg   &lt;-- the same file localized for Japan - Japanese
picture_zh_CN.jpg   &lt;-- the same file localized for China - Chinese
picture_zh_TW.jpg   &lt;-- the same file localized for Taiwan - Chinese
</pre></blockquote>

<p><b>Note:</b> SPF will generally use full (ie language- and
country-specific) locales. Your resource bundles are encouraged to do
likewise. However if you want to offer localization at the level of
language-only, you can do that. For example, while users of your portlet
may present with both France - French (<code>fr-FR</code>) and France -
Canada (<code>fr-CA</code>), if there is no difference in those
translations you could just have one file in your resource bundle for
them. Just drop the country code from the tagged locale:</p>

<blockquote><pre>
picture.jpg         &lt;-- the base file
picture_fr.jpg      &lt;-- the same file localized for country-generic French
picture_ja_JP.jpg   &lt;-- the same file localized for Japan - Japanese
picture_zh_CN.jpg   &lt;-- the same file localized for China - Chinese
picture_zh_TW.jpg   &lt;-- the same file localized for Taiwan - Chinese
</pre></blockquote>

<p>As with the Java standard for {@link ResourceBundle}, all of the
SPF (and Spring) internationalization utilities will search for the
most-specific match for the user's locale first, ultimately falling back
upon your base file.</p>

<hr>
<a name="i18n.location">
<h3>2.2. Where to put your resources</h3>
</a>

<p>You have a choice where you put your resource bundles. You may
put them into your portlet application (WAR) where they would
traditionally go (we call these <i>internal resources</i>). But you may
also put them outside, into a well-known folder on the portlet server
called the <i>portlet resource bundle folder</i> - we call these <i>external
resources</i>.</p>

<a name="i18n.location.internal">
<h4>2.2.1. Internal resources (portlet application)</h4>
</a>

<p>You may put your message properties and supporting resource files
into your portlet WAR where they traditionally go:</p>

<ol>
	<li>
	<p>Your message properties would go into your <code>WEB-INF/classes/</code>,
	optionally under some additional sub-path (we recommend <code>portlet/i18n/</code>
	for reasons that will become clear in the discussion of <a
		href="#i18n.location.external">external resources</a>). For example:</p>

	<blockquote><pre>
	<i>&lt;root&gt;</i>
	    WEB-INF/
	        classes/
	        	portlet/
	        		i18n/
	        			messages.properties
	        			messages_fr_FR.properties
	        			...
	</pre></blockquote>

	<p>Also, be sure to configure Spring properly in your portlet
	application, so that can find those message properties. For example, if
	you use Spring's {@link
	org.springframework.context.support.ReloadableResourceBundleMessageSource}
	class, you would put this into your application context configuration
	(eg either your application-wide <code>applicationContext.xml</code> or
	your portlet-specific version of that file) for a bundle of message
	properties with basename of <code>messages</code> (eg <code>messages.properties</code>,
	<code>messages_fr_FR.properties</code>, etc):</p>

	<blockquote><pre>
	&lt;bean id="messageSource"
		class="org.springframework.context.support.ReloadableResourceBundleMessageSource"&gt;
		&lt;property name="basenames"&gt;
			&lt;list&gt;
				&lt;value&gt;
					classpath:portlet/i18n/messages
				&lt;/value&gt;
			&lt;/list&gt;
		&lt;/property&gt;
	&lt;/bean&gt;
	</pre></blockquote>
	</li>

	<li>
	<p>Your other static resource files (images, videos, PDF's, etc)
	would go into respective folders at the root of your portlet WAR. For
	example, if you have a bundle of HTML files (<code>text.html</code>, <code>text_es_MX.html</code>,
	etc) and a bundle of images (<code>picture.jpg</code>, <code>picture_ja.jpg</code>,
	etc), they could go into your portlet WAR as follows:</p>

	<blockquote><pre>
	<i>&lt;root&gt;</i>
	    html/
	        text.html
	        text_es_MX.html
	        ...
	    images/
	        picture.jpg
	        picture_ja.jpg
	        ...
	</pre></blockquote>
	</li>
</ol>

<p>Then when you use the standard Spring message API's, or the SPF
portlet message API's in {@link
com.hp.it.spf.xa.i18n.portlet.I18nUtility}, or the tag libraries for
either, they will find your message resources inside your portlet WAR.
And when you use the localized file access API's in <code>I18nUtility</code>,
they will find your static resource files there likewise.</p>

<a name="i18n.location.external">
<h4>2.2.2. External resources (portlet resource bundle folder)</h4>
</a>

<p>You may instead put your messages and other resources <i>outside</i>
of your portlet WAR. Why? Doing so may have some advantages - for
example, it may make for easier administration of the resources.
Currently the SPF supports you putting them into what is called the <i>portlet
resource bundle folder</i>, which is any folder on the portlet server's
filesystem to which the portlet JVM has at least read access.</p>

<ol>
	<li>
	<p>Put the path for your portlet bundle folder into the classpath
	of your server's JVM. Or, put some parent path for it into the
	classpath. If you are using an application-hosting service (like SASU),
	they may already have defined for you a standard path from which to
	load so-called "global resources" (like externally-administered
	configuration files), and they may have put that into the classpath
	already. In any event, we recommend making the portlet bundle folder be
	a subfolder of your "global resources" classpath folder.</p>

	<p>For example, if you are using SASU, it may be that <code>/opt/sasuapps/spf/globalResources</code>
	is already your assigned classpath folder for all global resources (eg
	configuration files). If that is the case, we recommend creating the
	subfolder <code>portlet/i18n/</code> underneath it, so that <code>/opt/sasuapps/spf/globalResources/portlet/i18n/</code>
	is your portlet bundle folder. SASU should have put the <code>/opt/sasuapps/spf/globalResources</code>
	into the classpath for you.</p>
	</li>

	<li>
	<p>Put your message properties and other resource files into your
	portlet bundle folder. We recommend you use subfolders for further
	organization - for example, putting message properties in the portlet
	bundle folder proper, images in the <code>images/</code> subfolder,
	etc. Like this (example):</p>

	<blockquote><pre>
	/opt/sasuapps/spf/globalResources/     &lt;-- this is in the classpath
		...                                &lt;-- misc other external config files go here
		portlet/i18n/                      &lt;-- this is your portlet bundle folder
			html/                          &lt;-- this is your portlet bundle HTML subfolder
				text.html
				text_es_MX.html
				...
			images/                        &lt;-- this is your portlet bundle images subfolder
				picture.jpg
				picture_ja.jpg
				...
			messages.properties
			messages_fr_FR.properties
			...
	</pre></blockquote>
	</li>

	<li>
	<p>Configure Spring properly so it can find those externalized
	message properties relative to the classpath. We recommend you use
	Spring's {@link
	org.springframework.context.support.ReloadableResourceBundleMessageSource}
	class, since that makes your message properties hot-reloadable (ie your
	administrator can update your message bundles without restarting the
	JVM). You would use the same application-context configuration shown
	above, in the discussion of <a href="#i18n.location.internal">internal
	resources</a> (which is why we recommended using <code>portlet/i18n/</code>
	under <code>WEB-INF/classes/</code> above - so that the Spring
	configuration for internal resource access is the same as it is for
	external, so that if you ever change your approach, you will have one
	less configuration to update).</p>
	</li>

	<li>
	<p>If you chose a non-default location for the portlet bundle
	folder, configure it in <a href="#i18n.other.i18n_portlet_config"><code>i18n_portlet_config.properties</code></a>
	(see below). The default location is hardcoded in {@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#BUNDLE_DIR_DEFAULT}, which is
	<code>/opt/sasuapps/spf/globalResources/portlet/i18n</code> (as in the
	above example) at this time of writing.</p>
	</li>

	<li>
	<p>Finally, if you have non-message static resources (images, etc)
	in your portlet bundle folder, and you will be using {@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility} to make URL's for them (eg
	to render in the browser), note that SPF uses a <i>file relay
	servlet</i> (see <a href="#i18n.supporting.relay">discussion below</a>) to
	service those URL's. Deploy that relay servlet in any Web application
	which is <i>both</i> accessible to the end-user browser, and has access
	to the portlet bundle folder. For example, if you are using local
	portlets, you could deploy it in your portal application. By default,
	SPF assumes you have deployed it in your portlet application, mapped
	under the hardcoded {@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#RELAY_PATH_DEFAULT} path. See
	the <a href="#i18n.supporting.relay">discussion below</a> for more
	information about deploying this servlet. If you deploy it in a
	non-default location, you will need to configure that in <a
		href="#i18n.other.i18n_portlet_config"><code>i18n_portlet_config.properties</code></a>.
	</p>
	</li>
</ol>

<p>Then when you use the standard Spring message API's, or the SPF
portlet message API's in {@link
com.hp.it.spf.xa.i18n.portlet.I18nUtility}, or the tag libraries for
either, they will find your message resources in your portlet bundle
folder. And when you use the localized file access API's in <code>I18nUtility</code>,
they will find your static resource files there likewise.</p>

<a name="i18n.location.both">
<h4>2.2.3. Mixing internal and external resources</h4>
</a>

<p>Note that you can mix both the internal and external approaches
for resource management, if you like:</p>

<ul>
	<li>
	<p>If you want to put some resource bundles inside your portlet WAR
	while keeping others external, you can do that. For example, you can
	keep your message bundles inside the WAR while keeping all your images
	in the portlet bundle folder.</p>
	</li>
	<li>
	<p>If you want to split a bundle across locations - eg keeping the
	English (base) files inside the portlet WAR and only keeping your
	localized versions outside - you can also do that.</p>
	</li>
	<li>
	<p>Finally, you can even have identically-named bundle files in
	both locations. For example, you can keep a "default" / "fallback" set
	of bundles inside your portlet WAR, and put "overrides" for them
	outside. SPF will search the portlet bundle folder first, only
	falling-back to look inside the portlet WAR if the resource was not
	found outside.</p>

	<blockquote>
	<p>There are some caveats to this regarding message properties,
	however. SPF uses Spring for access to message resources, and Spring
	searches these in the order set by the system classloader. For the
	"fallback" approach to work, this classloader needs to check inside
	your portlet application <i>last</i>, only after having <i>first</i>
	checked the classpath. You may or may not be able to control the load
	order used by the system classloader in your application server. Test
	it.</p>
	</blockquote>
	</li>
</ul>

<hr>
<a name="i18n.messages.java">
<h3>2.3. Accessing message resources using Java code</h3>
</a>

<p>Once your message resources have been created and placed <a
	href="#i18n.location">as discussed above</a>, you can begin to access
best-fit localized text strings for your user from them in your Java
code. You may use either the standard Spring API's for doing this, or
(recommended) the SPF API's.</p>

<p><b>Note:</b> In either case, be sure you have configured Spring
to load your message resource, as described above. And (if your message
resources are external to your portlet WAR) be sure you have configured
the <i>portlet resource bundle folder</i> where you put them, in your
JVM classpath.</p>

<p><b>Note:</b> In both cases, JSP tag libraries are available for
you to use instead of the raw Java API's. See the <a
	href="#i18n.messages.tags">discussion on this</a> below.</p>

<a name="i18n.messages.java.spring.getMessage">
<h4>2.3.1. Using Spring (eg <code>MessageSource.getMessage</code>)</h4>
</a>

<p>See the Spring documentation for any class implementing {@link
org.springframework.context.MessageSource} - for example, {@link
org.springframework.context.ApplicationContext}. You use one of the <code>getMessage</code>
API's, such as {@link
org.springframework.context.ApplicationContext#getMessage(String,Object[],String,Locale)}.</p>

<p><b>Note:</b> If you use the Spring API's, you will not benefit
from any of the <a href="#i18n.messages.java.spf.getMessage">enhanced
message capabilities</a> supported by the SPF portlet utilities' {@link
com.hp.it.spf.xa.i18n.portlet.I18nUtility} class.</p>

<a name="i18n.messages.java.spf.getMessage">
<h4>2.3.2. Using SPF (<code>I18nUtility.getMessage</code>)</h4>
</a>

<p>SPF's <code>I18nUtility.getMessage</code> API's wrap around
Spring and provide the following extra capability:</p>

<ul>
	<li>
	<p>In the <a href="#i18n.l10n.spf">SPF localization process</a>,
	you can mark sections of your messages which you do <b>not</b> want the
	translators to localize, using the special <code>&lt;no_localization&gt;...&lt;/no_localization&gt;</code>
	tags. The SPF <code>I18nUtility.getMessage</code> API's automatically
	remove these for you; Spring does not.</p>
	<p>For example, in your message properties you can have:</p>
	<blockquote><pre>
key=This part should be translated &lt;no_localization&gt;but this part should not&lt;/no_localization&gt;.
</pre></blockquote>
	<p>SPF's <code>I18nUtility.getMessage</code> API's will
	automatically remove the special <code>&lt;no_localization&gt;...&lt;/no_localization&gt;</code>
	markup from this, if the translator did not do so already.</p>
	</li>
	<li>
	<p>The SPF <code>I18nUtility.getMessage</code> API's let you <i>inject</i>
	<a href="#help.kinds.contextual">contextual help</a> into the middle of
	a message. This can be very useful when you need to use contextual
	help, because by definition contextual help is typically help content
	that is embedded inline with broader text. If you break such text
	apart, so that you can generate standalone contextual help around just
	the text unit needing it, the broader text might become difficult to
	translate correctly. Leaving the text intact, and injecting the
	contextual help into it, is the proper way to do it, and is supported
	by the SPF <code>I18nUtility.getMessage</code> API's.</p>
	<p>For example, you can have the following in your message
	properties:</p>
	<blockquote><pre>
key=Here is some &lt;contextual_help&gt;help&lt;/contextual_help&gt; for you.
</pre></blockquote>
	<p>The SPF <code>I18nUtility.getMessage</code> API's will
	automatically inject the contextual help which you provide around the
	content surrounded by the special <code>&lt;contextual_help&gt;...&lt;/contextual_help&gt;</code>
	markup ("help" in this example). More on this below.</p>
	</li>
</ul>

<p>The <code>I18nUtility.getMessage</code> API's are:</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getMessage(PortletRequest,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getMessage(PortletRequest,String,boolean)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getMessage(PortletRequest,String,ContextualHelpProvider[])}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getMessage(PortletRequest,String,Locale)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getMessage(PortletRequest,String,Object[])}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getMessage(PortletRequest,String,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getMessage(PortletRequest,String,String,Object[],ContextualHelpProvider[],Locale,boolean)}</dt>
</dl>

<p>The last one is the core API which all the others feed into. Here
is a summary of the parameters it takes; the others take a subset of
these. See the method documentation for more information.</p>
<ul>
	<li>
	<p>The current {@link javax.portlet.PortletRequest} (required).</p>
	</li>

	<li>
	<p>The desired message key (required).</p>
	</li>

	<li>
	<p>A <code>String</code> default message value, to be returned
	automatically to you if the given message key is not found. (If no
	explicit default value is provided, then the message key itself is
	returned in that case.)</p>
	</li>

	<li>
	<p>An <code>Object[]</code> array containing any objects whose <code>toString</code>
	values should be inserted into any {@link MessageFormat} placeholders
	in the message. For example, in your message properties you can have:</p>

	<blockquote><pre>
	key=Your user ID is {0}.
	</pre></blockquote>

	<p>Then in your Java code, where <code>request</code> is the <code>PortletRequest</code>
	and <code>userID</code> is the user ID:</p>

	<blockquote><pre>
import com.hp.it.spf.xa.i18n.portlet.I18nUtility;
...
String[] args = new String[] { userID };
String msg = I18nUtility.getMessage(request, "key", args);
	</pre></blockquote>
	</li>

	<li>
	<p>A <code>ContextualHelpProvider[]</code> array containing any
	contextual help you wish to inject into the message.</p>

	<p>For example, let's say you need to produce a UI message like
	this (where the word "secure" links to some contextual help not shown
	yet):</p>

	<img
		src="com/hp/it/spf/xa/i18n/portlet/doc-files/contextualHelpLink.jpg">

	<p>Using the SPF <code>I18nUtility.getMessage</code> API's, you can
	have the following in your message properties:</p>

	<blockquote><pre>
key=Your sign-in is &lt;contextual_help&gt;secure&lt;/contextual_help&gt;
</pre></blockquote>

	<p>Then, in your Java code, you can create a <a
		href="#help.contextual.java"><code>ContextualHelpProvider</code></a>
	(such as a <a
		href="#help.contextual.java.classicContextualHelpProvider"><code>ClassicContextualHelpProvider</code></a>)
	and pass it in this array. The <code>I18nUtility.getMessage</code>
	method will wrap the contextual-help HTML which that <code>ContextualHelpProvider</code>
	yields, around the part of the message surrounded by the special
	&lt;contextual_help&gt;...&lt;/contextual_help&gt; markup - ie the word
	"secure". So then you can just output that message and it will contain
	the embedded contextual help, too.</p>

	<p>Returning to the example, your message properties could look
	like this:</p>

	<blockquote><pre>
key=Your sign-in is &lt;contextual_help&gt;secure&lt;/contextual_help&gt;
key.help.title=Service Portal and your security
key.help.content=Internet security is important to us...
		</pre></blockquote>

	<p>And your code would look like this, where <code>request</code>
	and <code>response</code> are your {@link javax.portlet.PortletRequest}
	and {@link javax.portlet.PortletResponse}, respectively. <b>Note:</b>
	this demonstration uses a <a
		href="#help.contextual.java.classicContextualHelpProvider"><code>ClassicContextualHelpProvider</code></a>
	and does not override any of the default style.</p>

	<blockquote><pre>
import com.hp.it.spf.xa.i18n.portlet.I18nUtility;
import com.hp.it.spf.xa.help.portlet.ClassicContextualHelpProvider;
...
// First get the title for the contextual help.
String helpTitle = I18nUtility.getMessage(request, "key.help.title");
// Now get the main content for the contextual help.
String helpContent = I18nUtility.getMessage(request, "key.help.content");
// Now make the classic contextual help object.  Note we don't have to set
// the link content, as I18nUtility will infer that from the special markup
// in the message.
ClassicContextualHelpProvider cchp = new ClassicContextualHelpProvider(request, response);
cchp.setTitleContent(helpTitle);
cchp.setHelpContent(helpContent);
// Now get the main message, with the contextual help embedded automatically
// inside it.
ClassicContextualHelpProvider[] cchps = new ClassicContextualHelpProvider[] {cchp};
String msg = I18nUtility.getMessage(request, "key", cchps);
		</pre></blockquote>

	<p>So then you could output the <code>msg</code> string to the user
	- it would look like above when rendered in the user's browser. And
	when the user clicked on the "secure" hyperlink, it would look like
	this:</p>

	<img src="com/hp/it/spf/xa/i18n/portlet/doc-files/contextualHelp.jpg"></li>

	<p>Please see the <code>I18nUtility.getMessage</code> method
	documentation for more details about passing contextual help providers.
	Also see the discussion on <a href="#help.kinds.contextual">contextual
	help</a> later in this guide and in the JavaDocs - eg see the {@link
	com.hp.it.spf.xa.help.portlet.ClassicContextualHelpProvider}
	documentation.</p>

	<p>Also, note that the above example illustrates the use of the
	SPF-provided "classic" rendition of contextual help (ie the {@link
	com.hp.it.spf.xa.help.portlet.ClassicContextualHelpProvider} class).
	The SPF contextual-help framework is extensible to custom formats of
	contextual help, where you write and then utilize your own contextual
	help provider - see the discussion below about <a
		href="#help.contextual.java.contextualHelpProvider">creating your
	own contextual help provider</a>.</p>

	<blockquote>
	<p><b>Note:</b> The classic rendition of contextual help utilizes
	an "X" image on which the user can click to close the window. This is a
	GIF image which you must supply (either inside your portlet
	application, or in the external resource bundle folder). You can
	localize the image if desired. Name the base file for the image <code>btn_close.gif</code>
	and put it in the <code>images/</code> subfolder (of your portlet WAR
	or the external folder). Management of this image is the same as for
	any other supporting resource file.</p>

	<p>The SPF portlet utilities JAR contains a sample <code>btn_close.gif</code>.
	(It is the same one shown in the example above.)</p>
	</blockquote>

	<li>
	<p>A <code>Locale</code> for which to find the best-fitting message
	resource. (By default, the method uses the locale contained inside your
	<code>PortletRequest</code>.)</p>
	</li>

	<li>
	<p>A <code>boolean</code> switch which controls whether to escape
	any HTML meta-characters, like <code>&lt;</code> and <code>&gt;</code>,
	found in the message string. For example, if your message property is
	this:</p>

	<blockquote><pre>
key=This is an HTML &lt;head&gt; tag.
</pre></blockquote>

	<p>Then the following code would escape the HTML inside the message
	string (where <code>request</code> is your current {@link
	javax.portlet.PortletRequest}:</p>

	<blockquote><pre>
import com.hp.it.spf.xa.i18n.portlet.I18nUtility;
...
String msg = I18nUtility.getMessage(request, "key", true);
// Now msg is: This is an HTML&amp;lt;head&amp;gt; tag.
	</pre></blockquote>

	<p>If you use this with a message string that contains contextual
	help, note that this policy will apply to the contextual help's title
	and content as well.</p>
	</li>
</ul>

<hr>

<a name="i18n.messages.tags">
<h3>2.4. Accessing message resources using JSP tag libraries</h3>
</a>

<p>Once your message resources have been created and placed <a
	href="#i18n.location">as discussed above</a>, you can begin to access
best-fit localized text strings for your user from them in your JSP's.
You may use either the standard Spring JSP tag libraries for doing this,
or (recommended) the SPF ones.</p>

<p><b>Note:</b> In either case, be sure you have configured Spring
to load your message resource, as described above. And (if your message
resources are external to your portlet WAR) be sure you have configured
the <i>portlet resource bundle folder</i> where you put them, in your
JVM classpath. See the <a href="#i18n.location">discussion above</a>.</p>

<p><b>Note:</b> In both cases, raw Java API's are available for you
to use if you prefer, instead of the JSP tag libraries. See the <a
	href="#i18n.messages.java">API descriptions</a> above.</p>

<a name="i18n.messages.jsp.spring.message">
<h4>2.4.1. Using Spring (<code>&lt;spring:message&gt;</code>)</h4>
</a>

<p>See the Spring documentation for any Spring JSP tag interface for
{@link org.springframework.context.MessageSource} - for example, <a
	href="http://static.springframework.org/spring/docs/1.1.5/taglib/tag/MessageTag.html"><code>&lt;spring:message&gt;</code></a>.
</p>

<p><b>Note:</b> If you use the Spring tags, you will not benefit
from any of the <a href="#i18n.messages.jsp.spf.message">enhanced
message capabilities</a> supported by the SPF portlet utility tags.</p>

<a name="i18n.messages.jsp.spf.message">
<h4>2.4.2. Using SPF (<code>&lt;spf-i18n-portlet:message&gt;</code>,
<code>&lt;spf-i18n-portlet:param&gt;</code>, and <code>&lt;spf-i18n-portlet:classicContextualHelpParam&gt;</code>)</h4>
</a>

<p>The SPF portlet utilities provide a JSP tag library which wraps
around <a href="#i18n.java.spf.getMessage"><code>I18nUtility.getMessage</code></a>
to offer the same extended message-handling capabilities. Just as with <code>I18nUtility.getMessage</code>,
with the SPF portlet utilities' message-handling JSP tags, you can:</p>

<ul>
	<li>
	<p>Use <code>&lt;no_localization&gt;...&lt;/no_localization&gt;</code>
	in your message values to signal to translators that they should leave
	the contents untranslated - the SPF will automatically remove that
	markup if the translator did not do so already.</p>
	</li>

	<li>
	<p>Use <code>&lt;contextual_help&gt;...&lt;/contextual_help&gt;</code>
	in your message values to inject contextual help into the middle of a
	message (thus avoiding possible translation problems which could occur
	if you broke the message into pieces and used standalone contextual
	help).</p>
	</li>
</ul>

<p>The SPF message-handling tags are thoroughly documented in the <a
	href="com/hp/it/spf/xa/i18n/portlet/tag/package-summary.html#message">package
description</a>. Briefly, they are:</p>

<dl>
	<dt>
	<p><a
		href="com/hp/it/spf/xa/i18n/portlet/tag/package-summary.html#message"><code>&lt;spf-i18n-portlet:message&gt;</code></a></p>
	</dt>

	<dd>
	<p>This tag is the main message tag for the SPF. It takes a message
	key and (optionally) a default value and a boolean switch for
	HTML-escaping the message value. The usage is:</p>

	<blockquote><pre>
&lt;%@ taglib prefix="spf-i18n-portlet" uri="/spf-i18n-portlet.tld" %&gt;
...
&lt;spf-i18n-portlet:message
	key="<i>message-key</i>"
	defaultValue="<i>default-value</i>"
	escape="<i>true-or-false</i>"
	/&gt;
</pre></blockquote>
	</dd>

	<p>For example, consider this message property in your resource
	bundle:</p>

	<blockquote><pre>
key=This is an HTML &lt;head&gt; tag.
</pre></blockquote>

	<p>If you wanted the HTML embedded inside the message value to
	render literally, you would use this:</p>

	<blockquote><pre>
&lt;%@ taglib prefix="spf-i18n-portlet" uri="/spf-i18n-portlet.tld" %&gt;
...
&lt;spf-i18n-portlet:message key="key" escape="true" /&gt;
</pre></blockquote>

	<p>In addition, the body of the <code>&lt;spf-i18n-portlet:message&gt;</code>
	tag may contain either or both of the following tags, zero or more
	times.</p>

	<dt>
	<p><a
		href="com/hp/it/spf/xa/i18n/portlet/tag/package-summary.html#param"><code>&lt;spf-i18n-portlet:param&gt;</code></a></p>
	</dt>
	<dd>
	<p>This tag is only used inside the tag body of <code>&lt;spf-i18n-portlet:message&gt;</code>.
	You use it to pass a string into a {@link MessageFormat} placeholder in
	the message value. The usage is:</p>

	<blockquote><pre>
&lt;%@ taglib prefix="spf-i18n-portlet" uri="/spf-i18n-portlet.tld" %&gt;
...
&lt;spf-i18n-portlet:param value="<i>string</i>" /&gt;
</pre></blockquote>

	<p>For example, if your message properties contain this:</p>

	<blockquote><pre>
key=Your name is {0} and your age is {1}.
</pre></blockquote>

	<p>Then you would populate the parameters with the <code>name</code>
	and <code>age</code> variables as follows:</p>

	<blockquote><pre>
&lt;%@ taglib prefix="spf-i18n-portlet" uri="/spf-i18n-portlet.tld" %&gt;
...
&lt;spf-i18n-portlet:message key="key"&gt;
	&lt;spf-i18n-portlet:param value="&lt;%= name %&gt;" /&gt;
	&lt;spf-i18n-portlet:param value="&lt;%= age %&gt;" /&gt;
&lt;/spf-i18n-portlet:message&gt;
</pre></blockquote>
	</dd>

	<dt>
	<p><a
		href="#help.contextual.jsp.classicContextualHelpProviderParam"><code>&lt;spf-i18n-portlet:classicContextualHelpParam&gt;</code></a></p>
	</dt>
	<dd>
	<p>This tag is only used inside the tag body of <code>&lt;spf-i18n-portlet:message&gt;</code>.
	You use it to inject contextual help into the message value, where the
	special <code>&lt;contextual_help&gt;...&lt;/contextual_help&gt;</code>
	markup is found. The format of contextual help which is injected is the
	"classic" rendition.</p>

	<p>This tag is documented in the <a href="#help">Online Help</a>
	section in this guide. Please see the <a
		href="#help.contextual.jsp.classicContextualHelpProviderParam"><code>&lt;spf-i18n-portlet:classicContextualHelpParam&gt;</code></a>
	documentation there.</p>
	</dd>

	<dt>
	<p><a href="#help.contextual.jsp.contextualHelpProvider">Parameters
	for custom renditions of contextual help</a></p>
	</dt>
	<dd>
	<p>The SPF provides you with the <code>&lt;spf-i18n-portlet:classicContextualHelpParam&gt;</code>
	(see above) which gives you a JSP tag for injecting the "classic"
	rendition of contextual help into a message. The SPF contextual help
	framework is extensible, however, and you can create your own rendition
	of contextual help instead. First you would <a
		href="#help.contextual.java.contextualHelpProvider">create your
	custom contextual help provider</a>, then you would <a
		href="#help.contextual.jsp.contextualHelpProvider">create a custom
	contextual help provider parameter tag</a> for it. Please see the
	documentation below.</p>
	</dd>
</dl>

<p>The SPF message-handling tags are thoroughly documented in the <a
	href="com/hp/it/spf/xa/i18n/portlet/tag/package-summary.html#message">package
description</a>. Please see that documentation for more information.</p>

<hr>

<a name="i18n.supporting.java">
<h3>2.5. Accessing supporting resources using Java code</h3>
</a>

<p>Once your supporting resources have been created and placed <a
	href="#i18n.location.supporting">as discussed above</a>, you can begin
to access them using the SPF portlet <code>I18nUtility</code>. There are
3 ways of access supported:</p>

<ul>
	<li>
	<p>You can get a URL pointing to the particular supporting resource
	file in a bundle which best-fits the user's locale. You can then output
	that URL to the user - for example, inside an HTML <code>&lt;IMG&gt;</code>
	tag as the <code>SRC</code> attribute, to display the proper localized
	version of any image to the user. Use the <a
		href="#i18n.supporting.java.getLocalizedFileURL"><code>I18nUtility.getLocalizedFileURL</code></a>
	methods for this.</p>
	</li>

	<li>
	<p>If you need to process the file server-side instead, you can get
	an {@link InputStream} for the particular one which best-fits the
	user's locale. Use the <a
		href="#i18n.supporting.java.getLocalizedFileStream"><code>I18nUtility.getLocalizedFileStream</code></a>
	methods for this.</p>
	</li>

	<li>
	<p>If you need to just check what the best-fit localized file in a
	particular supporting resource would be, and whether it exists, then
	you can use the <a href="#i18n.supporting.java.getLocalizedFileName"><code>I18nUtility.getLocalizedFileName</code></a>
	methods for this.</p>
	</li>
</ul>

<p><b>Note:</b> In all of these cases, if you are putting your
supporting resource files in the portlet bundle folder outside of the
WAR, you will need to configure <a
	href="#i18n.other.i18n_portlet_config"><code>i18n_portlet_config.properties</code></a>
properly if your portlet bundle folder is not in the default location
(indicated in {@link
com.hp.it.spf.xa.i18n.portlet.I18nUtility#BUNDLE_DIR_DEFAULT}).</p>

<a name="i18n.supporting.java.getLocalizedFileURL">
<h4>2.5.1. Using <code>I18nUtility.getLocalizedFileURL</code></h4>
</a>

<p><b>Note:</b> There is an SPF-provided JSP tag library for this -
see <a href="#i18n.supporting.jsp.localizedFileURL"><code>&lt;spf-i18n-portlet:localizedFileURL&gt;</code></a>
description below.</p>

<p>These methods return a URL string which the user's browser can
use to access the proper localized version of a supporting resource, for
the user's locale. The <code>I18nUtility.getLocalizedFileURL</code>
methods use the Java-standard {@link ResourceBundle} sequence for
finding the best-fit file in your bundle for the user's locale. Your
bundle of supporting resource files can be located inside your portlet
WAR, or in the <i>portlet resource bundle directory</i> outside of the
WAR, or in both locations, <a href="#i18n.location.supporting">as
discussed above</a>.</p>

<p>The returned URL string will be properly encoded for the portlet
(taking into account WSRP and the portal as needed), and thus ready to
output to the user (eg, in the <code>SRC</code> attribute of an HTML <code>&lt;IMG&gt;</code>
tag).</p>

<ul>
	<li>
	<p>If the best-fit localized file is found in the portlet bundle
	folder outside of the WAR, then the returned URL string will be a relay
	servlet URL pointing to that file. This URL will be built pointing to
	the URL for the relay servlet which you configured in <a
		href="#i18n.other.i18n_portlet_config"><code>i18n_portlet_config.properties</code></a>
	(or, by default, it will be assumed to be deployed under the {@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#RELAY_PATH_DEFAULT} in the
	current portlet application). Be sure you have configured and deployed
	the relay servlet properly at that URL. See the <a
		href="#i18n.supporting.relay">discussion below</a> for more
	information.</p>
	</li>
	<li>
	<p>If the best-fit localized file is found inside the portlet WAR
	itself, then the returned URL string will be a static resource string
	pointing to that file.</p>
	</li>
</ul>

<p>The <code>I18nUtility.getLocalizedFileURL</code> methods are:</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileURL(PortletRequest,PortletResponse,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileURL(PortletRequest,PortletResponse,String,boolean)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileURL(PortletRequest,PortletResponse,String,Locale,boolean)}</dt>
	<dd>
	<p>These methods take the base filename of the supporting resource
	bundle. That filename may include any subfolder (relative to the
	portlet bundle directory / portlet WAR root) where the bundle is
	located.</p>

	<p>For example, to get the best-fit localized URL for the <code>picture.jpg</code>
	image, where the bundle is stored in the <code>images/</code> subfolder
	(and where <code>request</code> and <code>response</code> are the
	{@link javax.portlet.PortletRequest} and {@link
	javax.portlet.PortletResponse} respectively):</p>

	<blockquote><pre>
import com.hp.it.spf.xa.i18n.portlet.I18nUtility;
...
String url = I18nUtility.getLocalizedFileURL(request, response, "/images/picture.jpg");
	</pre></blockquote>

	<p>If the best-fit localized version of <code>picture.jpg</code>
	was found in the portlet bundle folder, then <code>url</code> in this
	example would be a file-relay servlet URL pointing to that file. For
	example, if <code>picture_pt_BR.jpg</code> (ie the Brazil Portuguese
	version of the file) was the best candidate, then <code>url</code>
	would get a URL string containing the portlet-encoded form of <code>/relay/images/picture_pt_BR.jpg</code>
	(assuming the default setup of the relay servlet, which is under the <code>/relay</code>
	location mapping in the current portlet application).</p>

	<p>On the other hand, if the best-fit localized version of <code>picture.jpg</code>
	was found inside the portlet WAR, then <code>url</code> in this example
	would be a static resource URL pointing to it. For example, it would be
	the portlet-encoded form of <code>/images/picture_pt_BR.jpg</code>.</p>

	<p>If the resource bundle for the given base name simply is not
	found, then a static resource URL pointing to the basename (eg <code>/images/picture.jpg</code>)
	would be returned by default. (This will cause a 404 error if later
	opened by the browser, making a missing resource obvious and detectable
	during testing.)</p>

	<p>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileURL(PortletRequest,PortletResponse,String,Locale,boolean)}
	is the core API which all the others feed into. Here is a summary of
	the parameters it takes; the others take a subset of these. See the
	method documentation for more information.</p>

	<ul>
		<li>
		<p>The current {@link javax.portlet.PortletRequest} (required).</p>
		</li>
		<li>
		<p>The current {@link javax.portlet.PortletResponse} (required).</p>
		</li>
		<li>
		<p>The base filename (required).</p>
		</li>
		<li>
		<p>The {@link java.util.Locale} to use when searching for the
		best-fit candidate file. By default, the locale inside the <code>PortletRequest</code>
		is used.</p>
		</li>
		<li>
		<p>The boolean switch, set to <code>false</code>, lets you just
		lookup the given base file itself, without attempting to find the best
		candidate. By default, this switch is <code>true</code> (enabling the
		best-localized-candidate search).</p>
		</li>
	</ul>
	</dd>

	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileURL(PortletRequest,PortletResponse,String,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileURL(PortletRequest,PortletResponse,String,String,Locale)}</dt>
	<dd>
	<p>These methods get the localized file differently. You give them
	a message key and they lookup that message in your message resource
	bundles. This message lookup proceeds as described for the <a
		href="#i18n.messages.java.spf.getMessage"><code>I18nUtility.getMessage</code></a>
	API's above. The message value is then treated as the name of the
	localized (not base) file. The subfolder relative to the portlet bundle
	folder or portlet WAR, where the file is located, may be part of that
	value. If no actual file exists (as either an external or internal
	resource) matching that value, then a static resource URL pointing to
	it anyway will be returned. (As above, this will intentionally cause a
	404 error should the browser open it.)</p>

	<blockquote>
	<p><b>Note:</b>These methods offer no real advantage over the
	others, since they are more cumbersome to setup (you need to make sure
	that the proper localized filenames for each locale get put - eg by the
	translators - into the message properties file for that locale).
	Therefore we recommend using the other methods.</p>
	</blockquote>

	<p>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileURL(PortletRequest,PortletResponse,String,String,Locale)}
	is the core API which the other method feeds into. Here is a summary of
	the parameters it takes; the other method takes a subset of these. See
	the method documentation for more information.</p>

	<ul>
		<li>
		<p>The current {@link javax.portlet.PortletRequest} (required).</p>
		</li>
		<li>
		<p>The current {@link javax.portlet.PortletResponse} (required).</p>
		</li>
		<li>
		<p>The message key string for the localized filename (required).</p>
		</li>
		<li>
		<p>The default value string to use for the localized filename, if
		the message is not found.</p>
		<li>
		<p>The {@link java.util.Locale} to use when searching for the
		best-fit candidate file. By default, the locale inside the <code>PortletRequest</code>
		is used.</p>
		</li>
	</ul>
	</dd>
</dl>

<a name="i18n.supporting.java.getLocalizedFileStream">
<h4>2.5.2. Using <code>I18nUtility.getLocalizedFileStream</code></h4>
</a>

<p>Instead of returning a URL string, these methods return an {@link
InputStream} for the proper localized version of a supporting resource,
given the user's locale. If no appropriate file could be found, then
they return <code>null</code>. Otherwise they operate the same as the <a
	href="#i18n.supporting.java.getLocalizedFileURL"><code>I18nUtility.getLocalizedFileURL</code></a>
methods (see above).
<p>The <code>I18nUtility.getLocalizedFileStream</code> methods are:</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileStream(PortletRequest,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileStream(PortletRequest,String,boolean)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileStream(PortletRequest,String,Locale,boolean)}</dt>
	<dd>
	<p>These methods take the base filename of the supporting resource
	bundle. Building on the above example, here is how we get an <code>InputStream</code>
	for the <code>something.xml</code> file. This file (and its localized
	versions) in this example are stored in the <code>xml/</code> subfolder
	of either the portlet WAR or the <i>portlet resource bundle folder</i>.</p>

	<blockquote><pre>
import com.hp.it.spf.xa.i18n.portlet.I18nUtility;
...
InputStream file = I18nUtility.getLocalizedFileStream(request, "/xml/something.xml");
	</pre></blockquote>

	<p>So, if the best-fit localized file in the <code>something.xml</code>
	bundle was <code>something_ja_JP.xml</code>, then that is the <code>InputStream</code>
	that will be returned. <code>null</code> is returned if no good
	candidate exists.</p>

	<p>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileStream(PortletRequest,String,Locale,boolean)}
	is the core API which the others feed into. Here is a summary of the
	parameters it takes; the others take a subset of these. See the method
	documentation for more information.</p>

	<ul>
		<li>
		<p>The current {@link javax.portlet.PortletRequest} (required).</p>
		</li>
		<li>
		<p>The base filename (required).</p>
		</li>
		<li>
		<p>The {@link java.util.Locale} to use when searching for the
		best-fit candidate file. By default, the locale inside the <code>PortletRequest</code>
		is used.</p>
		</li>
		<li>
		<p>The boolean switch, set to <code>false</code>, lets you just
		lookup the given base file itself, without attempting to find the best
		candidate. By default, this switch is <code>true</code> (enabling the
		best-localized-candidate search).</p>
		</li>
	</ul>
	</dd>

	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileStream(PortletRequest,String,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileStream(PortletRequest,String,String,Locale)}</dt>
	<dd>
	<p>This method gets the localized file differently. You give it a
	message key and it looks up that message in your message resource
	bundles. The message value is then treated as the name of the localized
	(not base) file, and an <code>InputStream</code> is returned for it (or
	<code>null</code> if it does not exist).</p>

	<blockquote>
	<p><b>Note:</b>Using this method offers no real advantage over the
	others, and is more cumbersome to setup (you need to make sure that the
	proper localized filenames for each locale, get into the message
	properties file for that locale). Therefore we recommend using the
	other methods.</p>
	</blockquote>

	<p>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileStream(PortletRequest,String,String,Locale)}
	is the core API which the other method feeds into. Here is a summary of
	the parameters it takes; the other method takes a subset of these. See
	the method documentation for more information.</p>

	<ul>
		<li>
		<p>The current {@link javax.portlet.PortletRequest} (required).</p>
		</li>
		<li>
		<p>The message key string for the localized filename (required).</p>
		</li>
		<li>
		<p>The default value string to use for the localized filename, if
		the message is not found.</p>
		<li>
		<p>The {@link java.util.Locale} to use when searching for the
		best-fit candidate file. By default, the locale inside the <code>PortletRequest</code>
		is used.</p>
		</li>
	</ul>
	</dd>
</dl>

<a name="i18n.supporting.java.getLocalizedFileName">
<h4>2.5.3. Using <code>I18nUtility.getLocalizedFileName</code></h4>
</a>

<p>Instead of returning either a URL string or an <code>InputStream</code>,
these methods just lookup the best-fit localized version of the file for
the user's locale, and return its filename. The filename is returned
relative to the location where the file was found (ie, relative to the <i>portlet
resource bundle folder</i> or portlet WAR root). The methods return <code>null</code>
if no good candidate was found. These methods are most useful as a test
of whether a particular resource exists, and where it exists (is it
internal or external).</p>

<p>The <code>I18nUtility.getLocalizedFileName</code> methods are:</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileName(PortletRequest,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileName(PortletRequest,String,boolean)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileName(PortletRequest,String,Locale,boolean)}</dt>
	<dd>
	<p>These methods take the base filename of the supporting resource
	bundle, and <b>only</b> look inside the portlet application WAR.
	Building on the above example, here is how we check whether any
	good-candidate localized version of <code>something.xml</code> exists
	in the portlet WAR (in the <code>xml/</code> subfolder):</p>

	<blockquote><pre>
import com.hp.it.spf.xa.i18n.portlet.I18nUtility;
...
if (I18nUtility.getLocalizedFileName(request, "/xml/something.xml") != null) {
... // exists in portlet WAR
}
	</pre></blockquote>

	<p>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileName(PortletRequest,String,Locale,boolean)}
	is the core API which the others feed into. Here is a summary of the
	parameters it takes; the others take a subset of these. See the method
	documentation for more information.</p>

	<ul>
		<li>
		<p>The current {@link javax.portlet.PortletRequest} (required).</p>
		</li>
		<li>
		<p>The base filename (required).</p>
		</li>
		<li>
		<p>The {@link java.util.Locale} to use when searching for the
		best-fit candidate file. By default, the locale inside the <code>PortletRequest</code>
		is used.</p>
		</li>
		<li>
		<p>The boolean switch, set to <code>false</code>, lets you just
		lookup the given base file itself, without attempting to find the best
		candidate. By default, this switch is <code>true</code> (enabling the
		best-localized-candidate search).</p>
		</li>
	</ul>
	</dd>

	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileName(String,Locale)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileName(String,Locale,boolean)}</dt>
	<dd>
	<p>These methods take the base filename of the supporting resource
	bundle, and <b>only</b> look in the <i>portlet resource bundle
	folder</i>. Building on the above example, here is how we check whether any
	good-candidate localized version of <code>something.xml</code> exists
	in the portlet bundle folder (in the <code>xml/</code> subfolder):</p>

	<blockquote><pre>
import com.hp.it.spf.xa.i18n.portlet.I18nUtility;
...
if (I18nUtility.getLocalizedFileName("/xml/something.xml", request.getLocale()) != null) {
... // exists in portlet bundle folder
}
	</pre></blockquote>

	<p>{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#getLocalizedFileName(String,Locale,boolean)}
	is the core API which the other method feeds into. Here is a summary of
	the parameters it takes; the other method takes a subset of these. See
	the method documentation for more information.</p>

	<ul>
		<li>
		<p>The base filename (required).</p>
		</li>
		<li>
		<p>The {@link java.util.Locale} to use when searching for the
		best-fit candidate file (required)</p>
		</li>
		<li>
		<p>The boolean switch, set to <code>false</code>, lets you just
		lookup the given base file itself, without attempting to find the best
		candidate. By default, this switch is <code>true</code> (enabling the
		best-localized-candidate search).</p>
		</li>
	</ul>
	</dd>
</dl>

<hr>

<a name="i18n.supporting.jsp">
<h3>2.6. Accessing supporting resources using JSP tag libraries</h3>
</a>

<p>Once your supporting resources have been created and placed <a
	href="#i18n.location.supporting">as discussed above</a>, you can begin
to generate best-fit localized URL's for them in your JSP's. For
example, you can stick them into HTML <code>&lt;IMG&gt;</code> tag <code>SRC</code>
attributes.</p>

<p><b>Note:</b> Remember, if you are putting your supporting
resource files in the portlet bundle folder outside of the WAR, you will
need to configure <a href="#i18n.other.i18n_portlet_config"><code>i18n_portlet_config.properties</code></a>
properly if your portlet bundle folder is at a non-default location (the
default is indicated in {@link
com.hp.it.spf.xa.i18n.portlet.I18nUtility#BUNDLE_DIR_DEFAULT}). You will
likewise need to configure <a href="#i18n.other.i18n_portlet_config"><code>i18n_portlet_config.properties</code></a>
with the URL for the relay servlet, if that is at a non-default location
(the default is indicated in {@link
com.hp.it.spf.xa.i18n.portlet.I18nUtility#RELAY_SERVLET_PATH}). And
finally, you will need to configure and deploy that servlet at that
location - see <a href="#i18n.supporting.relay">discussion below</a>.</p>

<a name="i18n.supporting.jsp.localizedFileURL">
<h4>2.6.1. Using <code>&lt;spf-i18n-portlet:localizedFileURL&gt;</code></h4>
</a>

<p>The SPF portlet utilities provide a JSP tag, <code>&lt;spf-i18n-portlet:localizedFileURL&gt;</code>,
which wraps around <a href="#i18n.java.spf.getLocalizedFileURL"><code>I18nUtility.getLocalizedFileURL</code></a>
to offer most of the same capabilities. It is thoroughly documented in
the <a
	href="com/hp/it/spf/xa/i18n/portlet/tag/package-summary.html#getLocalizedFileURL">package
description</a>. Briefly:</p>

<dl>
	<dt>
	<p><a
		href="com/hp/it/spf/xa/i18n/portlet/tag/package-summary.html#localizedFileURL"><code>&lt;spf-i18n-portlet:localizedFileURL&gt;</code></a></p>
	</dt>

	<dd>
	<p>This tag takes the base filename (including any subfolder path
	relative to the portlet resource bundle folder / portlet WAR root), or
	(optionally) a message key for a message resource which indicates the
	localized file name. The usage is:</p>

	<blockquote><pre>
&lt;%@ taglib prefix="spf-i18n-portlet" uri="/spf-i18n-portlet.tld" %&gt;
...
&lt;spf-i18n-portlet:localizedFileURL
	file="<i>base-file</i>"
	fileKey="<i>localized-file-message-key</i>"
	/&gt;
</pre></blockquote>

	<p>The <code>file</code> attribute lets you provide the base
	filename (same as the {@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility.getLocalizedFileURL(PortletRequest,PortletResponse,String)}
	method). The <code>fileKey</code> attribute lets you alternatively
	provide a message key pointing to the localized filename (same as the
	{@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility.getLocalizedFileURL(PortletRequest,PortletResponse,String,String)}
	method). The <code>file</code> attribute takes priority. As mentioned
	above, there usually is no reason to prefer doing this using the <code>fileKey</code>
	attribute.</p>

	<p>For example, imagine we have the <code>picture.jpg</code> bundle
	of images in our <code>images/</code> folder. The following JSP code
	displays the proper localized version of that image in the browser:</p>

	<blockquote><pre>
&lt;%@ taglib prefix="spf-i18n-portlet" uri="/spf-i18n-portlet.tld" %&gt;
...
&lt;img src='&lt;spf-i18n-portlet:localizedFileURL file="/images/picture.jpg" /&gt;'&gt;
</pre></blockquote>

	<p>If you put the localized file into the <i>portlet resource
	bundle folder</i>, this URL will be a relay servlet URL (properly
	portlet-encoded for WSRP and the portal, as needed). Otherwise (ie you
	put the localized file into your portlet application), this URL will be
	a static resource URL for your application (again, properly-encoded).</p>

	<p>See the tag documentation, in the <a
		href="com/hp/it/spf/xa/i18n/portlet/tag/package-summary.html#localizedFileURL">package
	description</a>, for more information.</p>
	</dd>
</dl>

<hr>

<a name="i18n.supporting.relay">
<h3>2.7. Providing download service for external resources using <code>RelayServlet</code></h3>
</a>

<p>The <i>file relay servlet</i> is an SPF-provided servlet which
services download requests for supporting resource files in the <i>portlet
resource bundle folder</i>. If you are using <a
	href="#i18n.location.external">external resources</a> for supporting
files like images, video, etc, then when you use <a
	href="#i18n.supporting.java.getLocalizedFileURL"><code>I18nUtility.getLocalizedFileURL</code></a>
(or the <a href="#i18n.supporting.jsp.localizedFileURL"><code>&lt;spf-i18n-portlet:localizedFileURL&gt;</code></a>
tag) you will get a URL pointing to this servlet (with the actual
filename as a parameter in the URL). So if you give that URL to a
browser to open, it will be the relay servlet which services that
request.</p>

<p>The relay servlet itself is provided with the SPF portlet
utilities, {@link com.hp.it.spf.xa.relay.servlet.RelayServlet}. All you
need to do is configure and deploy it somewhere. We recommend you deploy
it as part of your portlet application WAR. Alternatively, you can
deploy it in another Web application (such as your portal application,
if your portal server has access to the portlet bundle folder - as in
the case of local portlets). The basic requirements are that, if you do
deploy it elsewhere, that Web application must have access to the
portlet bundle folder, and must in turn be accessible from the user
browser.</p>

<p>The basic steps for configuring and deploying the relay servlet
are documented fully in the <a
	href="com/hp/it/spf/xa/relay/servlet/package-summary.html">package
description</a>. Briefly, they are:</p>

<ol>
	<li><a
		href="com/hp/it/spf/xa/relay/servlet/package-summary.html#web.xml">Configure
	<code>web.xml</code></a> - provide the deployment descriptor for the
	servlet</li>
	<li><a
		href="com/hp/it/spf/xa/relay/servlet/package-summary.html#init_relay.properties">Configure
	<code>init_relay.properties</code> (optional)</a> - provide any non-default
	permitted file extensions and their MIME types</li>
	<li><a
		href="com/hp/it/spf/xa/relay/servlet/package-summary.html#i18n_portlet_config.properties">Configure
	<code>i18n_portlet_config.properties</code> (optional)</a> - provide any
	non-default portlet bundle folder or relay servlet location</li>
	<li><a
		href="com/hp/it/spf/xa/relay/servlet/package-summary.html#deployment">Assembling
	the application</a> - assemble the needed artifacts into the application
	WAR</li>
</ol>

<p>Please see the above-referenced documentation for more
information.</p>

<hr>

<a name="i18n.l10n">
<h3>2.8. Localizing your resources</h3>
</a>

<p>You can localize your resources (message property files, images,
HTML files, etc) in whatever way you see fit. The only requirements are:
</p>

<ul>
	<li>
	<p>For text resources, you must use UTF-8 character encoding.</p>
	</li>

	<li>
	<p>For Java message property files only, remember that Java's
	standard {@link java.util.Properties} class is the basis for loading
	those files into the system, and this class cannot load non-ASCII,
	UTF-8 characters natively. Therefore you must use the Java-standard <a
		href="http://java.sun.com/j2se/1.4.2/docs/tooldocs/solaris/native2ascii.html"><code>native2ascii</code></a>
	tool to convert your non-ASCII UTF-8-encoded characters into ASCII
	representation (specifically, into Java's supported <code>\uXXXX</code>
	string format for Unicode escape sequences).</p>
	</li>

	<li>
	<p>All localized resource files must be tagged with their
	respective locale as per the Java standard for {@link
	java.util.ResourceBundle}. This was already described in the section
	about <a href="#i18n.resources.bundles">resource bundles</a>, earlier
	in this document.</p>
	</li>
</ul>

<a name="i18n.l10n.spf">
<h4>2.8.1 The SPF localization process</h4>
</a>

<p>The Shared Portal Framework provides tools and support for a
localization process using HP's Translation and Localization (T&L) team.
This is a batch (not real-time) process combining manual and automated
activities. In this process:</p>

<ol>
	<li>
	<p>You <i>extract</i> your base (English) message and supporting
	resource files requiring localization from the system. You can do this
	in the lab (eg checkout from a your revision-control system) or in a
	run-time environment (eg extract from the base files already deployed
	in production).</p>
	</li>

	<li>
	<p>You <i>convert and pack</i> the base files for the T&L team,
	using an SPF-provided perl script, <code>xlate_send.pl</code>. For
	example, this removes any Vignette-internal message properties that
	never need localization, and packs your files into the T&L team's
	required format.</p>
	</li>

	<li>
	<p>You <i>send</i> the packed base files to the T&L team and
	request the needed locales.</p>
	</li>

	<li>
	<p>The T&L team <i>translates</i> them for you.</p>
	</li>

	<li>
	<p>You <i>receive</i> the translated files from the T&L team.</p>
	</li>

	<li>
	<p>You <i>unpack and convert</i> the translated files from the T&L
	team, using an SPF-provided perl script, <code>xlate_receive.pl</code>.
	For example, this unpacks the files from the T&L team's delivery
	format, and runs <a
		href="http://java.sun.com/j2se/1.4.2/docs/tooldocs/solaris/native2ascii.html"><code>native2ascii</code></a>
	for you against the translated message property files.</p>
	</li>

	<li>
	<p>Finally, you <i>deploy</i> your translations to the system. You
	can do this in the lab (eg checkin to your revision-control system) or
	in a run-time environment (eg deploy the translations directly to
	production).
	</li>
</ol>

<p>This process is not further documented in this guide. It is
covered in the <a href="TBD">SPF Localization Guide</a> (<b><font
	color="blue">TBD</font></b>).</p>

<hr>

<a name="i18n.other">
<h3>2.9. Other internationalization topics</h3>
</a>

<p>This section covers miscellaneous other topics in the subject
area of internationalization.</p>

<a name="i18n.other.locale.get">
<h4>2.9.1. Getting the locale</h4>
</a>

<p>Use the Java portlet standard API for this, {@link
javax.portlet.PortletRequest#getLocale()}. As follows (where <code>request</code>
is your <code>PortletRequest</code>):</p>

<blockquote><pre>
Locale loc = request.getLocale();
</pre></blockquote>

<p>This returns the locale to use in general when handling this
portlet request. Many of the internationalization API's and tags
documented above assume this locale (but the API's all provide
signatures letting you pass another locale if needed).</p>

<p>Where does the locale come from? In SPF, for simplicity, the user
is considered to have one preferred locale at any given time. The SPF
portal framework has the responsibility of resolving that locale from
numerous sources:</p>

<ol>
	<li>The SPF locale resolver accepts desired locales from the user
	according to the following inputs (in order):
	<ol>
		<li>The HP.com-standard <code>lang</code> and <code>cc</code>
		query parameters on the URL.</li>
		<li>The HP.com-standard <code>lang</code> and <code>cc</code>
		cookies.</li>
		<li>The HP Passport core user profile attribute, <code>langCode</code>.
		(Note that the HP Passport <code>residentCountryCode</code> core
		profile attribute is not used by HPP itself for locale determination,
		so is not used by SPF either.)</li>
		<li>The HTTP-standard <code>Accept-Language:</code> request
		header.</li>
	</ol>
	</li>
	<li>The SPF locale resolver filters the above inputs by the <i>available
	locales</i> for your portal site. (When you configure your portal site in
	the SPF portal, you can specify the <i>default locale</i> to use at
	your site, as well as any <i>additional locales</i> to support at the
	site.)
	<ul>
		<li>The locale from the first input found to match one of the
		available locale(s) for the portal site, is the one resolved.</li>
		<li>If none of the inputs provide locale(s) that match the
		available ones, then the default locale for the portal site is
		resolved.</li>
	</ul>
	</li>
</ol>

<a name="i18n.other.locale.set">
<h4>2.9.2. Setting the locale</h4>
</a>

<p>Generally there is no need for you to be concerned with setting
the locale. Typically you will just use the <a
	href="#i18n.other.locale.get">locale you get</a>. It is the SPF
portal's responsibility to set the locale (including providing the user
with a locale selector widget with which the user can set his/her own
locale). In fact, in the Java portlet API's there are no standard
methods for setting the locale in the response, since that is delegated
to the portal.</p>

<p>If you have a use case where your portlet must set the locale,
the only way you can do this is by calling the portal. The locale
setting will only take effect on subsequent request lifecycles (ie <code>PortletRequest.getLocale</code>
will not start returning the new locale until subsequent requests in the
session) and it will take effect throughout the portal, not just in your
portlet. Consider this carefully before deciding to implement such a use
case.</p>

<p>To call the portal to set a new locale, you must make a {@link
com.hp.it.spf.xa.portalurl.PortalURL} with the new locale set as a
parameter in the URL. Then convert that <code>PortalURL</code> into a
string, and cause the user browser to open that URL string. (For
example, redirect to that URL, or present it as a link or form action to
submit.)</p>

<p>Depending on the type of portal page, and the parameters you
pass, your setting will take effect with varying degrees of persistence:</p>

<ul>
	<li>
	<p>To make the setting last for the rest of the session (until the
	user restarts his/her browser):</p>
	<ol>
		<li>
		<p>Create a {@link com.hp.it.spf.xa.portalurl.PortalURL} for any
		page at your portal site. This is the page where you want the user to
		go after the new locale has been set.</p>
		</li>
		<li>
		<p>Set the HP.com-standard <code>lang</code> and <code>cc</code>
		parameters as portal parameters on that <code>PortalURL</code>, using
		{@link
		com.hp.it.spf.xa.portalurl.PortalURL#setParameter(java.lang.String,
		java.lang.String)}.</p>
		<ul>
			<li>The <code>lang</code> parameter should be the <a
				href="http://www.loc.gov/standards/iso639-2/php/English_list.php">ISO
			639-1</a> language code for the new locale (use {@link
			java.util.Locale#getLanguage()}).</li>
			<li>The <code>cc</code> should be the <a
				href="http://www.iso.org/iso/country_codes/iso_3166_code_lists/english_country_names_and_code_elements.htm">ISO
			3166-1</a> country code (use {@link java.util.Locale#getCountry()} (or
			can be omitted if the locale does not include a country).</li>
		</ul>
		</li>
		<li>
		<p>When the user's browser opens this <code>PortalURL</code>, the
		SPF portal's locale resolver will resolve that new locale (see <a
			href="#i18n.other.locale.get">discussion above</a>) for the rest of
		the session, until the browser is restarted.</p>
		</li>
	</ol>
	</li>
	<li>
	<p>To make the setting last persistently (ie set it remains even
	after browser restart), just as if the user had chosen it with the SPF
	locale selector in the portal:</p>
	<ol>
		<li>
		<p>Create a {@link com.hp.it.spf.xa.portalurl.PortalURL} for any
		page at your portal site. This is the page where you want the user to
		go after the new locale has been set.</p>
		</li>
		<li>
		<p>Create another <code>PortalURL</code> for the SPF locale
		selector secondary page process-action. The friendly URI for this is
		the value of {@link
		com.hp.it.spf.xa.misc.Consts#PAGE_FRIENDLY_URI_SELECT_LOCALE}.</p>
		</li>
		<li>
		<p>In the SPF locale selector <code>PortalURL</code>, set the
		following parameters using the {@link
		com.hp.it.spf.xa.portalurl.PortalURL#setParameter(java.lang.String,
		java.lang.String)} method:</p>
		<ul>
			<li>The value of the first parameter should be the <a
				href="http://www.faqs.org/rfcs/rfc3066.html">RFC 3066</a> language
			tag for the new locale (use {@link
			com.hp.it.spf.xa.i18n.I18nUtility#localeToLanguageTag(Locale)}). The
			name of this parameter should be the value of {@link
			com.hp.it.spf.xa.misc.Consts#PARAM_SELECT_LOCALE}.</li>
			<li>The value of the second parameter should be the string of
			the first URL (ie where you want the user to be taken after the new
			locale has been set). The name of this parameter should be the value
			of {@link com.hp.it.spf.xa.misc.Consts#PARAM_SELECT_LOCALE_TARGET}.</li>
		</ul>
		</li>
		<li>
		<p>When the user's browser opens this SPF locale selector <code>PortalURL</code>,
		the SPF locale selector secondary page will set that new locale
		persistently.</p>
		</li>
	</ol>
	<li>
	<p><b>Note:</b> Neither of the above techniques works-around the
	fact that you can only set locales which are configured as available in
	the portal site.</p>
	</li>
</ul>

<a name="i18n.other.i18n_portlet_config">
<h4>2.9.3. Configuring <code>i18n_portlet_config.properties</code>
(optional)</h4>
</a>

<blockquote>
<p><b>Note:</b> You only need to concern yourself with <code>i18n_portlet_config.properties</code>
if you have <a href="#i18n.location.external">external supporting
resources</a> <b>and</b> you are either putting the <i>portlet resource
bundle folder</i> in a non-default location, <b>or</b> you are deploying the
<i>file relay servlet</i> in a non-default location.</p>
</blockquote>

<p>The <code>i18n_portlet_config.properties</code> lets you
configure the location of the portlet resource bundle folder, on the
portlet server, and the URI for the file relay servlet.</p>

<dl>
	<dt><code>portlet.bundleDirectory</code></dt>
	<dd>
	<p>This property gives the fully-qualified pathname of the <i>portlet
	resource bundle folder</i> on the portlet server. For example:</p>
	<blockquote><pre>
portlet.bundleDirectory=/var/my_portlet/my_resources
</pre></blockquote>
	<p>The default value for this property is {@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#BUNDLE_DIR_DEFAULT} and you
	do not need to configure this property if you accept the default.</p>
	</dd>
	<dt><code>servlet.fileRelay.url</code></dt>
	<dd>
	<p>This property gives the URI of the <i>file relay servlet</i>.
	For example, if you are deploying the relay servlet inside your portlet
	application (as is recommended), put your servlet mapping path here,
	like this (eg where you have used <code>&lt;servlet-mapping&gt;/getFile/*</code>
	in your deployment descriptor for the servlet):</p>
	<blockquote><pre>
servlet.fileRelay.url=/getFile
	</pre></blockquote>
	<p>As another example, if you are deploying the relay servlet in
	the SPF portal application (but remember it must have access to the
	portlet bundle folder, so this typically only works with a
	local-portlet architecture), then likewise put your servlet mapping
	path here, like this (eg where the SPF portal application is deployed
	under <code>/portal</code> and the relay servlet is under <code>&lt;servlet-mapping&gt;/relay/*</code>):</p>
	<blockquote><pre>
servlet.fileRelay.url=/portal/relay
	</pre></blockquote>
	<p>The default value for this property is {@link
	com.hp.it.spf.xa.i18n.portlet.I18nUtility#RELAY_PATH_DEFAULT} and you
	do not need to configure it if you accept that default.</p>
	</dd>
</dl>

<a name="i18n.other.init_relay">
<h4>2.9.4. Configuring <code>init_relay.properties</code>
(optional)</h4>
</a>

<blockquote>
<p><b>Note:</b> You only need to concern yourself with <code>init_relay.properties</code>
if you have <a href="#i18n.location.external">external supporting
resources</a> <b>and</b> you are dis-satisfied with the configuration in <code>init_relay_default.properties</code>
(which is delivered inside the SPF portlet utilities JAR). See the
discussion in the <a
	href="com/hp/it/spf/xa/relay/servlet/package-summary.html#init_relay.properties">package
description</a> for the relay servlet.</p>
</blockquote>

<p>The properties in <code>init_relay.properties</code> list all of
the allowed file extensions which the relay servlet will permit to be
downloaded from anywhere underneath the <i>portlet resource bundle
folder</i>. They also map to the MIME type which the servlet should specify
(on the HTTP <code>Content-Type:</code> response header) when
downloading that particular type of file to the user. The properties use
the following format:</p>

<blockquote><pre>
contentType.<i>file-extension</i>=<i>mime-type</i>
</pre></blockquote>

<p>For example:</p>

<blockquote><pre>
contentType.mov=video/quicktime # For Apple quicktime format using .mov extension
</pre></blockquote>

<p>This means that all <code>*.mov</code> files in the portlet
bundle folder will be permissible for download, and <code>Content-Type:
video/quicktime</code> will be used in the download.</p>

<a name="i18n.other.common">
<h4>2.9.5. Using the common <code>I18nUtility</code></h4>
</a>

<p>Above we have seen the various internationalization API's and
tags provided by the SPF portlet utilities, primarily in the {@link
com.hp.it.spf.xa.i18n.portlet.I18nUtility} class. Be aware that class
inherits from the common {@link com.hp.it.spf.xa.i18n.I18nUtility}, part
of the <a
	href="http://samson.atl.hp.com:8080/hudson/job/spf-common-utilities/site/apidocs/overview-summary.html">SPF
common utilities</a>. And the common <code>I18nUtility</code> provides
numerous miscellaneous methods related to internationalization,
encompassing:</p>

<ul>
	<li>Localized display of locale names, timezone names, user names,
	etc, in SPF-standard format</li>
	<li>Transformation between locales, HP Passport languages, and RFC
	3066 language tags</li>
	<li>And more.</li>
	<li><b>Note:</b> these inherited methods are documented in the <a
		href="http://samson.atl.hp.com:8080/hudson/job/spf-common-utilities/site/apidocs/overview-summary.html#top">SPF
	Common Utilities Developer's Guide</a> as well as in the JavaDoc for the
	{@link com.hp.it.spf.xa.i18n.portlet.I18nUtility} class.</li>
</ul>

<hr>

<a name="help">
<h2>3. Online Help</h2>
</a>

<hr>

<a name="help.kinds">
<h3>3.1. Kinds of online help</h3>
</a>

<a name="help.kinds.contextual">
<h4>3.1.1. Contextual help (classic and custom; standalone and
injected)</h4>
</a>

<a name="help.kinds.portlet">
<h4>3.1.2. Portlet help (help mode)</h4>
</a>

<a name="help.kinds.global">
<h4>3.1.3. Portal help (global help)</h4>
</a>

<hr>

<a name="help.contextual.java">
<h3>3.2. Producing contextual help using Java code</h3>
</a>

<a name="help.contextual.java.classicContextualHelpProvider">
<h4>3.2.1. Using <code>ClassicContextualHelpProvider</code></h4>
</a>

<a name="help.contextual.java.contextualHelpProvider">
<h4>3.2.2. Extending <code>ContextualHelpProvider</code> to create
a custom rendition</h4>
</a>

<hr>

<a name="help.contextual.jsp">
<h3>3.3. Producing contextual help using JSP tag libraries</h3>
</a>

<a name="help.contextual.jsp.classicContextualHelpProvider">
<h4>3.3.1. Using <code>&lt;spf-help-portlet:classicContextualHelpProvider&gt;</code>
for standalone classic contextual help</h4>
</a>

<a name="help.contextual.jsp.classicContextualHelpProviderParam">
<h4>3.3.2. Using <a
	href="com/hp/it/spf/xa/i18n/portlet/tag/package-summary.html#classicContextualHelpParam"><code>&lt;spf-i18n-portlet:classicContextualHelpProviderParam&gt;</code></a>
for injected classic contextual help</h4>
</a>

<p>This tag is only used inside the tag body of <code>&lt;spf-i18n-portlet:message&gt;</code>.
You use it to inject contextual help into the message value, where the
special <code>&lt;contextual_help&gt;...&lt;/contextual_help&gt;</code>
markup is found. The format of contextual help which is injected is the
"classic" rendition. The usage is:</p>

<blockquote><pre>
&lt;%@ taglib prefix="spf-i18n-portlet" uri="/spf-i18n-portlet.tld" %&gt;
...
&lt;spf-i18n-portlet:classicContextualHelpParam
	title="<i>help-title</i>"
	titleKey="<i>help-title-message-key</i>"
	content="<i>help-content</i>"
	contentKey="<i>help-content-message-key</i>"
	noScriptHref="<i>uri</i>"
	width="<i>pixels</i>"
	borderStyle="<i>inline-style</i>'
	borderClass="<i>css-classname</i>"
	titleStyle="<i>inline-style</i>"
	titleClass="<i>css-classname</i>"
	contentStyle="<i>inline-style</i>"
	contentClass="<i>css-classname</i>"
	/&gt;
</pre></blockquote>

<p>Most of the tag attributes are optional. For example, if your
message properties contain this:</p>

<blockquote><pre>
key=Your sign-in is &lt;contextual_help&gt;secure&lt;/contextual_help&gt;
key.help.title=Service Portal and your security
key.help.content=Internet security is important to us...
</pre></blockquote>

<p>Then you could generate the message, with classic contextual help
injected, in your JSP like this:</p>

<blockquote><pre>
&lt;%@ taglib prefix="spf-i18n-portlet" uri="/spf-i18n-portlet.tld" %&gt;
...
&lt;spf-i18n-portlet:message key="key"&gt;
	&lt;spf-i18n-portlet:classicContextualHelpParam titleKey="key.help.title" contentKey="key.help.content" /&gt;
&lt;/spf-i18n-portlet:message&gt;
</pre></blockquote>

<p>This JSP would generate a message looking in the user's browser
like this:</p>

<img
	src="com/hp/it/spf/xa/i18n/portlet/doc-files/contextualHelpLink.jpg">

<p>When the user clicked on the link, then the classic-rendition
contextual help would pop open:</p>

<img src="com/hp/it/spf/xa/i18n/portlet/doc-files/contextualHelp.jpg">

<p>Most of the other tag attributes can be used to change the style
(color, font, size) of the classic contextual help popup. See the tag
documentation, in the <a
	href="com/hp/it/spf/xa/i18n/portlet/tag/package-summary.html#classicContextualHelpParam">package
description</a>, for more information.</p>

<blockquote>
<p><b>Note:</b> The classic rendition of contextual help utilizes an
"X" image on which the user can click to close the window. This is a GIF
image which you must supply (either inside your portlet application, or
in the external resource bundle folder). You can localize the image if
desired. Name the base file for the image <code>btn_close.gif</code> and
put it in the <code>images/</code> subfolder (of your portlet WAR or the
external folder). Management of this image is the same as for any other
supporting resource file.</p>

<p>The SPF portlet utilities JAR contains a sample <code>btn_close.gif</code>.
(It is the same one shown in the example above.)</p>
</blockquote>

<a name="help.contextual.jsp.contextualHelpProvider">
<h4>3.3.3. Creating a tag library for a custom contextual help
rendition</h4>
</a>

<hr>

<a name="help.portlet.java">
<h3>3.4. Producing portlet help (help mode) using <code>FileDisplayPortletController</code></h3>
</a>

<hr>

<a name="file">
<h2>4. File Display</h2>
</a>

<hr>

<a name="file.about">
<h3>4.1. About file display</h3>
</a>

<hr>

<a name="file.display">
<h3>4.2. Displaying file content using Java code</h3>
</a>

<a name="file.display.fileInterpolator">
<h4>4.2.1. Using <code>FileInterpolator</code> to read and
interpolate file content</h4>
</a>

<a name="file.display.fileDisplayPortletController">
<h4>4.2.2. Using <code>FileDisplayPortletController</code> to
display interpolated file content</h4>
</a>

<a name="file.display.htmlViewer">
<h4>4.2.3. Using the <code>html-viewer</code> portlet to display
interpolated file content</h4>
</a>

<hr>

<a name="file.author">
<h3>4.3. Authoring file content and using interpolation tokens</h3>
</a>

<a name="file.author.token.url">
<h4>4.3.1. Including URLs for supporting resources like images and
CSS (<code>&lt;CONTENT-URL:<i>path</i>&gt;</code>, <code>&lt;LOCALIZED-CONTENT-URL:<i>path</i>&gt</code>)</h4>
</a>

<a name="file.author.token.user">
<h4>4.3.2. Displaying user information (<code>&lt;NAME&gt;</code>,
<code>&lt;EMAIL&gt;</code>, <code>&lt;LANGUAGE-CODE&gt;</code>, <code>LANGUAGE-TAG&gt;</code>,
<code>&lt;USER-PROPERTY:<i>key</i>&gt;</code>)</h4>
</a>

<a name="file.author.token.auth">
<h4>4.3.3. Permissioning content for authorized users (<code>&lt;ROLE:<i>role-names</i>&gt;</code>,
<code>&lt;GROUP:<i>group-names</i>&gt;</code>)</h4>
</a>

<a name="file.author.token.consolidate">
<h4>4.3.4. Consolidating content for easier administration (<code>&lt;PORTLET:<i>friendly-ids</i>&gt;</code>,
<code>&lt;SITE:<i>site-names</i></code>, <code>&lt;TOKEN:<i>key</i>&gt;</code>)</h4>
</a>

<a name="file.author.token.misc">
<h4>4.3.5. Miscellaneous (<code>&lt;SITE&gt;</code>)</h4>
</a>

<hr>

<a name="portal">
<h2>5. Portal Data</h2>
</a>

<hr>

<a name="portal.kinds">
<h3>5.1. Kinds of portal provided data</h3>
</a>
<a name="portal.user">
<h4>5.1.1. User data (profile attributes, groups and roles)</h4>
</a>
<a name="portal.prefs">
<h4>5.1.2. Portlet preferences</h4>
</a>
<a name="portal.request">
<h4>5.1.3. Portal request data (site name, friendly ID, and URLs)</h4>
</a>

<hr>

<a name="portal.user.get">
<h3>5.2. Accessing user data using Java code</h3>
</a>
<a name="portal.user.props">
<h4>5.2.1. Accessing user profile attributes (<code>Utils.getUserProperty</code>)</h4>
</a>
<a name="portal.user.groups">
<h4>5.2.2. Accessing user groups (<code>Utils.getGroups</code>)</h4>
</a>

<hr>

<a name="portal.request.get">
<h3>5.3. Accessing portal request data</h3>
</a>
<a name="portal.request.site">
<h4>5.3.1. Accessing the portal site name (<code>Utils.getSiteName</code>)</h4>
</a>
<a name="portal.request.portlet">
<h4>5.3.2. Accessing the portlet friendly ID (<code>Utils.getPortletID</code>)</h4>
</a>
<a name="portal.request.url">
<h4>5.3.3. Accessing portal URL's (<code>Utils.getRequestURL</code>,
<code>Utils.getSiteRootURL</code>)</h4>
</a>

<hr>

<a name="error">
<h2>6. Error Handling</h2>
</a>

<hr>

<a name="error.about">
<h3>6.1. About error handling</h3>
</a>

<hr>

<a name="error.categorization">
<h3>6.2. Categorizing exceptions using the <code>SPFException</code>
hierarchy</h3>
</a>

<hr>

<a name="error.handling">
<h3>6.3. Handling exceptions using <code>ExceptionUtil</code> and <code>SimpleMappingExceptionResolver</code></h3>
</a>
</body>
</html>