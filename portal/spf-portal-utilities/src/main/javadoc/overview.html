<html>
<head>
<title>Shared Portal Framework - Portal Utilities - Developer's
Guide</title>
</head>
<body>
<p>This artifact contains utilities (Java API's and JSP tags) for
Vignette portal components built using the Shared Portal Framework
(SPF).</p>

<style type="text/css">
body {
	padding: 0;
	font-family: Verdana, Sans-serif;
	font-size: small;
}

h1 {
	font-family: Georgia, Serif;
	font-size: 200%;
	color: #404040;
	margin-top: 5px;
}

h2 {
	font-family: Georgia, Serif;
	font-size: 175%;
	color: #404040;
	page-break-before: always;
}

h3 {
	font-family: Verdana, Sans-serif;
	font-size: 150%;
	font-weight: bold;
	color: #404040;
	margin-top: 20px;
}

h4 {
	font-family: Verdana, Sans-serif;
	font-size: 125%;
	font-weight: bold;
	color: #404040;
	margin-top: 20px;
}

li {
	margin-left: -10px;
}

ol li {
	margin-bottom: 20px;
}

code {
	color: #990000;
	font-size: 110%
}

pre {
	color: #990000;
	font-size: 110%;
}

.byline {
	font-style: italic;
	font-size: 90%;
	color: gray;
	margin-top: -10px;
	border-bottom: solid black 1px;
}

.codeSample {
	color: #990000;
	font-family: 'Courier New', Courier, monospace;
	font-size: small;
	border: solid #990000 1px;
	padding: 5px;
}

.leftFloatingImage {
	float: left;
	margin: 0 10px 10px 0;
}

.rightFloatingImage {
	float: right;
	margin: 0 0 10px 10px;
}

.toc {
	list-style-type: none;
}

ul.toc ul {
	list-style-type: none;
}

table.props td,table.props th {
	padding: 5px;
	background-color: #F0F0F0
}

table.props th {
	font-size: 11px;
	font-weight: bold;
	text-align: right;
}

table.props td {
	font-family: 'Courier New', Courier, monospace;
}

.style1 {
	border-style: solid;
	border-width: 1px;
}
</style>

<a name="top">
<h1>Shared Portal Framework - Portal Utilities - Developer's Guide</h1>
</a>

<a name="toc">
<h2>Table of Contents</h2>
</a>

<ul class="toc">
	<li>1. <a href="#overview">Overview</a>
	<ul>
		<li>1.1. <a href="#overview.dependencies">Dependency
		management</a></li>
		<li>1.2. <a href="#overview.other">Other libraries for SPF
		portal component developers</a>
		<ul>
			<li>1.2.1. <a href="#overview.other.vignette.javadocs">Vignette
			Portal Published API</a></li>
			<li>1.2.2. <a href="#overview.other.vignette.devguide">Vignette
			Portal Developer's Guide</a></li>
			<li>1.2.2. <a href="#overview.other.spf.common">SPF Common
			Utilities</a></li>
		</ul>
		</li>
	</ul>
	</li>
	<li>2. <a href="#i18n">Internationalization</a>
	<ul>
		<li>2.1. <a href="#i18n.resources">Kinds of resources</a>
		<ul>
			<li>2.1.1. <a href="#i18n.resources.message">Message
			resources (message properties)</a></li>
			<li>2.1.2. <a href="#i18n.resources.supporting">Supporting
			resources (images, HTML, PDF, etc)</a></li>
			<li>2.1.3. <a href="#i18n.resources.bundles">Resource
			bundles</a></li>
		</ul>
		</li>
		<li>2.2. <a href="#i18n.location">Where to put your resources</a>
		</li>
		<li>2.3. <a href="#i18n.messages.java">Accessing message
		resources using Java code</a>
		<ul>
			<li>2.3.1. <a href="#i18n.messages.java.vignette.getMessage">Using
			Vignette (<code>I18nUtils.getValue</code>)</a></li>
			<li>2.3.2. <a href="#i18n.messages.java.spf.getMessage">Using
			SPF (<code>I18nUtility.getValue</code>)</a></li>
		</ul>
		</li>
		<li>2.4. <a href="#i18n.messages.tags">Accessing message
		resources using JSP tag libraries</a>
		<ul>
			<li>2.4.1. <a href="#i18n.messages.jsp.vignette.message">Using
			Vignette (<code>&lt;vgn-portal:i18nValue&gt;</code>, <code>&lt;vgn-portal:i18nParam&gt;</code>)</a></li>
			<li>2.4.2. <a href="#i18n.messages.jsp.spf.message">Using
			SPF (<code>&lt;spf-i18n-portal:i18nValue&gt;</code>, <code>&lt;spf-i18n-portal:i18nParam&gt;</code>,
			<code>&lt;spf-i18n-portal:i18nClassicContextualHelpParam&gt;</code>
			and <code>&lt;spf-i18n-portal:i18nClassicGlobalHelpParam&gt;</code>)</a></li>
		</ul>
		</li>
		<li>2.5. <a href="#i18n.supporting.java">Accessing supporting
		resources using Java code</a>
		<ul>
			<li>2.5.1. <a href="#i18n.supporting.java.getLocalizedFileURL">Using
			<code>I18nUtility.getLocalizedFileURL</code></a></li>
			<li>2.5.2. <a
				href="#i18n.supporting.java.getLocalizedFileStream">Using <code>I18nUtility.getLocalizedFileStream</code></a></li>
			<li>2.5.3. <a href="#i18n.supporting.java.getLocalizedFileName">Using
			<code>I18nUtility.getLocalizedFileName</code></a></li>
		</ul>
		</li>
		<li>2.6. <a href="#i18n.supporting.jsp">Accessing supporting
		resources using JSP tag libraries</a>
		<ul>
			<li>2.6.1. <a href="#i18n.supporting.jsp.localizedFileURL">Using
			<code>&lt;spf-i18n-portal:localizedFileURL&gt;</code></a></li>
		</ul>
		</li>
		<li>2.7. <a href="#i18n.locale.selector">Generating the
		locale selector</a>
		<ul>
			<li>2.7.1. <a href="#i18n.locale.selector.java">Using <code>ClassicLocaleSelectorProvider</code></a></li>
			<li>2.7.2. <a href="#i18n.locale.selector.jsp">Using <code>&lt;spf-i18n-portal:classicLocaleSelector&gt;</code></a></li>
			<li>2.7.3. <a href="#i18n.locale.selector.style">Using the <code>spf-locale-selector-classic-style</code></a></li>
			<li>2.7.4. <a href="#i18n.locale.selector.extend">Extending
			<code>LocaleSelectorProvider</code> to create a custom rendition</a></li>
			<li>2.7.5. <a href="#i18n.locale.selector.process">Using the
			<code>spf-locale-selector-secondarypagetype</code> and <code>spf-locale-selector-secondarypage</code></a></li>
		</ul>
		</li>
		<li>2.8. <a href="#i18n.locale.indicator">Generating the
		locale indicator</a>
		<ul>
			<li>2.8.1. <a href="#i18n.locale.indicator.java">Using <code>I18nUtility.getLocaleDisplayName</code></a></li>
			<li>2.8.2. <a href="#i18n.locale.indicator.jsp">Using <code>&lt;spf-i18n-portal:classicLocaleIndicator&gt;</code></a></li>
			<li>2.8.3. <a href="#i18n.locale.indicator.style">Using the
			<code>spf-classic-locale-indicator-style</code></a></li>
		</ul>
		</li>
		<li>2.9. <a href="#i18n.l10n">Localizing your resources</a>
		<ul>
			<li>2.9.1 <a href="#i18n.l10n.spf">The SPF localization
			process</a></li>
		</ul>
		</li>
		<li>2.10. <a href="#i18n.other">Other internationalization
		topics</a>
		<ul>
			<li>2.10.1. <a href="#i18n.other.locale.avail">Getting the
			available locales</a></li>
			<li>2.10.2. <a href="#i18n.other.locale.get">Getting the
			current locale</a></li>
			<li>2.10.3. <a href="#i18n.other.locale.set">Setting the
			current locale</a></li>
			<li>2.10.4. <a href="#i18n.other.locale.config">Configuring
			site default locale and additional locales (<code>site_locale_support.properties</code>)</a></li>
			<li>2.10.5. <a href="#i18n.other.common">Using the common <code>I18nUtility</code></a></li>
			<li>2.10.6. <a href="#i18n.other.locale.resolver">A word
			about the locale resolver</a></li>
		</ul>
		</li>
	</ul>
	</li>
	<li>3. <a href="#help">Online Help</a>
	<ul>
		<li>3.1. <a href="#help.kinds">About online help</a>
		<ul>
			<li>3.1.1. <a href="#help.kinds.contextual">Contextual help
			(classic and custom; standalone and injected)</a></li>
			<li>3.1.2. <a href="#help.kinds.portlet">Portlet help (help
			mode)</a></li>
			<li>3.1.3. <a href="#help.kinds.global">Portal help (global
			help)</a></li>
		</ul>
		</li>
		<li>3.2. <a href="#help.contextual.java">Producing contextual
		help using Java code </a>
		<ul>
			<li>3.2.1. <a
				href="#help.contextual.java.classicContextualHelpProvider">Using
			<code>ClassicContextualHelpProvider</code></a></li>
			<li>3.2.2. <a
				href="#help.contextual.java.contextualHelpProvider">Extending <code>ContextualHelpProvider</code>
			to create a custom rendition</a></li>
		</ul>
		</li>
		<li>3.3. <a href="#help.contextual.jsp">Producing contextual
		help using JSP tag libraries</a>
		<ul>
			<li>3.3.1. <a href="#help.contextual.jsp.classicContextualHelp">Using
			<code>&lt;spf-help-portal:classicContextualHelp&gt;</code> for
			standalone classic contextual help</a></li>
			<li>3.3.2. <a
				href="#help.contextual.jsp.classicContextualHelpParam">Using <code>&lt;spf-i18n-portal:i18nClassicContextualHelpParam&gt;</code>
			for injected classic contextual help</a></li>
			<li>3.3.3. <a href="#help.contextual.jsp.contextualHelpProvider">Creating
			a tag library for a custom rendition</a></li>
		</ul>
		</li>
		<li>3.4. <a href="#help.global">Producing global help using
		the <code>spf-global-help-secondarypagetype</code></a>
		<ul>
			<li>3.4.1. <a href="#help.global.car">Structuring your CAR
			file</a></li>
			<li>3.4.2. <a href="#help.global.xml">Creating your
			component descriptor (<code>component.xml</code>)</a></li>
			<li>3.4.3. <a href="#help.global.content">Creating your
			global help content (<code>globalHelp.html</code>)</a></li>
			<li>3.4.4. <a href="#help.global.properties">Creating your
			global help include properties (<code>globalHelpInclude.properties</code>
			- optional)</a></li>
			<li>3.4.5. <a href="#help.global.primary">Creating your
			primary JSP (<code>globalHelpMain.jsp</code>)</a></li>
			<li>3.4.6. <a href="#help.global.messages">Creating your
			page title (<code>WEB-INF/i18n/&lt;your-component-id&gt;.properties</code>)</a></li>
			<li>3.4.7. <a href="#help.global.deployment">Deploying and
			configuring your CAR file</a></li>
		</ul>
		</li>

		<li>3.5. <a href="#help.global.java">Producing links to
		global help using Java code </a>
		<ul>
			<li>3.5.1. <a href="#help.global.java.classicGlobalHelpProvider">Using
			<code>ClassicGlobalHelpProvider</code></a></li>
			<li>3.5.2. <a href="#help.global.java.globalHelpProvider">Extending
			<code>GlobalHelpProvider</code> to create a custom rendition</a></li>
		</ul>
		</li>
		<li>3.6. <a href="#help.global.jsp">Producing links to global
		help using JSP tag libraries</a>
		<ul>
			<li>3.6.1. <a href="#help.global.jsp.classicGlobalHelp">Using
			<code>&lt;spf-help-portal:classicGlobalHelp&gt;</code> for standalone
			classic global help links</a></li>
			<li>3.6.2. <a href="#help.global.jsp.classicGlobalHelpParam">Using
			<code>&lt;spf-i18n-portal:i18nClassicGlobalHelpParam&gt;</code> for
			injected classic global help links</a></li>
			<li>3.6.3. <a href="#help.global.jsp.globalHelpProvider">Creating
			a tag library for a custom rendition</a></li>
		</ul>
		</li>
	</ul>
	</li>
	<li>4. <a href="#file">Text Interpolation</a>
	<ul>
		<li>4.1. <a href="#file.about">About text interpolation</a></li>
		<li>4.2. <a href="#file.display.java">Interpolating text
		using Java code</a>
		<ul>
			<li>4.2.1. <a href="#file.display.java.fileInterpolator">Using
			<code>FileInterpolator</code> to interpolate text from files</a></li>
			<li>4.2.2. <a href="#file.display.java.tokenParser">Using <code>TokenParser</code>
			to interpolate strings</a></li>
		</ul>
		</li>
		<li>4.3. <a href="#file.display.jsp">Interpolating text using
		JSP tag libraries</a>
		<ul>
			<li>4.3.1. <a href="#file.display.jsp.interpolate">Using <code>&lt;spf-file-portal:interpolate&gt;</code></a></li>
		</ul>
		</li>
		<li>4.4. <a href="#file.author">Authoring text using
		interpolation tokens</a>
		<ul>
			<li>4.4.1. <a href="#file.author.token.url">Referencing URLs
			(<code>{CONTENT-URL:<i>path</i>}</code>, <code>{LOCALIZED-CONTENT-URL:<i>path</i>&gt</code>,
			<code>{REQUEST-URL}</code>, <code>{REQUEST-URL:<i>spec</i>}</code>, <code>{SITE-URL}</code>,
			<code>{SITE-URL:<i>spec</i>}</code>)</a></li>
			<li>4.4.2. <a href="#file.author.token.user">Displaying user
			information (<code>{NAME}</code>, <code>{EMAIL}</code>, <code>{LANGUAGE-CODE}</code>,
			<code>{LANGUAGE-CODE:<i>case</i>}</code>, <code>{LANGUAGE-NAME}</code>,
			<code>{COUNTRY-CODE}</code>, <code>{COUNTRY-CODE:<i>case</i>}</code>,
			<code>{COUNTRY-NAME}</code>, <code>{LANGUAGE-TAG}</code>, <code>{LANGUAGE-TAG:<i>case</i>}</code>,
			<code>{HPP-LANGUAGE-CODE}</code>, <code>{HPP-LANGUAGE-CODE:<i>case</i>}</code>,
			<code>{USER-PROPERTY:<i>key</i>}</code>, <code>{VALUE:<i>property-name</i>}</code>)</a></li>
			<li>4.4.3. <a href="#file.author.token.auth">Permissioning
			content for authorized users (<code>{LOGGED-IN}</code>, <code>{LOGGED-OUT}</code>,
			<code>{GROUP:<i>group-names</i>}</code>, <code>{AUTH:<i>types</i>}</code>,
			<code>{EXIST:<i>property-name</i>}</code>, <code>{SECURE}</code>, <code>{UNSECURE}</code>)</a></li>
			<li>4.4.4. <a href="#file.author.token.consolidate">Consolidating
			content for easier administration (<code>{PAGE:<i>friendly-ids</i>}</code>,
			<code>{NAV-ITEM:<i>items</i>}</code>, <code>{SITE:<i>site-names</i></code>},
			<code>{INCLUDE:<i>key</i>}</code>)</a></li>
			<li>4.4.5. <a href="#file.author.token.misc">Miscellaneous (<code>{AFTER:<i>date</i>}</code>,
			<code>{BEFORE:<i>date</i>}</code>, <code>{DATE:<i>date</i>}</code>, <code>{SITE-NAME}</code>,
			<code>{URL-ENCODE:<i>string</i>}</code>, <code>{XML-ESCAPE:<i>string</i>}</code>)</a></li>
		</ul>
		</li>
	</ul>
	</li>
	<li>5. <a href="#portal">Portal Data</a>
	<ul>
		<li>5.1. <a href="#portal.kinds">Kinds of portal provided
		data</a>
		<ul>
			<li>5.1.1. <a href="#portal.user">User data (profile
			attributes, groups, etc)</a></li>
			<li>5.1.2. <a href="#portal.request">Portal request data
			(site name, URLs, etc)</a></li>
		</ul>
		</li>
		<li>5.2. <a href="#portal.user.get">Accessing user data</a>
		<ul>
			<li>5.2.1. <a href="#portal.user.loginStatus">Checking user
			authentication status (<code>Utils.isAuthenticatedUser</code>)</a></li>
			<li>5.2.2. <a href="#portal.user.props">Accessing user
			profile attributes (<code>Utils.getUserProperty</code>)</a></li>
			<li>5.2.3. <a href="#portal.user.groups">Accessing user
			groups (<code>Utils.getGroups</code>, <code>Utils.isUserInGroup</code>)</a></li>
		</ul>
		</li>
		<li>5.3. <a href="#portal.request.get">Accessing portal
		request data</a>
		<ul>
			<li>5.3.1. <a href="#portal.request.site.current">Accessing
			information about the current portal site (<code>Utils.getSiteDNS</code>,
			<code>Utils.getSiteURL</code>)</a></li>
			<li>5.3.2. <a href="#portal.request.site.effective">Accessing
			information about the effective portal site (<code>Utils.getEffectiveSite</code>,
			<code>Utils.getEffectiveSiteDNS</code>, <code>Utils.getEffectiveSiteURL</code>)</a></li>
			<li>5.3.3. <a href="#portal.request.url">Accessing the
			portal request URL (<code>Utils.getRequestURL</code>)</a></li>
			<li>5.3.4. <a href="#portal.request.fed">Accessing site
			federation status (<code>Utils.isFederatedSite</code>)</a></li>
		</ul>
		</li>
	</ul>
	</li>
	<li>6. <a href="#error">Error Handling</a>
	<ul>
		<li>6.1. <a href="#error.system">Handling system errors</a>
		<ul>
			<li>6.1.1. <a href="#error.system.page">The system error
			page (<code>spf-system-error-secondarypage</code>)</a></li>
			<li>6.1.2. <a href="#error.system.redirect">Redirecting to
			the system error page (<code>ExceptionUtil.redirectSystemErrorPage</code>)</a></li>
		</ul>
		</li>
		<li>6.2. <a href="#error.auth">Handling authorization errors</a>
		<ul>
			<li>6.2.1. <a href="#error.auth.page">The authorization
			error page (<code>spf-auth-error-secondarypage</code>)</a></li>
			<li>6.2.2. <a href="#error.auth.redirect">Redirecting to the
			authorization error page (<code>ExceptionUtil.redirectAuthErrorPage</code>)</a></li>
		</ul>
		</li>
	</ul>
	</li>
	<li>7. <a href="#properties">Configuration File Management</a>
	<ul>
		<li>7.1. <a href="#properties.propertyResourceBundleManager">Accessing
		your property files (<code>PropertyResourceBundleManager</code>)</a>
		<ul>
			<li>7.1.1 <a
				href="#properties.propertyResourceBundleManager.getBundle">Getting
			a bundle of properties (<code>PropertyResourceBundleManager.getBundle</code>)</a></li>
			<li>7.1.2 <a
				href="#properties.propertyResourceBundleManager.getString">Getting
			a single property (<code>PropertyResourceBundleManager.getString</code>)</a></li>
			<li>7.1.3. <a href="#properties.config">Configuring <code>propertyresourcebundlemanager.properties</code>
			(optional)</a></li>
		</ul>
		</li>
	</ul>
	</li>
	<li>8. <a href="#history">Document History</a></li>
</ul>

<hr>

<a name="overview">
<h2>1. Overview</h2>
</a>

<p>This is the developer's guide for the <b>Shared Portal
Framework (SPF) portal utilities</b>. The SPF portal utilities are a
collection of Java classes and JSP tag libraries for use by developers
of SPF-based Vignette portal components. Currently the utilities provide
useful functionality in the following areas:</p>

<ul>
	<li><a href="#i18n">Internationalization</a> - the SPF portal
	utilities provide Java classes and JSP tags for handling all kinds of
	UI resources in your code (messages, images, etc) so that they can be
	localized</li>
	<li><a href="#help">Online Help</a> - the SPF portal utilities
	provide Java classes and JSP tags which make it easier for you to
	develop online help</li>
	<li><a href="#file">Text Interpolation</a> - the SPF portal
	utilities provide Java classes for interpolating and displaying text
	(including special markup tokens) from files or strings to users
	(saving you time when developing portal components that mostly display
	static text)</li>
	<li><a href="#portal">Portal Data</a> - the SPF portal utilities
	provide Java classes for accessing data provided by SPF to Vignette
	portal</li>
	<li><a href="#error">Error Handling</a> - the SPF portal utilities
	provide Java classes to assist you with system error handling</li>
</ul>

<p>The SPF portal utilities augment Vignette's own published portal
API's and JSP tags, which cover many other areas. See <a
	href="#overview.other">other libraries</a>. As a portal component
developer, you will use both the Vignette interfaces, and (where useful)
the SPF interfaces documented here.</p>

<hr>

<a name="overview.dependencies">
<h3>1.1. Dependencies</h3>
</a>

<p>The SPF portal utilities depend on the Vignette Portal API's and
the standard Java servlet and JSP technologies. In addition, the SPF
portal utilities depend on the SPF common utilities (these are common
utilities for both portlet and portal components in the Shared Portal
Framework).</p>

<p>The SPF portal utilities are a provided dependency for your
Vignette components in the Shared Portal Framework runtime environment.
In your Vignette component Maven artifact, just add SPF portal utilities
as a "provided" type of dependency to your POM.</p>

<hr>

<a name="overview.other">
<h3>1.2. Other libraries for SPF portal component developers</h3>
</a>
<a name="overview.other.vignette.javadocs">
<h4>1.2.1. Vignette Portal Published API</h4>
</a>

<p>Vignette Portal provides a library of Java API's which your
portal components can call. For example, these provide access to the
portal context (through the <code>PortalContext</code> object), metadata
about components (through the <code>Site</code>, <code>Style</code>, and
other objects), and more.</p>

<p>Developer documentation (JavaDocs) describing the Vignette Portal
API's are available at the Vignette Web site.</p>

<ol>
</ol>

<p>Copies of the Vignette JavaDocs may also be hosted by the SPF
team on their Web site. Check with the SPF team for the location.</p>

<a name="overview.other.vignette.devguide">
<h4>1.2.2. Vignette Portal Developer's Guide</h4>
</a>

<p>Besides the JavaDocs describing the Vignette-provided Java API's,
Vignette also makes available a Developer's Guide discussing the
Vignette component model (sites, secondary pages, styles, etc), how to
develop JSP's and action classes for components, available JSP tags you
can use in your component JSP's, and more. The Developer's Guide is also
available at the Vignette Web site.</p>

<ol>
</ol>

<p>A copy of the Vignette Portal Developer's Guide may also be
hsoted by the SPF team on their Web site. Check with the SPF team for
the location.</p>

<a name="overview.other.spf.common">
<h4>1.2.3. SPF Common Utilities</h4>
</a>

<p>The SPF common utilities, used both by SPF portlets and portal
components (ie Vignette components), contain a number of useful API's
for SPF portlet developers, including:</p>

<ul>
	<li>building portal page URLs, including portal page URLs which
	target portlets on those pages and pass them parameters</li>
	<li>managing your application's configuration properties using
	hot-reloadable external files</li>
	<li>performing miscellaneous
	internationalization/localization-related tasks such as localized
	display of names (user, locale, timezone) in SPF-standard format, and
	transformation between locales, HP Passport language codes, and RFC
	3066 language tags</li>
	<li>and more</li>
</ul>

<p>These functionalities are in a separate package so that they can
be used by SPF-based portlet applications as well. See the <a
	href="../../../common/spf-common-utilities/apidocs/" target="_blank">SPF
Common Utilities Developer's Guide</a> for more information.</p>

<hr>

<a name="i18n">
<h2>2. Internationalization</h2>
</a>

<p>The Vignette Portal API provides basic support for
internationalizing text strings (message resources) in your portal
component. The SPF portal utilities (primarily the {@link
com.hp.it.spf.xa.i18n.portal.I18nUtility} class) extend the native
Vignette functionality primarily in these directions:</p>

<ul>
	<li>internationalizing access to other static resources (images,
	PDF's, etc)</li>
	<li>injecting contextual help into your message resources</li>
	<li>placing no-localization reminders into your message resources</li>
	<li>controlling whether or not HTML metacharacters (&lt; &gt; and
	etc) in message strings are escaped
	<li>controlling whether or not Vignette injects <code>&lt;SPAN&gt;</code>
	tags into your message strings
	<li>miscellaneous useful methods, inherited from the common {@link
	com.hp.it.spf.xa.i18n.I18nUtility} class (see <a
		href="#i18n.other.common">using the common <code>I18nUtility</code></a>
	at the end of this section)</li>
</ul>

<p>This chapter describes these extensions.</p>

<hr>

<a name="i18n.resources">
<h3>2.1. Kinds of resources</h3>
</a>

<p>With the SPF portal utilities, you can internationalize access to
your text strings (message resources) and other static resources
(supporting resources like images, HTML, PDF, etc), so that they can be
localized.</p>

<a name="i18n.resources.message">
<h4>2.1.1. Message resources (message properties)</h4>
</a>

<p><i>Message resources</i> (sometimes just called messages) are
text strings used in your UI. They are managed in Java message property
files as per the usual Java {@link java.util.ResourceBundle} standard.
As per Vignette Portal standards, your message property files are named
after your portal component's component ID.</p>

<p>SPF has a well-defined process for localizing your message
resources: translating them from a <i>base locale</i> (typically US
English) into the various other locales you need. See <a
	href="#i18n.l10n">localizing your resources</a>, below.</p>

<a name="i18n.resources.supporting">
<h4>2.1.2. Supporting resources (images, HTML, PDF, etc)</h4>
</a>

<p>In addition to message resources, the SPF portal utilities
provide a solution for internationalized access to <i>supporting
resources</i>: static files like images, HTML, PDF, MS Word documents, etc.</p>

<p>SPF's localization process works for these files too, letting you
get them translated from a <i>base locale</i> (again, typically US
English) into the various other locales you need. See the discussion
around the <a href="#i18n.l10n.spf">SPF localization process</a>, below.</p>

<a name="i18n.resources.bundles">
<h4>2.1.3 Resource bundles</h4>
</a>

<p>Whether message property files, or supporting files, in SPF you
organize them into <i>resource bundles</i>. These are collections of
files containing identical content, just localized for different
locales. The <i>base file</i> contains the content for the base locale
(typically US English). The other files in the bundle each contain a
translation of that content for another locale. As with the Java
standard for {@link java.util.ResourceBundle}, the base file should <b>not</b>
have any locale tag, while the other files should be tagged according to
their locale, as follows:</p>

<blockquote><pre>
<i>base-filename</i>_<i>lang</i>_<i>CC</i>.<i>extension</i>
</pre></blockquote>

<ul>
	<li><i><code>lang</code></i> is the 2-character <a
		href="http://www.loc.gov/standards/iso639-2/php/English_list.php">ISO
	639-1</a> language code for the locale (lowercase)</li>
	<li><i><code>CC</code></i> is the 2-character <a
		href="http://www.iso.org/iso/country_codes/iso_3166_code_lists/english_country_names_and_code_elements.htm">ISO
	3166-1</a> country code for the locale (uppercase)</li>
</ul>

<p>For example, here is a collection of files constituting a message
resource bundle for the portal component whose component ID is <code>my-component</code>:</p>

<blockquote><pre>
my-component.properties         &lt;-- the base file
my-component_ja_JP.properties   &lt;-- the same file localized for Japan - Japanese
my-component_zh_CN.properties   &lt;-- the same file localized for China - Chinese
my-component_zh_TW.properties   &lt;-- the same file localized for Taiwan - Chinese
</pre></blockquote>

<p>Here is a collection of files constituting an image resource
bundle, where <code>picture.jpg</code> is the base filename:</p>

<blockquote><pre>
picture.jpg         &lt;-- the base file
picture_ja_JP.jpg   &lt;-- the same file localized for Japan - Japanese
picture_zh_CN.jpg   &lt;-- the same file localized for China - Chinese
picture_zh_TW.jpg   &lt;-- the same file localized for Taiwan - Chinese
</pre></blockquote>

<p><b>Note:</b> SPF will generally use full (ie language- and
country-specific) locales. Your resource bundles are encouraged to do
likewise. However if you want to offer localization at the level of
language-only, you can do that. For example, while users of your portlet
may present with both France - French (<code>fr-FR</code>) and France -
Canada (<code>fr-CA</code>), if there is no difference in those
translations you could just have one file in your resource bundle for
them. Just drop the country code from the tagged locale:</p>

<blockquote><pre>
picture.jpg         &lt;-- the base file
picture_fr.jpg      &lt;-- the same file localized for country-generic French
picture_ja_JP.jpg   &lt;-- the same file localized for Japan - Japanese
picture_zh_CN.jpg   &lt;-- the same file localized for China - Chinese
picture_zh_TW.jpg   &lt;-- the same file localized for Taiwan - Chinese
</pre></blockquote>

<p>As with the Java standard for {@link java.util.ResourceBundle},
all of the SPF internationalization utilities will search for the
most-specific match for the user's locale first, ultimately falling back
upon your base file.</p>

<hr>
<a name="i18n.location">
<h3>2.2. Where to put your resources</h3>
</a>

<p>As is standard with Vignette portal components, your message
resources must be named with the component ID of the component, tagged
per locale as above, and placed in the <code>WEB-INF/i18n/</code> folder
within the component CAR. This is where Vignette knows to search for
message resources; it is also where your message resources will be
displayable, editable, uploadable and downloadable via the Vignette
console (under the <b>Language</b> tab for your component).</p>

<p>Your supporting resources should be managed as <i>secondary
support files</i> within your component. This means they should be placed in
the <code>WEB-INF/</code> folder (there is no particular naming
convention required for the filenames, other than tagging them per
locale as above). There they will be uploadable and downloadable via the
Vignette console (under the <b>Support Files</b> tab for your
component).</p>

<p>For example, here are the resource files used in the example
above, placed into their proper locations within the <code>my-component</code>
CAR. (Standard files for a CAR, such as <code>component.xml</code> and
your primary JSP, are not shown.)</p>

<blockquote><pre>
<i>&lt;root&gt;</i>
    WEB-INF/
        i18n/
            my-component.properties
            my-component_ja_JP.properties
            ...
        picture.jpg
        picture_ja_JP.jpg
        ...
</pre></blockquote>

<p>Your resources therefore are parts of your component. You can
build them into your component CAR in the lab, and/or manipulate them
(upload, download, edit, etc) via the Vignette console at runtime. If
you change them through the console (eg edit message properties or
upload new message resource or supporting resource files), no restarts
are required for the changes to take effect - the SPF portal utilities'
internationalization methods will reflect your changes immediately.</p>

<blockquote>
<p><b>Note:</b> Unlike with the SPF portlet utilities, placing
resource files in the global resources folder is not supported. For
Vignette portal components, your resources must be within the component
itself.
</blockquote>

<hr>
<a name="i18n.messages.java">
<h3>2.3. Accessing message resources using Java code</h3>
</a>

<p>Once your message resources have been created and placed <a
	href="#i18n.location">as discussed above</a>, you can begin to access
best-fit localized text strings for your user from them in your Java
code. You may use either the standard published Vignette API's for doing
this (such as <code>com.epicentric.common.website.I18nUtils.getValue(...)</code>),
or (recommended) the SPF portal API's.</p>

<p><b>Note:</b> In both cases, JSP tag libraries are available for
you to use instead of the raw Java API's. See the <a
	href="#i18n.messages.tags">discussion on this</a> below.</p>

<a name="i18n.messages.java.vignette.getMessage">
<h4>2.3.1. Using Vignette (eg <code>com.epicentric.common.website.I18nUtils.getValue</code>)</h4>
</a>

<p>See the Vignette Portal published API documentation - for
example, see the Vignette-provided JavaDocs for any of the <code>com.epicentric.common.website.I18nUtils.getValue(...)</code>.
API's.</p>

<p><b>Note:</b> If you use the Vignette native API's, you will not
benefit from any of the <a href="#i18n.messages.java.spf.getMessage">enhanced
message capabilities</a> supported by the SPF portal utilities' {@link
com.hp.it.spf.xa.i18n.portal.I18nUtility} class.</p>

<a name="i18n.messages.java.spf.getMessage">
<h4>2.3.2. Using SPF (<code>I18nUtility.getValue</code>)</h4>
</a>

<p>SPF's <code>I18nUtility.getValue</code> API's wrap around
Vignette and provide numerous extra capabilities not supported by the
published native Vignette Portal API:</p>

<ul>
	<li>
	<p>The Vignette-provided <code>com.epicentric.common.website.I18nUtils.getValue</code>
	methods have deprecated the ability to control whether HTML
	metacharacters such as <code>&lt;</code> and <code>&gt;</code> are
	escaped (for literal display). Using Vignette's published API, returned
	message strings will always be escaped, causing you to have to perform
	a separate "de-escape" step when your message string actually contains
	HTML. In contrast, the SPF-provided <code>I18nUtility.getValue</code>
	methods give you full control over this.</p>
	</li>
	<li>
	<p>Similarly, the Vignette-provided <code>com.epicentric.common.website.I18nUtils.getValue</code>
	API's sometimes inject <code>&lt;SPAN
	lang="..."&gt;...&lt;/SPAN&gt;</code> markup around returned message strings.
	While ostensibly useful for accessibility purposes, this can sometimes
	interfere with proper display of the message (for example, when the
	message is used for an HTML title element). While the Vignette-provided
	API's do not let you turn this off, the SPF-provided <code>I18nUtility.getValue</code>
	methods give you full control over this.</p>
	</li>
	<li>
	<p>The Vignette-provided <code>com.epicentric.common.website.I18nUtils.getValue</code>
	methods do not provide a way to substitute string parameters into a
	message string. After calling the Vignette method, you need to make a
	second call (eg, to the Java-standard <code>MessageFormat</code> class)
	to interpolate string parameters into your message. In contrast, the
	SPF-provided <code>I18nUtility.getValue</code> methods give you full
	control over this.</p>
	</li>
	<li>
	<p>In the <a href="#i18n.l10n.spf">SPF localization process</a>,
	you can mark sections of your messages which you do <b>not</b> want the
	translators to localize, using the special <code>&lt;no_localization&gt;...&lt;/no_localization&gt;</code>
	tags. The SPF <code>I18nUtility.getValue</code> API's automatically
	remove these for you; Vignette does not.</p>
	<p>For example, in your message properties you can have:</p>
	<blockquote><pre>
key=This part should be translated &lt;no_localization&gt;but this part should not&lt;/no_localization&gt;.
</pre></blockquote>
	<p>SPF's <code>I18nUtility.getValue</code> API's will automatically
	remove the special <code>&lt;no_localization&gt;...&lt;/no_localization&gt;</code>
	markup from this, if the translator did not do so already.</p>
	</li>
	<li>
	<p>The SPF <code>I18nUtility.getValue</code> API's let you <i>inject</i>
	<a href="#help.kinds.contextual">contextual help</a> into the middle of
	a message. This can be very useful when you need to use contextual
	help, because by definition contextual help is typically help content
	that is embedded inline with broader text. If you break such text
	apart, so that you can generate standalone contextual help around just
	the text unit needing it, the broader text might become difficult to
	translate correctly. Leaving the text intact, and injecting the
	contextual help into it, is the proper way to do it, and is supported
	by the SPF <code>I18nUtility.getValue</code> API's.</p>
	<p>For example, you can have the following in your message
	properties:</p>
	<blockquote><pre>
key=Here is some &lt;contextual_help&gt;help&lt;/contextual_help&gt; for you.
</pre></blockquote>
	<p>The SPF <code>I18nUtility.getValue</code> API's will
	automatically inject the contextual help which you provide around the
	content surrounded by the special <code>&lt;contextual_help&gt;...&lt;/contextual_help&gt;</code>
	markup ("help" in this example). More on this below.</p>
	</li>
	<li>
	<p>Similarly, the SPF <code>I18nUtility.getValue</code> API's let
	you inject <a href="#help.kinds.global">global help</a> hyperlinks into
	the middle of a message. For example, you can have the following in
	your message properties:</p>
	<blockquote><pre>
key=Have questions?  &lt;global_help&gt;Read help&lt;/global_help&gt; about this portal site.
</pre></blockquote>
	<p>The SPF <code>I18nUtility.getValue</code> API's will
	automatically inject the global help hyperlink around the content
	surrounded with <code>&lt;global_help&gt;...&lt;/global_help&gt;</code>
	("Read help" in this example). This links to your portal site's
	secondary page instance of the <b>SPF global help secondary page
	type</b>, which your portal site is presumed to <a href="#help.global">produced</a>
	as described later in this document.</p>
	</li>
</ul>

<p>The <code>I18nUtility.getValue</code> API's are:</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getValue(String,PortalContext)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getValue(String,PortalContext,Object[])}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getValue(String,String,PortalContext)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getValue(String,String,PortalContext,Object[])}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getValue(String,String,PortalContext,Object[],GlobalHelpProvider[],ContextualHelpProvider[],boolean,boolean)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getValue(String,String,String,Locale)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getValue(String,String,String,Locale,Object[])}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getValue(String,String,String,Locale,Object[],GlobalHelpProvider[],ContextualHelpProvider[],boolean,boolean)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getValue(String,String,String,PortalContext)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getValue(String,String,String,PortalContext,Object[])}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getValue(String,String,String,PortalContext,Object[],GlobalHelpProvider[],ContextualHelpProvider[],boolean,boolean)}</dt>
</dl>

<p>The methods take various parameters. Here is a summary
description; please see the documentation for each method for more
information.</p>

<ul>
	<li>
	<p>The desired message key (a required <code>String</code>).</p>
	</li>

	<li>
	<p>An optional <code>String</code> giving the default message
	value. This is returned automatically to you if the given message key
	is not found. (If you do not provide the default value, then the
	message key itself is returned in that case.)</p>
	</li>

	<li>
	<p>An optional <code>String</code> component ID for a portal
	component whose resource bundle you want to read from. If you do not
	provide a component ID, then you must provide the current <code>PortalContext</code>
	and the current component in that context will be assumed - this is the
	typical model-of-use, actually.</p>
	</li>

	<li>
	<p>An optional <code>Locale</code> for which to return the
	best-candidate localized value for the message. Determination of
	best-candidate proceeds against the message files in your indicated
	component, using the Java-standard <code>ResourceBundle</code> search
	logic. If you do not provide a <code>Locale</code>, then you must
	provide the current <code>PortalContext</code> and the current locale
	indicated in that context will be assumed - that is the typical
	model-of-use, actually.</p>
	</li>

	<li>
	<p>An optional <code>Object[]</code> array containing any objects
	whose <code>toString</code> values should be inserted into any {@link
	java.text.MessageFormat} placeholders in the message. For example, in
	your message properties you can have:</p>

	<blockquote><pre>
	key=Your user ID is {0}.
	</pre></blockquote>

	<p>Then in your Java code, where <code>ctx</code> is the <code>PortalContext</code>
	and <code>userID</code> is the user ID:</p>

	<blockquote><pre>
import com.hp.it.spf.xa.i18n.portal.I18nUtility;
...
String[] args = new String[] { userID };
String msg = I18nUtility.getValue("key", ctx, args);
	</pre></blockquote>
	</li>

	<li>
	<p>An optional <code>ContextualHelpProvider[]</code> array
	containing any contextual help you wish to inject into the message.
	(What is contextual help, and what does it mean to inject it? See the <a
		href="#help.kinds.contextual">introduction to contextual help</a>
	later in this document.)</p>

	<p>For example, let's say you need to produce a UI message like
	this (where the word "secure" links to some contextual help not shown
	yet):</p>

	<img
		src="com/hp/it/spf/xa/i18n/portal/doc-files/contextualHelpLink.jpg">

	<p>Using the SPF <code>I18nUtility.getValue</code> API's, you can
	have the following in your message properties:</p>

	<blockquote><pre>
key=Your sign-in is &lt;contextual_help&gt;secure&lt;/contextual_help&gt;
</pre></blockquote>

	<p>Then, in your Java code, you can create a <a
		href="#help.contextual.java"><code>ContextualHelpProvider</code></a>
	(such as a <a
		href="#help.contextual.java.classicContextualHelpProvider"><code>ClassicContextualHelpProvider</code></a>)
	and pass it in this array. The <code>I18nUtility.getValue</code> method
	will wrap the contextual-help HTML which that <code>ContextualHelpProvider</code>
	yields, around the part of the message surrounded by the special
	&lt;contextual_help&gt;...&lt;/contextual_help&gt; markup - ie the word
	"secure". So then you can just output that message and it will contain
	the embedded contextual help, too.</p>

	<p>Returning to the example, your message properties could look
	like this:</p>

	<blockquote><pre>
key=Your sign-in is &lt;contextual_help&gt;secure&lt;/contextual_help&gt;
key.help.title=Service Portal and your security
key.help.content=Internet security is important to us...
		</pre></blockquote>

	<p>And your code would look like this, where <code>ctx</code> is
	your Vignette-provided <code>PortalContext</code> object. <b>Note:</b>
	this demonstration uses a <a
		href="#help.contextual.java.classicContextualHelpProvider"><code>ClassicContextualHelpProvider</code></a>
	and does not override any of the default style.</p>

	<blockquote><pre>
import com.hp.it.spf.xa.i18n.portal.I18nUtility;
import com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider;
...
// First get the title for the contextual help.
String helpTitle = I18nUtility.getValue("key.help.title", ctx);
// Now get the main content for the contextual help.
String helpContent = I18nUtility.getValue("key.help.content", ctx);
// Now make the classic contextual help object.  Note we don't have to set
// the link content, as I18nUtility will infer that from the special markup
// in the message.
ClassicContextualHelpProvider cchp = new ClassicContextualHelpProvider(ctx);
cchp.setTitleContent(helpTitle);
cchp.setHelpContent(helpContent);
// Now get the main message, with the contextual help embedded automatically
// inside it.
ClassicContextualHelpProvider[] cchps = new ClassicContextualHelpProvider[] {cchp};
String msg = I18nUtility.getValue("key", null, ctx, null, null, cchps, false, false);
		</pre></blockquote>

	<p>So then you could output the <code>msg</code> string to the user
	- it would look like above when rendered in the user's browser. And
	when the user clicked on the "secure" hyperlink, it would look like
	this:</p>

	<img src="com/hp/it/spf/xa/i18n/portal/doc-files/contextualHelp.jpg">

	<p>Please see the <code>I18nUtility.getValue</code> method
	documentation for more details about passing contextual help providers.
	Also see the discussion on <a href="#help.kinds.contextual">contextual
	help</a> later in this guide and in the JavaDocs - eg see the {@link
	com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider}
	documentation.</p>

	<p>Also, note that the above example illustrates the use of the
	SPF-provided "classic" rendering of contextual help (ie the {@link
	com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider} class). The
	SPF contextual-help framework is extensible to custom formats of
	contextual help, where you write and then utilize your own contextual
	help provider - see the discussion below about <a
		href="#help.contextual.java.contextualHelpProvider">creating your
	own contextual help provider</a>.</p>

	<blockquote>
	<p><b>Note 1:</b> The classic rendering of contextual help utilizes
	an "X" image on which the user can click to close the window. This is
	an image which you can supply if desired (the SPF Vignette portal
	application provides a default for you, looking as in this example).
	There are a few different ways you can supply the image:</p>
	<ul>
		<li>
		<p>Name the image whatever you like and host it anywhere
		URL-addressable. Then provide the URL of the image in your portal
		component's message resource bundle, using the <code>contextualHelp.close.url</code>
		message key. (This way you can have different URL's for different
		locales, and thus provide a localized image if desired.) Your URL can
		be relative to the portal application root, or absolute. If you plan
		to use contextual help under both HTTP and HTTPS pages on your site,
		we recommend using either an HTTPS URL for the close-button image, or
		a relative URL; if you use an HTTP close-button image URL and the user
		accesses a page with contextual help under HTTPS, the user's browser
		will typically display a warning to the user.</p>
		</li>
		<li>
		<p>Alternatively, put the image into your portal component's
		secondary support files, and put the filename of the image into your <code>contextualHelp.close.url</code>
		message property. You can have localized images; just tag them by
		locale properly, put them all into your component as secondary support
		files, and put the base filename of the image into the message
		property. It is OK to put just the base filename into the message
		property across the whole resource bundle; SPF will generate the
		actual URL for you automatically, pointing to the best-candidate among
		the localized versions of the files you supplied.</p>
		</li>
		<li>
		<p>By default, if you do not provide a <code>contextualHelp.close.url</code>
		message property, then SPF will assume the close-button image file is
		named <code>btn_close.gif</code> and is located as a secondary support
		file in your current portal component. As above, it will choose the
		best-available localized version for the user's locale.</p>
		</li>
		<li>
		<p>Lastly, if you provide no image file, SPF will default to use
		the <code>btn_close.gif</code> image provided with the SPF Vignette
		portal application itself - it looks like the "X" image shown in the
		examples here, and is the same for all locales.</p>
		</li>
	</ul>
	</blockquote>

	<blockquote>
	<p><b>Note 2:</b> Due to a current limitation, you cannot inject
	both global help and contextual help into the same message.</p>
	</blockquote>
	</li>

	<li>
	<p>An optional <code>GlobalHelpProvider[]</code> array containing
	any global help hyperlink(s) that you wish to inject into the message.
	When clicked, the global help hyperlink will open your portal site's
	global help secondary page, in a child window styled with the window
	parameters you specify. (You must have provided a secondary page for
	the SPF-provided <b>global help secondary page type</b> containing your
	desired content, as documented in <a href="#help.global">producing
	global help</a> later in this document. What is global help, and what does
	it mean to inject it? See the <a href="#help.kinds.global">introduction
	to global help</a> later in this document.)</p>
	<p>For example, say you want "Read help" in the following message
	to be linked to your site's global help secondary page:</p>

	<blockquote><pre>
	<u><font color="blue">Read help</font></u> to learn more about this Web site.
	</pre></blockquote>

	<p>Using global help injection, you can have the following in your
	component's message properties:</p>

	<blockquote><pre>
	key=&lt;global_help&gt;Read help&lt;/global_help&gt; to learn more about this Web site.
	</pre></blockquote>

	<p>Then your component Java code would look like this, where <code>ctx</code>
	is your Vignette-provided <code>PortalContext</code> object. <b>Note:</b>
	this demonstration uses a <a
		href="#help.contextual.java.classicGlobalHelpProvider"><code>ClassicGlobalHelpProvider</code></a>
	and does not override any of the default style.</p>

	<blockquote><pre>
import com.hp.it.spf.xa.i18n.portal.I18nUtility;
import com.hp.it.spf.xa.help.portal.ClassicGlobalHelpProvider;
...
ClassicGlobalHelpProvider cghp = new ClassicGlobalHelpProvider(ctx);
ClassicGlobalHelpProvider[] cghps = new ClassicGlobalHelpProvider[] {cghp};
String msg = I18nUtility.getValue("key", null, ctx, null, cghps, null, false, false);
	</pre></blockquote>

	<p>So then you could output the <code>msg</code> string to the user
	- it would look like above when rendered in the user's browser. And
	when the user clicked on the "Read help" hyperlink, it would open your
	site's global help secondary page in a classic-style child popup
	window.</p>

	<p>Please see the <code>I18nUtility.getValue</code> method
	documentation for more details about passing global help providers.
	Also see the discussion on <a href="#help.global.java">global help</a>
	later in this guide and in the JavaDocs - eg see the {@link
	com.hp.it.spf.xa.help.portal.ClassicGlobalHelpProvider} documentation.</p>

	<p>Also, note that the above example illustrates the use of the
	SPF-provided "classic" presentation of a global help hyperlink and
	popup window (ie the {@link
	com.hp.it.spf.xa.help.portal.ClassicGlobalHelpProvider} class). The SPF
	global-help framework is extensible to custom presentations of global
	help, where you write and then utilize your own provider - see the
	discussion below about <a href="#help.global.java.globalHelpProvider">creating
	your own global help provider</a>.</p>

	<blockquote>
	<p><b>Note:</b> Due to a current limitation, you cannot inject both
	global help and contextual help into the same message.</p>
	</blockquote>
	</li>

	<li>
	<p>A <code>boolean</code> switch which controls whether to escape
	any HTML meta-characters, like <code>&lt;</code> and <code>&gt;</code>,
	found in the message string. By default, they are not escaped (the
	opposite of the Vignette-standard <code>I18nUtils.getValue</code>
	behavior).</p>
	<p>For example, if your message property is this:</p>

	<blockquote><pre>
key=This is an HTML &lt;head&gt; tag.
</pre></blockquote>

	<p>Then the following code would escape the HTML inside the message
	string (where <code>ctx</code> is your current Vignette-supplied <code>PortalContext</code>
	object):</p>

	<blockquote><pre>
import com.hp.it.spf.xa.i18n.portal.I18nUtility;
...
String msg = I18nUtility.getValue("key", null, ctx, null, null, null, true, false);
// Now msg is: This is an HTML&amp;lt;head&amp;gt; tag.
	</pre></blockquote>

	<p>If you use this with a message string that contains contextual
	help, note that this policy will apply to the contextual help's title
	and content as well.</p>
	</li>

	<li>
	<p>Another <code>boolean</code> switch letting you enable or
	disable the generation of Vignette-injected <code>&lt;SPAN
	lang="..."&gt;...&lt;/SPAN&gt;</code> tags around portions of your content.
	Vignette does this in some circumstances, so this boolean lets you
	permit or disable that. It is rare that you need to use this switch, as
	the default Vignette behavior is usually adequate.</p>
	</li>
</ul>

<hr>

<a name="i18n.messages.tags">
<h3>2.4. Accessing message resources using JSP tag libraries</h3>
</a>

<p>Once your message resources have been created and placed <a
	href="#i18n.location">as discussed above</a>, you can begin to access
best-fit localized text strings for your user from them in your JSP's.
You may use either the standard Vignette-provided JSP tags for doing
this (such as <code>&lt;vgn-portal:i18nValue&gt;</code>) or
(recommended) the SPF-provided tags.</p>

<p><b>Note:</b> In both cases, raw Java API's are available for you
to use if you prefer, instead of the JSP tag libraries. See the <a
	href="#i18n.messages.java">API descriptions</a> above.</p>

<a name="i18n.messages.jsp.vignette.message">
<h4>2.4.1. Using Vignette (eg <code>&lt;vgn-portal:i18nValue&gt;</code>)</h4>
</a>

<p>Vignette makes a couple of JSP tags available for
internationalized access to your portal component's message resources:</p>

<ul>
	<li><code>&lt;vgn-portal:i18nValue&gt;</code></li>
	<li><code>&lt;vgn-portal:i18nParam&gt;</code></li>
</ul>

<p>See the Vignette Portal Developer's Guide for how to use these
tags.</p>

<p><b>Note:</b> If you use the Vignette tags, you will not benefit
from any of the <a href="#i18n.messages.jsp.spf.message">enhanced
message capabilities</a> supported by the SPF tags.</p>

<a name="i18n.messages.jsp.spf.message">
<h4>2.4.2. Using SPF (<code>&lt;spf-i18n-portal:i18nValue&gt;</code>,
<code>&lt;spf-i18n-portal:i18nParam&gt;</code>, <code>&lt;spf-i18n-portal:i18nClassicContextualHelpParam&gt;</code>,
and <code>&lt;spf-i18n-portal:i18nClassicGlobalHelpParam&gt;</code>)</h4>
</a>

<p>The SPF portal utilities provide a JSP tag library which wraps
around <a href="#i18n.messages.java.spf.getMessage"><code>I18nUtility.getValue</code></a>
to offer the same extended message-handling capabilities. Just as with <code>I18nUtility.getValue</code>,
with the SPF portal utilities' message-handling JSP tags, you can:</p>

<ul>
	<li>
	<p>Control whether HTML meta-characters like &lt; and &gt; in the
	expressed message are escaped (for literal display).</p>
	</li>

	<li>
	<p>Control whether Vignette auto-generates <code>&lt;SPAN&gt;</code>
	markup in the expressed message.</p>
	</li>

	<li>
	<p>Use <code>MessageFormat</code>-style placeholders in your
	message string (<code>{0}</code>, <code>{1}</code>, etc) and
	interpolate them with string parameters you supply.</p>
	</li>

	<li>
	<p>Use <code>&lt;no_localization&gt;...&lt;/no_localization&gt;</code>
	in your message values to signal to translators that they should leave
	the contents untranslated - the SPF will automatically remove that
	markup if the translator did not do so already.</p>
	</li>

	<li>
	<p>Use <code>&lt;contextual_help&gt;...&lt;/contextual_help&gt;</code>
	in your message values to inject HPWeb classic-style contextual help
	into the middle of a message (thus avoiding possible translation
	problems which could occur if you broke the message into pieces and
	used standalone contextual help).</p>
	</li>

	<li>
	<p>Use <code>&lt;global_help&gt;...&lt;/global_help&gt;</code> in
	your message values to inject HPWeb classic-style global help popup
	hyperlinks into the middle of a message.</p>
	</li>
</ul>

<p>The SPF message-handling tags are thoroughly documented in the <a
	href="com/hp/it/spf/xa/i18n/portal/tag/package-summary.html#message">package
description</a>. Briefly, they are:</p>

<dl>
	<dt>
	<p><a
		href="com/hp/it/spf/xa/i18n/portal/tag/package-summary.html#message"><code>&lt;spf-i18n-portal:i18nValue&gt;</code></a></p>
	</dt>

	<dd>
	<p>This tag is the main message tag for the SPF. It takes a message
	key and (optionally) a default value for the message; a component ID
	(for another portal component whose message resources you need to
	access - by default the current component is assumed); and boolean
	switches for HTML-escaping the message value and filtering
	Vignette-generated <code>&lt;SPAN&gt;</code> tags. The usage is:</p>

	<blockquote><pre>
&lt;%@ taglib prefix="spf-i18n-portal" uri="/spf-i18n-portal.tld" %&gt;
...
&lt;spf-i18n-portal:i18nValue
	stringID="<i>component-id</i>"
	key="<i>message-key</i>"
	defaultValue="<i>default-value</i>"
	escape="<i>true-or-false</i>"
	filterSpan="<i>true-or-false</i>"
	/&gt;
</pre></blockquote>

	<p>For example, consider this message property in your resource
	bundle:</p>

	<blockquote><pre>
key=This is an HTML &lt;head&gt; tag.
</pre></blockquote>

	<p>If you wanted the HTML embedded inside the message value to
	render literally, you would use this:</p>

	<blockquote><pre>
&lt;%@ taglib prefix="spf-i18n-portal" uri="/spf-i18n-portal.tld" %&gt;
...
&lt;spf-i18n-portal:i18nValue key="key" escape="true" /&gt;
</pre></blockquote>

	<p>In addition, the body of the <code>&lt;spf-i18n-portal:i18nValue&gt;</code>
	tag may contain the following tags, zero or more times.</p>
	</dd>

	<dt>
	<p><a
		href="com/hp/it/spf/xa/i18n/portal/tag/package-summary.html#param"><code>&lt;spf-i18n-portal:i18nParam&gt;</code></a></p>
	</dt>
	<dd>
	<p>This tag is only used inside the tag body of <code>&lt;spf-i18n-portal:i18nValue&gt;</code>.
	You use it to pass a string into a {@link java.text.MessageFormat}
	placeholder in the message value. The usage is:</p>

	<blockquote><pre>
&lt;%@ taglib prefix="spf-i18n-portal" uri="/spf-i18n-portal.tld" %&gt;
...
&lt;spf-i18n-portal:i18nParam value="<i>string</i>" /&gt;
</pre></blockquote>

	<p>For example, if your message properties contain this:</p>

	<blockquote><pre>
key=Your name is {0} and your age is {1}.
</pre></blockquote>

	<p>Then you would populate the parameters with your <code>name</code>
	and <code>age</code> variables as follows:</p>

	<blockquote><pre>
&lt;%@ taglib prefix="spf-i18n-portal" uri="/spf-i18n-portal.tld" %&gt;
...
&lt;spf-i18n-portal:i18nValue key="key"&gt;
	&lt;spf-i18n-portal:i18nParam value="&lt;%= name %&gt;" /&gt;
	&lt;spf-i18n-portal:i18nParam value="&lt;%= age %&gt;" /&gt;
&lt;/spf-i18n-portal:i18nValue&gt;
</pre></blockquote>
	</dd>

	<dt>
	<p><a href="#help.contextual.jsp.classicContextualHelpParam"><code>&lt;spf-i18n-portal:i18nClassicContextualHelpParam&gt;</code></a></p>
	</dt>
	<dd>
	<p>This tag is only used inside the tag body of <code>&lt;spf-i18n-portal:i18nValue&gt;</code>.
	You use it to inject contextual help into the message value, where the
	special <code>&lt;contextual_help&gt;...&lt;/contextual_help&gt;</code>
	markup is found. The format of contextual help which is injected is the
	"classic" rendition.</p>

	<p>This tag is documented in the <a href="#help">Online Help</a>
	section in this guide. Please see the <a
		href="#help.contextual.jsp.classicContextualHelpParam"><code>&lt;spf-i18n-portal:i18nClassicContextualHelpParam&gt;</code></a>
	documentation there.</p>
	</dd>

	<dt>
	<p><a href="#help.contextual.jsp.contextualHelpProvider">Parameters
	for custom renditions of contextual help</a></p>
	</dt>
	<dd>
	<p>The SPF provides you with the <code>&lt;spf-i18n-portal:i18nClassicContextualHelpParam&gt;</code>
	(see above) which gives you a JSP tag for injecting the "classic"
	rendition of contextual help into a message. The SPF contextual help
	framework is extensible, however, and you can create your own rendition
	of contextual help instead. First you would <a
		href="#help.contextual.java.contextualHelpProvider">create your
	custom contextual help provider</a>, then you would <a
		href="#help.contextual.jsp.contextualHelpProvider">create a custom
	contextual help provider parameter tag</a> for it. Please see the
	documentation below.</p>
	</dd>

	<dt>
	<p><a href="#help.global.jsp.classicGlobalHelpParam"><code>&lt;spf-i18n-portal:i18nClassicGlobalHelpParam&gt;</code></a></p>
	</dt>
	<dd>
	<p>This tag is only used inside the tag body of <code>&lt;spf-i18n-portal:i18nValue&gt;</code>.
	You use it to inject a hyperlink pointing to your portal site's <b>global
	help secondary page</b>, which your site is presumed to <a
		href="#help.global">produce</a> (as described later in this document).
	The hyperlink is injected wherever the special <code>&lt;global_help&gt;...&lt;/global_help&gt;</code>
	markup is found. The global help hyperlink which is injected opens the
	secondary page in a child popup window, according to the window
	features you specify.</p>

	<p>This tag is documented in the <a href="#help">Online Help</a>
	section in this guide. Please see the <a
		href="#help.global.jsp.classicGlobalHelpParam"><code>&lt;spf-i18n-portal:i18nClassicGlobalHelpParam&gt;</code></a>
	documentation there.</p>
	</dd>

	<dt>
	<p><a href="#help.global.jsp.globalHelpProvider">Parameters for
	custom renditions of global help hyperlinks</a></p>
	</dt>
	<dd>
	<p>The SPF provides you with the <code>&lt;spf-i18n-portal:i18nClassicGlobalHelpParam&gt;</code>
	(see above) which gives you a JSP tag for injecting the "classic" style
	of hyperlink to the global help secondary page into a message. The SPF
	is extensible, however, and you can create your own manner of global
	help hyperlinks instead. First you would <a
		href="#help.global.java.globalHelpProvider">create your custom
	global help provider</a>, then you would <a
		href="#help.global.jsp.globalHelpProvider">create a custom global
	help provider parameter tag</a> for it. Please see the documentation below.</p>
	</dd>

</dl>

<p>The SPF message-handling tags are thoroughly documented in the <a
	href="com/hp/it/spf/xa/i18n/portal/tag/package-summary.html#message">package
description</a>. Please see that documentation for more information.</p>

<hr>

<a name="i18n.supporting.java">
<h3>2.5. Accessing supporting resources using Java code</h3>
</a>

<p>Once your supporting resources have been created and placed into
your component as secondary support files, <a href="#i18n.location">as
discussed above</a>, you can begin to access them using the SPF portal <code>I18nUtility</code>
class. There are 3 ways of access supported:</p>

<ul>
	<li>
	<p>You can get a URL pointing to the particular supporting resource
	file in a bundle which best-fits the user's locale. You can then output
	that URL to the user - for example, inside an HTML <code>&lt;IMG&gt;</code>
	tag as the <code>SRC</code> attribute, to display the proper localized
	version of any image to the user. Use the <a
		href="#i18n.supporting.java.getLocalizedFileURL"><code>I18nUtility.getLocalizedFileURL</code></a>
	methods for this.</p>
	</li>

	<li>
	<p>If you need to process the file server-side instead, you can get
	an {@link java.io.InputStream} for the particular one which best-fits
	the user's locale. Use the <a
		href="#i18n.supporting.java.getLocalizedFileStream"><code>I18nUtility.getLocalizedFileStream</code></a>
	methods for this.</p>
	</li>

	<li>
	<p>If you need to just check what the best-fit localized file in a
	particular bundle of supporting resource files would be, and whether it
	exists, then you can use the <a
		href="#i18n.supporting.java.getLocalizedFileName"><code>I18nUtility.getLocalizedFileName</code></a>
	methods for this.</p>
	</li>
</ul>

<a name="i18n.supporting.java.getLocalizedFileURL">
<h4>2.5.1. Using <code>I18nUtility.getLocalizedFileURL</code></h4>
</a>

<blockquote>
<p><b>Note:</b> There is an SPF-provided JSP tag library for this -
see <a href="#i18n.supporting.jsp.localizedFileURL"><code>&lt;spf-i18n-portal:localizedFileURL&gt;</code></a>
description below.</p>
</blockquote>

<p>These methods return a URL string which the user's browser can
use to access the proper localized version of a supporting resource (ie
secondary support file, <a href="#i18n.location">as discussed above</a>)
for the user's locale. The returned URL string will point to the
best-fit secondary support file in your portal component, and will be
ready for output to the user (eg, in the <code>SRC</code> attribute of
an HTML <code>&lt;IMG&gt;</code> tag).</p>

<p>The <code>I18nUtility.getLocalizedFileURL</code> methods are:</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileURL(PortalContext,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileURL(PortalContext,String,boolean)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileURL(PortalContext,String,Locale,boolean)}</dt>
	<dd>

	<p>These methods take the base filename of the supporting resource
	bundle, which <a href="#i18n.location">as discussed above</a> should be
	stored in your portal component CAR as secondary support files. The
	methods use the Java-standard {@link java.util.ResourceBundle} search
	sequence for finding the best-fit file in your bundle for the user's
	locale. The methods then return a URL for that file, suitable for
	presentation to the browser (for example, you could express the
	returned URL in an <code>&lt;IMG SRC="..."&gt;</code> tag).</p>

	<p>For example, to get the best-fit localized URL for the <code>picture.jpg</code>
	image, out of all of the localizations of that image stored as
	secondary support files in the current portal component (where <code>ctx</code>
	is the current Vignette <code>PortalContext</code> object):</p>

	<blockquote><pre>
import com.hp.it.spf.xa.i18n.portal.I18nUtility;
...
String url = I18nUtility.getLocalizedFileURL(ctx, "picture.jpg");
	</pre></blockquote>

	<p>Continuing this example, assume the bundle of <code>picture.jpg</code>
	files in the portal component consists of the following:</p>

	<blockquote><pre>
picture.jpg
picture_pt_BR.jpg
picture_pt.jpg
</pre></blockquote>

	<p>If the user presents with a Portugal Portuguese (<code>pt-PT</code>)
	locale, then the above code will return a URL for the <code>picture_pt.jpg</code>)
	since, per the Java-standard <code>ResourceBundle</code> search
	sequence, that is the best-candidate file for the user.</p>

	<p>If the resource bundle for the given basename simply is not
	found, though, then a URL pointing to the basename (eg <code>picture.jpg</code>)
	will be returned by default. (This will cause a 404 error if later
	opened by the browser, making a missing resource obvious and detectable
	during testing.)</p>

	<p>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileURL(PortalContext,String,Locale,boolean)}
	is the core API which all the others feed into. Here is a summary of
	the parameters it takes; the others take a subset of these. See the
	method documentation for more information.</p>

	<ul>
		<li>
		<p>The current Vignette <code>PortalContext</code> object
		(required).</p>
		</li>
		<li>
		<p>The base filename (required).</p>
		</li>
		<li>
		<p>The {@link java.util.Locale} to use when searching for the
		best-fit candidate file. By default, the locale for the current user
		request, stored inside the <code>PortalContext</code> object, is used.</p>
		</li>
		<li>
		<p>The boolean switch, set to <code>false</code>, lets you just
		lookup the given base file itself, without attempting to find the best
		candidate. By default, this switch is <code>true</code> (enabling the
		best-localized-candidate search).</p>
		</li>
	</ul>
	</dd>

	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileURL(PortalContext,String,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileURL(PortalContext,String,String,Locale)}</dt>
	<dd>
	<p>These methods get the localized file differently. You give them
	a message key and they lookup that message in your portal component's
	message resource bundle. This message lookup proceeds as described for
	the <a href="#i18n.messages.java.spf.getMessage"><code>I18nUtility.getValue</code></a>
	API's above. The message value is then treated as the name of the
	localized (not base) file. If no actual file exists among your
	secondary support files matching that value, then a URL pointing to it
	anyway will be returned. (As above, this will intentionally cause a 404
	error should the browser open it.)</p>

	<blockquote>
	<p><b>Note:</b>These methods offer no real advantage over the
	others, since they are more cumbersome to setup (you need to make sure
	that the proper localized filenames for each locale get put - eg by the
	translators - into the message properties file for that locale).
	Therefore we recommend using the other methods.</p>
	</blockquote>

	<p>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileURL(PortalContext,String,String,Locale)}
	is the core API which the other method feeds into. Here is a summary of
	the parameters it takes; the other method takes a subset of these. See
	the method documentation for more information.</p>

	<ul>
		<li>
		<p>The current Vignette <code>PortalContext</code> object
		(required).</p>
		</li>
		<li>
		<p>The message key string for the localized filename (required).</p>
		</li>
		<li>
		<p>The default value string to use for the localized filename, if
		the message is not found.</p>
		<li>
		<p>The {@link java.util.Locale} to use when searching for the
		best-fit candidate file. By default, the locale for the current user
		request, inside the <code>PortalContext</code> object, is used.</p>
		</li>
	</ul>
	</dd>
</dl>

<a name="i18n.supporting.java.getLocalizedFileStream">
<h4>2.5.2. Using <code>I18nUtility.getLocalizedFileStream</code></h4>
</a>

<p>Instead of returning a URL string, these methods return an {@link
java.io.InputStream} for the proper localized version of a supporting
resource, given the user's locale. If no appropriate file could be
found, then they return <code>null</code>. Otherwise they operate the
same as the <a href="#i18n.supporting.java.getLocalizedFileURL"><code>I18nUtility.getLocalizedFileURL</code></a>
methods (see above).
<p>The <code>I18nUtility.getLocalizedFileStream</code> methods are:</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileStream(PortalContext,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileStream(PortalContext,String,boolean)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileStream(PortalContext,String,Locale,boolean)}</dt>
	<dd>
	<p>These methods take the base filename of the supporting resource
	bundle. For example, here is how we get an <code>InputStream</code> for
	the best-candidate <code>something.xml</code> file in the user's
	locale. This file (and its localized versions) in this example are
	stored as secondary support files in the current portal component, <a
		href="#i18n.location">as discussed earlier</a>. In this example, <code>ctx</code>
	is the current <code>PortalContext</code> object.</p>

	<blockquote><pre>
import com.hp.it.spf.xa.i18n.portal.I18nUtility;
...
InputStream file = I18nUtility.getLocalizedFileStream(ctx, "something.xml");
	</pre></blockquote>

	<p>So, if the best-fit localized file in the <code>something.xml</code>
	bundle was <code>something_ja_JP.xml</code>, then that is the <code>InputStream</code>
	that will be returned. <code>null</code> is returned if no good
	candidate exists.</p>

	<p>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileStream(PortalContext,String,Locale,boolean)}
	is the core API which the others feed into. Here is a summary of the
	parameters it takes; the others take a subset of these. See the method
	documentation for more information.</p>

	<ul>
		<li>
		<p>The current Vignette <code>PortalContext</code> object
		(required).</p>
		</li>
		<li>
		<p>The base filename (required).</p>
		</li>
		<li>
		<p>The {@link java.util.Locale} to use when searching for the
		best-fit candidate file. By default, the locale for the current user
		request, inside the <code>PortalContext</code> object, is used.</p>
		</li>
		<li>
		<p>The boolean switch, set to <code>false</code>, lets you just
		lookup the given base file itself, without attempting to find the best
		candidate. By default, this switch is <code>true</code> (enabling the
		best-localized-candidate search).</p>
		</li>
	</ul>
	</dd>

	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileStream(PortalContext,String,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileStream(PortalContext,String,String,Locale)}</dt>
	<dd>
	<p>This method gets the localized file differently. You give it a
	message key and it looks up that message in your message resource
	bundles. The message value is then treated as the name of the localized
	(not base) file, and an <code>InputStream</code> is returned for it (or
	<code>null</code> if it does not exist).</p>

	<blockquote>
	<p><b>Note:</b>Using this method offers no real advantage over the
	others, and is more cumbersome to setup (you need to make sure that the
	proper localized filenames for each locale, get into the message
	properties file for that locale). Therefore we recommend using the
	other methods.</p>
	</blockquote>

	<p>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileStream(PortalContext,String,String,Locale)}
	is the core API which the other method feeds into. Here is a summary of
	the parameters it takes; the other method takes a subset of these. See
	the method documentation for more information.</p>

	<ul>
		<li>
		<p>The current Vignette <code>PortalContext</code> object
		(required).</p>
		</li>
		<li>
		<p>The message key string for the localized filename (required).</p>
		</li>
		<li>
		<p>The default value string to use for the localized filename, if
		the message is not found.</p>
		<li>
		<p>The {@link java.util.Locale} to use when searching for the
		best-fit candidate file. By default, the locale for the current user
		request, inside the <code>PortalContext</code> object, is used.</p>
		</li>
	</ul>
	</dd>
</dl>

<a name="i18n.supporting.java.getLocalizedFileName">
<h4>2.5.3. Using <code>I18nUtility.getLocalizedFileName</code></h4>
</a>

<p>Instead of returning either a URL string or an {@link
java.io.InputStream}, these methods just lookup the best-fit localized
version of the file for the user's locale, and return its filename. The
methods return <code>null</code> if no good candidate was found. These
methods are most useful as a test of whether a particular resource
exists inside your portal component.</p>

<p>The <code>I18nUtility.getLocalizedFileName</code> methods are:</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileName(PortalContext,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileName(PortalContext,String,boolean)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileName(PortalContext,String,Locale,boolean)}</dt>
	<dd>
	<p>These methods take the base filename of the supporting resource
	bundle, and look for the best-fit localized version of that file for
	the user's locale inside the current portal component. For example,
	here is how we check whether any good-candidate localized version of <code>something.xml</code>
	exists in the portal component). The <code>PortalContext</code> object
	here is named <code>ctx</code>:</p>

	<blockquote><pre>
import com.hp.it.spf.xa.i18n.portal.I18nUtility;
...
if (I18nUtility.getLocalizedFileName(ctx, "something.xml") != null) {
... // exists among portal component's support files
}
	</pre></blockquote>

	<p>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileName(PortalContext,String,Locale,boolean)}
	is the core API which the others feed into. Here is a summary of the
	parameters it takes; the others take a subset of these. See the method
	documentation for more information.</p>

	<ul>
		<li>
		<p>The current Vignette <code>PortalContext</code> object
		(required).</p>
		</li>
		<li>
		<p>The base filename (required).</p>
		</li>
		<li>
		<p>The {@link java.util.Locale} to use when searching for the
		best-fit candidate file. By default, the locale for the current user
		request, inside the <code>PortalContext</code> object, is used.</p>
		</li>
		<li>
		<p>The boolean switch, set to <code>false</code>, lets you just
		lookup the given base file itself, without attempting to find the best
		candidate. By default, this switch is <code>true</code> (enabling the
		best-localized-candidate search).</p>
		</li>
	</ul>
	</dd>
</dl>

<hr>

<a name="i18n.supporting.jsp">
<h3>2.6. Accessing supporting resources using JSP tag libraries</h3>
</a>

<p>Once your supporting resources have been created and placed <a
	href="#i18n.location">as discussed above</a>, you can begin to generate
best-fit localized URL's for them in your JSP's. For example, you can
stick them into HTML <code>&lt;IMG&gt;</code> tag <code>SRC</code>
attributes.</p>

<a name="i18n.supporting.jsp.localizedFileURL">
<h4>2.6.1. Using <code>&lt;spf-i18n-portal:localizedFileURL&gt;</code></h4>
</a>

<p>The SPF portal utilities provide a JSP tag, <code>&lt;spf-i18n-portal:localizedFileURL&gt;</code>,
which wraps around <a href="#i18n.supporting.java.getLocalizedFileURL"><code>I18nUtility.getLocalizedFileURL</code></a>
to offer most of the same capabilities. It is thoroughly documented in
the <a
	href="com/hp/it/spf/xa/i18n/portal/tag/package-summary.html#localizedFileURL">package
description</a>. Briefly:</p>

<dl>
	<dt>
	<p><a
		href="com/hp/it/spf/xa/i18n/portal/tag/package-summary.html#localizedFileURL"><code>&lt;spf-i18n-portal:localizedFileURL&gt;</code></a></p>
	</dt>

	<dd>
	<p>This tag takes the base filename of your bundle of secondary
	support files; or (optionally) a message key for a message resource
	which indicates the localized file name. The usage is:</p>

	<blockquote><pre>
&lt;%@ taglib prefix="spf-i18n-portal" uri="/spf-i18n-portal.tld" %&gt;
...
&lt;spf-i18n-portal:localizedFileURL
	file="<i>base-file</i>"
	fileKey="<i>localized-file-message-key</i>"
	/&gt;
</pre></blockquote>

	<p>The <code>file</code> attribute lets you provide the base
	filename (same as the {@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileURL(PortalContext,String)}
	method). The <code>fileKey</code> attribute lets you alternatively
	provide a message key pointing to the localized filename (same as the
	{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocalizedFileURL(PortalContext,String,String)}
	method). The <code>file</code> attribute takes priority. As mentioned
	above, there usually is no reason to prefer using the <code>fileKey</code>
	attribute.</p>

	<p>For example, imagine we have the <code>picture.jpg</code> bundle
	of images in our portal component:</p>

	<blockquote><pre>
picture.jpg
picture_zh_TW.jpg
picture_zh_HK.jpg
picture_zh.jpg
</pre></blockquote>

	<p>The following JSP code displays the proper localized version of
	that image in the browser:</p>

	<blockquote><pre>
&lt;%@ taglib prefix="spf-i18n-portal" uri="/spf-i18n-portal.tld" %&gt;
...
&lt;img src='&lt;spf-i18n-portal:localizedFileURL file="picture.jpg" /&gt;'&gt;
</pre></blockquote>

	<p>When the user's locale is Hong Kong Chinese (<code>zh-HK</code>),
	then a URL for <code>picture_zh_HK.jpg</code> will be expressed into
	the <code>&lt;IMG&gt;</code> tag. When the user's locale is China
	Chinese (<code>zh-CN</code>), then a URL for <code>picture_zh.jpg</code>
	will be expressed, since that is the best available candidate file for
	that locale. When the user's locale is Japanese, then a URL for <code>picture.jpg</code>
	will be expressed, for the same reason.</p>

	<p>See the tag documentation, in the <a
		href="com/hp/it/spf/xa/i18n/portal/tag/package-summary.html#localizedFileURL">package
	description</a>, for more information.</p>
	</dd>
</dl>

<hr>

<a name="i18n.locale.selector">
<h3>2.7. Generating the locale selector</h3>
</a>

<p>A <i>locale selector</i> is a widget letting the user choose his
or her preferred locale. SPF provides the framework necessary to
generate the locale selector for your portal site. This includes:</p>

<blockquote>
<dl>
	<dt>
	<p>A Java class (<a href="#i18n.locale.selector.java"><code>ClassicLocaleSelectorProvider</code></a>),
	JSP tag (<a href="#i18n.locale.selector.jsp"><code>&lt;spf-i18n-portal:classicLocaleSelector&gt;</code></a>),
	and Vignette component (<a href="#i18n.locale.selector.style"><code>spf-locale-selector-classic-style</code></a>)
	for expressing the HTML for an HPWeb "classic"-style locale selector
	input form.</p>
	</dt>
	<dd>
	<p>This includes an optional label, an HTML <code>&lt;SELECT&gt;</code>
	element listing all available locales for your portal site as <code>&lt;OPTION&gt;</code>'s
	(with the current locale pre-selected), and a submit button linked to
	the SPF-provided processing logic (see below). For example, it looks
	like this:</p>

	<img
		src="com/hp/it/spf/xa/i18n/portal/doc-files/classicLocaleSelector.jpg">

	<p>You just <a href="#i18n.other.locale.config">configure the
	available locales</a> for your portal site, then use the <a
		href="#i18n.locale.selector.java"><code>ClassicLocaleSelectorProvider</code></a>
	or <a href="#i18n.locale.selector.jsp"><code>&lt;spf-i18n-portal:classicLocaleSelector&gt;</code></a>
	to surface the classic locale selector anywhere in your portal
	component. (When coding with the class or tag, you can provide any
	desired label text, sort order and display treatment for the locales in
	the list, and desired decorative CSS to add to the widget.) If you
	would rather surface the classic locale selector through Vignette, as a
	style in your grid, you can use the <a
		href="#i18n.locale.selector.style"><code>spf-locale-selector-classic-style</code></a>
	instead of coding your own component using the class or tag.</p>
	</dd>

	<dt>
	<p>A Java abstract base class (<a
		href="#i18n.locale.selector.extend"><code>LocaleSelectorProvider</code></a>)
	for extending and creating other renderings of the locale selector
	form, if desired.</p>
	</dt>
	<dd>
	<p>For most purposes, though, the provided classic locale selector
	should suffice. (An HPWeb "enhanced" JasperJohns version of the locale
	selector has been requested from the SPF team.)</p>
	</dd>

	<dt>
	<p>A backing Vignette secondary page type and secondary page (<a
		href="#i18n.locale.selector.process"><code>spf-locale-selector-secondarypagetype</code>
	and <code>spf-locale-selector-secondarypage</code></a>) containing the
	processing logic for persisting the user selection from the locale
	selector form.</p>
	</dt>
	<dd>
	<p>You need to configure these components in the Vignette console
	to be executable within the scope of your portal site, but no
	customization or coding for them is needed. The locale selector form
	points at this secondary page, and after it persists the user's
	selection, it redirects back to the previous page (or whatever other
	target you pass to it from the form).</p>
	</dd>
</dl>
</blockquote>

<blockquote>
<p><b>Note:</b> SPF supports the locale selector only on the portal
side. No support is provided for portlets to generate a locale selector.
It was felt during design that locale selection was a portal
responsibility about which portlets should properly be agnostic.</p>
</blockquote>

<a name="i18n.locale.selector.java">
<h4>2.7.1. Using <code>ClassicLocaleSelectorProvider</code></h4>
</a>

<p>{@link
com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider} is a Java
class which generates the HTML markup for the HPWeb "classic" version of
a locale selector form. You construct a <code>ClassicLocaleSelectorProvider</code>
object, set the desired attributes, and then call one of the <code>getHTML</code>
methods to get the generated HTML string. This string can then be
expressed wherever you would like the locale selector to appear, in your
portal component JSP.</p>

<blockquote>
<p><b>Note:</b> A <a href="#i18n.locale.selector.jsp">JSP tag</a>, <code>&lt;spf-i18n-portal:classicLocaleSelector&gt;</code>,
offering most of the same functionality is also available (see next
section). There are some differences; with the tag, a label is required
whereas with <code>ClassicLocaleSelectorProvider</code> it is optional.</p>
</blockquote>

<p>For example, say you wanted to produce a classic locale selector
widget including a <code>Language:</code> label, with each locale option
displayed country first (eg "Australia-English"), localized according to
its own locale, and sorted in the collating sequence of the current
locale. Here is how you would do it. First, add the label to your
message resources using whatever message key name you like. For example
(in the base message properties):</p>

<blockquote><pre>
localeSelector.label = Language:
</pre></blockquote>

<p>Next, use the following Java code in your portal component action
class or JSP (here the <code>portalContext</code> and <code>request</code>
objects are your current Vignette <code>PortalContext</code> and <code>HttpServletRequest</code>,
respectively):</p>

<blockquote><pre>
import com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider;
import com.hp.it.spf.xa.i18n.portal.I18nUtility;
...
Locale currentLocale = I18nUtility.getLocale(request);
String label = I18nUtility.getValue("localeSelector.label", portalContext);
...
ClassicLocaleSelectorProvider selector = new ClassicLocaleSelectorProvider(portalContext);
selector.setLabelContent(label);
// Current locale is default; do not need to make this call, but shown for illustration.
selector.setSortLocale(currentLocale);
// Null (meaning each in its own locale) is default; do not need to make this call, but
// shown for illustration.
selector.setDisplayLocale(null);
// Country-first is default; do not need to make this call, but shown for illustration.
selector.setOrder(ClassicLocaleSelectorProvider.ORDER_COUNTRY_FIRST);
// Workaround for MSIE does not cascade CSS into &lt;select&gt;
selector.setListStyle("font-family: Arial;font-size: 12px;");
String html = selector.getHTML(false);
</pre></blockquote>

<p>Note the use of a workaround for an MSIE problem; since MSIE
would not cascade the CSS font style of the surrounding page into the
select options, we had to set it specifically using {@link
com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider#setListStyle(String)}.
The resulting <code>html</code> string is ready for you to express in
your JSP. When rendered in a browser, it would look like this:</p>

<img
	src="com/hp/it/spf/xa/i18n/portal/doc-files/classicLocaleSelector.jpg">

<blockquote>
<p><b>Note 1:</b> The actual list of locale options is something you
<a href="#i18n.other.locale.config">configure for Vignette</a> - see
separate discussion below. Also, be sure to <a
	href="#i18n.locale.selector.process">configure the <code>spf-locale-selector-secondarypagetype</code>
and <code>spf-locale-selector-secondarypage</code></a> in Vignette, for the
processing logic (invoked when the user clicks the submit button) to
work. Note that processing logic will redirect the user to the original
URL for the page that included your portal component (this URL is
obtained by the locale selector automatically, using {@link
com.hp.it.spf.xa.misc.portal.Utils#getRequestURL(HttpServletRequest)}.
So when the user clicks the submit button, he or she will return to the
same page (with the new locale selection in effect for this and
subsequent pages) after the selection is silently persisted.</p>
</blockquote>

<blockquote>
<p><b>Note 2:</b> The submit button image is, by default, rendered
from the HP.com servers at <a
	href="http://welcome.hp-ww.com/img/hpweb_1-2_arrw_sbmt.gif">http://welcome.hp-ww.com/img/hpweb_1-2_arrw_sbmt.gif</a>.
However you can override this with your own submit button image if
desired. Name your image file <code>btn_submit.gif</code> and include it
among the secondary support files in your component. You can actually
include a whole bundle of localized submit button images, each tagged by
locale appropriately and sharing that same basename.</p>

<p>The alt text for the submit button image can be provided by you
inside your portal component, if desired. (By default, there is no alt
text.) Just add the <code>localeSelector.submit.alt</code> message key
to your current portal component's message resource bundle, like this:</p>

<blockquote><pre>
localeSelector.submit.alt = Change country and language
</pre></blockquote>
</blockquote>

<p>Here is a summary of the methods supported by {@link
com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider}; please see
the class JavaDoc for more information.</p>

<blockquote>
<dl>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider#ClassicLocaleSelectorProvider(PortalContext)}</dt>
	<dd>
	<p>The class constructor, which must be given your current
	Vignette-supplied <code>PortalContext</code> object.</p>
	</dd>

	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider#setLabelContent(String)}</dt>
	<dd>
	<p>An optional setter for the label text, if any is desired. If
	localization is desired, it should be provided already localized. The
	boolean parameters on the <code>getHTML</code> methods (see below) will
	control whether this label is escaped or includes Vignette-generated <code>&lt;SPAN&gt;</code>
	markup. Thus, for example, if you choose not to escape the HTML output
	when calling <code>getHTML</code>, your label text string may contain
	actual HTML that gets rendered by the browser as such.</p>
	<p><font color="red"><b>Coming soon:</b></font> The label you
	provide is tagged for accessibility purposes as the label for the
	select widget. If you do not provide any label string, then a hidden
	label (visible only by screen-reading devices) can still implicitly be
	provided by you, in the <code>localeSelector.label.alt</code> message
	key in your component's message resource bundle. This is only used when
	a label string is not provided with the <code>setLabelContent(String)</code>
	setter; if you use that setter, it overrides the hidden screen-reader
	label.</p>
	</dd>

	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider#setLabelStyle(String)}<br>
	{@link
	com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider#setLabelClass(String)}</dt>
	<dd>
	<p>Alternative optional methods for applying some arbitrary inline
	CSS styling to the label text string you provided. If you use the <code>setLabelStyle</code>
	method, you should pass one or more CSS properties pertaining to the
	contents of your label string, like <code>font-family: Arial;
	font-size: 12px</code>. If you use the <code>setLabelClass</code> method, you
	should pass the classname of a CSS class you have defined elsewhere on
	the page, which contains such properties. Whatever you provide is
	applied only to the label text string you provided with the {@link
	com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider#setLabelContent(String)}
	method, so if you have no label content these methods are meaningless.
	By default, no inline CSS is applied to your label content (thus
	whatever CSS is used on the surrounding page will cascade into the
	label content automatically, as usual).</p>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider#setListStyle(String)}<br>
	{@link
	com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider#setListClass(String)}</dt>
	<dd>
	<p>Alternative optional methods for applying some arbitrary inline
	CSS styling to the locale options displayed inside the <code>&lt;SELECT&gt;</code>
	list. If you use the <code>setListStyle</code> method, you should pass
	one or more CSS properties supported by <code>&lt;SELECT&gt;</code>,
	such as font properties like <code>font-family: Arial;font-size:
	12px</code>. If you use the <code>setListClass</code> method, you should pass
	the classname of a CSS class you have defined elsewhere on the page,
	which contains such properties. By default, no inline CSS is applied to
	your list options, and thus whatever CSS on the surrounding page will
	cascade into the list options as usual.</p>
	<blockquote>
	<p><b>Note:</b> At least some versions of MSIE have a bug in which
	surrounding CSS does <b>not</b> cascade into the options of a <code>&lt;SELECT&gt;</code>
	element. So you may use either of these methods to workaround that.</p>
	</blockquote>
	</dd>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider#setOrder(int)}</dt>
	<dd>
	<p>Controls the order of country and language name for any full
	locales in the list, like Australian English. You provide one of the
	following flags:</p>
	<dl>
		<dt>{@link
		com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider#ORDER_COUNTRY_FIRST}</dt>
		<dd>Country sorts and displays first, then language. This is the
		default. Example: <code>Australia-English</code></dd>
		<dt>{@link
		com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider#ORDER_LANGUAGE_FIRST}</dt>
		<dd>Language sorts and displays first, then country. Example: <code>English-Australia</code></dd>
	</dl>
	<p>This flag has no effect on generic (ie language-only) locales,
	like English.</p>
	</dd>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider#setDisplayLocale(Locale)}</dt>
	<dd>
	<p>Controls the localization of country and language names in the
	list - both for purposes of sorting the list and displaying the list.
	By default, each is localized automatically for that locale. Thus by
	default, each locale in the list sorts and displays as localized
	according to that locale. Pass in a specific locale (eg the current
	locale, which you can get using {@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocale(HttpServletRequest)}
	- <a href="#i18n.other.locale.get">see below</a>) to force localization
	across the list into a single common locale. In any case, the localized
	country and language names that are generated, are those built-into the
	JRE itself - their values are not determined by Shared Portal
	Framework.</p>
	</dd>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider#setSortLocale(Locale)}</dt>
	<dd>
	<p>Controls the locale of the collating sequence used when sorting
	the locale options displayed in the <code>&lt;SELECT&gt;</code> list.
	In other words, for purposes of sorting only, each locale is internally
	localized into the locale given <code>setDisplayLocale</code>, then
	sorted according to the collating sequence passed to <code>setSortLocale</code>.
	By default, the current locale's collating sequence is assumed. As
	noted above, the actual localized country and language names used
	during the sort are those built-into the JRE itself.</p>
	</dd>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider#getHTML(boolean)}<br>
	{@link
	com.hp.it.spf.xa.i18n.portal.ClassicLocaleSelectorProvider#getHTML(boolean,boolean)}</dt>
	<dd>
	<p>After using the constructor and setters above, you use either of
	these methods to generate and return to you the HTML for the locale
	selector. This string is ready for you to express in your JSP.</p>
	<ul>
		<li>The first parameter is a switch controlling whether to
		HTML-escape your label content. By default it is not escaped, so any
		HTML tags in your label content are rendered by the browser. Pass <code>true</code>
		to have them display literally instead.</li>
		<li>The second parameter is another switch controlling whether
		any <code>&lt;SPAN&gt;</code> tags that may be present in your label
		content are stripped-out. By default they are retained, but pass <code>true</code>
		if you want them to be removed. (When you generated your label content
		string, you may have included in it one or more messages - in that
		case, Vignette may have automatically inserted <code>&lt;SPAN
		LANG="..."&gt;...&lt;/SPAN&gt;</code> tags in your messages. These ostensibly
		help with accessibility, but in some rare cases can have side-effects
		depending on what other HTML markup you use. So you can use the second
		boolean parameter in the <code>getHTML</code> method to take out the <code>&lt;SPAN&gt;</code>
		tags if they are causing a problem.)</li>
	</ul>
	</dd>
</dl>
</blockquote>

<a name="i18n.locale.selector.jsp">
<h4>2.7.2. Using <code>&lt;spf-i18n-portal:classicLocaleSelector&gt;</code></h4>
</a>

<p>You use the <code>&lt;spf-i18n-portal:classicLocaleSelector&gt;</code>
tag to express an HPWeb "classic" version of a locale selector form into
your portal component JSP.</p>

<blockquote>
<p><b>Note:</b> <code>&lt;spf-i18n-portal:classicLocaleSelector&gt;</code>
is a wrapper for a <a href="#i18n.locale.selector.java">Java class</a>,
<code>ClassicLocaleSelectorProvider</code> (see above), which you can
call directly instead, if desired. The Java class provides a little more
flexibility than the tag (eg with the <code>ClassicLocaleSelectorProvider</code>
a label is optional; with the tag it is required).</p>
</blockquote>

<p>Usage for the <code>&lt;spf-i18n-portal:classicLocaleSelector&gt;</code>
is:</p>

<blockquote><pre>
&lt;%@ taglib prefix=&quot;spf-i18n-portal&quot; uri=&quot;/spf-i18n-portal.tld&quot; %&gt;
...
&lt;spf-i18n-portal:classicLocaleSelector
   label="<i>string</i>"
   labelKey="<i>message-key</i>"
   order="<i>spec</i>"
   displayInLocale="<i>language-tag</i>"
   sortInLocale="<i>language-tag</i>"
   labelStyle="<i>inline-style</i>"
   labelClass="<i>css-classname</i>"
   listStyle="<i>inline-style</i>"
   listClass="<i>css-classname</i>"
   escape="<i>true-or-false</i>"
   filterSpan="<i>true-or-false</i>"
   /&gt;
</pre></blockquote>

<p>Either the <code>label</code> or <code>labelKey</code> attributes
must be provided, because with this tag, a label to go with the locale
selector is required. (If you need no label, use the <a
	href="#i18n.locale.selector.java">Java class</a> directly, which has no
such limitation. The reasons for this difference in behavior are
unclear.) The other tag attributes are optional. Read the full tag
documentation in the <a
	href="com/hp/it/spf/xa/i18n/portal/tag/package-summary.html#selector">package
description</a> for information on each attribute.</p>

<p>Here is an example. Say you wanted to produce a classic locale
selector widget including a <code>Language:</code> label, with each
locale option displayed country first (eg "Australia-English") and
localized according to its own locale, then sorted according to the
current locale's collating sequence. First, add the label to your portal
component's message resource bundle, using whatever message key name you
like. For example (in your base message properties):</p>

<blockquote><pre>
localeSelector.label = Language: 
</pre></blockquote>

<p>Next use the following JSP markup in your portal component's JSP:</p>

<blockquote><pre>
&lt;%@ taglib prefix=&quot;spf-i18n-portal&quot; uri=&quot;/spf-i18n-portal.tld&quot; %&gt;
...
&lt;spf-i18n-portal:classicLocaleSelector
   labelKey=&quot;localeSelector.label&quot;
   displayInLocale=&quot;various&quot;
   sortInLocale=&quot;current&quot;
   /&gt;
</pre></blockquote>

<p>The resulting locale selector would render as follows. Note the
illustration below is for when the user's current locale is US English;
the label string, default (ie pre-selected) value, and sort order could
differ in other locales, though each displayed locale name in the select
list would continue to be rendered in its own language.</p>

<img
	src="com/hp/it/spf/xa/i18n/portal/doc-files/classicLocaleSelector.jpg">

<blockquote>
<p><b>Note 1:</b> The actual list of locale options is something you
<a href="#i18n.other.locale.config">configure for Vignette</a> - see
separate discussion below. Also, be sure to <a
	href="#i18n.locale.selector.process">configure the <code>spf-locale-selector-secondarypagetype</code>
and <code>spf-locale-selector-secondarypage</code></a> in Vignette, for the
processing logic (invoked when the user clicks the submit button) to
work. Note that processing logic will redirect the user to the original
URL for the page that included your portal component (this URL is
obtained by the locale selector automatically, using {@link
com.hp.it.spf.xa.misc.portal.Utils#getRequestURL(HttpServletRequest)}.
So when the user clicks the submit button, he or she will return to the
same page (with the new locale selection in effect for this and
subsequent pages) after the selection is silently persisted.</p>
</blockquote>

<blockquote>
<p><b>Note 2:</b> The submit button image is, by default, rendered
from the HP.com servers at <a
	href="http://welcome.hp-ww.com/img/hpweb_1-2_arrw_sbmt.gif">http://welcome.hp-ww.com/img/hpweb_1-2_arrw_sbmt.gif</a>.
However you can override this with your own submit button image if
desired. Name your image file <code>btn_submit.gif</code> and include it
among the secondary support files in your component. You can actually
include a whole bundle of localized submit button images, each tagged by
locale appropriately and sharing that same basename.</p>

<p>The alt text for the submit button image can be provided by you
inside your portal component, if desired. (By default, there is no alt
text.) Just add the <code>localeSelector.submit.alt</code> message key
to your current portal component's message resource bundle, like this:</p>

<blockquote><pre>
localeSelector.submit.alt = Change country and language
</pre></blockquote>
</blockquote>

<p>See the full tag documentation in the <a
	href="com/hp/it/spf/xa/i18n/portal/tag/package-summary.html#selector">package
description</a> for more information about the <code>&lt;spf-i18n-portal:classicLocaleSelector&gt;</code>
tag.</p>

<a name="i18n.locale.selector.style">
<h4>2.7.3. Using the <code>spf-locale-selector-classic-style</code></h4>
</a>

<p>If you are developing your own Vignette grid, Shared Portal
Framework provides a style type and style component for the HPWeb
"classic" locale selector which you can plug right in. The style type is
<code>spf-locale-widget-styletype</code>, the <code>Shared Portal
Framework - Locale Widget Style Type</code>. This style type has 2 styles
provided by SPF:</p>

<ul>
	<li><code>spf-locale-selector-classic-style</code>, the <code>Shared
	Portal Framework - Classic Locale Selector Style</code> (described here)</li>
	<li><code>spf-locale-indicator-classic-style</code>, the <code>Shared
	Portal Framework - Classic Locale Indicator Style</code> (described <a
		href="#i18n.locale.indicator.style">below</a>)</li>
</ul>

<p>When your portal site is <a href="#i18n.other.locale.config">configured</a>
with 2 or more available locales, the <code>spf-locale-selector-classic-style</code>
uses the JSP tag described <a href="#i18n.locale.selector.jsp">above</a>
to emit your portal site's locale selector in the HPWeb "classic"
fashion. This locale selector:</p>

<ul>
	<li>includes a properly-localized label: <code>Select:</code></li>
	<li>renders with the default behavior of the JSP tag in other
	respects - for example, locales are each displayed in native language,
	country first, and sorted in the collating sequence of the current
	locale.</li>
</ul>

<p>If your portal site is <a href="#i18n.other.locale.config">configured</a>
with just one available locale (ie, your site default locale, with no
additional locales declared in <code>site_locale_support.properties</code>),
though, this <code>spf-locale-selector-classic-style</code> degenerates
into a <a href="#i18n.locale.indicator">locale indicator</a> for the
current locale, since no locale selection is possible for the user in
this case.</p>

<p>The <code>spf-locale-selector-classic-style</code> and its
companion style type, <code>spf-locale-widget-styletype</code>, are
provided in the main SPF components distribution, and included in each
SPF portal runtime environment. To use them:</p>

<ul>
	<li>
	<p>Define your Vignette grid to include a position for the <code>spf-locale-widget-styletype</code>,
	as usual in Vignette grid programming.</p>
	</li>
	<li>
	<p>Create a Vignette theme for that grid, and set <code>spf-locale-selector-classic-style</code>
	to be the style instance to use for the <code>spf-locale-widget-styletype</code>.</p>
	</li>
	<li>
	<p>For your portal site administrator to have access to the grid,
	theme and styles (eg to change theme settings in the runtime
	environment), the SPF Vignette server administrator should share the <code>spf-locale-indicator-classic-style</code>,
	<code>spf-locale-selector-classic-style</code>, and the theme and grid
	to your portal site. In the Vignette server console, go to <b>Components
	&gt; Styles &gt; Style List</b>, checkmark the 2 styles, and use <b>Share
	to...</b>. This should already have been done for you when your portal site
	was first setup. (It should not be necessary to share the style type to
	your site, just the styles.) Then do similarly for your theme and grid.</p>
	</li>
</ul>

<a name="i18n.locale.selector.extend">
<h4>2.7.4. Extending <code>LocaleSelectorProvider</code> to create
a custom rendition</h4>
</a>

<p>If the HPWeb "classic" rendering of a locale selector does not
suit your requirements, you can get a head-start building your own
locale selector by extending the SPF-provided {@link
com.hp.it.spf.xa.i18n.portal.LocaleSelectorProvider} abstract base
class. Once you have implemented your concrete locale selector provider
class, you call its (inherited) {@link
com.hp.it.spf.xa.i18n.portal.LocaleSelectorProvider#getHTML(boolean)} or
{@link
com.hp.it.spf.xa.i18n.portal.LocaleSelectorProvider#getHTML(boolean,boolean)}
methods to get the locale selector HTML string for expressing in your
JSP. (You could also write a JSP tag to wrap your class.)</p>

<p>Basically, <code>LocaleSelectorProvider</code> generates the HTML
for the <i>non-visible</i> parts of an SPF-standard locale selection
form. The form's action is targeted at your portal site's <a
	href="#i18n.locale.selector.process">SPF locale selector secondary
page</a>. And a hidden form parameter is defined containing your current
page URL (obtained by SPF using {@link
com.hp.it.spf.xa.misc.portal.Utils#getRequestURL(HttpServletRequest)}
automatically) as the target URL to which the secondary page should
redirect (after persisting the locale selection).</p>

<p>What you do is subclass <code>LocaleSelectorProvider</code> and
then implement the {@link
com.hp.it.spf.xa.i18n.portal.LocaleSelectorProvider#getWidgetHTML(String,Collection,Locale,boolean,boolean)}
method (and any custom methods, like attribute setters, which you need).
<code>getWidgetHTML</code>'s job is to return the <i>visible</i> parts
of the form. <code>LocaleSelectorProvider</code> will embed the string
you return from <code>getWidgetHTML</code> into the rest of the <code>&lt;FORM&gt;</code>
markup which it automatically generates. Since <code>LocaleSelectorProvider</code>
targets the form at the locale selector secondary page, which needs to
get the user's chosen locale from your visible elements of the form,
therefore your <code>getWidgetHTML</code> return string <b>must</b>
minimally define some kind of form parameter containing the user's
chosen locale. For example, your <code>getWidgetHTML</code>
implementation could include a <code>&lt;SELECT&gt;</code> element for
the chosen locale in the return string, or an <code>&lt;INPUT&gt;</code>
element of some kind. In any case:</p>

<ol>
	<li>
	<p>Your form parameter <b>must</b> be declared to have a name
	matching the <code>String</code> argument to <code>getWidgetHTML</code>.
	That is, you must take the <code>String</code> argument to <code>getWidgetHTML</code>
	and use it as the HTML form parameter name for the user's locale
	selection in your returned string.</p>
	</li>
	<li>
	<p>Additionally, your form parameter's value (in your returned
	string from <code>getWidgetHTML</code>) <b>must</b> be an RFC 3066
	language tag representing the user's locale selection. The language tag
	must be comprised of the ISO 639-1 language code and, optionally, the
	ISO 3166-1 country code. For example, <code>fr-CH</code> for Swiss
	French and <code>en</code> for generic English are both valid language
	tags. (In your implementation of <code>getWidgetHTML</code>, you may
	find {@link
	com.hp.it.spf.xa.i18n.I18nUtility#localeToLanguageTag(Locale)} helpful
	for generating language tags for the available <code>Locale</code>
	options.)</p>
	</li>
</ol>

<p>Put another way, the <code>LocaleSelectorProvider.getHTML</code>
methods return the HTML for the whole locale selector form, with your <code>getWidgetHTML</code>
string embedded inside it like this:</p>

<blockquote><pre>
&lt;form action="<i>points to locale selector secondary page</i>" method="post"&gt;
   &lt;input type="hidden" value="<i>the current page URL</i>"&gt;
   &lt;-- your getWidgetHTML return string goes here; somewhere in it you must  --&gt;
   &lt;-- define a form parameter named with the String passed to getWidgetHTML --&gt;
   &lt;-- and whose value when submitted is the user's chosen locale, in        --&gt;
   &lt;-- language-tag format (eg "zh-CN")                                      --&gt;
&lt;/form&gt;
</pre></blockquote>

<p>Here are the parameters to the <code>getWidgetHTML</code> method:</p>

<ul>
	<li>
	<p>The <code>String</code> is the name you must use for the form
	parameter.</p>
	</li>
	<li>
	<p>The <code>Collection</code> is a collection of all of the
	available locales which you have <a href="#i18n.other.locale.config">configured</a>
	for the current portal site. The locales are passed as <code>Locale</code>
	objects (ie this is a <code>Collection</code> of <code>Locale</code> -
	it is not declared in the <code>getWidgetHTML</code> signature as <code>Collection&lt;Locale&gt;</code>
	for backward-compatibility to Java 1.4). As provided, the collection is
	unsorted. The system obtained this collection for you by calling <a
		href="#i18n.other.locale.avail"><code>I18nUtility.getAvailableLocales(HttpServletRequest)</code></a>
	in the usual manner.</p>
	</li>
	<li>
	<p>The <code>Locale</code> is the user's current locale, which the
	system obtained for you by calling <a href="#i18n.other.locale.get"><code>I18nUtility.getLocale(HttpServletRequest)</code></a>
	in the usual manner.</p>
	</li>
	<li>
	<p>Finally, the 2 boolean switches are advice to you.</p>
	<ul>
		<li>
		<p>The first switch indicates whether any visible text in your <code>getWidgetHTML</code>
		return string should be HTML-escaped or not. If <code>true</code>, it
		means you should HTML-escape your visible text; if <code>false</code>,
		do not. To help you perform a requested HTML-escape, there are many
		utility methods available in the Java world; one such is the
		SPF-provided {@link com.hp.it.spf.xa.misc.Utils#escapeXml(String)}
		method. If you are getting all your visible text from message
		resources, though, note you can just pass this switch through into the
		SPF message retrieval utility you choose to use, such as <a
			href="#i18n.messages.java.spf.getMessage"><code>I18nUtility.getValue</code></a>;
		it will honor the flag for you, automatically.</p>
		</li>
		<li>
		<p>The second switch indicates whether any Vignette-generated <code>&lt;SPAN&gt;</code>
		tags should be removed from your visible text, or retained. If <code>true</code>,
		you should remove them; if <code>false</code>, do not. {@link
		com.hp.it.spf.xa.i18n.portal.I18nUtility#filterSpan(String)} can help
		with removing them, but you will probably rather just pass this switch
		through into the SPF message retrieval utility you choose to use, as
		above; the utility will then honor the flag for you, automatically.</p>
		</li>
	</ul>
	<p>Note that in reality, these switches are themselves just
	passed-through by <code>LocaleSelectorProvider</code> from its <code>getHTML</code>
	methods to your <code>getWidgetHTML</code> implementation. So depending
	on how you plan to set those switches when you call <code>getHTML</code>
	in your portal component, you can ignore them or even apply a different
	semantic entirely.</p>
	<li>
	<p><b>Note:</b> The <code>PortalContext</code> object is not an
	argument to the <code>getWidgetHTML</code> method, but it is passed to
	the constructor, which places it in the protected class attribute,
	{@link
	com.hp.it.spf.xa.i18n.portal.LocaleSelectorProvider#portalContext}. So
	if your implementation of <code>getWidgetHTML</code> needs a <code>PortalContext</code>,
	that's where it can find it.</p>
	</li>
</ul>

<a name="i18n.locale.selector.process">
<h4>2.7.5. Using the <code>spf-locale-selector-secondarypagetype</code>
and <code>spf-locale-selector-secondarypage</code></h4>

<p>All of the above variations in the locale selector share a common
trait: they all point to SPF-provided processing logic for persisting
the user's locale selection when activated. That is, they all produce
HTML forms that, when submitted, invoke the SPF-provided locale selector
secondary page at your portal site, which persists the locale selection
and then redirects to your page. This section describes a bit about how
this works, and what configuration you need to do for it to work.</p>

<p>The locale persistence logic is provided by two SPF Vignette
portal components:</p>

<ul>
	<li>The <b>Shared Portal Framework - Locale Selector Process</b>
	secondary page (component ID <code>spf-locale-selector-secondarypage</code>)</li>
	<li>The <b>Shared Portal Framework - Locale Selector Process</b>
	secondary page type (component ID <code>spf-locale-selector-secondarypagetype</code>)</li>
</ul>

<p>The <code>spf-locale-selector-secondarypage</code> is an instance
of the <code>spf-locale-selector-secondarypagetype</code>. Both
components are included among the SPF portal components present in every
SPF Vignette portal runtime environment. You just need to make them
available within your portal site. In Vignette console:</p>

<ol>
	<li>
	<p>The SPF locale selector secondary page must have been configured
	as the default secondary page to use for the SPF locale selector
	secondary page type. In the Vignette server console, go to <b>Server
	Settings &gt; Server Defaults &gt; Site &amp; Appearance &gt; Default
	Secondary Pages</b> to make this configuration. In most cases, this will
	already have been done for you during SPF server setup.</p>
	</li>
	<li>
	<p>The SPF locale selector secondary page must have been shared to
	your portal site. In the Vignette server console, go to <b>Components
	&gt; Pages &gt; Secondary Page List</b>, checkmark the <b>Shared Portal
	Framework - Locale Selector Process</b>, and <b>Share to...</b>. This
	should already have been done for you when your portal site was first
	setup. (It should not be necessary to share the secondary page type to
	your site, just the secondary page.)</p>
	</li>
	<li>
	<p>Finally, in your portal site, you must apply your site's grid
	and theme to the secondary page, and again make sure that the secondary
	page is configured to be used for that secondary page type. In the
	Vignette site console for your site, go to <b>Site Settings &gt;
	Appearance &gt; Secondary Pages</b> to do this.</p>
	</li>
	<li>
	<p>Done - no further configuration or customization is needed.</p>
	</li>
</ol>

<p>When invoked from one of the locale selectors discussed in the
previous sections, the locale selector secondary page will get the
user's chosen locale from request parameters in the usual manner. It
will persist the locale selection so that it takes effect through the <a
	href="#i18n.other.locale.resolver">SPF locale resolver</a> for the
remainder of the session in an HP.com-compliant manner. And finally it
will redirect to a target page whose URL is also provided through a
request parameter (the locale selector form always sets that parameter
to the URL for the current page). Here are some details you don't really
need to know:</p>

<ul>
	<li>
	<p>The secondary page expects the request parameter containing the
	chosen locale to be named with the value of {@link
	com.hp.it.spf.xa.misc.Consts.PARAM_SELECT_LOCALE} and to contain the
	chosen locale in RFC 3066 format like <code>zh-CN</code> for China
	Chinese, <code>de</code> for generic German, etc.</p>
	</li>
	<li>
	<p>Since the processing logic will end in a redirect, it also
	expects the redirect target URL to be provided in another request
	parameter, named with the value of {@link
	com.hp.it.spf.xa.misc.Consts.PARAM_SELECT_LOCALE_TARGET}.</p>
	</li>
	<li>
	<p>After double-checking that the chosen locale really is one of
	the available locales you have <a href="#i18n.other.locale.config">configured</a>
	for your portal site, the secondary page sets the HP.com <code>lang</code>
	cookie for 1 year with the language of the chosen locale. If there is a
	country in the chosen locale, that is also set for 1 year, into the
	HP.com <code>cc</code> cookie (if there is no country in the chosen
	locale, any previous HP.com <code>cc</code> cookie is deleted). Since
	the <a href="#i18n.other.locale.resolver">SPF locale resolver</a>
	inputs these cookies, this ensures they will take effect for the rest
	of the session and into the future, for up to a year, not just in HPSC
	but in all other HP.com-compliant Web sites too.</p>
	</li>
	<li>
	<p>If the user is currently logged-into HP Passport, the secondary
	page also writes-back the chosen locale to the HPP profile. Only the
	HPP profile's language attribute is updated, not the
	country-of-residence attribute. Since the <a
		href="#i18n.other.locale.resolver">SPF locale resolver</a> also takes
	the HPP profile as an input (only when the cookies don't exist), this
	ensures the locale preference will take effect when the user logs-in
	indefinitely into the future, even if the cookies are no longer
	present. It also ensures that any background activity performed against
	the HPP profile (eg bulk mailing, and not just in HPSC but any HPP
	profile-facing application) takes the user's preferred language into
	account, too.</p>
	</li>
	<li>
	<p>Finally, the secondary page redirects to the target URL it was
	passed from the locale selector form. As discussed earlier, in practice
	the form will always have set this to your current page, so that is
	where the user will be redirected.</p>
	</li>
</ul>

<hr>

<a name="i18n.locale.indicator">
<h3>2.8. Generating the locale indicator</h3>
</a>

<p>A <i>locale indicator</i> is just a very simple widget - in the
HPWeb "classic" rendering, it is just a text string - stating what the
current locale is. Whereas the <a href="#i18n.locale.selector">locale
selector</a> is placed in a portal component where you want the user to be
able to change his or her current locale, the locale indicator is placed
where you just want a simple statement of what the current locale is.
SPF provides the necessary tools for generating the locale indicator for
your portal site.</p>

<a name="i18n.locale.indicator.java">
<h4>2.8.1. Using <code>I18nUtility.getLocaleDisplayName</code></h4>
</a>

<p>The HPWeb "classic"-style locale indicator is just a simple text
string, like "Deutschland-Deutsch" or "Germany-German". To generate an
HPWeb classic locale indicator in Java, you can use one of the <code>I18nUtility.getLocaleDisplayName</code>
methods:</p>

{@link
com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocaleDisplayName(Locale)}<br>
{@link
com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocaleDisplayName(Locale,Locale)}<br>
{@link
com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocaleDisplayName(Locale,Locale,int)}

<blockquote>
<p><b>Note:</b> Alternatively there is an <a
	href="#i18n.locale.indicator.jsp">JSP tag</a> you can use for
generating an HPWeb classic locale indicator.</p>
</blockquote>

<p>Each method returns a localized text string, ready for expressing
into your JSP, stating the name of the given <code>Locale</code>. The
hypen character is used as a separator between country and language
names, as per the HPWeb standard.</p>

<ul>
	<li>
	<p>The first <code>Locale</code> parameter is the given locale.</p>
	</li>
	<li>
	<p>The second, optional <code>Locale</code> parameter is the locale
	in which to localize the given locale's name. By default, this is
	assumed to be the same as the given locale.</p>
	</li>
	<li>
	<p>The integer parameter is actually a bitmask indicating the
	desired order (country-first, or language-first) of country and
	language in the name of a full locale. By default, language will be
	first (eg "Deutsch-Deutschland"). Pass {@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#LOCALE_BY_COUNTRY} for
	country-first, which is the HPWeb standard. This has no effect on a
	generic (ie language-only) locale.</p>
	</li>
</ul>

<a name="i18n.locale.indicator.jsp">
<h4>2.8.2. Using <code>&lt;spf-i18n-portal:classicLocaleIndicator&gt;</code></h4>
</a>

<p>You use the <code>&lt;spf-i18n-portal:classicLocaleIndicator&gt;</code>
tag to express an HPWeb "classic" locale indicator (text string like
"United States-English") into your portal component JSP.</p>

<blockquote>
<p><b>Note:</b> <code>&lt;spf-i18n-portal:classicLocaleIndicator&gt;</code>
is a wrapper for a <a href="#i18n.locale.indicator.java">Java method</a>,
<code>I18nUtility.getLocaleDisplayName</code> (see above), which you can
call directly instead, if desired.</p>
</blockquote>

<p>Usage for this JSP tag is:</p>

<blockquote><pre>
&lt;%@ taglib prefix=&quot;spf-i18n-portal&quot; uri=&quot;/spf-i18n-portal.tld&quot; %&gt;
...
&lt;spf-i18n-portal:classicLocaleIndicator
   order="<i>spec</i>"
   displayInLocale="<i>language-tag</i>"
   /&gt;
</pre></blockquote>

<a name="i18n.locale.indicator.style">
<h4>2.8.3. Using the <code>spf-locale-indicator-classic-style</code></h4>
</a>

<p>If you are developing your own Vignette grid, Shared Portal
Framework provides a style type and style component for the HPWeb
"classic" locale indicator which you can plug right in. The style type
is <code>spf-locale-widget-styletype</code>, the <code>Shared
Portal Framework - Locale Widget Style Type</code>. This style type has 2
styles provided by SPF:</p>

<ul>
	<li><code>spf-locale-selector-classic-style</code>, the <code>Shared
	Portal Framework - Classic Locale Selector Style</code> (described <a
		href="#i18n.locale.selector.style">above</a>)</li>
	<li><code>spf-locale-indicator-classic-style</code>, the <code>Shared
	Portal Framework - Classic Locale Indicator Style</code> (described here)</li>
</ul>

<p>The <code>spf-locale-indicator-classic-style</code> simply uses
the JSP tag described <a href="#i18n.locale.indicator.jsp">above</a> to
emit the name of the current locale (called a <i>locale indicator</i>)
in the HPWeb "classic" fashion.</p>

<p>The <code>spf-locale-indicator-classic-style</code> and its
companion style type, <code>spf-locale-widget-styletype</code>, are
provided in the main SPF components distribution, and included in each
SPF portal runtime environment. To use them:</p>

<ul>
	<li>
	<p>Define your Vignette grid to include a position for the <code>spf-locale-widget-styletype</code>,
	as usual in Vignette grid programming.</p>
	</li>
	<li>
	<p>Create a Vignette theme for that grid, and set <code>spf-locale-indicator-classic-style</code>
	to be the style instance to use for the <code>spf-locale-widget-styletype</code>.</p>
	</li>
	<li>
	<p>For your portal site administrator to have access to the grid,
	theme and styles (eg to change theme settings in the runtime
	environment), the SPF Vignette server administrator should share the <code>spf-locale-indicator-classic-style</code>,
	<code>spf-locale-selector-classic-style</code>, and the theme and grid
	to your portal site. In the Vignette server console, go to <b>Components
	&gt; Styles &gt; Style List</b>, checkmark the 2 styles, and use <b>Share
	to...</b>. This should already have been done for you when your portal site
	was first setup. (It should not be necessary to share the style type to
	your site, just the styles.) Then do similarly for your theme and grid.</p>
	</li>
</ul>

<hr>

<a name="i18n.l10n">
<h3>2.9. Localizing your resources</h3>
</a>

<p>You can localize your resources (message property files, images,
HTML files, etc) in whatever way you see fit. The only requirements are:</p>

<ul>
	<li>
	<p>For text resources, you must use UTF-8 character encoding.</p>
	</li>

	<li>
	<p>For Java message property files only, remember that Java's
	standard {@link java.util.Properties} class is the basis for loading
	those files into the system, and this class cannot load non-ASCII,
	UTF-8 characters natively. Therefore you must use the Java-standard <a
		href="http://java.sun.com/j2se/1.4.2/docs/tooldocs/solaris/native2ascii.html"><code>native2ascii</code></a>
	tool to convert your non-ASCII UTF-8-encoded characters into ASCII
	representation (specifically, into Java's supported <code>\uXXXX</code>
	string format for Unicode escape sequences).</p>
	</li>

	<li>
	<p>All localized resource files must be tagged with their
	respective locale as per the Java standard for {@link
	java.util.ResourceBundle}. This was already described in the section
	about <a href="#i18n.resources.bundles">resource bundles</a>, earlier
	in this document.</p>
	</li>
</ul>

<a name="i18n.l10n.spf">
<h4>2.9.1 The SPF localization process</h4>
</a>

<p>The Shared Portal Framework provides tools and support for a
localization process using HP's Translation and Localization (T&L) team.
This is a batch (not real-time) process combining manual and automated
activities. In this process:</p>

<ol>
	<li>
	<p>You <i>extract</i> your base (English) message and supporting
	resource files requiring localization from the system. You can do this
	in the lab (eg checkout from a your revision-control system) or in a
	run-time environment (eg extract from the base files already deployed
	in production).</p>
	</li>

	<li>
	<p>You <i>convert and pack</i> the base files for the T&L team,
	using an SPF-provided perl script, <code>xlate_send.pl</code>. For
	example, this removes any Vignette-internal message properties that
	never need localization, and packs your files into the T&L team's
	required format.</p>
	</li>

	<li>
	<p>You <i>send</i> the packed base files to the T&L team and
	request the needed locales.</p>
	</li>

	<li>
	<p>The T&L team <i>translates</i> them for you.</p>
	</li>

	<li>
	<p>You <i>receive</i> the translated files from the T&L team.</p>
	</li>

	<li>
	<p>You <i>unpack and convert</i> the translated files from the T&L
	team, using an SPF-provided perl script, <code>xlate_receive.pl</code>.
	For example, this unpacks the files from the T&L team's delivery
	format, and runs <a
		href="http://java.sun.com/j2se/1.4.2/docs/tooldocs/solaris/native2ascii.html"><code>native2ascii</code></a>
	for you against the translated message property files.</p>
	</li>

	<li>
	<p>Finally, you <i>deploy</i> your translations to the system. You
	can do this in the lab (eg checkin to your revision-control system) or
	in a run-time environment (eg deploy the translations directly to
	production).
	</li>
</ol>

<p>This process is not further documented in this guide. It is
covered in the <b>SPF Localization Guide</b>.</p>

<hr>

<a name="i18n.other">
<h3>2.10. Other internationalization topics</h3>
</a>

<p>This section covers miscellaneous other topics in the subject
area of internationalization.</p>

<blockquote>
<p><b>Note:</b> Several of the following operations take the current
<code>HttpServletRequest</code>. Remember that you can get your current
<code>HttpServletRequest</code> from the Vignette <code>PortalContext</code>
object which is passed by Vignette into your JSP or Java action classes.
Use either <code>PortalContext.getHttpServletRequest()</code> or <code>PortalContext.getPortalRequest().getRequest()</code>.
See the <a href="#overview.other.vignette.devguide">Vignette Portal
Developer's Guide</a> for more information.</p>
</blockquote>


<a name="i18n.other.locale.avail">
<h4>2.10.1. Getting the available locales</h4>
</a>

<p>In Shared Portal Framework, each portal site can define its own
list of available locales - ie, the locales acceptable to the portal
site. For example, this is the collection of locales listed in the <a
	href="#i18n.locale.selector">locale selector</a> for the portal site.
These available locales are defined to be the aggregation of the
following:</p>

<ul>
	<li>
	<p>The <i>default locale</i> for the portal site, as <a
		href="#i18n.other.locale.config">configured</a> in Vignette console.
	Every site has a default locale, even if it is allowed to itself just
	default to the SPF Vignette server default locale (which is
	US-English).</p>
	</li>
	<li>
	<p>Any <i>additional locales</i> supported by the portal site, as <a
		href="#i18n.other.locale.config">configured</a> in <code>site_locale_support.properties</code>.</p>
	</li>
</ul>

<p>Note that each locale is only considered available if it is also
a registered locale in Vignette server. Both full country-specific
locales like US-English, and generic language-only locales like English,
are supported by SPF and thus may be made available for your portal site
(but note that the current HP.com standard is to utilize full
country-specific locales only). Read <a href="#i18n.other.locale.config">below</a>
for more information on configuring the available locales for your
portal site.</p>

<p>SPF portal components can get the collection of available locales
at runtime. (Portlets cannot do this. The set of available locales is a
portal-managed asset, not exposed by SPF to portlets.) Use one of the
following SPF portal <code>I18nUtility</code> methods:</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getAvailableLocales(HttpServletRequest)}</dt>
	<dd>
	<p>Returns a {@link java.util.Collection} of {@link
	java.util.Locale} objects, one for each of the available locales at the
	<b>current</b> portal site. You pass your current {@link
	javax.servlet.http.HttpServletRequest}.</p>
	</dd>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getAvailableLocales(Site)}</dt>
	<dd>
	<p>Returns a similar <code>Collection</code> of <code>Locale</code>
	objects, which are the available locales at the <b>given</b> portal
	site. You pass the Vignette <code>Site</code> object for the desired
	site.</p>
	</dd>
</dl>

<p>In each method, the returned collection is unsorted. It contains
the site default locale and any additional locales aggregated together
without distinction. If you need to know which is the site default
locale, you can get just the site default locale using one of the
following SPF portal <code>I18nUtility</code> methods:</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getDefaultLocale(HttpServletRequest)}</dt>
	<dd>
	<p>Returns the site default {@link java.util.Locale} for the <b>current</b>
	portal site. You pass your current {@link
	javax.servlet.http.HttpServletRequest}.</p>
	</dd>
	<dt>{@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#getDefaultLocale(Site)}</dt>
	<dd>
	<p>Returns the site default {@link java.util.Locale} for the <b>given</b>
	portal site. You pass the Vignette <code>Site</code> object for the
	desired site.</p>
	</dd>
</dl>
</dl>

<p>Please see the JavaDocs for more information about the methods.</p>

<a name="i18n.other.locale.get">
<h4>2.10.2. Getting the current locale</h4>
</a>

<p>In Shared Portal Framework, the <a
	href="#i18n.other.locale.resolver">locale resolver</a> compares locale
information in each user request with the set of <a
	href="#i18n.other.locale.avail">available locales</a> to determine each
user's current locale. (In SPF, for simplicity, the user is considered
to have one preferred locale at any given time.) You can get this locale
in your SPF portal component code using the {@link
com.hp.it.spf.xa.i18n.portal.I18nUtility#getLocale(HttpServletRequest)}
method (where you pass the current {@link
javax.servlet.http.HttpServletRequest}).</p>

<p>Many of the internationalization API's and tags documented above
assume this locale (but the API's all provide signatures letting you
pass another locale if needed).</p>

<p>Where does the locale come from? The SPF-provided <a
	href="#i18n.other.locale.resolver">locale resolver</a> automatically
determines it, as described later in this guide.</p>

<a name="i18n.other.locale.set">
<h4>2.10.3. Setting the current locale</h4>
</a>

<p>The SPF portal {@link
com.hp.it.spf.xa.i18n.portal.I18nUtility#setLocale(HttpServletRequest,Locale)}
method can be used to change the current locale setting for the user in
Vignette (and any portlets called downstream). But generally there is no
need for you to be concerned with this. In fact, using <code>I18nUtility.setLocale</code>
directly is discouraged, since the <a href="#i18n.other.locale.resolver">locale
resolver</a> is the authority for determining the proper locale and setting
it on your behalf in Vignette and downstream portlets (as well as the
HP.com locale cookies) at the beginning of each request.</p>

<p>If you have a use case where you must set the locale, there are a
number of better ways to do it:</p>

<ul>
	<li>
	<p>If you need to present the user with a widget where he or she
	can select the desired locale and persist it, use a <a
		href="#i18n.locale.selector">locale selector</a> widget as discussed
	previously in this guide.</p>
	</li>
	<li>
	<p>If you need to present the user with a hyperlink which, when
	clicked, invokes a particular locale and persists it, use one of these
	techniques:</p>
	<ul>
		<li>
		<p>To make the setting last for the rest of the session (until the
		user restarts his/her browser):</p>
		<ol>
			<li>
			<p>Create a {@link com.hp.it.spf.xa.portalurl.PortalURL} for any
			page at your portal site. This is the page where you want the user to
			go after the new locale has been set.</p>
			</li>
			<li>
			<p>Set the HP.com-standard <code>lang</code> and <code>cc</code>
			parameters as portal parameters on that <code>PortalURL</code>, using
			{@link
			com.hp.it.spf.xa.portalurl.PortalURL#setParameter(java.lang.String,
			java.lang.String)}.</p>
			<ul>
				<li>The <code>lang</code> parameter should be the <a
					href="http://www.loc.gov/standards/iso639-2/php/English_list.php">ISO
				639-1</a> language code for the new locale (use {@link
				java.util.Locale#getLanguage()}).</li>
				<li>The <code>cc</code> should be the <a
					href="http://www.iso.org/iso/country_codes/iso_3166_code_lists/english_country_names_and_code_elements.htm">ISO
				3166-1</a> country code (use {@link java.util.Locale#getCountry()}, or
				can be omitted if the locale does not include a country).</li>
			</ul>
			</li>
			<li>
			<p>When the user's browser opens this <code>PortalURL</code>, the
			SPF portal's locale resolver will resolve that new locale (see <a
				href="#i18n.other.locale.resolver">discussion below</a>) for the
			rest of the session, until the browser is restarted.</p>
			</li>
		</ol>
		</li>
		<li>
		<p>To make the setting last persistently (ie set it remains even
		after browser restart), just as if the user had chosen it with the SPF
		locale selector in the portal:</p>
		<ol>
			<li>
			<p>Create a {@link com.hp.it.spf.xa.portalurl.PortalURL} for any
			page at your portal site. This is the page where you want the user to
			go after the new locale has been set.</p>
			</li>
			<li>
			<p>Create another <code>PortalURL</code> for the SPF locale
			selector secondary page process-action. The friendly URI for this is
			the value of {@link
			com.hp.it.spf.xa.misc.Consts#PAGE_FRIENDLY_URI_SELECT_LOCALE}.</p>
			</li>
			<li>
			<p>In the SPF locale selector <code>PortalURL</code>, set the
			following parameters using the {@link
			com.hp.it.spf.xa.portalurl.PortalURL#setParameter(java.lang.String,
			java.lang.String)} method:</p>
			<ul>
				<li>The value of the first parameter should be the <a
					href="http://www.faqs.org/rfcs/rfc3066.html">RFC 3066</a> language
				tag for the new locale (use {@link
				com.hp.it.spf.xa.i18n.I18nUtility#localeToLanguageTag(Locale)}). The
				name of this parameter should be the value of {@link
				com.hp.it.spf.xa.misc.Consts#PARAM_SELECT_LOCALE}.</li>
				<li>The value of the second parameter should be the string of
				the first URL (ie where you want the user to be taken after the new
				locale has been set). The name of this parameter should be the value
				of {@link com.hp.it.spf.xa.misc.Consts#PARAM_SELECT_LOCALE_TARGET}.</li>
			</ul>
			</li>
			<li>
			<p>When the user's browser opens this SPF locale selector <code>PortalURL</code>,
			the SPF locale selector secondary page will set that new locale
			persistently.</p>
			</li>
		</ol>
		<li>
		<p><b>Note:</b> Neither of the above techniques works-around the
		fact that you can only set locales which are <a
			href="#i18n.other.locale.config">configured</a> as available in the
		portal site.</p>
		</li>
	</ul>
	</li>
</ul>

<a name="i18n.other.locale.config">
<h4>2.10.4. Configuring site default locale and additional locales
(<code>site_locale_support.properties</code>)</h4>
</a>

<p>The <a href="#i18n.other.locale.avail">available locales</a> for
your portal site are:</p>

<ul>
	<li>Your <i>site default locale</i>, configured in Vignette
	console; plus</li>
	<li>Any <i>additional locales</i>, defined for your site in <code>site_locale_support.properties</code></li>
</ul>

<dl>
	<dt>To configure your <b>site default locale</b>:</dt>
	<dd>
	<p>In Vignette site console for your site, navigate to <b>Site
	Settings &gt; Site Basics &gt; Languages</b> and configure the <b>Default
	Language</b>. The list of Vignette server-registered locales is presented
	to you, from which to choose your site default. Ignore the other
	settings on the page, such as <b>Guest Languages</b> - SPF does not use
	them. Changes to the site default locale take effect immediately within
	the list of <a href="#i18n.other.locale.avail">available locales</a>.</p>
	</dd>
	<dt>To configure your <b>additional locales</b>:</dt>
	<dd>
	<p>Add the locales to the <code>site_locale_support.properties</code>
	file. This is a configuration file on each Vignette portal machine,
	stored in a directory on the portal classpath - typically the <i>global
	resources</i> directory, <code>/opt/sasuapps/sp/global_resources</code>
	(though in a sandbox, it may be in a different location). The format of
	the file is:</p>
	<blockquote><pre>
<i>&lt;site-name&gt;</i> = <i>&lt;language-tag&gt;</i>, <i>&lt;language-tag&gt;</i>, ...
</pre></blockquote>
	<p>where the <code><i>&lt;site-name&gt;</i></code> is the Vignette
	"site DNS name" for your portal site (this is the string which appears
	in your portal site URL, <code>http://.../portal/site/<i>&lt;site-name&gt;</i></code>),
	and where each <code><i>&lt;language-tag&gt;</i></code> is a locale, in
	<a href="http://www.faqs.org/rfcs/rfc3066.html">RFC 3066</a> language
	tag format (for example, <code>ja</code> for Japanese, <code>es-MX</code>
	for Mexico Spanish, etc).</p>
	<p>For example, the following configures Mexico Spanish, Italy
	Italian, France French and Germany German as additional locales for the
	<code>example</code> portal site:</p>
	<blockquote><pre>
example = es-MX, it-IT, fr-FR, de-DE
</pre></blockquote>
	<p>The order in which the locales are listed does not matter. If
	you want to just make all server-registered locales available in your
	portal site, you can use the special keyword <code>ALL</code> instead
	of listing the language tags - like this:</p>
	<blockquote><pre>
example = ALL
</pre></blockquote>
	<p>Changes to the file, once saved, take effect in the list of <a
		href="#i18n.other.locale.avail">available locales</a> within 15
	minutes, or upon a portal server restart (whichever comes first).</p>
	<p>The locales you configure in <code>site_locale_support.properties</code>
	are limited to the server-registered locales in Vignette. The
	server-registered locales are listed in Vignette server console, under
	<b>Server Settings &gt; Server Defaults &gt; Languages</b>.</p>
	<blockquote>
	<p><b>Note:</b> Outside of the sandbox environment, only authorized
	SPF server administrators have access to the Vignette server console
	and <code>site_locale_support.properties</code>. You may need to make a
	request to the SPF support team to setup <code>site_locale_support.properties</code>
	for you.</p>
	<p><b>Note:</b> For your information, <code>site_locale_support.properties</code>
	is an extension to native Vignette capabilities. Out of the box, all
	Vignette portal sites share the same set of available locales for
	registered users. Shared Portal Framework added <code>site_locale_support.properties</code>
	to the system in order to support different locale sets for each portal
	site.</p>
	</blockquote>
	</dd>
</dl>

<a name="i18n.other.common">
<h4>2.10.5. Using the common <code>I18nUtility</code></h4>
</a>

<p>Above we have seen the various internationalization API's and
tags provided by the SPF portal utilities, including the {@link
com.hp.it.spf.xa.i18n.portal.I18nUtility} class. Be aware that class
inherits from the common {@link com.hp.it.spf.xa.i18n.I18nUtility}, part
of the <a
	href="../../../common/spf-common-utilities/apidocs/" target="_blank">SPF
common utilities</a>. And the common <code>I18nUtility</code> provides
numerous miscellaneous methods related to internationalization,
encompassing:</p>

<ul>
	<li>Localized display of locale names, timezone names, user names,
	etc, in SPF-standard format</li>
	<li>Transformation between locales, HP Passport languages, and RFC
	3066 language tags</li>
	<li>And more.</li>
	<li><b>Note:</b> these inherited methods are documented in the <a
		href="../../../common/spf-common-utilities/apidocs/" target="_blank">SPF
	Common Utilities Developer's Guide</a> as well as in the JavaDoc for the
	{@link com.hp.it.spf.xa.i18n.portal.I18nUtility} class.</li>
</ul>

<a name="i18n.other.locale.resolver">
<h4>2.10.6. A word about the locale resolver</h4>
</a>

<p>In Shared Portal Framework, the <b>locale resolver</b> is an
SPF-provided module which automatically determines the user's current
locale on each portal request, taking into account all of the user's
indicated locale preferences, the <a href="#i18n.other.locale.avail">available
locales</a> that are <a href="#i18n.other.locale.config">configured</a> for
your portal site, and any default locales for each available language.
The locale resolver then sets the locale into Vignette (and any
portlets) as well as the HP.com locale cookies (when appropriate); so
when your portal components (or any portlets on the page) <a
	href="#i18n.other.locale.get">get the current locale</a>, they get the
locale which the locale resolver determined.</p>

<p>The locale resolver is an SPF-provided module (a servlet filter
integrated with the Vignette portal application), which needs no
customization or configuration. It just runs automatically and does its
job. But since developers may be curious how it works, this section
gives a brief description of its operation.</p>

<ol>
	<li>
	<p>The SPF locale resolver accepts preferred locales from the user
	according to the following inputs (in order):</p>
	<ol>
		<li>
		<p>The HP.com-standard <code>lang</code> and <code>cc</code> query
		parameters on the URL.</p>
		</li>
		<li>
		<p>The HP.com-standard <code>lang</code> and <code>cc</code>
		cookies in the request.</p>
		</li>
		<li>
		<p>The HP Passport core user profile attribute, <code>langCode</code>.
		(Note that the HP Passport <code>residentCountryCode</code> core
		profile attribute is not used by HPP itself for locale determination,
		so is not used by SPF either.)</p>
		</li>
		<li>
		<p>The HTTP-standard <code>Accept-Language:</code> request header.</p>
		</li>
	</ol>
	</li>
	<li>
	<p>The SPF locale resolver filters the above inputs by the <a
		href="#i18n.other.locale.avail">available locales</a> you have <a
		href="#i18n.other.locale.config">configured</a> for your portal site.</p>
	<ol>
		<li>
		<p>The locale from the first input found to match one of the
		available locale(s) for the portal site, resolves the matched locale.
		Specifically:</p>
		<ul>
			<li>
			<p>If an input locale exactly matches an available locale, then
			that available locale is resolved. For example, the <code>ja-JP</code>
			input locale exactly matches the <code>ja-JP</code> available locale,
			so <code>ja-JP</code> (Japan Japanese) is resolved.</p>
			</li>
			<li>
			<p>Otherwise if an input locale's language code matches an
			available language-only locale, then that available locale is
			resolved. For example, the <code>ja-JP</code> input locale does not
			exactly match the <code>ja</code> available locale, but the <code>ja-JP</code>
			language code alone (<code>ja</code>) does, so <code>ja</code>
			(Japanese) is resolved.</p>
			</li>
			<li>
			<p>Otherwise if an input locale's language code, combined with
			the HP.com-default country for that language, matches an available
			locale, than that available locale is resolved. For example, the <code>ja-SG</code>
			input locale does not exactly match the <code>ja-JP</code> available
			locale; but the <code>ja-SG</code> language code alone (<code>ja</code>)
			has an HP.com-default country code (<code>JP</code>), and put
			together they do match - so <code>ja-JP</code> is resolved.</p>
			<blockquote>
			<p><b>Note:</b> The HP.com-default countries for each language
			are defined as initialization parameters to the locale resolver, by
			the SPF team. For Japanese the default is Japan; for English it is
			USA; for German it is Germany; etc. Contact the SPF team for a
			complete listing, if curious.</p>
			</blockquote>
			</li>
		</ul>
		<li>
		<p>If none of the inputs provide locale(s) that match the
		available ones, then the default locale for the portal site is
		resolved.</p>
		</li>
	</ol>
	</li>
	<li>
	<p>Once a locale is resolved, it is set into Vignette so that it
	becomes the current locale for the request, in all portal components
	and portlets implicated in handling that request.</p>
	<p>Furthermore, if the locale was resolved from the URL (<code>lang</code>
	and <code>cc</code> HP.com-standard query parameters, see above), then
	the resolved locale is set into the HP.com-standard cookies, <code>lang</code>
	and <code>cc</code>. The cookies are set at the HP.com level for
	sharing across all HP.com sites, not just SPF sites, for the rest of
	the browser session. (This ensures that the URL-indicated locale
	carries-over into subsequent requests lacking the same locale
	parameters.)</p>
	</li>
</ol>

<p><b><u>An example</u></b></p>

<p>For example, consider the <code>example</code> portal site. The
site default locale is <code>en-US</code> and we have the following in <code>site_locale_support.properties</code>:</p>

<blockquote><pre>
example = es-MX, it-IT, fr-FR, de-DE
</pre></blockquote>

<p>Now consider a user request to the <code>example</code> site,
with no HP.com-standard <code>lang</code> or <code>cc</code> URL
parameters or cookies. Nor is the user logged-in. However the user's
browser language preferences are set, indicating <code>fr-FR</code>
(France French) as a preferred language (via the <code>Accept-Language</code>
HTTP request header, per the HTTP standards). Therefore the locale
resolver determines that <code>fr-FR</code> (since it is one of the
available locales for the <code>example</code> site) is the proper
current locale. Had the user not had any browser language preferences
set, the locale resolver would have settled on <code>en-US</code>, the
site default locale.</p>

<p>What if the user's browser preference had been <code>fr-CH</code>
(Swiss French) instead? In that case <code>fr-CH</code> would not be
resolved as the current locale, since it is not in the available list.
However the HP.com default for French is <code>fr-FR</code>, which is in
the list - so the locale resolver still would have settled on <code>fr-FR</code>
as the current locale.</p>

<p>What happens when the user logs-in? The HP Passport language code
comes into play, at higher precedence than the browser settings. If the
user had registered in HPP using Spanish (<code>es</code>), then after
login the locale resolver would begin to resolve <code>es-MX</code>
(Mexico Spanish) instead - because while <code>es</code> is not one of
the available locales, <code>es-MX</code> is the HP.com default for
Spanish and is among the available locales. So after login, the user
experience would switch from <code>fr-FR</code> to <code>es-MX</code>.</p>

<p>Note that the HP.com cookies still have not been set, in this
example. They are typically not set until the user does something to
consciously choose a locale - for example, use the <a
	href="#i18n.locale.selector">locale selector</a> widget, or click on a
hyperlink which has another locale's <code>lang</code> and <code>cc</code>
query parameters embedded into it. When the cookies are set, or the URL
query parameters appear, they will override both the HPP and browser
settings.</p>

<hr>

<a name="help">
<h2>3. Online Help</h2>
</a>

<p>The SPF portal utilities' online help framework is discussed
here. These are the utilities with which you can develop online help for
the users of your portal site.</p>

<hr>

<a name="help.kinds">
<h3>3.1. Kinds of online help</h3>
</a>

<p>The Shared Portal Framework provides for 3 levels of online help:
contextual, portlet, and global.</p>

<a name="help.kinds.contextual">
<h4>3.1.1. Contextual help (classic and custom; standalone and
injected)</h4>
</a>

<p><i>Contextual help</i> is a small amount of online help linked
directly from a screen element (eg text, image, form input label, etc)
and generally providing a definition or other kind of help about that
element. Contextual help is meant to be brief and specific about the
particular screen element from which it is linked.</p>

<p>SPF provides a contextual help framework for helping you develop
your contextual help. This framework is available for both portlets and
Vignette portal components to use; since this is the developer's guide
for portal utilities, the focus in this guide will be on contextual help
in portal components, but for portlet-resident contextual help you can
refer to the SPF portlet utilities developer guide.</p>

<p>The SPF contextual help framework includes a "classic" HPWeb
rendition of contextual help, where the linked screen element opens a
DHTML popup window (table) which is click-and-dragable by the user.
Inside the popup window are a brief help title, some brief help content,
and an "X" image with which to dismiss the window. An optional <code>ALT</code>
can be provided for the "X" image. For non-scripted browsers, "classic"
contextual help provides a no-script action on the link, which takes the
user to a page you provide, or to your portal site's <a
	href="#help.global">global help secondary page</a> by default (in
portal components; in portlets, it takes the user to portlet help mode
by default).</p>

<p>For example, the text for "classic" contextual help might look
like this - notice the word <code>secure</code> is the linked screen
element in question:</p>

<img src="com/hp/it/spf/xa/i18n/portal/doc-files/contextualHelpLink.jpg">

<p>When the user clicks on the link, the "classic" contextual help
popup might look like this:</p>

<img src="com/hp/it/spf/xa/i18n/portal/doc-files/contextualHelp.jpg">

<p>With "classic" contextual help, the SPF-provided API's and JSP
tags let you define your own link, title, and help content, as well as
the no-script URL (or document fragment), window size, and style
(colors, etc).</p>

<p>What if you are not satisfied with the "classic" rendering of
contextual help? The SPF contextual help framework is extensible; you
can implement your own (ie custom) rendition of contextual help. (This
is explained in the section about <a
	href="#help.contextual.java.contextualHelpProvider">extending a <code>ContextualHelpProvider</code></a>.)</p>

<p>In any case, regardless of whether you are using classic or
custom contextual help, SPF lets you use it "standalone" around a screen
element, as well as "injected" into a message. With standalone
contextual help, the text or other HTML markup inside the
contextual-help hyperlink is expected to be its own unit, which can
stand alone for localization purposes. This is often the case when the
linked screen element is an image, or the label for a form input
element, for example.</p>

<p>Often, however, you may want to just link to contextual help from
a mere word or two within a sentence (as in the above example, where the
link surrounds the word <code>secure</code> within a broader sentence).
Trying to treat that as standalone would cause you to have to break the
sentence into pieces, perhaps making it difficult to translate. So SPF
lets you keep the sentence intact, as a single localizable message in
your message resources, and inject the contextual help around just the
part of the sentence needing to be linked.</p>

<p>Injection of contextual help into a message, is mostly discussed
in the <a href="#i18n">Internationalization</a> section above. See the <a
	href="#i18n.messages.java.spf.getMessage"><code>I18nUtility.getValue</code></a>
Java API's and the <a href="#i18n.messages.jsp.spf.message"><code>&lt;spf-i18n-portal:i18nValue&gt;</code></a>
JSP tag discussions above.</p>

<p>The remaining documentation for contextual help is covered in
this section, including the <a href="#help.contextual.java">Java
API's</a> and <a href="#help.contextual.jsp">JSP tags</a> for classic and
custom, standalone and injected forms.</p>

<a name="help.kinds.portlet">
<h4>3.1.2. Portlet help (help mode)</h4>
</a>

<p>The Java portlet standards support the concept of <code>help</code>
mode: an optional portlet mode you can implement, the purpose of which
is to display help about your portlet (or portlet application) to the
user. Using WPAP and Spring Portlet MVC you can readily implement
controllers and views for <code>help</code> mode to meet your needs.</p>

<p>Often, however, the purpose of your <code>help</code> mode will
simply be to display some largely-static help content to the user. SPF
assists you with this by letting you just author your help content as a
mostly-static HTML file, in which you can put text, image references,
CSS, JavaScript, and <i>special markup tokens</i> for certain dynamic
server-side behaviors. You just write this content, and then use one of
the SPF's text interpolation utilities to render it for the user for <code>help</code>
mode.</p>

<p>Since the subject of this guide is portal utilities, portlet help
will not be discussed further here. Please see the SPF Portlet Utilities
Developer's Guide instead, for more information.</p>

<a name="help.kinds.global">
<h4>3.1.3. Portal help (global help)</h4>
</a>

<p>Finally, the SPF portal supports the concept of site-wide or <i>global
help</i>, which is online help content that covers your whole portal site
rather than a specific in-context screen element, or a specific portlet.</p>

<p>As it is site-wide, this is implemented in SPF at the portal
level rather than the portlet level. SPF provides a Vignette secondary
page type for global help, named <b>Shared Portal Framework - Global
Help Page</b> (component ID <code>spf-global-help-secondarypagetype</code>).
To implement global help, you create a secondary page instance dedicated
to your portal site, which inherits the display action from the page
type, and in which you provide your own HTML content file. This file can
contain whatever text, image references, CSS, JavaScript, and certain
dynamic behavior (ie the <a href="#file.authoer">special markup
tokens</a> discussed later in this document, under <a href="#file">Text
Interpolation</a>). The page type display action then renders the content
from your provided HTML file.</p>

<p>Portal components can then create hyperlinks pointing to global
help. SPF provides support for links that generate HPWeb "classic" popup
windows for displaying your global help secondary page. This is a
buttonless unadorned child browser window in which your global help is
displayed - by default it looks like this, though you can alter the
window features:</p>

<img src="com/hp/it/spf/xa/help/portal/doc-files/globalHelp.jpg">

<p>What if you are not satisfied with this "classic", popup
rendering of the global help secondary page? The SPF global help link
generator framework is extensible; you can implement your own (ie
custom) kind of global help help link. (This is explained in the section
about <a href="#help.global.java.globalHelpProvider">extending a <code>GlobalHelpProvider</code></a>.)</p>

<p>Your links pointing to global help can be either "standalone" or
"injected", as defined previously in the <a
	href="#help.kinds.contextual">contextual help introduction above</a>.
As with contextual help, you can create these links using <a
	href="#help.global.java">Java API's</a> or <a href="#help.global.jsp">JSP
tags</a>.</p>

<hr>

<a name="help.contextual.java">
<h3>3.2. Producing contextual help using Java code</h3>
</a>

<p>The SPF portal utilities include a Java class which implements
the HPWeb "classic" rendering of contextual help for you, {@link
com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider}. Or, if you
need to create your own rendition of contextual help, you can extend the
SPF contextual help framework to do so, by extending any class in the
{@link com.hp.it.spf.xa.help.ContextualHelpProvider} hierarchy.</p>

<a name="help.contextual.java.classicContextualHelpProvider">
<h4>3.2.1. Using <code>ClassicContextualHelpProvider</code></h4>
</a>

<blockquote>
<p><b>Note:</b> There is an SPF-provided JSP tag library for this -
see the <a href="#help.contextual.jsp.classicContextualHelp"><code>&lt;spf-help-portal:classicContextualHelp&gt;</code></a>
description below for standalone help, and the <a
	href="#help.contextual.jsp.classicContextualHelpParam"><code>&lt;spf-i18n-portal:i18nClassicContextualHelpParam&gt;</code></a>
description below for injected help.</p>
</blockquote>

<p>{@link
com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider} is a Java
class in the SPF portal utilities which knows how to render-out the
"classic" version of contextual help. Usage is as follows:</p>

<ol>
	<li>
	<p>First, you construct the object using the current Vignette <code>PortalContext</code>
	object.</p>
	</li>

	<li>
	<p>Then, you set the attributes for the contextual help. The
	following setters are available:</p>

	<dl>
		<dt>{@link
		com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider#setLinkContent(String)}</dt>
		<dd>
		<p>Sets the content of the contextual-help hyperlink. Pass in
		whatever HTML (text and markup) you want to be included inside the
		hyperlink. Use this if you are doing <i>standalone</i> contextual
		help. If you are <i>injecting</i> contextual help into a message,
		leave it unset, since the link content will be injected from the
		message.</p>
		</dd>

		<dt>{@link
		com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider#setTitleContent(String)}</dt>
		<dd>
		<p>Sets the content for the title in the contextual-help popup.
		Pass in whatever HTML (text and markup) you need, but keep it very
		brief so that it fits well in the table.</p>
		</dd>

		<dt>{@link
		com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider#setHelpContent(String)}</dt>
		<dd>
		<p>Sets the main help content in the contextual-help popup. Pass
		in whatever HTML (text and markup) you need, but keep it brief so that
		it fits well within the table.</p>
		</dd>

		<dt>{@link
		com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider#setNoScriptHref(String)}</dt>
		<dd>
		<p>Optional. Provides a URL or document fragment to use in the
		link in the case of a no-script browser. If you pass in anything
		besides a document fragment (ie anything but a string beginning with <code>#</code>),
		then that will be used as the URL to open when the link is clicked in
		the no-script case. If you pass in a document fragment, or do not even
		call this setter at all, and your portal site has a <a
			href="#help.global">global help secondary page</a> (ie a secondary
		page with the SPF global help secondary page ID, <code>template.PUBLIC_SPF_GLOBAL_HELP</code>),
		then the contextual help no-script markup will point to that secondary
		page (and pass your given fragment name, if any) - if your site does
		not have this secondary page, though, the contextual help markup will
		not include any no-script action (ie the contextual help hyperlink
		will be inactive in the no-script case).</p>
		</dd>

		<dt>{@link
		com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider#setWidth(int)}</dt>
		<dd>
		<p>Optional. Use this to set a non-default width for the popup, in
		pixels (the default width is {@link
		com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider#DEFAULT_WIDTH},
		currently 300 pixels).</p>
		</dd>

		<dt>{@link
		com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider#setBorderStyle(String)}</dt>
		<dt>{@link
		com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider#setBorderClass(String)}</dt>
		<dd>
		<p>Optional. Use these to set an inline CSS style or refer to a
		CSS class, for the border properties. If you use the <code>setBorderStyle</code>
		method, you should pass one or more CSS properties which pertain to
		HTML <code>&lt;TABLE&gt;</code> borders, like <code>border-color:red;border-width:1px</code>.
		If you use the <code>setBorderClass</code> method, you should pass the
		name of a CSS class where you defined such properties. Basically, the
		strings you pass to these setters are used as the HTML <code>&lt;STYLE&gt;</code>
		and <code>&lt;CLASS&gt;</code> attributes for the HTML <code>&lt;TABLE&gt;</code>
		that defines the popup. The default border style is {@link
		com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider#DEFAULT_BORDER_STYLE},
		currently 1-pixel solid black; if you want to reset this without
		providing any replacement style of your own, just call these setters
		with a blank string.</p>
		</dd>

		<dt>{@link
		com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider#setTitleStyle(String)}</dt>
		<dt>{@link
		com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider#setTitleClass(String)}</dt>
		<dd>
		<p>Optional. Use these to set an inline CSS style or refer to a
		CSS class, for the contextual help title. If you use the <code>setTitleStyle</code>
		method, you should pass one or more CSS properties which pertain to
		HTML <code>&lt;TD&gt;</code> cells, like <code>background-color:yellow;color:black</code>.
		If you use the <code>setTitleClass</code> method, you should pass the
		name of a CSS class where you defined such properties. Basically, the
		strings you pass to these setters are used as the HTML <code>&lt;STYLE&gt;</code>
		and <code>&lt;CLASS&gt;</code> attributes for the HTML <code>&lt;TD&gt;</code>
		cells that constitute the title inside the popup. The default title
		style is {@link
		com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider#DEFAULT_TITLE_STYLE},
		currently bold white font on a blue background; if you want to reset
		this without providing any replacement style of your own, just call
		these setters with a blank string.</p>
		</dd>

		<dt>{@link
		com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider#setHelpStyle(String)}</dt>
		<dt>{@link
		com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider#setHelpClass(String)}</dt>
		<dd>
		<p>Optional. Use these to set an inline CSS style or refer to a
		CSS class, for the main contextual help content area. These work like
		<code>setTitleStyle</code> and <code>setTitleClass</code> do, except
		on the main help content area instead of the title. The default style
		is {@link
		com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider#DEFAULT_HELP_STYLE},
		currently normal black font on a white background.</p>
		</dd>
	</dl>
	</li>

	<li>
	<p>Finally, you are ready to generate the contextual help:</p>

	<ul>
		<li>
		<p>If you are doing <i>standalone</i> contextual help, just call
		the {@link
		com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider#getHTML(boolean,boolean)}
		method now. This will return the large HTML string containing all the
		HTML and JavaScript and CSS necessary to generate the contextual help
		link and its (initially hidden) popup.</p>
		<ul>
			<li>
			<p>The first boolean switch, if set <code>true</code>, enables
			HTML-escaping in the link, title, and main help content (ie any HTML
			meta-characters there like <code>&lt;</code> will be converted to
			their HTML escape sequences so as to be displayed literally in the
			browser).</p>
			</li>
			<li>
			<p>The second boolean switch, when set <code>true</code>,
			suppresses any <code>&lt;SPAN&gt;</code> tags such as Vignette may
			have injected into your message strings, from the link, title and
			main help content.</p>
			</li>
		</ul>
		</li>
		<li>
		<p>If you are <i>injecting</i> contextual help, just pass your <code>ContextualHelpProvider</code>
		into the <a href="#i18n.messages.java.spf.getMessage"><code>I18nUtility.getValue</code></a>
		method. See the <a href="#i18n.messages.java.spf.getMessage">discussion
		above</a> for an example of this. The <code>I18nUtility.getValue</code>
		method will supply the link content from the message itself.</p>
		</li>
	</ul>
	</li>

	<li>
	<p>You can reuse the same <code>ClassicContextualHelpProvider</code>
	numerous times if you wish. The main JavaScript making the popup
	click-and-dragable will only be included the first time, unless you
	call the {@link
	com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider#resetHTML()}
	method.</p>
	</li>
</ol>

<p>An example of injecting contextual help was shown above, in the
description of the <a href="#i18n.messages.java.spf.getMessage"><code>I18nUtility.getValue</code></a>
methods. Standalone contextual help is very similar. For example,
imagine we have the following in our portal component's message
properties:</p>

<blockquote><pre>
key.help.title=Service Portal and your security
key.help.content=Internet security is important to us...
</pre></blockquote>

<p>To provide that content as standalone classic contextual help
around an image like this (possibly localized) <img
	src="com/hp/it/spf/xa/help/portal/doc-files/more_info.gif"> whose
base name was <code>more_info.gif</code>, with a gray title bar with
heavy black font, your code might look like this (where <code>ctx</code>
is your Vignette <code>PortalContext</code> object):</p>

<blockquote><pre>
import com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider;
...
// First get the title for the contextual help popup.
String helpTitle = I18nUtility.getValue("key.help.title", ctx);
// Now get the main content for the contextual help popup.
String helpContent = I18nUtility.getValue("key.help.content", ctx);
// Now make the HTML &lt;img&gt; tag for the content of the contextual help hyperlink.
String imgURL = I18nUtility.getLocalizedFileURL(ctx, "more_info.gif");
String imgTag = "&lt;IMG SRC='" + imgURL + "'&gt;"; 
// Now make the classic contextual help object and set its contents.
ClassicContextualHelpProvider cchp = new ClassicContextualHelpProvider(ctx);
cchp.setLinkContent(imgTag);
cchp.setTitleContent(helpTitle);
cchp.setHelpContent(helpContent);
// We want a gray title bar with bold black font.  It would be more flexible if we did this
// through a CSS class (and used cchp.setTitleClass) instead of hardcoding the style like this!
cchp.setTitleStyle("background-color:gray;color:black;font-weight:bold;font-style:italic");
// Now get the HTML for the whole contextual help link, image, and initially-hidden popup.
String html = cchp.getHTML(false, false);
</pre></blockquote>

<p>The resulting contextual help popup (when the user clicks on the
<img src="com/hp/it/spf/xa/help/portal/doc-files/more_info.gif">
image) looks like this:</p>

<img
	src="com/hp/it/spf/xa/i18n/portal/doc-files/contextualHelpGrayTitle.jpg">

<p>If the browser was unscripted, though, clicking on the link would
open your portal site's <a href="#help.global">global help secondary
page</a>. If your site has no global help secondary page, then the link
would be inoperable (ie just the question-mark image would display, with
no contextual-help link around it at all).</p>

<p>Note that the classic contextual help popup includes an "X" image
on which the user can click to close the popup. There are a few
different ways you can supply the image:</p>
<ul>
	<li>
	<p>Name the image whatever you like and host it anywhere
	URL-addressable. Then provide the URL of the image in your portal
	component's message resource bundle, using the <code>contextualHelp.close.url</code>
	message key. (This way you can have different URL's for different
	locales, and thus provide a localized image if desired.) Your URL can
	be relative to the portal application root, or absolute. If you plan to
	use contextual help under both HTTP and HTTPS pages on your site, we
	recommend using either an HTTPS URL for the close-button image, or a
	relative URL; if you use an HTTP close-button image URL and the user
	accesses a page with contextual help under HTTPS, the user's browser
	will typically display a warning to the user.</p>
	</li>
	<li>
	<p>Alternatively, put the image into your portal component's
	secondary support files, and put the filename of the image into your <code>contextualHelp.close.url</code>
	message property. You can have localized images; just tag them by
	locale properly, put them all into your component as secondary support
	files, and put the base filename of the image into the message
	property. It is OK to put just the base filename into the message
	property across the whole resource bundle; SPF will generate the actual
	URL for you automatically, pointing to the best-candidate among the
	localized versions of the files you supplied.</p>
	</li>
	<li>
	<p>By default, if you do not provide a <code>contextualHelp.close.url</code>
	message property, then SPF will assume the close-button image file is
	named <code>btn_close.gif</code> and is located as a secondary support
	file in your current portal component. As above, it will choose the
	best-available localized version for the user's locale.</p>
	</li>
	<li>
	<p>Lastly, if you provide no image file, SPF will default to use
	the <code>btn_close.gif</code> image provided with the SPF Vignette
	portal application itself - it looks like the "X" image shown in the
	examples here, and is the same for all locales.</p>
	</li>
</ul>

<p>Also, your "X" image can optionally have an <code>ALT</code> text
string displayed with it when the user hovers the mouse over it. Put
your desired <code>ALT</code> message into your portal component's
message resource bundle, using the <code>contextualHelp.close.alt</code>
message key.</p>

<p>See the {@link
com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider} class
documentation, and the <a
	href="com/hp/it/spf/xa/help/portal/package-summary.html">package
description</a>, for more information.</p>

<a name="help.contextual.java.contextualHelpProvider">
<h4>3.2.2. Extending a <code>ContextualHelpProvider</code> to
create a custom rendition</h4>
</a>

<p>If you need to create a custom version of contextual help, you
should extend either of these classes in the <a
	href="#overview.other.spf.common">SPF common utilities</a>: {@link
com.hp.it.spf.xa.help.ClassicContextualHelpProvider} or {@link
com.hp.it.spf.xa.help.ContextualHelpProvider}. The common {@link
com.hp.it.spf.xa.help.ClassicContextualHelpProvider} provides behavior
very close to the one <a
	href="#help.contextual.java.classicContextualHelpProvider">discussed
above</a>. The {@link com.hp.it.spf.xa.help.ContextualHelpProvider} is much
more generic. Basically, in each case you need to implement the abstract
methods, and potentially override any other methods to impose your
desired functionality.</p>

<p>Please read the class and method documentation for each class, in
order to familiarize yourself with their provided and abstract
functionality, so that you can decide which would be best for you to
extend.</p>

<hr>

<a name="help.contextual.jsp">
<h3>3.3. Producing contextual help using JSP tag libraries</h3>
</a>

<p>The SPF portal utilities include two JSP tags which implements
the "classic" rendering of contextual help for you. One is for
standalone classic contextual help (<code>&lt;spf-help-portal:classicContextualHelp&gt;</code>)
and the other is for injecting classic contextual help into a
surrounding message (<code>&lt;spf-i18n-portal:i18nClassicContextualHelpParam&gt;</code>.
Or, if you have created a custom contextual help provider, you can
create your own JSP tag to wrap around it.</p>

<a name="help.contextual.jsp.classicContextualHelp">
<h4>3.3.1. Using <code>&lt;spf-help-portal:classicContextualHelp&gt;</code>
for standalone classic contextual help</h4>
</a>

<p>You use this tag to express standalone contextual help with a
"classic" rendering. It wraps around the {@link
com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider} to provide
the same capabilities for standalone help. The usage is:</p>

<blockquote><pre>
&lt;%@ taglib prefix="spf-help-portal" uri="/spf-help-portal.tld" %&gt;
...
&lt;spf-help-portal:classicContextualHelp
	anchor="<i>link-content</i>"
	anchorKey="<i>link-content-message-key</i>"
	anchorImg="<i>link-image-url</i>"
	anchorImgKey="<i>link-image-base-file</i>"
	anchorImgAlt="<i>link-image-alt-text</i>"
	anchorImgAltKey="<i>link-image-alt-text-message-key</i>"
	escape="<i>true-or-false</i>"
	filterSpan="<i>true-or-false</i>"
	title="<i>help-title</i>"
	titleKey="<i>help-title-message-key</i>"
	content="<i>help-content</i>"
	contentKey="<i>help-content-message-key</i>"
	noScriptHref="<i>uri</i>"
	width="<i>pixels</i>"
	borderStyle="<i>inline-style</i>'
	borderClass="<i>css-classname</i>"
	titleStyle="<i>inline-style</i>"
	titleClass="<i>css-classname</i>"
	contentStyle="<i>inline-style</i>"
	contentClass="<i>css-classname</i>"
	/&gt;
</pre></blockquote>

<p>You must provide one of the first four attributes (<code>anchor</code>,
<code>anchorKey</code>, <code>anchorImg</code>, <code>anchorImgKey</code>)
- these provide the link content. You must also provide the <code>title</code>
(or <code>titleKey</code>) and <code>content</code> (or <code>contentKey</code>)
- these provide the messages for the contextual-help popup layer itself.
The other tag attributes are optional.</p>

<ul>
	<li>
	<p>With <code>anchor</code> you provide the exact link content - a
	string of text, HTML, and whatever else.</p>
	</li>
	<li>
	<p>With <code>anchorKey</code> you provide the keyname of a message
	in your portal component's message resource bundle, and the tag looks
	up the whole link content from there. As usual with message resource
	lookup, the best-fit localized version for the user's current locale
	found in your bundle is used (this proceeds like <a
		href="#i18n.messages.java.spf.getMessage"><code>I18nUtility.getValue</code></a>
	described earlier in this document).</p>
	</li>
	<li>
	<p>With <code>anchorImg</code> you provide the URL of an image, and
	the <code>&lt;spf-help-portal:classicGlobalHelp&gt;</code> tag builds
	an HTML <code>&lt;IMG&gt;</code> tag for that and uses it as the link
	content.</p>
	</li>
	<li>
	<p>With <code>anchorImgKey</code> you provide the basename of a
	supporting resource file (ie <i>secondary support file</i>) in your
	portal component. The <code>&lt;spf-help-portal:classicGlobalHelp&gt;</code>
	tag looks-up the best-fit localized version of that file for the user's
	current locale, and makes a URL for it (this proceeds like <a
		href="#i18n.supporting.java.getLocalizedFileURL"><code>I18nUtility.getLocalizedFileURL</code></a>
	described earlier in this document) - then builds an HTML <code>&lt;IMG&gt;</code>
	tag for that and uses it as the link content.</p>
	<blockquote>
	<p>With either of the above image-related attributes, you can also
	specify HTML <code>ALT</code> text for the HTML <code>&lt;IMG&gt;</code>
	tag using either <code>anchorImgAlt</code> for the exact text, or <code>anchorImgAltKey</code>
	for the keyname of a message property in your component's resource
	bundle.</p>
	</blockquote>
	</li>
	<li>
	<p>With <code>title</code> you provide the exact title text for the
	contextual help popup layer, including whatever HTML you like.</p>
	</li>
	<li>
	<p>With <code>titleKey</code> you provide the keyname of a message
	property containing the title text for the contextual help popup. As
	above, this may be localized.</p>
	</li>
	<li>
	<p>With <code>content</code> you provide the exact body text for
	the contextual help popup layer, including whatever HTML you like.</p>
	</li>
	<li>
	<p>With <code>contentKey</code> you provide a message keyname
	instead - as above, this may be localized.</p>
	</li>
</ul>

<p>For example, suppose your portal component's message resource
bundle contains this:</p>

<blockquote><pre>
key.help.title=Service Portal and your security
key.help.content=Internet security is important to us...
key.help.image.alt=Click for help
</pre></blockquote>

<p>And suppose you need to generate some standalone contextual help
with that content, linked from an image (possibly localized) inside your
portal component, where the image base name is <code>question_mark.gif</code>.
(This image and its localized variants are locale-tagged and maintained
as supporting resource files - ie <i>secondary support files</i> -
inside your portal component, as described <a href="#i18n.location">earlier</a>
in this document.) Furthermore, suppose that the contextual help title
bar should use a gray background with heavy black font. Then you could
generate the image, link, and (initially hidden) classic contextual help
popup, using JSP like this:</p>

<blockquote><pre>
&lt;%@ taglib prefix="spf-help-portal" uri="/spf-help-portal.tld" %&gt;
...
&lt;spf-help-portal:classicContextualHelp 
	anchorImgKey="question_mark.gif"
	anchorImgAltKey="key.help.image.alt"
	titleKey="key.help.title"
	contentKey="key.help.content"
	titleStyle="background-color:gray;color:black;font-weight:bold;font-style:italic"
	/&gt;
</pre></blockquote>

<p>This JSP would generate an HTML &lt;IMG&gt; tag, with the <code>SRC</code>
pointing at the properly-localized version of the <code>question_mark.gif</code>
secondary support file; and with the <code>ALT</code> showing the
properly-localized version of the <code>Click for help</code> message.
When the user clicked on the image, the resulting contextual help popup
would look like this:</p>

<img
	src="com/hp/it/spf/xa/i18n/portal/doc-files/contextualHelpGrayTitle.jpg">

<p>If the browser was unscripted, though, clicking on the link would
open your portal site's <a href="#help.global">global help secondary
page</a>. If your portal site has no such page, then the link would be
inoperable (ie just the image would display, with no contextual-help
link around it at all).</p>

<p>For more detailed description of this tag, see the tag
documentation, in the <a
	href="com/hp/it/spf/xa/help/portal/tag/package-summary.html#classicContextualHelp">package
description</a>, for more information.</p>

<blockquote>
<p>Note that the classic contextual help popup includes an "X" image
on which the user can click to close the popup. There are a few
different ways you can supply the image:</p>
<ul>
	<li>
	<p>Name the image whatever you like and host it anywhere
	URL-addressable. Then provide the URL of the image in your portal
	component's message resource bundle, using the <code>contextualHelp.close.url</code>
	message key. (This way you can have different URL's for different
	locales, and thus provide a localized image if desired.) Your URL can
	be relative to the portal application root, or absolute. If you plan to
	use contextual help under both HTTP and HTTPS pages on your site, we
	recommend using either an HTTPS URL for the close-button image, or a
	relative URL; if you use an HTTP close-button image URL and the user
	accesses a page with contextual help under HTTPS, the user's browser
	will typically display a warning to the user.</p>
	</li>
	<li>
	<p>Alternatively, put the image into your portal component's
	secondary support files, and put the filename of the image into your <code>contextualHelp.close.url</code>
	message property. You can have localized images; just tag them by
	locale properly, put them all into your component as secondary support
	files, and put the base filename of the image into the message
	property. It is OK to put just the base filename into the message
	property across the whole resource bundle; SPF will generate the actual
	URL for you automatically, pointing to the best-candidate among the
	localized versions of the files you supplied.</p>
	</li>
	<li>
	<p>By default, if you do not provide a <code>contextualHelp.close.url</code>
	message property, then SPF will assume the close-button image file is
	named <code>btn_close.gif</code> and is located as a secondary support
	file in your current portal component. As above, it will choose the
	best-available localized version for the user's locale.</p>
	</li>
	<li>
	<p>Lastly, if you provide no image file, SPF will default to use
	the <code>btn_close.gif</code> image provided with the SPF Vignette
	portal application itself - it looks like the "X" image shown in the
	examples here, and is the same for all locales.</p>
	</li>
</ul>

<p>Also your "X" image can optionally have an <code>ALT</code> text
string displayed with it when the user hovers the mouse over it. Put
your desired <code>ALT</code> message into your portal component's
message resource bundle, using the <code>contextualHelp.close.alt</code>
message key.</p>
</blockquote>

<a name="help.contextual.jsp.classicContextualHelpParam">
<h4>3.3.2. Using <a
	href="com/hp/it/spf/xa/i18n/portal/tag/package-summary.html#classicContextualHelpParam"><code>&lt;spf-i18n-portal:i18nClassicContextualHelpParam&gt;</code></a>
for injected classic contextual help</h4>
</a>

<p>This tag is only used inside the tag body of <a
	href="#i18n.messages.jsp.spf.message"><code>&lt;spf-i18n-portal:i18nValue&gt;</code></a>.
It wraps around the {@link
com.hp.it.spf.xa.help.portal.ClassicContextualHelpProvider} to provide
the same capabilities for injected help. You use it to inject contextual
help into the message value, where the special <code>&lt;contextual_help&gt;...&lt;/contextual_help&gt;</code>
markup is found. The format of contextual help which is injected is the
"classic" rendition. The usage is:</p>

<blockquote><pre>
&lt;%@ taglib prefix="spf-i18n-portal" uri="/spf-i18n-portal.tld" %&gt;
...
&lt;spf-i18n-portal:i18nClassicContextualHelpParam
	title="<i>help-title</i>"
	titleKey="<i>help-title-message-key</i>"
	content="<i>help-content</i>"
	contentKey="<i>help-content-message-key</i>"
	noScriptHref="<i>uri</i>"
	width="<i>pixels</i>"
	borderStyle="<i>inline-style</i>'
	borderClass="<i>css-classname</i>"
	titleStyle="<i>inline-style</i>"
	titleClass="<i>css-classname</i>"
	contentStyle="<i>inline-style</i>"
	contentClass="<i>css-classname</i>"
	/&gt;
</pre></blockquote>

<p>The <code>title</code> (or <code>titleKey</code>) and <code>content</code>
(or <code>contentKey</code>) are required; the other tag attributes are
optional.</p>

<ul>
	<li>
	<p>With <code>title</code> you provide the exact content for the
	title bar of the contextual-help popup - a string of text, HTML, and
	whatever else.</p>
	</li>
	<li>
	<p>With <code>titleKey</code> you provide the keyname of a message
	in your portal component's message resource bundle, and the tag looks
	up the contextual-help title from there. As usual with message resource
	lookup, the best-fit localized version for the user's current locale
	found in your bundle is used (this proceeds like <a
		href="#i18n.messages.java.spf.getMessage"><code>I18nUtility.getValue</code></a>
	described earlier in this document).</p>
	</li>
	<li>
	<p>With <code>content</code> you provide the exact body text for
	the contextual help popup layer, including whatever HTML you like.</p>
	</li>
	<li>
	<p>With <code>contentKey</code> you provide a message keyname for
	the contextual help popup's main body instead - as above, this may be
	localized.</p>
	</li>
</ul>

<p>For example, if your message properties contain this:</p>

<blockquote><pre>
key=Your sign-in is &lt;contextual_help&gt;secure&lt;/contextual_help&gt;
key.help.title=Service Portal and your security
key.help.content=Internet security is important to us...
</pre></blockquote>

<p>Then you could generate the message, with classic contextual help
injected, in your JSP like this:</p>

<blockquote><pre>
&lt;%@ taglib prefix="spf-i18n-portal" uri="/spf-i18n-portal.tld" %&gt;
...
&lt;spf-i18n-portal:i18nValue key="key"&gt;
	&lt;spf-i18n-portal:i18nClassicContextualHelpParam titleKey="key.help.title" contentKey="key.help.content" /&gt;
&lt;/spf-i18n-portal:i18nValue&gt;
</pre></blockquote>

<p>This JSP would generate a message looking in the user's browser
like this:</p>

<img src="com/hp/it/spf/xa/i18n/portal/doc-files/contextualHelpLink.jpg">

<p>When the user clicked on the link, then the classic-rendition
contextual help would pop open:</p>

<img src="com/hp/it/spf/xa/i18n/portal/doc-files/contextualHelp.jpg">

<p>Most of the other tag attributes can be used to change the style
(color, font, size) of the classic contextual help popup. See the tag
documentation, in the <a
	href="com/hp/it/spf/xa/i18n/portal/tag/package-summary.html#classicContextualHelpParam">package
description</a>, for more information.</p>

<blockquote>
<p><b>Note 1:</b> The classic rendition of contextual help utilizes an
"X" image on which the user can click to close the window. 
There are a few different ways you can supply the image:</p>
<ul>
	<li>
	<p>Name the image whatever you like and host it anywhere
	URL-addressable. Then provide the URL of the image in your portal
	component's message resource bundle, using the <code>contextualHelp.close.url</code>
	message key. (This way you can have different URL's for different
	locales, and thus provide a localized image if desired.) Your URL can
	be relative to the portal application root, or absolute. If you plan to
	use contextual help under both HTTP and HTTPS pages on your site, we
	recommend using either an HTTPS URL for the close-button image, or a
	relative URL; if you use an HTTP close-button image URL and the user
	accesses a page with contextual help under HTTPS, the user's browser
	will typically display a warning to the user.</p>
	</li>
	<li>
	<p>Alternatively, put the image into your portal component's
	secondary support files, and put the filename of the image into your <code>contextualHelp.close.url</code>
	message property. You can have localized images; just tag them by
	locale properly, put them all into your component as secondary support
	files, and put the base filename of the image into the message
	property. It is OK to put just the base filename into the message
	property across the whole resource bundle; SPF will generate the actual
	URL for you automatically, pointing to the best-candidate among the
	localized versions of the files you supplied.</p>
	</li>
	<li>
	<p>By default, if you do not provide a <code>contextualHelp.close.url</code>
	message property, then SPF will assume the close-button image file is
	named <code>btn_close.gif</code> and is located as a secondary support
	file in your current portal component. As above, it will choose the
	best-available localized version for the user's locale.</p>
	</li>
	<li>
	<p>Lastly, if you provide no image file, SPF will default to use
	the <code>btn_close.gif</code> image provided with the SPF Vignette
	portal application itself - it looks like the "X" image shown in the
	examples here, and is the same for all locales.</p>
	</li>
</ul>

<p><b>Note 2:</b> Your "X" image can optionally have an <code>ALT</code> text
string displayed with it when the user hovers the mouse over it. Put
your desired <code>ALT</code> message into your portal component's
message resource bundle, using the <code>contextualHelp.close.alt</code>
message key.</p>
</blockquote>

<a name="help.contextual.jsp.contextualHelpProvider">
<h4>3.3.3. Creating a tag library for a custom rendition</h4>
</a>

<p>If you need to create a custom version of contextual help, you
can create a tag class to reference it. First, develop your custom
contextual help provider as described above, by <a
	href="#help.contextual.java.contextualHelpProvider">extending a <code>ContextualHelpProvider</code>
class</a> of your choosing.</p>

<p>Then create a tag class for it. Just as the SPF provides a class
hierarchy for the provider classes themselves, it provides a class
hierarchy for their tag classes.</p>

<ul>
	<li>If you extend {@link
	com.hp.it.spf.xa.help.ClassicContextualHelpProvider} then the tag class
	to extend is {@link
	com.hp.it.spf.xa.help.tag.ClassicContextualHelpBaseTag} (for a tag for
	standalone help) or {@link
	com.hp.it.spf.xa.i18n.tag.ClassicContextualHelpParamBaseTag} (for a tag
	for injected help).</li>
	<li>If you extend {@link
	com.hp.it.spf.xa.help.ContextualHelpProvider} then the tag class to
	extend is {@link com.hp.it.spf.xa.help.tag.ContextualHelpBaseTag} (for
	a tag for standalone help) or {@link
	com.hp.it.spf.xa.i18n.tag.ContextualHelpParamBaseTag} (for a tag for
	injected help).</li>
</ul>

<p>As you would expect, the <code>ClassicContextualHelpBaseTag</code>
and <code>ClassicContextualHelpParamBaseTag</code> provide behavior very
close to the <a href="#help.contextual.jsp.classicContextualHelp"><code>&lt;spf-help-portal:classicContextualHelp&gt;</code></a>
and <a href="#help.contextual.jsp.classicContextualHelpParam"><code>&lt;spf-i18n-portal:i18nClassicContextualHelpParam&gt;</code></a>
tags discussed above. The <code>ContextualHelpBaseTag</code> and <code>ContextualHelpParamBaseTag</code>
are much more generic. Basically, in each case you need to implement the
abstract methods, and potentially override any other methods to impose
your desired functionality. You also need to create your TLD file.</p>

<p>Please read the class and method documentation for each class, in
order to familiarize yourself with their provided and abstract
functionality, so that you can decide which would be best for you to
extend. You may also want to look at the source for SPF's own classes
that do this, such as {@link
com.hp.it.spf.xa.help.portal.tag.ClassicContextualHelpTag} and {@link
com.hp.it.spf.xa.i18n.portal.tag.ClassicContextualHelpParamTag}, to see
how it is done. The SPF development team can direct you to the source
code.</p>

<hr>

<a name="help.global">
<h3>3.4. Producing global help using the <code>spf-global-help-secondarypagetype</code></h3>
</a>

<p>Not every portal site needs to have a global help page. But if
you decide to implement one, the SPF provides a framework to minimize
the task for you, letting you concentrate just on the content itself.
This framework is based around the SPF-provided <b>global help
secondary page type</b>. This section will tell you how to implement global
help using that secondary page type, and the <a href="#help.global.java">following</a>
<a href="#help.global.jsp">sections</a> will give you ways to link to
your global help page.</p>

<p>To build a global help page, you implement a <b>global help
secondary page</b> instance for the SPF-provided global help secondary page
type. This secondary page type, named <b>Shared Portal Framework -
Global Help Page</b> (component ID <code>spf-global-help-secondarypagetype</code>),
is available in every SPF-provided instance of Vignette portal. To
construct your global help secondary page, it helps to have some
experience with Vignette portal component development. The <a
	href="#overview.other.vignette.devguide">Vignette Portal
Developer's Guide</a> is a good reference for that, and this section will
assume you have the basic background.</p>

<a name="help.global.car">
<h4>3.4.1. Structuring your CAR file</h4>
</a>

<p>As with all Vignette portal components, your global help
secondary page must be packaged as a CAR (Vignette component archive)
file. Your CAR file should have the following layout. See below for an
explanation of the files.</p>
<blockquote><pre>
component.xml                                          # Your Vignette component descriptor.
globalHelp.html                                        # Base (English) global help content.
globalHelp_&lt;your-locales&gt;.html                         # Translations.
...                                                    # ...
globalHelp_&lt;your-locales&gt;.html                         # Translations.
globalHelpInclude.properties                           # Your help content's include properties (optional).
globalHelpMain.jsp                                     # The primary JSP.
&lt;any-supporting-resources&gt;                             # Any supporting resources (eg images) used
                                                       # by your help content (optional).
WEB-INF
   +--i18n
      +--&lt;your-component-id&gt;.properties                # Base (English) messages.
      +--&lt;your-component-id&gt;_&lt;your-locales&gt;.properties # Translations.
      +--...                                           # ...
      +--&lt;your-component-id&gt;_&lt;your-locales&gt;.properties # Translations.
</pre></blockquote>

<a name="help.global.xml">
<h4>3.4.2. Creating your component descriptor (<code>component.xml</code>)</h4>
</a>
<p>The <code>component.xml</code> (Vignette component descriptor)
for your global help secondary page must follow a stereotypical pattern.
In particular, you must declare your secondary page component name and
ID, and instantiate the <code>spf-global-help-secondarypagetype</code>,
which provides most of the code needed to render your global help. It
looks like this. This example is taken from the HP Support Center, an
SPF-based portal site. See after the example for important notes about
the tag attributes which are hyperlinked below.</p>

<blockquote><pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;epideploy:component build-version="Gold"
	<a href="#help.global.xml.id">component-id="sp4ts-global-help-secondarypage"</a>
	component-type="Secondary Pages"
	<a href="#help.global.xml.desc">description="Secondary page for display of global help in HP Support Center."</a>
	epi-build="251"
	epi-version="7.2.2"
	major-version="1"
	minor-version="0"
	<a href="#help.global.xml.title">title="HP Support Center - Global Help Page"</a>
	xmlns:epideploy="http://www.epicentric.com/deployment"&gt;
	&lt;epideploy:required-component
		component-id="spf-global-help-secondarypagetype"
		component-type="Secondary Page Types"
		major-version="1"
		minor-version="0" /&gt;
	&lt;epideploy:detail&gt;
		&lt;style-info apply-template-header="false"
			<a href="#help.global.xml.desc">description="Secondary page for display of global help in HP Support Center."</a>
			<a href="#help.global.xml.friendly">friendly-id="PUBLIC_SP4TS_GLOBAL_HELP"</a>
			<a href="#help.global.xml.id">id="sp4ts-global-help-secondarypage"</a>
			is-system="false" 
			primary-filename="globalHelpMain.jsp"
			processing-type="ACTION_BASED" 
			template-default="true"
			template-uid="spf-global-help-secondarypagetype"
			<a href="#help.global.xml.title">title="HP Support Center - Global Help Page"</a>
			visible="true"&gt;
			&lt;actions&gt;
				&lt;group-reference group-id="INHERIT_ALL" /&gt;
			&lt;/actions&gt;
		&lt;/style-info&gt;
	&lt;/epideploy:detail&gt;
&lt;/epideploy:component&gt;
</pre></blockquote>

<blockquote>
<dl>
	<dt><a name="help.global.xml.id"><b>component-id (id)</b></a></dt>
	<dd>
	<p>Technically this can be whatever you want. But by convention,
	please use <code><i>&lt;your-site&gt;</i>-global-help-secondarypage</code>,
	where <code><i>&lt;your-site&gt;</i></code> is your "site DNS name".</p>
	</dd>
	<dt><a name="help.global.xml.title"><b>title</b></a></dt>
	<dd>
	<p>Technically this can be whatever you want. But by convention,
	please use <code><i>&lt;your-site&gt;</i> - Global Help Page</code>,
	where <code><i>&lt;your-site&gt;</i></code> is your full site name.</p>
	</dd>
	<dt><a name="help.global.xml.desc"><b>description</b></a></dt>
	<dd>
	<p>Customize this with a short description of the purpose of the
	page. For example, <code>Secondary page for display of global
	help in <i>&lt;your-site&gt;</i></code>.</p>
	</dd>
	<dt><a name="help.global.xml.friendly"><b>friendly-id</b></a></dt>
	<dd>
	<p>Technically this can be whatever you want. But by convention,
	please use <code>PUBLIC_<i>&lt;your-site&gt;</i>_GLOBAL_HELP</code>,
	where <code><i>&lt;your-site&gt;</i></code> is your "site DNS name" in
	uppercase.</p>
	</dd>
</dl>
</blockquote>

<a name="help.global.content">
<h4>3.4.3. Creating your global help content (<code>globalHelp.html</code>)</h4>
</a>

<p>Your global help content is placed in an HTML <a
	href="#i18n.resources.bundles">resource bundle</a> whose base filename
is <code>globalHelp.html</code>. You can use whatever HTML markup
(including CSS and JS) you need. Remember, though, that this document
will be pulled-in by the portal and aggregated with your theme (grid and
style) - therefore it should not include any document-level markup such
as the <code>&lt;HTML&gt;</code>, <code>&lt;HEAD&gt;</code>, and <code>&lt;BODY&gt;</code>
tags.</p>

<p>You can also use the SPF's dynamic token language in your <code>globalHelp.html</code>.
This lets you interpolate certain dynamic data into the content, such as
user properties (name, email address, etc); URL's pointing to images,
CSS files, JS files, etc; and <a href="#help.global.properties">include
properties</a> from your <code>globalHelpInclude.properties</code> file. You
can also permission/condition the content so that certain parts are seen
only by logged-in or logged-out users, or users within certain groups.
Read more about the <a href="#file.author">token language</a> later in
this document.</p>

<p>Your global help content can be localized. Each localized file
should be named and tagged as described earlier in the discussion about
<a href="#i18n.resources.bundles">resource bundles</a>, and must use
UTF-8 character encoding. At runtime, the <code>spf-global-help-secondarypagetype</code>
will select the best-available localized version for the user's locale.
The user's locale is as determined automatically by the SPF portal's <a
	href="#i18n.other.locale.resolver">locale resolver</a>, and the search
sequence for the best-fit <code>globalHelp.html</code> file follows the
standard Java {@link java.util.ResourceBundle} algorithm.</p>

<p>Your global help HTML may include references (ie URLs) pointing
to other supporting resource files which you keep in your global help
CAR (eg images, CSS files, etc). Use the <a
	href="#file.author.token.url"><code>{CONTENT-URL:<i>filename</i>}</code></a>
or <a href="#file.author.token.url"><code>{LOCALIZED-CONTENT-URL:<i>filename</i>}</code></a>
dynamic tokens to generate URLs for them inside your <code>globalHelp.html</code>.
Be sure to include the <code><i>filename</i></code> files in your CAR as
well. Note the <code><i>filename</i></code> files may themselves be
localized - just tag them appropriately as you do with the localized <code>globalHelp.html</code>
files.</p>

<p>Note: If you wish, your global help can refer to CSS classes
defined by your theme. That is, any CSS classes pulled-in by the page
grid and/or styles which you will apply to your global help secondary
page (see <a href="#help.global.deployment">below</a>), can be assumed
and used in your content since they will be in-scope when the content is
aggregated with the theme at runtime.</p>

<p>For example, here is some global help content taken from the HP
Support Center:</p>

<blockquote><pre>
&lt;div id="introBlock"&gt;
&lt;h1 class="headerAlpha"&gt;Welcome to HP Support Center site help&lt;/h1&gt;

&lt;p class="content"&gt;This page provides general information about HP
Support Center and how to use it. For detailed information about
specific features such as Forums, Search, etc., use the specific feature
help links available below.&lt;br&gt;
&lt;br&gt;

&lt;span class="textLevelC"&gt;Note: For additional features for users
with support agreements (such as Support Case Manager, Software Update
Manager, and others), please visit the &lt;a href="{INCLUDE:itrc.url.home}"&gt;IT
Resource Center website&lt;/a&gt;. These services will be added to HP Support
Center in a future release.&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;

...

{GROUP:LOCAL_PORTAL_LANG_JA|LOCAL_PORTAL_COUNTRY_JP}
{LOGGED-IN}

...

	&lt;tr&gt;
		&lt;td valign="top"&gt;1.&lt;/td&gt;
		&lt;td valign="top"&gt;In the OiSC contract confirmation page, enter
		your registry key issued by HP Japan and click 'confirm'. If you do
		not know your registry key, contact &lt;a
			href="mailto:{INCLUDE:hp.email.registry}"&gt;{INCLUDE:hp.email.registry}&lt;/a&gt;.&lt;/td&gt;
		&lt;td&gt;&lt;img src="{LOCALIZED-CONTENT-URL:oiscRegPage.jpg}"
			alt="Oracle internet Support Center"
			title="Oracle internet Support Center"&gt;&lt;/td&gt;
	&lt;/tr&gt;

...

{/LOGGED-IN}
{/GROUP}
</pre></blockquote>

<p>Notes on this example:</p>

<ul>
	<li>
	<p>Since this content will be aggregated with the theme components
	to assemble the whole page, notice that no document-level tags like <code>&lt;HTML&gt;</code>,
	<code>&lt;HEAD&gt;</code>, and <code>&lt;BODY&gt;</code> are used.</p>
	</li>

	<li>
	<p>HP.com-defined CSS stylesheets are linked-in by the theme
	components for this portal site by default. Therefore the <code>globalHelp.html</code>
	content makes use of HP.com-defined CSS classes such as <code>introBlock</code>
	and <code>headerAlpha</code> without defining them.</p>
	</li>

	<li>
	<p>Several include-properties are used, for parts of the document
	which the author felt were important to keep in a separate properties
	file. (This way, for example, they could be changed without having to
	re-localize the <code>globalHelp.html</code> bundle.) For example, the
	ITRC URL is assumed to be available in an include-property named <code>itrc.url.home</code>,
	and included here in <code>globalHelp.html</code> at runtime using the
	<code>{INCLUDE:itrc.url.home}</code> token. The property value is
	defined in a separate file, <code>globalHelpInclude.properties</code>;
	see <a href="#help.global.properties">below</a>.</p>
	</li>

	<li>
	<p>Notice that a whole block of content is defined exclusively for
	logged-in Japanese users. First, the <code>{GROUP:LOCAL_PORTAL_LANG_JA|LOCAL_PORTAL_LANG_JP}</code>
	token is used to permission the enclosed content for users who are in
	either the SPF-provided Japanese language group (<code>LOCAL_PORTAL_LANG_JA</code>)
	or the SPF-provided Japan country group (<code>LOCAL_PORTAL_LANG_JP</code>)
	(or both). Next, the <code>{LOGGED-IN}</code> token is used to
	permission the enclosed content for authenticated users only. You can
	read more about permissioning tokens later in this document, in the
	section about <a href="#file.author.token.auth">permissioning
	content</a> during text interpolation. (The available groups to permission
	will vary depending on your portal site, but the standard SPF-provided
	ones are defined later in this document too, in the section about <a
		href="#portal.user.groups"><code>Utils.getGroups</code></a>.)</p>
	</li>

	<li>
	<p>Finally, notice that an <code>&lt;IMG&gt;</code> tag is
	declared, pointing to a picture named <code>oiscRegPage.jpg</code>
	using the <code>{LOCALIZED-CONTENT-URL:oiscRegPage.jpg}</code> token.
	Thus the JPG file, <code>oiscRegPage.jpg</code> (and specifically the
	Japanese localized version of it, in this context, since the token is
	referenced inside a Japan-only section of the help document), must be
	kept inside the CAR as well.</p>
	</li>
</ul>

<a name="help.global.properties">
<h4>3.4.4. Creating your global help include properties (<code>globalHelpInclude.properties</code>
- optional)</h4>
</a>

<p>If your <a href="#help.global.content">global help content</a>
does not use the <a href="#file.author.token.consolidate"><code>{INCLUDE:<i>key</i>}</code></a>
token, you do not need a <code>globalHelpInclude.properties</code> file.
But if you do use that token, put your key-value pairs into <code>globalHelpInclude.properties</code>,
and put <code>globalHelpInclude.properties</code> into your CAR file as
shown <a href="#help.global.car">above</a>.</p>

<p>For example, the <code>globalHelpInclude.properties</code> for
the content example shown above looks like this. (Notice how
include-property values can reference other dynamic tokens. In this
example, this has been applied to the task of passing the proper ITRC
language code for the user's current locale into the ITRC URL. The
property value has been wrapped for readability in this listing.)</p>

<blockquote><pre>
#
# ITRC properties
#
itrc.url.home = http://www.itrc.hp.com/service/home/home.do?LANGUAGE_OPTION={INC
LUDE:itrc.language.{INCLUDE:country.{LANGUAGE-TAG}}}
itrc.language. = english
itrc.language.CN = chinese-s
itrc.language.HK = chinese-t
itrc.language.TW = chinese-t
itrc.language.KR = korean
itrc.language.JP = japanese
...
#
# email properties
#
hp.email.registry = sw.mvs@hp.com
#
# internal properties
#
country.zh-CN = CN
country.zh-HK = HK
country.zh-TW = TW
country.ko-KR = KR
country.ja-JP = JP
country.zh = CN
country.ko = KR
country.ja = JP
...
</pre></blockquote>

<p>If desired, you can localize your <code>globalHelpInclude.properties</code>
so that include-property values referred-to from your localized global
help content are themselves localized. Tag your localized files with
locale and put them into the global help CAR file too.</p>

<a name="help.global.primary">
<h4>3.4.5. Creating your primary JSP (<code>globalHelpMain.jsp</code>)</h4>
</a>

<p>Your global help secondary page's primary JSP can be very simple.
The secondary page type will interpolate your <a
	href="#help.global.content">global help content</a> and any <a
	href="#help.global.properties">include properties</a> for you,
depositing the resulting interpolated content into the portal request
object as a single {@link java.lang.String} request attribute. So your
primary JSP can just get and express that attribute. The name of the
attribute is contained in the {@link
com.hp.it.spf.xa.misc.portal.Consts#REQUEST_ATTR_GLOBAL_HELP_DATA} class
attribute, part of the SPF portal utilities. So a stereotypical primary
JSP for your global help secondary page could look just like this:</p>

<blockquote><pre>
&lt;%@ taglib prefix="vgn-portal" uri="vgn-tags" %&gt;

&lt;%@ page import="com.hp.it.spf.xa.misc.portal.Consts" %&gt;

&lt;vgn-portal:defineObjects/&gt;

&lt;%= request.getAttribute(Consts.REQUEST_ATTR_GLOBAL_HELP_DATA) %&gt;
</pre></blockquote>

<a name="help.global.messages">
<h4>3.4.6. Creating your page title (<code>WEB-INF/i18n/&lt;your-component-id&gt;.properties</code>)</h4>
</a>

<p>If you are using one of the C-frames provided by the SPF team, or
building on the SPF-provided C-frame components, note that your global
help secondary page is expected to have a <code>title</code> message in
its resource bundle, containing the title to use for the page. As usual
with Vignette component development, the base filename should match your
component ID - by convention, <code><i>&lt;your-site&gt;</i>-global-help-secondarypage.properties</code>
- and you can declare a <code>title_comment</code> message for use in
describing the purpose of the <code>title</code> message in Vignette
console. For example:</p>

<blockquote><pre>
title = Site help
title_comment = Title for the HP Support Center global help page.
</pre></blockquote>

<p>As usual with message resource bundles, your base file can be
localized - just tag each localized file with the locale and include in
your CAR, as shown <a href="#help.global.car">above</a>.</p>

<a name="help.global.deployment">
<h4>3.4.7. Deploying and configuring your CAR file</h4>
</a>

<p>Deploy your global help secondary page to Vignette following the
usual procedure. (You need Vignette server console access to do this -
so in integration and production environments, contact the SPF support
team for assistance.)</p>

<p>Then, to activate your global help secondary page in your portal
site, do the following steps in Vignette console:</p>

<ol>
	<li>
	<p>Share your global help secondary page to your portal site. In
	the Vignette server console, go to <b>Components &gt; Pages &gt;
	Secondary Page List</b>, checkmark your global help secondary page, and <b>Share
	to...</b> your portal site. This step requires server console access;
	contact the SPF support team for assistance if needed. (It should not
	be necessary to share the SPF global help secondary page type to your
	site, just your global help secondary page.)</p>
	</li>
	<li>
	<p>Apply your portal site's grid and theme to the SPF global help
	secondary page type, and configure your global help secondary page to
	be used for that secondary page type. In the Vignette site console for
	your site, go to <b>Site Settings &gt; Appearance &gt; Secondary
	Pages</b> to do this.</p>
	</li>
	<li>
	<p>Done.</p>
	</li>
</ol>

<p>Now, when you invoke the template friendly URL for global help at
your portal site, you should see your global help content (interpolated)
render with your grid, theme and title. (That template friendly URL is <code>template.PUBLIC_SPF_GLOBAL_HELP</code>
- so entering the URL <code>/portal/site/<i>&lt;your-site&gt;</i>/template.PUBLIC_SPF_GLOBAL_HELP</code>
will now invoke your global help.)</p>

<hr>

<a name="help.global.java">
<h3>3.5. Producing links to global help using Java code</h3>
</a>

<p>Making a link to global help is as simple as making a portal URL
for your site containing the template friendly URL for global help, <code>template.PUBLIC_SPF_GLOBAL_HELP</code>.
This friendly URL string is the value of a special class attribute,
{@link
com.hp.it.spf.xa.misc.portal.Consts#PAGE_FRIENDLY_URI_GLOBAL_HELP}. So
it is easy to make a global help hyperlink in Java code in a number of
ways. For example, using {@link
com.hp.it.spf.xa.misc.portal.Utils#getPortalSiteURL(HttpServletRequest,String)}
(where <code>request</code> is your <code>HttpServletRequest</code>):</p>

<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Consts;
import com.hp.it.spf.xa.misc.portal.Utils;
...
String url = Utils.getPortalSiteURL(request, "/" + Consts.PAGE_FRIENDLY_URI_GLOBAL_HELP);
</pre></blockquote>

<p>This returns the fully-qualified, absolute URL for the global
help secondary page on the current portal site, using the same scheme
(HTTP or HTTPS), host and port as was used in the request (for example,
<code>http://my_host.hp.com/portal/site/my_site/template.PUBLIC_SPF_GLOBAL_HELP/</code>).</p>

<p>Beyond just making global help URLs, though, the SPF portal
utilities include a framework for generating links for HPWeb
"classic"-style global help popup windows. These are minimalistic child
windows in which your global help is rendered in the HPWeb "classic"
style - for example, without buttons or information bars, as illustrated
in the section <a href="#help.kinds.global">introducing global help</a>.
The pattern for doing so in SPF is similar to that for <a
	href="#help.contextual.java">contextual help</a>:</p>

<ul>
	<li>
	<p>First, there is a Java class which generates the popup-window
	link for you, {@link
	com.hp.it.spf.xa.help.portal.ClassicGlobalHelpProvider}.</p>
	</li>
	<li>
	<p>Second, if you need to create your own style of global help, you
	can extend the SPF global help framework to do so, by extending the
	{@link com.hp.it.spf.xa.help.portal.GlobalHelpProvider} abstract base
	class.</p>
	</li>
</ul>

<p>More on this below.</p>

<a name="help.global.java.classicGlobalHelpProvider">
<h4>3.5.1. Using <code>ClassicGlobalHelpProvider</code></h4>
</a>

<blockquote>
<p><b>Note:</b> There is an SPF-provided JSP tag library for this -
see the <a href="#help.global.jsp.classicGlobalHelp"><code>&lt;spf-help-portal:classicGlobalHelp&gt;</code></a>
description below for standalone help, and the <a
	href="#help.global.jsp.classicGlobalHelpParam"><code>&lt;spf-i18n-portal:i18nClassicGlobalHelpParam&gt;</code></a>
description below for injected help.</p>
</blockquote>

<p>{@link com.hp.it.spf.xa.help.portal.ClassicGlobalHelpProvider} is
a Java class in the SPF portal utilities which knows how to generate
hyperlinks pointing your portal site's global help secondary page inside
an HPWeb "classic"-style popup window. Usage is as follows:</p>

<ol>
	<li>
	<p>First, you construct the object using the current Vignette <code>PortalContext</code>
	object.</p>
	</li>

	<li>
	<p>Then, you set the attributes for the global help link. The
	following setters are available:</p>

	<dl>
		<dt>{@link
		com.hp.it.spf.xa.help.portal.ClassicGlobalHelpProvider#setLinkContent(String)}</dt>
		<dd>
		<p>Sets the content of the global-help hyperlink. Pass in whatever
		HTML (text and markup) you want to have included inside the hyperlink.
		Use this if you are doing a <i>standalone</i> global help link. If you
		are <i>injecting</i> the global help link into a message, leave it
		unset, since the link content will be injected from the message.</p>
		</dd>
		<dt>{@link
		com.hp.it.spf.xa.help.portal.ClassicGlobalHelpProvider#setWindowFeatures(String)}</dt>
		<dd>
		<p>Sets the JavaScript <code>window.open(...)</code> features to
		impose on the child window. This lets you control the size (height and
		width) of the window, presence or absence of controls (eg buttons) and
		bars (eg address bar, status bar), and all other window
		characteristics and behaviors specifiable in <code>window.open(...)</code>.</p>
		<p>Pass a string listing the desired window features, in exactly
		the syntax that <code>window.open(...)</code> uses. Many resources are
		available on the Internet which document the syntax and semantics of
		the available features - for example, <a
			href="https://developer.mozilla.org/en/window.open">https://developer.mozilla.org/en/window.open</a>.
		By default, if you do not set any window features, the <code>ClassicGlobalHelpProvider</code>
		will assume the following: <code>height=610,width=410,menubar=no,status=no,toolbar=no,resizable=yes</code>.</p>
		</dd>
		<dt>{@link
		com.hp.it.spf.xa.help.portal.ClassicGlobalHelpProvider#setFragment(String)}</dt>
		<dd>
		<p>By default, the popup window will display your global help
		secondary page from the top of the page. If you have defined any
		anchors (ie, document fragment names) inside your global help content,
		though, you can cause the popup window to autoscroll to that fragment
		by using this <code>setFragment(String)</code> method. Just pass the
		anchor (ie fragment) name.</p>
		</dd>
	</dl>
	</li>

	<li>
	<p>Finally, you are ready to generate the global help hyperlink:</p>

	<ul>
		<li>
		<p>If you are doing a <i>standalone</i> global help link, just
		call the {@link
		com.hp.it.spf.xa.help.portal.ClassicGlobalHelpProvider#getHTML(boolean,boolean)}
		method now. This will return the HTML string containing all the HTML
		and JavaScript necessary to generate the link for popup global help.</p>
		<ul>
			<li>
			<p>The first boolean switch, if set <code>true</code>, enables
			HTML-escaping in the link content (ie any HTML meta-characters there
			like <code>&lt;</code> will be converted to their HTML escape
			sequences so as to be displayed literally in the browser).</p>
			</li>
			<li>
			<p>The second boolean switch, when set <code>true</code>,
			suppresses any <code>&lt;SPAN&gt;</code> tags such as Vignette may
			have injected into your message strings, from the link content.</p>
			</li>
		</ul>
		</li>
		<li>
		<p>If you are <i>injecting</i> your global help link into a
		message, though, just pass your <code>GlobalHelpProvider</code> into
		the <a href="#i18n.messages.java.spf.getMessage"><code>I18nUtility.getValue</code></a>
		method. See the <a href="#i18n.messages.java.spf.getMessage">discussion
		above</a> for an example of this. The <code>I18nUtility.getValue</code>
		method will supply the link content from the message itself.</p>
		</li>
	</ul>
	</li>

	<li>
	<p>You can reuse the same <code>ClassicGlobalHelpProvider</code>
	numerous times if you wish. The main JavaScript making the popup window
	will only be included the first time, unless you call the {@link
	com.hp.it.spf.xa.help.portal.ClassicGlobalHelpProvider#resetHTML()}
	method.</p>
	</li>
</ol>

<p>An example of injecting a global help popup link into a message
was shown above, in the description of the <a
	href="#i18n.messages.java.spf.getMessage"><code>I18nUtility.getValue</code></a>
methods. Standalone global help is very similar. For example, say you
just want to wrap the word "Help" inside a global help popup hyperlink.
(You could do this using global help injection, since the linked content
is a text message. But since it is a whole text message, not just a
substring, using the standalone approach works too. The following
example will demonstrate the standalone approach, and you can see the <a
	href="#i18n.messages.java.spf.getMessage"><code>I18nUtility.getValue</code></a>
for a demonstration of the injected approach.)</p>

<p>First, in your portal component's message properties you would
have the "Help" message:</p>

<blockquote><pre>
key=Help
</pre></blockquote>

<p>Then your Java code for generating the HTML markup string for the
"Help" global help popup hyperlink using <code>ClassicGlobalHelpProvider</code>
would look like this (where <code>context</code> is your Vignette <code>PortalContext</code>
object):</p>

<blockquote><pre>
import com.hp.it.spf.xa.help.portal.ClassicGlobalHelpProvider;
import com.hp.it.spf.xa.i18n.portal.I18nUtility;
...
// First get the "Help" message, for the link content.
String helpText = I18nUtility.getValue("key", context);
// Next get the "Help" message wrapped in a classic global-help popup link.
ClassicGlobalHelpProvider cghp = new ClassicGlobalHelpProvider(context);
cghp.setLinkContent(helpText);
String html = cghp.getHTML(false, false);
</pre></blockquote>

<p>So then you would express the <code>html</code> string in your
JSP, to render the "Help" text hyperlinked to your global help secondary
page inside an HPWeb classic-style global help popup. Since the above
code didn't call {@link
com.hp.it.spf.xa.help.portal.ClassicGlobalHelpProvider#setWindowFeatures(String)}
to override the default window features, the child window will have the
default specifications, and look like the example in the section <a
	href="#help.kinds.global">introducing global help</a>.</p>

<p>The above example causes the generated link to open a
default-styled popup displaying your global help secondary page at the
top of the page. Your link content doesn't have to be a message string,
though; any string of HTML wrappable in an hyperlink will do. For
example, imagine that instead of the "Help" message, you wanted this
image <img src="com/hp/it/spf/xa/help/portal/doc-files/warning.gif">
to open the global-help popup when clicked, and auto-scroll to the
fragment (anchor) within your global help content named "warnings".
Assuming the image was packed inside your component as a secondary
support file named <code>warning.gif</code> (note it can be localized
too), then your code would look like this:</p>

<blockquote><pre>
import com.hp.it.spf.xa.help.portal.ClassicGlobalHelpProvider;
import com.hp.it.spf.xa.i18n.portal.I18nUtility;
...
// First get the "warning.gif" image, for the link content.
String imgURL = I18nUtility.getLocalizedFileURL(context, "warning.gif");
String imgTag = "&lt;IMG SRC='" + imgURL + "'&gt;";
// Next get the "warning.gif" wrapped in a classic global-help popup link.
// Do this so the global help auto-scrolls to the "warnings" section.
ClassicGlobalHelpProvider cghp = new ClassicGlobalHelpProvier(context);
cghp.setLinkContent(imgTag);
cghp.setFragment("warnings");
String html = cghp.getHTML(false, false);
</pre></blockquote>

<p>See the {@link
com.hp.it.spf.xa.help.portal.ClassicGlobalHelpProvider} class
documentation, and the <a
	href="com/hp/it/spf/xa/help/portal/package-summary.html">package
description</a>, for more information.</p>

<a name="help.global.java.GlobalHelpProvider">
<h4>3.5.2. Extending <code>GlobalHelpProvider</code> to create a
custom rendition</h4>
</a>

<p>If you need to create a custom version of a global help
hyperlink, you should extend the {@link
com.hp.it.spf.xa.help.portal.GlobalHelpProvider} abstract base class.
This class is a foundation for generating global help hyperlinks of
various kinds; for example, the {@link
com.hp.it.spf.xa.help.portal.ClassicGlobalHelpProvider} discussed above
is based on it.</p>

<p>When you extend <code>GlobalHelpProvider</code>, you inherit the
method for setting the link content, {@link
com.hp.it.spf.xa.help.portal.GlobalHelpProvider#setLinkContent(String)}.
You just need to implement the {@link
com.hp.it.spf.xa.help.portal.GlobalHelpProvider#getHTML(boolean,boolean)}
method, to generate and return the link HTML based on the link content
that was set (available to you in the {@link
com.hp.it.spf.xa.help.portal.GlobalHelpProvider#linkContent} protected
string attribute). You also generate any other methods needed for your
rendition of global help - eg setters for other attributes of the link.</p>

<p>The <code>getHTML</code> <code>boolean</code> parameters tell you
whether to invoke HTML-escaping and filtering of Vignette-generated <code>&lt;SPAN&gt;</code>
tags, respectively, on the link content (and any other content included
in the return from <code>getHTML</code>).</p>

<ul>
	<li>
	<p>When the first boolean is true, that tells you that your <code>getHTML</code>
	method should call something like {@link
	com.hp.it.spf.xa.misc.portal.Utils#escapeXml(String)} to escape the
	content.</p>
	</li>
	<li>
	<p>When the second boolean is true, that tells you that your <code>getHTML</code>
	method should call {@link
	com.hp.it.spf.xa.i18n.portal.I18nUtility#filterSpan(String)} to
	filter-out the <code>&lt;SPAN&gt;</code> tags Vignette may have
	generated.</p>
	</li>
</ul>

<p>Please read the <code>GlobalHelpProvider</code> documentation for
more information.</p>

<hr>

<a name="help.global.jsp">
<h3>3.6. Producing links to global help using JSP tag libraries</h3>
</a>

<p>Making a URL pointing to the global help secondary page in your
JSP is fairly easy. Just use {@link
com.hp.it.spf.xa.misc.portal.Utils#getPortalSiteURL(HttpServletRequest,String)}
and {@link
com.hp.it.spf.xa.misc.portal.Consts#PAGE_FRIENDLY_URI_GLOBAL_HELP}
inside a Java section (ie inside <code>&lt;% ... %&gt;</code>) - an
example of that code is covered at the beginning of the section about <a
	href="#help.global.java">Java APIs for global help links</a>
(previously in this document).</p>

<blockquote>
<p><b>Note:</b> Unfortunately there is no JSP tag for this.</p>
</blockquote>

<p>Beyond just making global help URLs, though, the SPF portal
utilities include a framework for generating links to HPWeb
"classic"-style global help popup windows. These are minimalistic child
windows in which your global help secondary page is rendered in the
HPWeb "classic" style - for example, without buttons or information
bars, as illustrated in the section <a href="#help.kinds.global">introducing
global help</a>. The pattern for this is similar to that for <a
	href="#help.contextual.jsp">contextual help</a>:</p>

<ul>
	<li>
	<p>First, there is a JSP tag which generates the HPWeb "classic"
	global help popup link around some standalone content: <a
		href="#help.global.jsp.classicGlobalHelp"><code>&lt;spf-help-portal:classicGlobalHelp&gt;</code></a>.</p>
	</li>
	<li>
	<p>Second, there is another JSP tag which does the same, but
	injects the link into a message: <a
		href="#help.global.jsp.classicGlobalHelpParam"><code>&lt;spf-i18n-portal:classicGlobalHelpParam&gt;</code></a>.</p>
	</li>
	<li>
	<p>Finally, if you need to create your own style of global help
	link, you can <a href="#help.global.jsp.globalHelpProvider">create
	a custom tag library</a> by extending the SPF framework.</p>
	</li>
</ul>

<p>More on each of these below.</p>

<a name="help.global.jsp.classicGlobalHelp">
<h4>3.6.1. Using <code>&lt;spf-help-portal:classicGlobalHelp&gt;</code>
for standalone classic global help links</h4>
</a>

<p>You use this tag to express a standalone HPWeb "classic"-style
global help popup hyperlink. It wraps around the <a
	href="#help.global.java.classicGlobalHelpProvider"><code>ClassicGlobalHelpProvider</code></a>
to provide the same capabilities for standalone global help. The usage
is:</p>

<blockquote><pre>
&lt;%@ taglib prefix=&quot;spf-help-portal&quot; uri=&quot;/spf-help-portal.tld&quot; %&gt;
...
&lt;spf-help-portal:classicGlobalHelp
  anchor=&quot;&lt;link-text&gt;&quot;
  anchorKey=&quot;&lt;link-message-key&gt;&quot;
  anchorImg=&quot;&lt;link-image-URL&gt;&quot;
  anchorImgKey=&quot;&lt;link-image-message-key&gt;&quot;
  anchorImgAlt=&quot;&lt;link-image-alt-text&gt;&quot;
  anchorImgAltKey=&quot;&lt;link-image-alt-message-key&gt;&quot;
  escape=&quot;&lt;true-or-false&gt;&quot;
  filterSpan=&quot;&lt;true-or-false&gt;&quot;
  fragment=&quot;&lt;fragment-name&gt;&quot;
  windowFeatures=&quot;&lt;popup-window-features&gt;&quot;
/&gt;
</pre></blockquote>

<p>You must provide one of the first four attributes (<code>anchor</code>,
<code>anchorKey</code>, <code>anchorImg</code>, <code>anchorImgKey</code>)
- these provide the link content. The other tag attributes are optional.</p>

<ul>
	<li>
	<p>With <code>anchor</code> you provide the exact link content - a
	string of text, HTML, and whatever else.</p>
	</li>
	<li>
	<p>With <code>anchorKey</code> you provide the keyname of a message
	in your portal component's message resource bundle, and the tag looks
	up the whole link content from there. As usual with message resource
	lookup, the best-fit localized version for the user's current locale
	found in your bundle is used (this proceeds like <a
		href="#i18n.messages.java.spf.getMessage"><code>I18nUtility.getValue</code></a>
	described earlier in this document).</p>
	</li>
	<li>
	<p>With <code>anchorImg</code> you provide the URL of an image, and
	the <code>&lt;spf-help-portal:classicGlobalHelp&gt;</code> tag builds
	an HTML <code>&lt;IMG&gt;</code> tag for that and uses it as the link
	content.</p>
	</li>
	<li>
	<p>With <code>anchorImgKey</code> you provide the basename of a
	supporting resource file (ie <i>secondary support file</i>) in your
	portal component. The <code>&lt;spf-help-portal:classicGlobalHelp&gt;</code>
	tag looks-up the best-fit localized version of that file for the user's
	current locale, and makes a URL for it (this proceeds like <a
		href="#i18n.supporting.java.getLocalizedFileURL"><code>I18nUtility.getLocalizedFileURL</code></a>
	described earlier in this document) - then builds an HTML <code>&lt;IMG&gt;</code>
	tag for that and uses it as the link content.</p>
	<blockquote>
	<p>With either of the above image-related attributes, you can also
	specify HTML <code>ALT</code> text for the HTML <code>&lt;IMG&gt;</code>
	tag using either <code>anchorImgAlt</code> for the exact text, or <code>anchorImgAltKey</code>
	for the keyname of a message property in your component's resource
	bundle.</p>
	</blockquote>
	</li>
</ul>

<p>For example, say you need to link a message ("Help") to the top
of the global help secondary page (presented in an HPWeb "classic"-style
popup window with all the default window features). The message would be
in your component's message resource bundle like this:</p>

<blockquote><pre>
key=Help
</pre></blockquote>

<p>Then your JSP would look like this:</p>

<blockquote><pre>
&lt;%@ taglib prefix="spf-help-portal" uri="/spf-help-portal.tld" %&gt;
...
&lt;spf-help-portal:classicGlobalHelp anchorKey="key" /&gt;
</pre></blockquote>

<p>This would render the word "Help" as a hyperlink like this:</p>

<blockquote><u><font color="blue"> Help </font></u></blockquote>

<p>And when clicked, the link would open a child window pointing to
the top of your portal site's <a href="#help.global">global help
secondary page</a>, with the default size and window features for an HPWeb
"classic"-style popup. (See the illustration in the <a
	href="#help.kinds.global">introducing global help</a> section.)</p>

<p>As another example, consider anchoring this image <img
	src="com/hp/it/spf/xa/help/portal/doc-files/warning.gif"> to the
"warning" section in global help, inside an HPWeb "classic"-style popup
window. Assume the "warning" section is marked in your <a
	href="#help.global.content">global help content</a> with an <code>&lt;a
name="warning"&gt;</code> tag as usual.</p>

<p>To do this, first put the image file into your portal component
CAR, as a secondary support file. (The image may be localized - just
following the packaging and locale-tagging guidelines discussed <a
	href="#i18n.location">earlier</a>. In this example, we will use <code>warning.gif</code>
as the basename for this image file.) Also put some <code>ALT</code>
text for the image into your component's message resources, like this:</p>

<blockquote><pre>
warning.alt=Caution
</pre></blockquote>

<p>Then your JSP would look like this:</p>

<blockquote><pre>
&lt;%@ taglib prefix="spf-help-portal" uri="/spf-help-portal.tld" %&gt;
...
&lt;spf-help-portal:classicGlobalHelp
   anchorImgKey="warning.gif"
   anchorImgAltKey="warning.alt"
   fragment="warning"
   /&gt;
</pre></blockquote>

<p>This example would render the (properly-localized version of the)
<code>warning.gif</code> image <img
	src="com/hp/it/spf/xa/help/portal/doc-files/warning.gif"> with <code>ALT</code>
text saying "Caution" when moused-over. And when clicked, it would open
the global help popup window and auto-scroll to the <code>warning</code>
section.</p>

<p>See the <code>&lt;spf-help-portal:classicGlobalHelp&gt;</code>
tag documentation in the <a
	href="com/hp/it/spf/xa/help/portal/tag/package-summary.html#classicGlobalHelp">package
description</a> for more information about this JSP tag.</p>

<a name="help.global.jsp.classicGlobalHelpParam">
<h4>3.6.2. Using <code>&lt;spf-i18n-portal:i18nClassicGlobalHelpParam&gt;</code>
for injected classic global help links</h4>
</a>

<p>This tag is only used inside the tag body of <a
	href="#i18n.messages.jsp.spf.message"><code>&lt;spf-i18n-portal:i18nValue&gt;</code></a>.
It wraps-around the <a
	href="#help.global.java.classicGlobalHelpProvider"><code>ClassicGlobalHelpProvider</code></a>
to provide the same capabilities for injected help. You use it to inject
hyperlinks pointing to your <a href="#help.global">global help
secondary page</a> into the message value, where the special <code>&lt;global_help&gt;...&lt;/global_help&gt;</code>
markup is found. The hyperlink which is injected points to global help
using an HPWeb "classic"-style child (popup) window. The usage is:</p>

<blockquote><pre>
&lt;%@ taglib prefix=&quot;spf-i18n-portal&quot; uri=&quot;/spf-i18n-portal.tld&quot; %&gt;
...
&lt;spf-i18n-portal:classicGlobalHelpParam
  fragment=&quot;&lt;fragment-name&gt;&quot;
  windowFeatures=&quot;&lt;popup-window-features&gt;&quot;
/&gt;
</pre></blockquote>

<p>The tag attributes are optional and can be used to indicate a
section (ie named fragment) of the global help content to which the
popup window should auto-scroll, or provide an overriding set of
JavaScript <code>window.open(...)</code> features specifying the size
and attributes of the popup window.</p>

<p>For example, if your portal component's message properties
contain this:</p>

<blockquote><pre>
key=Read &lt;global_help&gt;help&lt;/global_help&gt; about using HP Passport.
</pre></blockquote>

<p>Then in your JSP you could inject a hyperlink to global help into
that message when rendering it, pointing to the HP Passport section of
your global help content. (In this example, assuming that the section
was marked in your <a href="#help.global.content">global help
content</a> with <code>&lt;a name="hpp_info"&gt;</code>. Assume also that we
want a 974 x 410 pixel window, with a scrollbar but no other controls.)
Your JSP would look like this:</p>

<blockquote><pre>
&lt;%@ taglib prefix="spf-i18n-portal" uri="/spf-i18n-portal.tld" %&gt;
...
&lt;spf-i18n-portal:i18nValue key="key"&gt;
	&lt;spf-i18n-portal:i18nClassicGlobalHelpParam
	    fragment="hpp_info"
	    windowFeatures="height=410,width=974,scrollbars=yes,menubar=no,status=no,toolbar=no" /&gt;
&lt;/spf-i18n-portal:i18nValue&gt;
</pre></blockquote>

<p>This JSP would generate a message in the user's browser looking
like this:</p>

<blockquote>Read <u><font color="blue">help</font></u>
about using HP Passport.</blockquote>

<p>And when the user clicked the "help" link, a popup window would
reveal the HP Passport section of your global help content, like this:</p>

<img src="com/hp/it/spf/xa/help/portal/doc-files/globalHelp.jpg">

<p>See the <code>&lt;spf-i18n-portal:classicGlobalHelpParam&gt;</code>
tag documentation in the <a
	href="com/hp/it/spf/xa/i18n/portal/tag/package-summary.html#classicGlobalHelpParam">package
description</a> for more information about this JSP tag.</p>

<a name="help.global.jsp.globalHelpProvider">
<h4>3.6.3. Creating a tag library for a custom rendition</h4>
</a> p>If you need to create a custom version of a global help link, you can
create a tag class to reference it. First, develop your custom global
help provider as described above, by <a
	href="#help.contextual.java.globalHelpProvider">extending <code>GlobalHelpProvider</code></a>.
</p>

<p>Then create a tag class to go with it. SPF provides some base tag
classes you can upon:</p>

<ul>
	<li>For a tag for standalone global help, extend {@link
	com.hp.it.spf.xa.help.portal.tag.GlobalHelpBaseTag}.</li>
	<li>For a tag for injecting global help into a message body,
	extend {@link com.hp.it.spf.xa.i18n.portal.tag.GlobalHelpParamBaseTag}.</li>
</ul>

<p>Basically, in each case you need to implement the abstract <code>getGlobalHelpProvider</code>
method, and potentially override or create any other methods to impose
your desired functionality. You also need to create your TLD file.</p>

<p>Please read the class and method documentation for each class, in
order to familiarize yourself with their provided and abstract
functionality. You may also want to look at the source for SPF's own
{@link com.hp.it.spf.xa.help.portal.tag.ClassicGlobalHelpTag} and {@link
com.hp.it.spf.xa.i18n.portal.tag.ClassicGlobalHelpParamTag} to see how
it is done. The SPF development team can direct you to the source code.</p>

<hr>

<a name="file">
<h2>4. Text Interpolation</h2>
</a>

<p>The SPF portal utilities' text interpolation capabilities are
discussed in this chapter.</p>

<hr>

<a name="file.about">
<h3>4.1. About text interpolation</h3>
</a>

<blockquote>
<p><i><b>interpolate</b> (verb) - <b>1 a:</b> to alter ... (as a
text) by inserting new or foreign matter; <b>1 b:</b> to insert (words)
into a text... (ref: <a
	href="http://www.merriam-webster.com/dictionary/interpolate">http://www.merriam-webster.com/dictionary/interpolate</a>)</i>
</p>
</blockquote>

<p>The SPF portal utilities include an engine for interpolating
text: parsing text strings for <i>special markup tokens</i> and
dynamically substituting, inserting, or deleting content accordingly.
The token language supports the following basic capabilities:</p>

<ul>
	<li><a href="#file.author.token.url">inserting dynamic URL's</a>
	for portal/portlet artifacts, such as the portal site home page URL,
	and URLs for <a href="#i18n.resources.supporting">supporting
	resources</a> (ie <i>secondary support files</i>) like localized images
	<li><a href="#file.author.token.user">inserting user
	information</a>, such as name, email, language, or any other user property</li>
	<li><a href="#file.author.token.auth">permissioning content</a> so
	it is included only for authorized users (based on groups,
	request-property or logged-in status)</li>
	<li><a href="#file.author.token.consolidate">consolidating
	content</a> for ease of management (eg offloading common content into a
	separate properties file)</li>
	<li><a href="#file.author.token.misc">miscellaneous</a></li>
</ul>

<p>The SPF portal utilities give you Java and JSP interfaces for
accessing this engine. You can access with raw strings, or you can
access and interpolate whole files (where those files too can be
localized and managed as external or internal supporting resources /
bundles).</p>

<blockquote>
<p><b>Note:</b> If you implement a <a href="#help.global">global
help secondary page</a>, you can use the text interpolation engine in SPF to
interpolate your global help content. This is discussed in the section
about global help, earlier in this document.</p>
</blockquote>

<hr>

<a name="file.display.java">
<h3>4.2. Interpolating text using Java code</h3>
</a>

<p>The SPF portal utilities include a Java class for interpolating
text already loaded into a string (<a
	href="#file.display.java.tokenParser"><code>TokenParser</code></a>). Or
you can use <a href="#file.display.java.fileInterpolator"><code>FileInterpolator</code></a>
to load your text first from a (possibly localized file).</p>

<a name="file.display.java.fileInterpolator">
<h4>4.2.1. Using <code>FileInterpolator</code> to interpolate text
from files</h4>
</a>

<blockquote>
<p><b>Note:</b> There is an SPF-provided JSP tag library for this -
see <a href="#file.display.jsp.interpolate"><code>&lt;spf-file-portal:interpolate&gt;</code></a>
below.</p>
</blockquote>

<p>The portal {@link
com.hp.it.spf.xa.interpolate.portal.FileInterpolator} is a plain Java
object which implements text interpolation for files. For example, the
global help secondary page uses the <code>FileInterpolator</code> to
read and interpolate the help content resource bundle (see the <a
	href="#help.global">global help</a> discussion previously in this
document). (Note: The <code>FileInterpolator</code> in turn calls the <a
	href="#file.display.java.tokenParser"><code>TokenParser</code></a>,
which interpolates text in strings, after it has read the file.)</p>

<p>To use the <code>FileInterpolator</code>, first you construct it,
then you call its <code>interpolate</code> method. Here are the relevant
methods:</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.interpolate.portal.FileInterpolator#FileInterpolator(PortalContext,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.interpolate.portal.FileInterpolator#FileInterpolator(PortalContext,String,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.interpolate.portal.FileInterpolator#FileInterpolator(PortalContext,Locale,String,String)}</dt>
	<dd>
	<p>Use one of these constructors to instantiate the class. The
	arguments are:</p>

	<ul>
		<li>
		<p>Your current Vignette <code>PortalContext</code> object.</p>
		</li>
		<li>
		<p>The {@link java.util.Locale} you want to use during the file
		interpolation (ie to find the proper localized file, as well as to
		perform locale-dependent token substitutions within it). By default
		(ie if you do not specify this, or leave it null) the locale inside
		the Vignette <code>PortalContext</code> is assumed (this is the locale
		determined by the <a href="#i18n.other.locale.resolver">locale
		resolver</a> for the current portal request).</p>
		</li>
		<li>
		<p>A string giving the base filename for the text file to
		interpolate. This is a base name for a bundle of one or more
		supporting resource files, potentially localized, as described in the
		<a href="#i18n.resources.bundles">resource bundle</a> discussion in
		this document. These files are stored as <i>secondary support
		files</i> in your current portal component, as also described <a
			href="#i18n.location">earlier</a> in this document. Note the files <b>must</b>
		be UTF-8 encoded, and may contain any of the special markup tokens
		supported by <code>TokenParser</code> - see the discussion on <a
			href="#file.author">authoring text</a> below.</p>
		</li>
		<li>
		<p>An optional string for a <i>token substitutions</i> property
		file. As discussed in the section about <a
			href="#file.author.token.consolidate">authoring text</a>, one of the
		special markup tokens (<code>{INCLUDE:<i>key</i>}</code>) substitutes
		values from this property file. By default, the name of the property
		file is considered to be <code>default_includes.properties</code>, but
		you can override that with this parameter. If you will not be using
		the special <code>{INCLUDE:<i>key</i>}</code> or will use the default
		filename, you can ignore this parameter.</p>
		<p>If you do use this parameter, you should pass the basename of a
		secondary support file in the current portal component which contains
		the substitution key/value pairs. Note this file may be localized; as
		with the text filename parameter above, the method selects the
		best-fit localized version of the file for the given locale.</p>
		</li>
	</ul>
	</dd>

	<dt>{@link
	com.hp.it.spf.xa.interpolate.portal.FileInterpolator#interpolate()}</dt>
	<dd>
	<p>You use this method to open the file and get its interpolated
	content. If you did not provide the {@link java.util.Locale}, then the
	one inside the current portal request (ie the Vignette <code>PortalContext</code>
	object given to the constructor) is assumed.</p>

	<ol>
		<li>
		<p>First, the method finds the best-fit localized file for the
		base filename that was provided to the constructor. This proceeds as
		discussed for the <a
			href="#i18n.supporting.java.getLocalizedFileStream"><code>I18nUtility.getLocalizedFileStream</code></a>
		methods above.</p>
		</li>
		<li>
		<p>Then, the method parses the file content (using the <a
			href="#file.display.java.tokenParser"><code>TokenParser</code></a>)
		and performs all of the special markup processing described in the
		section about <a href="#file.author">authoring text</a>. If the file
		could not be found or read, or was empty, then null is returned (and a
		warning is logged).</p>
		</li>
	</ol>
	</dd>
</dl>

<p>For example, consider a secondary support file in our portal
component, here named <code>text.html</code>, with the following content
and special markup tokens:</p>

<blockquote><pre>
&lt;h1&gt;This is the base version&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;Your language:  {LANGUAGE-TAG}&lt;/li&gt;
  &lt;li&gt;The HP.com URL: {INCLUDE:url.hp}&lt;/li&gt;
{LOGGED-IN}
  &lt;li&gt;Your name:      {NAME}&lt;/li&gt;
{/LOGGED-IN}
&lt;/ul&gt;
</pre></blockquote>

<p>Along with <code>text.html</code>, consider a companion secondary
support file named <code>text_ja_JP.html</code> which is similar, except
it has been localized into Japanese for Japan (represented here in
English for readability):</p>

<blockquote><pre>
&lt;h1&gt;This is the Japanese version&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;Your language:  {LANGUAGE-TAG}&lt;/li&gt;
  &lt;li&gt;The HP.com URL: {INCLUDE:url.hp}&lt;/li&gt;
{LOGGED-IN}
  &lt;li&gt;Your name:      {NAME}&lt;/li&gt;
{/LOGGED-IN}
&lt;/ul&gt;
</pre></blockquote>

<p>Finally, consider that we have put the HP.com homepage URL into
another secondary support file, here named <code>my_includes.properties</code>,
as follows:</p>

<blockquote><pre>
url.hp = http://www.hp.com
</pre></blockquote>

<p>To interpolate this bundle in our portal component Java code, for
the current user in his/her current locale, using the portal <code>FileInterpolator</code>,
we use the following code (where <code>context</code> is our Vignette <code>PortalContext</code>
object):</p>

<blockquote><pre>
import com.hp.it.spf.xa.interpolate.portal.FileInterpolator;
...
FileInterpolator file = new FileInterpolator(context, 
    "html/text.html",
    "my_tokens.properties");
String content = file.interpolate();
</pre></blockquote>

<p>For a logged-in Japanese (Japan) user (first name <code>Bob</code>,
last name <code>Smith</code>), the returned <code>content</code> string
is:</p>

<blockquote><pre>
&lt;h1&gt;This is the Japanese version&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;Your language:  ja-JP&lt;/li&gt;
  &lt;li&gt;The HP.com URL: http://www.hp.com&lt;/li&gt;

  &lt;li&gt;Your name:      Smith Bob&lt;/li&gt;

&lt;/ul&gt;
</pre></blockquote>

<p>(The name is displayed with the last name first, since that is
conventional for Japan. See {@link
com.hp.it.spf.xa.i18n.I18nUtility#getUserDisplayName(String,String,Locale)}.)</p>

<p>For a logged-out German (Germany) user, though, the returned <code>content</code>
string is:</p>

<blockquote><pre>
&lt;h1&gt;This is the base version&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;Your language:  de-DE&lt;/li&gt;
  &lt;li&gt;The HP.com URL: http://www.hp.com&lt;/li&gt;

&lt;/ul&gt;
</pre></blockquote>

<p>Please see the class documentation for more information.</p>

<blockquote>
<p><b>Note:</b> These examples demonstrated only some of the special
markup tokens. For a good overview of all of them, see the discussion
below about <a href="#file.author">authoring text</a>.</p>
</blockquote>

<a name="file.display.java.tokenParser">
<h4>4.2.2. Using <code>TokenParser</code> to interpolate strings</h4>
</a>

<p>The portal {@link
com.hp.it.spf.xa.interpolate.portal.TokenParser} is the engine at the
heart of text interpolation in the SPF portal utilities. The
file-interpolation class and JSP tag perform text interpolation via this
<code>TokenParser</code> class.</p>

<p>With <code>TokenParser</code> you can perform text interpolation
against Java strings which you have already populated with content,
including any of the special markup tokens described in the <a
	href="#file.author">authoring discussion</a> below. First, you
construct your <code>TokenParser</code>, then you use any of its <code>parse</code>
methods to perform the desired interpolations.</p>

<p>Here are the relevant methods:</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.interpolate.portal.TokenParser#TokenParser(PortalContext)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.interpolate.portal.TokenParser#TokenParser(PortalContext,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.interpolate.portal.TokenParser#TokenParser(PortalContext,Locale,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.interpolate.portal.TokenParser#TokenParser(PortalContext,ResourceBundle)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.interpolate.portal.TokenParser#TokenParser(PortalContext,Locale,ResourceBundle)}</dt>
	<dd>
	<p>Use one of these constructors to instantiate the class. The
	arguments are:</p>

	<ul>
		<li>
		<p>Your current Vignette <code>PortalContext</code> object.</p>
		</li>
		<li>
		<p>The {@link java.util.Locale} you want to use during the string
		interpolation (ie when performing locale-dependent token substitutions
		within it). By default (ie if you do not specify this, or leave it
		null) the locale inside the portlet request is assumed.</p>
		</li>
		<li>
		<p>An optional parameter indicating any include properties to
		apply during parsing. As discussed in the section about <a
			href="#file.author.token.consolidate">authoring text</a>, one of the
		special markup tokens (<code>{INCLUDE:<i>key</i>}</code>) substitutes
		values from a set of substitution properties. By default, these
		properties are assumed to be stored in a secondary support file in
		your component, named <code>default_includes.properties</code>. But
		you can override that via one of the optional parameters:</p>
		<ul>
			<li>
			<p>A {@link java.lang.String} parameter giving the name of a
			different property file. You pass the basename of a secondary support
			file in your component containing the substitution properties. Note
			this file may be localized; the <code>TokenParser</code> chooses the
			best-fit localized version of the file for the given locale, using
			the standard Java search sequence for a <code>ResourceBundle</code>.
			Your bundle of localized include-files must be tagged by locale and
			stored as secondary support files in your component, as described <a
				href="#i18n.location">previously</a>.</p>
			</li>
			<li>
			<p>Or a {@link java.util.ResourceBundle} parameter passing the
			substitution properties directly.</p>
			</li>
		</ul>
		</li>
	</ul>
	</dd>

	<dt>{@link
	com.hp.it.spf.xa.interpolate.portal.TokenParser#parse(String)}</dt>
	<dd>
	<p>You use this method to interpolate any string you provide. The
	parameters you gave the constructor will be used as the data sources
	for the inserted material. The <code>TokenParser.parse(String)</code>
	method performs all of the special markup processing described in the
	section about <a href="#file.author">authoring text</a>.</p>

	<p>Besides the <code>TokenParser.parse(String)</code> method, each
	individual token has its own parser method. For example, {@link
	com.hp.it.spf.xa.interpolate.portal.TokenParser#parseEmail(String)} to
	just parse the given string for the <code>{EMAIL}</code> token. See the
	class documentation for a list of all the available methods. Generally
	you will want to use the full <code>TokenParser.parse(String)</code>
	method instead.</p>
	</dd>
</dl>

<p>For example, consider a string with the following content and
special markup tokens:</p>

<blockquote><pre>
&lt;ul&gt;
  &lt;li&gt;Your language:  {LANGUAGE-TAG}&lt;/li&gt;
  &lt;li&gt;The HP.com URL: {INCLUDE:url.hp}&lt;/li&gt;
{LOGGED-IN}
  &lt;li&gt;Your phone:     {USER-PROPERTY:PhoneNumber}&lt;/li&gt;
{/LOGGED-IN}
&lt;/ul&gt;
</pre></blockquote>

<p>(<code>PhoneNumber</code> is the defined user property key for
the phone number. See the authoring text discussion below, for how to
learn the names of the available user properties.)</p>

<p>Also consider that we have put the HP.com homepage URL into a
token substitutions file named <code>my_tokens.properties</code>, as
follows, and stored that file as a secondary support file in our portal
component:</p>

<blockquote><pre>
url.hp=http://www.hp.com
</pre></blockquote>

<p>To interpolate this string in our portal component, for the
current user in his/her current locale, using the portal <code>TokenParser</code>,
we use the following code (where <code>context</code> is our Vignette <code>PortalContext</code>
object, and <code>raw</code> is the above string of text):</p>

<blockquote><pre>
import com.hp.it.spf.xa.interpolate.portal.TokenParser;
...
TokenParser parser = new TokenParser(context, "my_tokens.properties");
String interpolated = parser.parse(raw);
</pre></blockquote>

<p>For a logged-in French (Canada) user (with phone number <code>12345</code>),
the <code>interpolated</code> string is:</p>

<blockquote><pre>
&lt;ul&gt;
  &lt;li&gt;Your language:  fr-CA&lt;/li&gt;
  &lt;li&gt;The HP.com URL: http://www.hp.com&lt;/li&gt;

  &lt;li&gt;Your phone:     12345&lt;/li&gt;

&lt;/ul&gt;
</pre></blockquote>

<p>For a logged-out Italian (generic) user, the <code>interpolated</code>
string is:</p>

<blockquote><pre>
&lt;ul&gt;
  &lt;li&gt;Your language:  it&lt;/li&gt;
  &lt;li&gt;The HP.com URL: http://www.hp.com&lt;/li&gt;

&lt;/ul&gt;
</pre></blockquote>

<p>Please see the class documentation for more information.</p>

<blockquote>
<p><b>Note:</b> These examples demonstrated only some of the special
markup tokens. For a good overview of all of them, see the discussion
below about <a href="#file.author">authoring text</a>.</p>
</blockquote>

<hr>

<a name="file.display.jsp">
<h3>4.3. Interpolating text using JSP tag libraries</h3>
</a>

<p>The SPF portal utilities include a JSP tag which wraps-around the
<a href="#file.display.java.fileInterpolator"><code>FileInterpolator</code></a>
for you: <code>&lt;spf-file-portal:interpolate&gt;</code>.</p>

<a name="file.display.jsp.interpolate">
<h4>4.3.1. Using <code>&lt;spf-file-portal:interpolate&gt;</code></h4>
</a>

<p>The SPF portal utilities provide a JSP tag, <code>&lt;spf-file-portal:interpolate&gt;</code>,
which wraps around <a href="#file.display.java.fileInterpolator"><code>FileInterpolator</code></a>
to offer most of the same capabilities. The tag is thoroughly documented
in the <a
	href="com/hp/it/spf/xa/interpolate/portal/tag/package-summary.html#interpolate">package
description</a>. Briefly:</p>

<dl>
	<dt>
	<p><a
		href="com/hp/it/spf/xa/interpolate/portal/tag/package-summary.html#interpolate"><code>&lt;spf-file-portal:interpolate&gt;</code></a></p>
	</dt>

	<dd>
	<p>This tag takes two base filenames of secondary support files (or
	bundles of localized secondary support files, where the system will
	pick the best-fit for the user's current locale). The first filename is
	required and contains the content to interpolate and render. The second
	filename is for an optional <i>token substitutions</i> file. The tag
	reads the content, interpolates it, and expresses it in-place in your
	JSP. The usage is:</p>

	<blockquote><pre>
&lt;%@ taglib prefix="spf-file-portal" uri="/spf-file-portal.tld" %&gt;
...
&lt;spf-file-portal:interpolate
	file="<i>base-file</i>"
	includeFile="<i>token-substitutions-file</i>"
	/&gt;
</pre></blockquote>

	<p>The <code>file</code> attribute lets you provide the base
	filename for the file to interpolate and display (same as the {@link
	com.hp.it.spf.xa.interpolate.portal.FileInterpolator} constructors).</p>

	<p>The <code>includeFile</code> attribute lets you provide an
	override for the default token substitutions filename, same as the
	{@link
	com.hp.it.spf.xa.interpolate.portal.FileInterpolator#FileInterpolator(PortalContext,String,String)}
	constructor. This is used for any special <code>{INCLUDE:<i>key</i>}</code>
	tokens that might be found in the file content. (See the discussion on
	<a href="#file.author">authoring content</a> below, for a description
	of this and other dynamic tokens which the <code>FileInterpolator</code>
	supports.)</p>

	<p>For example, consider the sample scenario first described above,
	in the discussion around <a href="#file.display.java.fileInterpolator"><code>FileInterpolator</code></a>.
	Here is how we would express the interpolated content for that same
	file in JSP, using this tag:</p>

	<blockquote><pre>
&lt;%@ taglib prefix="spf-file-portal" uri="/spf-file-portal.tld" %&gt;
...
&lt;spf-file-portal:interpolate file="text.html" includeFile="my_tokens.properties" /&gt;
</pre></blockquote>

	<p>The selection of the proper localized file, and the subsequent
	interpolation, are performed using the attributes of the current
	request (its locale, user attributes, etc). See the tag documentation,
	in the <a
		href="com/hp/it/spf/xa/interpolate/portal/tag/package-summary.html#interpolate">package
	description</a>, for more information.</p>
	</dd>
</dl>

<hr>

<a name="file.author">
<h3>4.4. Authoring text using interpolation tokens</h3>
</a>

<p>The text interpolation tokens supported by the SPF portal
utilities are described briefly here. Each token is delimited by braces
<code>{...}</code> (although you can use angle-brackets instead of
braces, if you prefer <code>&lt;...&gt;</code>). Detailed information on
each token is provided in the class documentation for the {@link
com.hp.it.spf.xa.interpolate.portal.FileInterpolator}.</p>

<blockquote>
<p><b>Important:</b> File interpolation only supports UTF-8 encoded
file content. If you are authoring your text in a file, be sure to use
UTF-8 encoding.</p>
</blockquote>

<blockquote>
<p><b>Note:</b> Many of the interpolation tokens take parameters.
You can use any of the tokens inside the parameters; they will be
interpolated before the parameter is used. Similarly, many of the tokens
get substituted with replacement values. Any tokens inside the inserted
values will also get interpolated. Finally, many of the tokens are
"container" tokens, which you use to surround content with to
conditionally include or exclude it. That surrounded content can contain
any of the tokens, including nested occurrences of the same token; they
will get interpolated too.
</blockquote>

<a name="file.author.token.url">
<h4>4.4.1. Referencing URLs (<code>{CONTENT-URL:<i>path</i>}</code>,
<code>{LOCALIZED-CONTENT-URL:<i>path</i>}</code>, <code>{REQUEST-URL}</code>,
<code>{REQUEST-URL:<i>spec</i>}</code>, <code>{SITE-URL}</code>, <code>{SITE-URL:<i>spec</i>}</code>)</h4>
</a>

<p>The following tokens can be used to interpolate URL's into your
text. Please click on the links for more documentation for each token.</p>

<dl>
	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#content-url"><code>{CONTENT-URL:<i>filename</i>}</code></a></dt>
	<dd>
	<p>Use this token to insert a URL for an <b>unlocalized</b> <a
		href="#i18n.resources.supporting">supporting resource file</a> into
	the interpolated content. As a supporting resource file, this file must
	be stored as a <i>secondary support file</i> in the same portal
	component as where you are interpolating the <code>{CONTENT-URL:<i>filename</i>}</code>
	token. The result of using this token is a well-formed Vignette portal
	URL referencing that secondary support file.</p>

	<p>The <code><i>filename</i></code> in the token should give the
	name of the secondary support file. Here is some example HTML markup
	which illustrates using this token to help build an HTML &lt;IMG&gt;
	tag for an image (<code>picture.jpg</code>) in the same portal
	component:</p>

	<blockquote><pre>
&lt;IMG SRC="{CONTENT-URL:picture.jpg}"&gt;
</pre></blockquote>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#localized-content-url"><code>{LOCALIZED-CONTENT-URL:<i>filename</i>}</code></a></dt>
	<dd>
	<p>Use this token to insert a URL for an <b>possibly localized</b>
	<a href="#i18n.resources.supporting">supporting resource file</a> into
	the interpolated content. As a supporting resource file, this file
	(including its localized versions) must be stored as <i>secondary
	support files</i>, properly tagged by locale, in the same portal component
	as where you are interpolating the <code>{LOCALIZED-CONTENT-URL:<i>filename</i>}</code>
	token. The result of using this token is a well-formed Vignette portal
	URL referencing the best-fit localized version of that file for the
	user's current locale (as determined by the SPF portal's <a
		href="#i18n.other.locale.resolver">locale resolver</a>).</p>

	<p>The <code><i>filename</i></code> in the token should give the
	base name of the secondary support file bundle. Here is some example
	HTML markup which illustrates using this token to help build an HTML
	&lt;IMG&gt; tag:</p>

	<blockquote><pre>
&lt;IMG SRC="{LOCALIZED-CONTENT-URL:picture.jpg}"&gt;
</pre></blockquote>

	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#request-url"><code>{REQUEST-URL}</code></a></dt>
	<dd>
	<p>Use this token to insert the current portal request URL into the
	interpolated content. This is a reconstruction of the URL which, if
	opened by the browser, would re-request the current portal page and
	portlet (including any form arguments). (The URL is for the current
	scheme; if you need to switch the scheme, see the next token.) Here is
	some sample HTML text, using this token to help build a hidden form
	input element containing the request URL as a return URL for the form
	handler:</p>

	<blockquote><pre>
&lt;INPUT TYPE="hidden" NAME="returnURL" VALUE="{REQUEST-URL}"&gt;
</pre></blockquote>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#request-url"><code>{REQUEST-URL:<i>spec</i>}</code></a></dt>
	<dd>
	<p>Use this token to insert the current portal request URL into the
	interpolated content. Like the above token, this is a reconstruction of
	the URL which, if opened by the browser, would re-request the current
	portal page and portlet (including any form arguments). With this
	token, you can provide a <code><i>spec</i></code> to switch the scheme
	or port. The format of the <code><i>spec</i></code> is as follows:</p>

	<blockquote><pre>
<i>scheme</i>:<i>port</i>	
	</pre></blockquote>

	<p>Each element is optional.</p>
	<ul>
		<li>
		<p>You can specify a <code><i>scheme</i></code>, either <code>http</code>
		or <code>https</code>. By default the scheme of the current request is
		assumed.
		</li>
		<li>
		<p>You can provide a <code><i>port</i></code>. By default the port
		from the current request is assumed.
		</li>
	</ul>

	<p>Here is some sample HTML text, using this token to help build a
	hidden form input element containing the request URL as a return URL
	for the form handler. The request URL scheme has been forced to HTTPS:</p>

	<blockquote><pre>
&lt;INPUT TYPE="hidden" NAME="returnURL" VALUE="{REQUEST-URL:https}"&gt;
</pre></blockquote>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#site-url"><code>{SITE-URL}</code></a></dt>
	<dd>
	<p>Use this token to insert the portal home page URL into the
	interpolated content. (The URL is for the current scheme; if you need
	to switch the scheme, see the next token.) Here is some sample HTML
	text, using this token to help build a hyperlink pointing to the home
	page:</p>

	<blockquote><pre>
Click &lt;A HREF="{SITE-URL}"&gt;here&lt;/A&gt; to go to the home page.
</pre></blockquote>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#site-url"><code>{SITE-URL:<i>spec</i>}</code></a></dt>
	<dd>
	<p>Use this token to insert a URL pointing to any page in the
	portal site, by the site-relative URI for that page. You can also
	adjust the URL scheme (<code>http</code> or <code>https</code>) and
	port number with this token. The format of the <code><i>spec</i></code>
	is as follows:</p>

	<blockquote><pre>
<i>scheme</i>:<i>port</i>;<i>uri</i>	
	</pre></blockquote>

	<p>Each element is optional.</p>
	<ul>
		<li>
		<p>You can specify a <code><i>scheme</i></code>, either <code>http</code>
		or <code>https</code>. By default the scheme of the current request is
		assumed. When you don't provide a scheme or port, you don't need the <code>:</code>
		or <code>;</code> characters.</p>
		</li>
		<li>
		<p>You can provide a <code><i>port</i></code>. By default the port
		from the current request is assumed. When you don't provide a scheme
		or port, you don't need the <code>:</code> or <code>;</code>
		characters.</p>
		</li>
		<li>
		<p>You can provide a <code><i>uri</i></code>, which you use to
		indicate the page and/or portal site you wish to target with this URL.
		For example, your <code><i>uri</i></code> could be a Vignette
		"friendly URI" for the desired page. It could be a template name, for
		a secondary page. Your <code><i>uri</i></code> can also include any
		additional path or query string you might need. You can also use the <code><i>uri</i></code>
		to switch to another portal site: if your <code><i>uri</i></code>
		begins with <code>/</code>, it is considered relative to the current
		site, but otherwise the first part of the <code><i>uri</i></code> is
		considered to be the new "site DNS name" to use.</p>
		</li>
	</ul>

	p>For example, here is some HTML text using this token to help build a
	hyperlink pointing to the current site's Forums page (which in this
	example has a "friendly URI" of <code>/forums</code>):
	</p>

	<blockquote><pre>
Click &lt;A HREF="{SITE-URL:/forums}"&gt;here&lt;/A&gt; to go to the Forums.
</pre></blockquote>

	<p>To repeat the above example, but switch to the <code>itrc</code>
	site as well, use <code>{SITE-URL:itrc/forums}</code> instead.</p>

	<p>To repeat both of those examples, and force use of HTTPS in the
	URL, use {SITE-URL:https;/forums}<code>{SITE-URL:https;itrc/forums}</code>
	instead.</p>

	<p>To force use of HTTPS but otherwise generate just a home page
	URL for the current portal site (ie like <code>{SITE-URL}</code>
	without any parameters does), use <code>{SITE-URL:https;}</code>.</p>
	</dd>
</dl>

<a name="file.author.token.user">
<h4>4.4.2. Displaying user information (<code>{NAME}</code>, <code>{EMAIL}</code>,
<code>{LANGUAGE-CODE}</code>, <code>{LANGUAGE-CODE:<i>case</i>}</code>,
<code>{LANGUAGE-NAME}</code>, <code>{COUNTRY-CODE}</code>, <code>{COUNTRY-CODE:<i>case</i>}</code>,
<code>{COUNTRY-NAME}</code>, <code>{LANGUAGE-TAG}</code>, <code>{LANGUAGE-TAG:<i>case</i>}</code>,
<code>{HPP-LANGUAGE-CODE}</code>, <code>{HPP-LANGUAGE-CODE:<i>case</i>}</code>,
<code>{USER-PROPERTY:<i>key</i>}</code>, <code>{VALUE:<i>property-name</i>}</code>)</h4>
</a>

<p>The following tokens can be used to interpolate information about
the user into your text. Please click on the links for more
documentation for each token.</p>

<dl>
	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#country-code"><code>{COUNTRY-CODE}</code></a></dt>
	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#country-code"><code>{COUNTRY-CODE:<i>case</i>}</code></a></dt>
	<dd>
	<p>Use either of these tokens to insert the <a
		href="http://www.iso.org/iso/country_codes/iso_3166_code_lists/english_country_names_and_code_elements.htm">ISO
	3166-1</a> country code for the current user into the interpolated content.
	By default the inserted country code is uppercase; you can force the
	case using <code><i>lower</i></code> or <code><i>upper</i></code>
	accordingly. If the user's locale is not a country-specific locale (eg
	is simply French instead of France French, for example), then blank
	will be substituted. Here is some sample HTML text, using this token to
	help build a URL pointing to the another HP Web site, passing the
	country (and language) codes in the URL as per the <a
		href="https://h10014.www1.hp.com/hpweb/buildguide/locale_codes.html">HP.com
	standards</a>:</p>

	<blockquote><pre>
&lt;A HREF="http://other.hp.com/path?lang={LANGUAGE-CODE}&cc={COUNTRY-CODE}"&gt;...&lt;/A&gt;
</pre></blockquote>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#country-name"><code>{COUNTRY-NAME}</code></a></dt>
	<dd>
	<p>Use this token to insert into the interpolated content the
	localized country name from the locale used in the current portal
	request. For example, <code>{COUNTRY-NAME}</code> is replaced with <code>Deutschland</code>
	for a Germany - German user. If the user's locale is not a
	country-specific locale (eg is simply French instead of France -
	French, for example), then blank will be substituted. Note that the
	country name translations used by this token are the ones built-into
	the JVM and returned by <code>Locale.getDisplayCountry()</code>.</p>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#email"><code>{EMAIL}</code></a></dt>
	<dd>
	<p>Use this token to insert the email address for the user into the
	interpolated content. The email is taken from the SPF-generated <i>user
	profile map</i>. An email address is only available when the user is
	logged-in; when the email is not available, blank will be substituted.
	For example:</p>
	<blockquote><pre>
The email address we have on record for you is: {EMAIL}
	</pre></blockquote>
	<p>(This is best used when wrapped inside the <code>{LOGGED-IN}</code>
	container token - <a href="#file.author.token.auth">see below</a>.)</p>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#hpp-language-code"><code>{HPP-LANGUAGE-CODE}</code></a></dt>
	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#hpp-language-code"><code>{HPP-LANGUAGE-CODE:<i>case</i>}</code></a></dt>
	<dd>
	<p>Use this token to insert the HP Passport standard language code
	for the current user into the interpolated content. Note that HP
	Passport does not exactly conform to the ISO 639-1 standard, which is
	why this token is provided; to work with HP Passport in all languages,
	your content must use this token instead of <code>{LANGUAGE-CODE}</code>.
	By default the inserted HPP language code is lowercase; you can force
	the case using <code><i>lower</i></code> or <code><i>upper</i></code>
	accordingly. Here is some sample HTML text, using this token to help
	build a URL pointing to an HP Passport login page, passing the language
	in the query string:</p>

	<blockquote><pre>
&lt;A HREF="https://passport2.hp.com/hppcf/login.do?lang={HPP-LANGUAGE-CODE}"&gt;...&lt;/A&gt;
</pre></blockquote>
	</dd>


	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#language-code"><code>{LANGUAGE-CODE}</code></a></dt>
	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#language-code"><code>{LANGUAGE-CODE:<i>case</i>}</code></a></dt>
	<dd>
	<p>Use this token to insert the <a
		href="http://www.loc.gov/standards/iso639-2/php/English_list.php">ISO
	639-1</a> language code for the current user into the interpolated content.
	By default the inserted language code is lowercase; you can force the
	case using <code><i>lower</i></code> or <code><i>upper</i></code>
	accordingly. Here is some sample HTML text, using this token to help
	build a URL pointing to the another HP Web site, passing the language
	(and country) codes in the URL as per the <a
		href="https://h10014.www1.hp.com/hpweb/buildguide/locale_codes.html">HP.com
	standards</a>:</p>

	<blockquote><pre>
&lt;A HREF="http://other.hp.com/path?lang={LANGUAGE-CODE}&cc={COUNTRY-CODE}"&gt;...&lt;/A&gt;
</pre></blockquote>

	<p><b>Note:</b> HP Passport does not fully conform to the ISO 639-1
	standard. To work with HP Passport in all languages, use the <code>{HPP-LANGUAGE-CODE}</code>
	token instead.</p>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#language-name"><code>{LANGUAGE-NAME}</code></a></dt>
	<dd>
	<p>Use this token to insert into the interpolated content the
	localized language name from the locale used in the current portal
	request. For example, <code>{LANGUAGE-NAME}</code> is replaced with <code>Deutsch</code>
	for a Germany - German user. Note that the language name translations
	used by this token are the ones built-into the JVM and returned by <code>Locale.getDisplayLanguage()</code>.</p>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#language-tag"><code>{LANGUAGE-TAG}</code></a></dt>
	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#language-tag"><code>{LANGUAGE-TAG:<i>case</i>}</code></a></dt>
	<dd>
	<p>Use this token to insert the <a
		href="http://www.faqs.org/rfcs/rfc3066.html">RFC 3066</a> language tag
	for the current user into the interpolated content. For a user with a
	country-specific locale, this will be a full language-country value (eg
	<code>es-MX</code> for Spanish in Mexico). For a user with a generic
	locale (ie no country indicated), this will be just the language code
	(eg <code>es</code> for generic Spanish). By default the inserted
	language tag uses mixed case (uppercase for country and lowercase for
	language). You can force the case to all-lowercase or all-uppercase,
	using <code><i>lower</i></code> or <code><i>upper</i></code>
	accordingly. Here is some sample HTML text, using this token to help
	build a URL pointing to the another HP Web site, passing the language
	tag:</p>

	<blockquote><pre>
&lt;A HREF="http://other.hp.com/path?lang={LANGUAGE-TAG}"&gt;...&lt;/A&gt;
</pre></blockquote>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#name"><code>{NAME}</code></a></dt>
	<dd>
	<p>Use this token to insert the full name (both given and family
	names) for the user into the interpolated content. The given and family
	names are taken from the SPF-generated <i>user profile map</i>. The
	name is inserted in the customary order for the user's current locale:
	family-name-first in certain East Asian locales (eg <code>Smith
	Bob</code>) and the Western custom of given-name-first otherwise (eg <code>Bob
	Smith</code>). The name is only available when the user is logged-in; when the
	name is not available, blank will be substituted. For example:</p>
	<blockquote><pre>
Welcome, {NAME}!
	</pre></blockquote>
	<p>(This is best used when wrapped inside the <code>{LOGGED-IN}</code>
	container token - <a href="#file.author.token.auth">see below</a>. The
	display order is based on the configuration in the SPF common
	utilities' <code>i18n_config.properties</code> file; this is an
	internal file in the <a href="#overview.other.spf.common">SPF
	common utilities</a> JAR which you should not need to change.)</p>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#user-property"><code>{USER-PROPERTY:<i>key</i>}</code></a></dt>
	<dd>
	<p>Use this token to insert any property in the SPF-generated <i>user
	profile map</i> for the user into the interpolated content. The <code><i>key</i></code>
	is the name of the property, as you would pass it to the SPF portal
	utilities' <a href="#portal.user.props"><code>Utils.getUserProperty</code></a>
	method (see).</p>
	<p>These user properties include core user-identity attributes from
	HP Passport or HP Enterprise Directory, as well as extended attributes
	defined by Persona or UPS. The extended attributes are not part of the
	SPF framework and so are not listed here. For a list of the core
	user-identity attributes, see the documentation for <a
		href="#portal.user.props"><code>Utils.getUserProperty</code></a>
	below. Basically, all of the class constants in {@link
	com.hp.it.spf.xa.misc.portal.Consts} which start with <code>KEY_*</code>
	- except for those starting with <code>KEY_PORTAL_*</code> - are
	keynames for the core user-identity attributes.</p>

	<blockquote>
	<p><b>Note:</b> In the <code><i>key</i></code> for the <code>{USER-PROPERTY:<i>key</i>}</code>
	token, you must use the literal property name - you cannot use a Java
	constant/variable name for it.</p>
	</blockquote>

	<p>For example, from {@link
	com.hp.it.spf.xa.misc.portal.Consts#KEY_PHONE_NUMBER} we see that the
	value of this user property key is <code>PhoneNumber</code>. So we can
	reference the phone number in our interpolated text as follows:</p>
	<blockquote><pre>
The phone number we have on record for you is: {USER-PROPERTY:PhoneNumber}
	</pre></blockquote>
	<p>(When the user is not logged-in, the user properties are set to
	generic or blank values, depending on the particular property. So this
	token is probably best used when wrapped inside the <code>{LOGGED-IN}</code>
	container token - <a href="#file.author.token.auth">see below</a>.)</p>
	<p></p>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#value"><code>{VALUE:<i>property-name</i>}</code></a></dt>
	<dd>
	<p>Use this token to insert the value of a request or session
	attribute or parameter named by the <code><i>property-name</i></code>.
	The <code><i>property-name</i></code> is case-insensitive. The
	following attributes and parameters are checked, in this order:</p>

	<p>request attribute,<br>
	request parameter,<br>
	session attribute</p>

	<p>For an example, suppose we intend to display the value from
	request named <code>requestKey</code>. So we can reference this value
	in our text as follows:</p>
	<blockquote><pre>
The request property value for 'requestKey' is : {VALUE:requestKey}
	</pre></blockquote>
	<p>If the <code><i>property-name</i></code> does not exist in the
	request or session, then a blank is inserted.</p>
	</dd>

</dl>

<a name="file.author.token.auth">
<h4>4.4.3. Permissioning content for authorized users (<code>{LOGGED-IN}</code>,
<code>{LOGGED-OUT}</code>, <code>{GROUP:<i>group-names</i>}</code>, <code>{AUTH:<i>types</i>}</code>,
<code>{EXIST:<i>property-name</i>}</code>, <code>{SECURE}</code>, <code>{UNSECURE}</code>)</h4>
</a>

<p>The following tokens may be used to permission content against
the user. With these tokens, you specify various conditions the user
must satisfy in order for the content to pass-through the interpolation.
If the user does not safisfy the various conditions, the content is
removed during interpolation. Please click on the links for more
documentation for each token.</p>

<blockquote>
<p><b>Note:</b> The SPF lets you "nest" container tokens. Nested
containers form a "logical-AND" between their respective conditions. So,
for example, <code>{LOGGED-IN}{GROUP:abc}{GROUP:xyz}...{/GROUP}{/GROUP}{/LOGGED-IN}</code>
means the user must be logged-in <b>and</b> must be in groups <code>abc</code>
<b>and</b> <code>xyz</code> in order to see the <code>...</code> wrapped
content.
</blockquote>

<dl>
	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#auth"><code>{AUTH:<i>types</i>}...{/AUTH}</code></a></dt>
	<dd>
	<p>Use this container token to permission the content inside the
	container based on the SPF-provided authentication system currently in
	use by the user. SPF provides the following kinds of authentication:</p>

	<ul>
		<li>Standard HP Passport (authentication type: <code>HPP</code>)</li>
		<li>Federated HP Passport (authentication type: <code>FED</code>)
		- not commonly used</li>
		<li>&#64;HP employee portal via HP Intranet (authentication type:
		<code>ATHP</code>)</li>
	</ul>

	<p>Use the <code><i>types</i></code> parameter to list the code(s)
	for the authentication type(s) against which to permission the wrapped
	content (the authentication type codes are listed above, and are
	case-insensitive). Use the <code>|</code> character to delimit multiple
	ones. The user must be accessing via one of the <code><i>types</i></code>
	you list, in order for the wrapped content to be included in the
	output.</p>

	<p>You may also prefix the <code>!</code> character to any
	authentication type code listed in the <code><i>types</i></code>, in
	order to indicate negation. The content enclosed by the <code>{AUTH}</code>
	token is then included in the output only if the user is <b>not</b>
	using that authentication system.</p>

	<p>For example:</p>

	<blockquote><pre>
This content is for everyone.
{AUTH:!ATHP}
  This content is only for non-internal users - eg users of standard or 
  federated HP Passport, as well as other types not yet defined.
  {AUTH:HPP|FED}
    This content is only for members of HP Passport in either standard or
    federated modes.
  {/AUTH}
{/AUTH}
{AUTH:ATHP}
  This content is only for internal users.
{/AUTH}
	</pre></blockquote>

	<p>Note that this works for both anonymous and authenticated users.
	In other words, even before logging-in, users are always accessing your
	portal site via one SPF authentication system or another, and which one
	is known to SPF. Thus this token works in both authenticated and
	anonymous cases.</p>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#group"><code>{GROUP:<i>groups</i>}...{/GROUP}</code></a></dt>
	<dd>
	<p>Use this container token to permission the content inside the
	container based on the user's current set of groups. Use the <code><i>groups</i></code>
	parameter to list the names of the group(s) against which to permission
	the wrapped content (use the <code>|</code> character to delimit the
	group names). The user must be a member of at least one of the <code><i>groups</i></code>
	in order for the wrapped content to be included in the output. Group
	names are case-insensitive and are delimited with the <code>|</code>
	character.</p>

	<p>You may also prefix the <code>!</code> character to any group
	name listed in the <code><i>groups</i></code>, in order to indicate
	negation. The content enclosed by the <code>{GROUP}</code> token is
	then included in the output only if the user is <b>not</b> a member of
	that group.</p>

	<p>For example:</p>

	<blockquote><pre>
This text is for everybody.&lt;BR&gt;
{GROUP:abc|xyz}
  This text is only for members of the "abc" or "xyz" groups.
{/GROUP}
{GROUP:!abc}
  {GROUP:!xyz}
    This text is for everyone except members of the "abc" and "xyz" groups.
  {/GROUP}
{/GROUP}
	</pre></blockquote>

	<p>The actual group names will vary by application, over time, and
	according to the mappings which initially derive them. UGS, as the
	external grouping provider for SPF, will let application teams define
	their needed groups. The SPF framework does define and provide a few
	core groups - see the list in the discussion about <a
		href="#portal.user.groups"><code>Utils.getGroups</code></a>, below.</p>

	<blockquote>
	<p><b>Note:</b> In the <code><i>groups</i></code> for the <code>{GROUP:<i>groups</i>}</code>
	token, you must use the literal group name - you cannot use the Java
	constant/variable name for it.</p>
	</blockquote>

	<p><b>Background:</b> The SPF has 2 related concepts for
	authorization: groups and roles. Groups are portal-level constructs and
	are not JSR portlet standard; roles are portlet-level constructs which
	are JSR-standard. The SPF portal both forwards the user's groups as
	part of the {@link javax.portlet.PortletRequest}, and maps the groups
	into roles which are likewise part of the <code>PortletRequest</code>.
	The group-to-role mapping is specified when provisioning the portlet
	inside the portal. In SPF, groups themselves are generally mapped from
	other characteristics, either in the portal itself, or in UGS. Both
	groups and roles can exist apart from authentication; ie anonymous
	users can still be in groups/roles. Only groups are made available for
	portal components to check on the portal side, but portlets have access
	both to groups and roles. This SPF authorization design is documented
	elsewhere.</p>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#logged-in"><code>{LOGGED-IN}...{/LOGGED-IN}</code></a></dt>
	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#logged-out"><code>{LOGGED-OUT}...{/LOGGED-OUT}</code></a></dt>
	<dd>
	<p>Use these container tokens to permission the content inside the
	container based on the user's current authentication status. The <code>{LOGGED-IN}...{/LOGGED-IN}</code>
	token will cause the wrapped content to be <b>included</b> in the
	interpolated content if the user is logged-in, and <b>omitted</b> if
	the user is not logged-in. The <code>{LOGGED-OUT}...{/LOGGED-OUT}</code>
	token will do the opposite. Here is some example HTML text using these
	tokens:</p>
	<blockquote><pre>
This text is for everybody.&lt;BR&gt;
{LOGGED-IN}This text is for logged-in users only.{/LOGGED-IN}
{LOGGED-OUT}This text is for logged-out users only.{/LOGGED-OUT}
	</pre></blockquote>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#secure"><code>{SECURE}...{/SECURE}</code></a></dt>
	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#unsecure"><code>{UNSECURE}...{/UNSECURE}</code></a></dt>
	<dd>
	<p>Use these container tokens to permission the content inside the
	container based on the user's current security status. The <code>{SECURE}...{/SECURE}</code>
	token will cause the wrapped content to be <b>included</b> in the
	interpolated content if the user request to the portal used HTTPS (ie, was
	secure), and <b>omitted</b> if not.  The <code>{UNSECURE}...{/UNSECURE}</code>
	token will do the opposite. Here is some example HTML text using these
	tokens:</p>
	<blockquote><pre>
This text is for everybody.&lt;BR&gt;
{SECURE}This text is for secure HTTPS users only.{/SECURE}
{UNSECURE}This text is for non-secure HTTP users only.{/UNSECURE}
	</pre></blockquote>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#exist"><code>{EXIST:<i>property-names</i>}...{/EXIST}</code></a></dt>
	<dd>
	<p>Use this container token to permission the content inside the
	container based on whether certain attributes or parameters exist in
	the user's current request or session. The <code><i>property-names</i></code>
	is case-insensitive.</p>

	<p>Your <code><i>property-names</i></code> may include one or more
	property names, delimited with the <code>|</code> character. The engine
	looks for each <code><i>property-name</i></code> anywhere in the
	current request attributes or parameters, and anywhere in the current
	portal session. If an attribute or parameter named by the <code><i>property-name</i></code>
	exists in any of those places, the surrounded content is included in
	the output; otherwise it is omitted from the output.</p>

	<p>In addition, you may prefix any property name you list in your <code><i>property-names</i></code>
	with the <code>!</code> character to indicate negation. The surrounded
	content is then included in the output when the request does <b>not</b>
	contain any request attribute, parameter, or session attribute of that
	name.</p>

	<p>For example:</p>

	<blockquote><pre>
This text is for everybody.&lt;BR&gt;
{EXIST:key1|key2|key3}
  This text is visible only when an attribute or parameter exists named
  'key1', 'key2', or 'key3'.
  {EXIST:!key3}
    This text is visible only when an attribute or parameter exists named
    'key1' or 'key2'.
  {/EXIST}
{/EXIST}
	</pre></blockquote>

	<p>The engine looks for the <code><i>property-name</i></code>
	anywhere in the current request attributes or parameters, and anywhere
	in the current session. If an attribute or parameter named by one of
	the <code><i>property-names</i></code> exists in any of those places,
	the surrounded content is included in the output. Conversely, if any
	one of the <b>negated</b> <code><i>property-names</i></code> fails to
	exist in any of those places, the surrounded content will also be
	included. Otherwise the surrounded content will be dropped from the
	output.</p>

	</dd>
</dl>

<a name="file.author.token.consolidate">
<h4>4.4.4. Consolidating content for easier administration (<code>{PAGE:<i>friendly-ids</i>}</code>,
<code>{NAV-ITEM:<i>items</i>}</code>, <code>{SITE:<i>site-names</i>}</code>,
<code>{INCLUDE:<i>key</i>}</code>)</h4>
</a>

<p>The following tokens may be used to consolidate content, either
to reduce the number of files storing content for different pages,
navigation items or portal sites, or to provide referential integrity
for content shared between multiple files (via the use of
include-properties). Please click on the links for more documentation
for each token.</p>

<blockquote>
<p><b>Note:</b> The SPF lets you "nest" container tokens. Nested
containers form a "logical-AND" between their respective conditions. So,
for example, <code>{PAGE:forums}{NAV-ITEM:forums/article/edit}...{/NAV-ITEM}{/PAGE}</code>
means the current request must be for the <code>forums</code> page and
the <code>forums/article/edit</code> navigation item, in order to get
the <code>...</code> wrapped content.
</blockquote>

<dl>
	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#include"><code>{INCLUDE:<i>key</i>}</code></a></dt>
	<dd>
	<p>Use this token to consolidate shared content into a separate
	properties file, and then include it into the interpolated content.
	First, you create a <i>token substitutions property file</i> (also
	called an <i>include property file</i>) with a simple key-value format
	(ie the standard {@link java.util.Properties} format):</p>

	<blockquote><pre>
<i>key</i> = <i>value</i>
</pre></blockquote>

	<p>Then you reference the <code><i>key</i></code> in your <code>{INCLUDE:<i>key</i>}</code>
	token. The interpolation engine substitutes the <code><i>value</i></code>
	from the properties file into your interpolated content. For example,
	assume you have the following in your property file:</p>

	<blockquote><pre>
url.hp=http://www.hp.com
	</pre></blockquote>

	<p>Then you can substitute <code>http://www.hp.com</code> into the
	content like this:</p>

	<blockquote><pre>
&lt;A HREF="{INCLUDE:url.hp}"&gt;Go to HP home page&lt;/A&gt;
	</pre></blockquote>

	<p>Your substitution property <code><i>value</i></code> can contain
	any content valid in a Java {@link java.util.Properties} file. It can
	even contain any of the other special markup tokens described in this
	guide (however it cannot contain other <code>{INCLUDE:<i>key</i>}</code>
	tokens).</p>

	<p>Your token substitutions property file must be a <i>secondary
	support file</i> in the same portal component as is interpolating the <code>{INCLUDE:<i>key</i>}</code>
	token. You can have a single version of the file, or multiple localized
	versions of the file, tagged by locale and stored in your portal
	component as a bundle of <a href="#i18n.resources.supporting">supporting
	resource files</a> (see earlier in this document). The SPF will choose the
	best-fit version for the user's locale in each request.</p>

	<p>The base filename of the token substitutions property file is
	assumed by the SPF to be <code>default_includes.properties</code>. You
	can use a different base filename in different ways, depending on how
	you invoke the interpolator:</p>

	<ul>
		<li>
		<p>If you invoke <a href="#file.display.java.tokenParser"><code>TokenParser</code></a>
		to interpolate from a string, you can pass the base token
		substitutions filename to the constructor. (You can even use an
		alternate constructor that lets you pass some properties you have
		already loaded, as a {@link java.util.ResourceBundle}, into the <code>TokenParser</code>
		constructor. See the <code>TokenParser</code> discussion.)</p>
		</li>
		<li>
		<p>If you invoke <a href="#file.display.java.fileInterpolator"><code>FileInterpolator</code></a>
		to interpolate from a file, you can pass the base include property
		filename to the constructor.</p>
		</li>
		<li>
		<p>If you use the <a href="#file.display.jsp.interpolate"><code>&lt;spf-file-portal:interpolate&gt;</code></a>
		JSP tag, use the <code>includeFile</code> tag attribute.</p>
		</li>
		<li>
		<p>If you are inmplementing a <a href="#help.global">global
		help secondary page</a>, the base filename of your include properties must
		be <code>globalHelpInclude.properties</code>.</p>
		</li>
	</ul>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#nav"><code>{NAV-ITEM:<i>items</i>}...{/NAV-ITEM}</code></a></dt>
	<dd>
	<p>Use this container token to put content for multiple portal
	navigation items into the same uninterpolated content string (or file).
	When it is interpolated, only the sections for which the current
	navigation item qualifies will be included.</p>

	<p>The <code><i>items</i></code> parameter lists the <i>substrings</i>
	of desired navigation item names and/or friendly URLs. The navigation
	item name or friendly URL for the current operative navigation item
	must <i>contain</i> (case-insensitive) at least one of the listed item
	names or friendly URLs. Use the <code>|</code> character to delimit
	multiple item names or friendly URLs in the <code><i>items</i></code>
	parameter. (In the SPF portal, the navigation item name and friendly
	URL are Vignette properties, assigned by the administrator.)</p>

	<p>You may also use the <code>!</code> character as a negation
	operator. Any item listed in your <code><i>items</i></code> and
	prefixed with <code>!</code> indicates the wrapped content is to be
	displayed only when the current navigation item is <b>not</b> the one
	named. (Remember that this is compared against both the current
	navigation item name and its friendly URL; to fully negate the match,
	neither of those must match.)</p>

	<p>For example:</p>
	<blockquote><pre>
This text is for everybody.&lt;BR&gt;
{NAV-ITEM:manuals|parts|repairs}
  This text is only for pages accessed with the "manuals", "parts", or 
  "repairs" navigation items.
  {NAV-ITEM:manuals}
    Additional text only for pages accessed with the "manuals" navigation item.
  {/NAV-ITEM}
  {NAV-ITEM:!manuals}
    Additional text only for pages accessed with the "parts" or "repairs"
    navigation items.
  {/NAV-ITEM}
{/NAV-ITEM}
</pre></blockquote>

	<p>The actual navigation item names and friendly URLs will vary;
	they are setup by the administrator. They are not listed here.</p>

	<blockquote>
	<p><b>Note:</b> In Vignette, friendly URLs are only unique within a
	site, and navigation item names are not unique at all. Be advised.
	Unfortunately Vignette does not provide a friendly unique ID for
	navigation items.</p>
	<p><b>Note:</b> The friendly URL here actually corresponds with the
	friendly URL as carried in the actual request URL to the portal. This
	may not exactly match the friendly URL on the navigation item in
	Vignette, because Vignette does not require friendly URLs to exactly
	match. For example, Vignette only requires that the configured
	navigation item friendly URL match the beginning of a friendly URL in
	the request. Thus you can use the <code>{NAV-ITEM}</code> token to
	specify additional path beyond the configured friendly URL, if desired.
	As another example, Vignette defaults requests without any friendly URL
	(or with an unrecognized friendly URL) to the home page for your site.
	So for portlets on a home page, the actual friendly URL in the request,
	which your <code>{NAV-ITEM}</code> markup is compared against, may be
	quite different than the friendly URL for the home page navigation item
	configured in Vignette.</p>
	</blockquote>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#page"><code>{PAGE:<i>pages</i>}...{/PAGE}</code></a></dt>
	<dd>
	<p>Use this container token to put content for multiple portal
	pages into the same uninterpolated content string (or file). When it is
	interpolated, only the sections for which the current portal page
	qualifies will be included.</p>

	<p>The <code><i>pages</i></code> parameter lists the page ID <i>substrings</i>
	for the pages that should use the wrapped content. The page ID for the
	current portal page must <i>contain</i> (case-insensitive) at least one
	of the listed page ID's. Use the <code>|</code> character to delimit
	multiple page ID's in the <code><i>pages</i></code> parameter. (In the
	SPF portal, the page ID is the Vignette <i>friendly ID</i> assigned to
	the page by the administrator.)</p>

	<p>You may also use the <code>!</code> character as a negation
	operator. Any ID listed in your <code><i>pages</i></code> and prefixed
	with <code>!</code> indicates the wrapped content is to be displayed
	only when the current page ID is <b>not</b> the one named.</p>

	<p>For example:</p>
	<blockquote><pre>
This text is for everybody.&lt;BR&gt;
{PAGE:abc|def}
  This text is only for the "abc" or "def" pages.
{/PAGE}
{PAGE:!xyz}
  This text is for every page except the "xyz" page.
{/PAGE}
</pre></blockquote>

	<p>The actual page ID's will vary; they are setup by the
	administrator. They are not listed here.</p>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#site"><code>{SITE:<i>sites</i>}...{/SITE}</code></a></dt>
	<dd>
	<p>Use this container token to put content for multiple portal
	sites into the same uninterpolated content string (eg file). When it is
	interpolated, only the section for which the current portal site
	qualifies will be included.</p>

	<p>The <code><i>sites</i></code> parameter lists the <i>site
	name(s)</i> of the portal site(s) which should get the wrapped content. The
	site name for the current portal request must match (case-insensitive)
	at least one of the listed site names. Use the <code>|</code> character
	to delimit multiple site names in the <code><i>sites</i></code>
	parameter. (In the SPF portal, the site name is the Vignette "site DNS
	name" assigned to the portal site when it is created by the
	administrator.)</p>

	<p>You may also use the <code>!</code> character as a negation
	operator. Any name listed in your <code><i>sites</i></code> and
	prefixed with <code>!</code> indicates the wrapped content is to be
	displayed only when the current site name is <b>not</b> that one.</p>

	<p>For example:</p>
	<blockquote><pre>
This text is for everybody.&lt;BR&gt;
{SITE:abc|def}
  This text is only for pages in the the "abc" or "def" portal sites.
{/SITE}
{SITE:!xyz}
  This text is for pages in every site except the "xyz" portal site.
{/SITE}
</pre></blockquote>

	<p>The actual site names will vary by portal site; they are setup
	by the administrator. They are not listed here.</p>
	</dd>
</dl>

<a name="file.author.token.misc">
<h4>4.4.5. Miscellaneous (<code>{AFTER:<i>date</i>}</code>, <code>{BEFORE:<i>date</i>}</code>,
<code>{DATE:<i>date</i>}</code>, <code>{SITE-NAME}</code>, <code>{URL-ENCODE:<i>string</i>}</code>,
<code>{XML-ESCAPE:<i>string</i>}</code>)</h4>
</a>

<p>These are miscellaneous tokens. Please click on the links for
more documentation on each token.</p>

<dl>
	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#after"><code>{AFTER:<i>date</i>}...{/AFTER}</code></a></dt>
	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#before"><code>{BEFORE:<i>date</i>}...{/BEFORE}</code></a></dt>
	<dd>
	<p>Use these container tokens to restrict content inside the
	container based on the current date and time. The <code>{AFTER:<i>date</i>}...{/AFTER}</code>
	token will cause the wrapped content to be <b>included</b> in the
	interpolated content beginning right after the particular <code><i>date</i></code>.
	The <code>{BEFORE:<i>date</i>}...{/BEFORE}</code> token is the
	opposite: the content will be included only until the particular <code><i>date</i></code>.
	You can nest these tokens to mark content with a beginning and end
	date.</p>
	<p>The format of the <code><i>date</i></code> parameter may include
	date only, or both date and time:</p>

	<p><code><i>M</i>/<i>d</i>/<i>yyyy</i> <i>h</i>:<i>mm</i> <i>a</i>
	<i>z</i></code></p>

	<ul>
		<li><code><i>M</i></code> is a one or two-digit month</li>
		<li><code><i>d</i></code> is a one or two-digit day of month</li>
		<li><code><i>yyyy</i></code> is a four-digit year</li>
	</ul>

	<p>The rest of the format is optional:</p>

	<ul>
		<li><code><i>h</i></code> is a one or two-digit hour (12 hour
		clock)</li>
		<li><code><i>mm</i></code> is a two-digit minutes</li>
		<li><code><i>a</i></code> is <code>AM</code> or <code>PM</code></li>
		<li><code><i>z</i></code> is the timezone such as <code>GMT</code>
		for Greenwich Mean Time, <code>PST</code> for Pacific Standard Time, <code>GMT-05:00</code>
		for 5 hours behind GMT, etc.</li>
	</ul>

	<p>The tokens are very picky about this format. If they do not
	recognize your <code><i>date</i></code>, they will err on the side of
	displaying the wrapped content.</p>

	<p>If you specify only a date, then midnight GMT is assumed. Thus
	the comparison will be between the current clocktime and midnight on
	that date in GMT. If you specify both date and time, note that time
	fields below minute are assumed to be zero. Thus the comparison will be
	between the current clocktime and that minute, "sharp".</p>

	<p>For example:</p>

	<blockquote><pre>
This text is permanent.&lt;BR&gt;
{BEFORE:2/20/2009 12:30 PM GMT}
This text is only displayed until 12:30 PM sharp (Greenwhich Mean Time) on February 20, 2009.
{/BEFORE}
{AFTER:2/1/2009}
  {BEFORE:3/1/2009}
  This text is only displayed during the month of February 2009 (as measured by Greenwich Mean Time).
  {/BEFORE}
{/AFTER}
</pre></blockquote>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#date"><code>{DATE:<i>date</i>}</code></a></dt>
	<dd>
	<p>Use this token to insert the given <code><i>date</i></code> as a
	well-formatted string, localized according to the user locale. The
	string may contain the date only, or time as well. When time is taken
	into account, it is adjusted for the user timezone. If you do not
	specify a <code><i>date</i></code>, the current date is assumed.</p>

	<p>The format of the <code><i>date</i></code> parameter may include
	date only, or both date and time:</p>

	<p><code><i>M</i>/<i>d</i>/<i>yyyy</i> <i>h</i>:<i>mm</i> <i>a</i>
	<i>z</i></code></p>

	<ul>
		<li><code><i>M</i></code> is a one or two-digit month</li>
		<li><code><i>d</i></code> is a one or two-digit day of month</li>
		<li><code><i>yyyy</i></code> is a four-digit year</li>
	</ul>

	<p>The rest of the format is optional and used to specify a time of
	day:</p>

	<ul>
		<li><code><i>h</i></code> is a one or two-digit hour (12 hour
		clock)</li>
		<li><code><i>mm</i></code> is a two-digit minutes</li>
		<li><code><i>a</i></code> is <code>AM</code> or <code>PM</code></li>
		<li><code><i>z</i></code> is the timezone such as <code>GMT</code>
		for Greenwich Mean Time, <code>PST</code> for Pacific Standard Time, <code>GMT-05:00</code>
		for 5 hours behind GMT, etc.</li>
	</ul>

	<p>If you specify just a date, then just the date will be inserted
	(localized for the user locale). If you specify both date and time,
	then both date and time will be inserted (localized for the user locale
	and adjusted for the user timezone). If you do not specify any <code><i>date</i></code>
	parameter, then the current date (not including time) in the user's
	timezone will be inserted, localized for the user locale.</p>

	<p>The tokens are very picky about the format of the <code><i>date</i></code>
	you specify. If the tokens do not recognize your <code><i>date</i></code>,
	they will insert an empty string instead.</p>

	<p>For example:</p>

	<ul>
		<li>
		<p>For a user with locale of US-English and US (East Coast)
		timezone, <code>{DATE:2/20/2009 11:30 PM GMT}</code> is replaced with
		<code>February 20, 2009 6:30 PM EST</code>. The same token instance,
		for a German-Germany user with Western Europe timezone, is replaced
		with <code>21. Februar 2009 00:30 CET</code>.</p>
		</li>
		<li>
		<p>For the same users, <code>{DATE:2/20/2009}</code> is simply
		rendered as <code>February 20, 2009</code> and <code>20.
		Februar 2009</code>, respectively. Note that the user timezone and
		time-of-day is ignored in this case, so the displayed date will always
		be the same one you specify.</p>
		</li>
		<li>
		<p>For the same users, <code>{DATE}</code> will render the current
		localized date in their timezones at the time of execution. So if the
		token is executed at 11:30 PM GMT on February 20, 2009, then it will
		render as <code>February 20, 2009</code> for the US-English (East
		Coast timezone) user, and <code>21. Februar 2009</code> for the
		German-Germany (Western Europe timezone) user (since at 11:30 PM GMT
		it is already the next day on the Western European continent).</p>
		</li>
	</ul>

	<p><b>Note:</b> This token's output format is rigid. Varying the
	output format - eg, using numeric month instead of word month, or
	2-digit instead of 4-digit year - is not supported.</p>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#site-name"><code>{SITE-NAME}</code></a></dt>
	<dd>
	<p>Use this token to insert the portal site name into the
	interpolated content. In SPF, the portal site name is the Vignette
	"site DNS name", which the portal administrator assigns when creating
	the site. It is the part of the portal URL which uniquely identifies
	the portal site: <code>http://host.hp.com/portal/site/&lt;site-DNS-name&gt;/...</code>.
	Here is some sample HTML text, using this token (as well as the <code>{SITE-URL:<i>key</i>}</code>
	token) to present a logout hyperlink (in SPF, the logout process runs
	in the <code>spf</code> portal site, uses the Vignette secondary page
	whose template ID is <code>SPF_LOGOUT</code>, and expects the effective
	site DNS name to be in the <code>spfSite</code> query parameter):</p>

	<blockquote><pre>
&lt;A HREF="{SITE-URL:spf/template.SPF_LOGOUT?spfSite={SITE-NAME}}"&gt;Sign out&lt;/A&gt;
</pre></blockquote>

	<p>(Incidentally, notice from this example how <code>{SITE-NAME}</code>
	is nested inside the <code><i>uri</i></code> parameter for <code>{SITE-URL:<i>uri</i>}</code>.
	In general, any of the tokens can be used inside the parameter-values
	for any of the tokens.)</p>
	</dd>

	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#url-encode"><code>{URL-ENCODE:<i>string</i>}</code></a></dt>
	<dd>
	<p>Use this token to insert a <code><i>string</i></code>,
	URL-encoded, into the interpolated content. For example:</p>

	<blockquote><pre>
&lt;A HREF="https://passport2.hp.com/hppcf/modifyuser.do?applandingpage={URL-ENCODE:{REQUEST-URL}}"&gt;
	</pre></blockquote>

	<p>This inserts the current request URL, properly encoded, into the
	query string of that hyperlink.</p>
	</dd>
	
	<dt><a
		href="com/hp/it/spf/xa/interpolate/portal/FileInterpolator.html#xml-escape"><code>{XML-ESCAPE:<i>string</i>}</code></a></dt>
	<dd>
	<p>Use this token to insert a <code><i>string</i></code>,
	XML-escaped, into the interpolated content. For example:</p>

	<blockquote><pre>
&lt;P&gt;
   Welcome, {XML-ESCAPE:{NAME}}!
&lt;/P&gt;
	</pre></blockquote>

	<p>This inserts the current user name, safely escaped, into the
	surrounding HTML content. This way, if the name happens to contain any
	sensitive XML meta-characters like <code>&lt;</code> and <code>&amp;</code>
	they will be converted to their equivalent escape sequences so the user
	agent will render them properly instead of interpreting them as HTML.
	This helps prevent inadvertent corruption to your content by the
	presence of such characters, or even deliberate cross-site-scripting
	(XSS) attacks.</p>
	</dd>
	
</dl>

<hr>

<a name="portal">
<h2>5. Portal Data</h2>
</a>

<p>The Shared Portal Framework provides Vignette portal components
with access to data from the SPF portal, including user data and portal
request data. This chapter describes how to access these elements.</p>

<hr>

<a name="portal.kinds">
<h3>5.1. Kinds of portal provided data</h3>
</a>

<p>Following are the kinds of data which the SPF portal makes
available to your portal components.</p>

<a name="portal.user">
<h4>5.1.1. User data (profile attributes, groups, etc)</h4>
</a>

<p>SPF provides a {@java.util.Map} of user attributes aggregated
from numerous sources including HP Passport (when the user has logged-in
via HPP), HP Enterprise Directory (when the user has logged-in via the
&#64;HP employee portal), Persona, UPS, and UGS. This map, called the <i>SPF
user profile map</i>, is stored in the Vignette <code>PortalContext</code>
object. When the user is not logged-in, this map is still provided -
however its properties are set to default values for the user's current
locale (determined by the <a href="#i18n.other.locale.resolver">locale
resolver</a>).</p>

<p>The SPF portal {@link com.hp.it.spf.xa.misc.portal.Utils} class
provides access to the properties in the user profile map. You can get
user attributes, groups, and check whether or not the user is logged-in.</p>

<a name="portal.request">
<h4>5.1.2. Portal request data (site name and URLs)</h4>
</a>

<p>The Vignette-standard <code>PortalContext</code> object already
provides most of the information about the current request that your
portal component may need to know: the current navigation item,
secondary page, style, friendly ID's and so forth. However SPF
supplements that with getters for the current request URL and "site DNS
name", a builder for arbitrary portal site URLs, a predicate for testing
whether identity federation is enabled for the current portal site <i>(not
typically used in SPF at this time)</i>, and a few others. The SPF portal
{@link com.hp.it.spf.xa.misc.portal.Utils} class provides access to this
information as well.</p>

<hr>

<a name="portal.user.get">
<h3>5.2. Accessing user data</h3>
</a>

<p>Use {@link com.hp.it.spf.xa.misc.portal.Utils} to access user
data, including profile attributes, groups, and current authentication
status.</p>

<a name="portal.user.loginStatus">
<h4>5.2.1. Checking user authentication status (<code>Utils.isAuthenticatedUser</code>)</h4>
</a>

<p>Use {@link
com.hp.it.spf.xa.misc.portal.Utils#isAuthenticatedUser(PortalContext)}
to determine whether the user is currently logged-in or not. This method
takes one parameter, the current Vignette <code>PortalContext</code>
object. For example (where <code>context</code> is your <code>PortalContext</code>):</p>

<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
if (Utils.isAuthenticatedUser(context)) {
    // user is logged-in
    ...
} else {
    // user is not logged-in
    ...
}
</pre></blockquote>

<p>Please see the method documentation for more information.</p>

<a name="portal.user.props">
<h4>5.2.2. Accessing user profile attributes (<code>Utils.getUserProperty</code>)</h4>
</a>

<p>Use {@link
com.hp.it.spf.xa.misc.portal.Utils#getUserProperty(PortalContext,String)}
to obtain user attributes from the SPF <i>user profile map</i>. The
method returns an {@link java.lang.Object} whose type depends on the
type of property. The method takes the following arguments:</p>

<ul>
	<li>
	<p>The current Vignette <code>PortalContext</code> object.</p>
	</li>
	<li>
	<p>The string name of the property to lookup. This could be the
	name of a core user property from HP Passport or the &#64;HP employeee
	portal - these are the user-identity systems in SPF - or it could be
	the name of an extended user property from those systems, or from
	Persona or UPS.</p>

	<p>The core user-identity properties' names each have constants
	defined for them in the {@link com.hp.it.spf.xa.misc.portal.Consts}
	class. They are the <code>Consts</code> class attributes whose names
	begin with <code>KEY_*</code> but <b>not</b> <code>KEY_PORTAL_*</code>.
	Here they are:</p>

	<dl>
		<dt>{@link com.hp.it.spf.xa.misc.portal.Consts#KEY_CITY}</dt>
		<dd>
		<p>When you use this argument with an authenticated user, it
		returns the "city" field from the postal address on record for the
		user. This is taken from the HP Passport business contact data, or the
		HP Enterprise Directory information for the user (depending on whether
		the user logged-in via HPP or the &#64;HP employee portal).</p>
		<p>For an anonymous user, this returns null.</p>
		<p><i>Returns type:</i> {@link java.lang.String}</p>
		</dd>

		<dt>{@link com.hp.it.spf.xa.misc.portal.Consts#KEY_COUNTRY}</dt>
		<dd>
		<p>When you use this argument, <code>Utils.getUserProperty</code>
		returns the <a
			href="http://www.iso.org/iso/country_codes/iso_3166_code_lists/english_country_names_and_code_elements.htm">ISO
		3166-1</a> country code for the country of the user. Note this is <b>not</b>
		necessarily the same as the country in the current resolved locale (ie
		the one returned by the <code>I18nUtility.getLocale</code> method -
		see the previous discussion about <a href="#i18n.other.locale.get">how
		SPF gets that locale</a>). Rather it is the country of record in the user
		profile:</p>
		<p>For an authenticated &#64;HP user, this will be the country of
		record for the user in the HP Enterprise Directory.</p>
		<p>For an authenticated HP Passport user, this is the HPP <code>residentCountryCode</code>
		attribute from the HPP user profile.</p>
		<p>For an anonymous user, this is the country of record for the
		default user profile the user has been assigned, based on their
		current resolved locale.</p>

		<p><i>Returns type:</i> {@link java.lang.String}</p>
		</dd>

		<dt>{@link com.hp.it.spf.xa.misc.portal.Consts#KEY_EMAIL}</dt>
		<dd>
		<p>When you use this argument with an authenticated user, <code>Utils.getUserProperty</code>
		returns the email address for the user. This is taken from the HPP or
		HP ED user account.</p>
		<p>For an anonymous user, this returns null.</p>

		<p><i>Returns type:</i> {@link java.lang.String}</p>
		</dd>

		<dt>{@link com.hp.it.spf.xa.misc.portal.Consts#KEY_EMAIL_PREF}</dt>
		<dd>
		<p>When you use this argument with an authenticated HP Passport
		user, it returns the user's opt-in preference for email contact from
		HP. A value of <code>Y</code> means the user is willing to be
		contacted via email. Any other value (eg, <code>N</code>) means the
		user wishes not to be contacted via email.</p>
		<p>For &#64;HP and anonymous users, this returns null.</p>
		<p><i>Returns type:</i> {@link java.lang.String}</p>
		</dd>

		<dt>{@link com.hp.it.spf.xa.misc.portal.Consts#KEY_FIRST_NAME}</dt>
		<dd>
		<p>When you use this argument with an authenticated user, it
		returns the first (ie given) person name for the user, as taken from
		the HP Passport or HP Enterprise Directory information for the user
		(depending on whether the user logged-in via HPP or the &#64;HP
		employee portal).</p>
		<p>For an anonymous user, this returns null</p>

		<p><i>Returns type:</i> {@link java.lang.String}</p>
		</dd>

		<dt>{@link com.hp.it.spf.xa.misc.portal.Consts#KEY_LANGUAGE}</dt>
		<dd>
		<p>When you use this argument, <code>Utils.getUserProperty</code>
		returns a code for the language of the user. Note that this is <b>not</b>
		necessarily the same as the language in the current resolved locale
		(ie the one returned by the <code>I18nUtility.getLocale</code> method
		- see the previous discussion about <a href="#i18n.other.locale.get">how
		SPF gets that locale</a>). Rather it is the language of record in the user
		profile:</p>
		<p>For an authenticated &#64;HP user, this will always be <code>en</code>.
		</p>
		<p>For an authenticated HP Passport user, this is the HPP <code>langCode</code>
		attribute from the HPP user profile. It looks like an <a
			href="http://www.loc.gov/standards/iso639-2/php/English_list.php">ISO
		639-1</a> language code, but there are exceptions for Simplified and
		Traditional Chinese (you can use one of the SPF-provided converter
		methods, like {@link
		com.hp.it.spf.xa.i18n.portal.I18nUtility#hppLanguageToLocale(String)},
		to normalize it).</p>
		<p>For an anonymous user, this is the <a
			href="http://www.loc.gov/standards/iso639-2/php/English_list.php">ISO
		639-1</a> language code of record for the default user profile the user
		has been assigned, based on their current resolved locale.</p>

		<p><i>Returns type:</i> {@link java.lang.String}</p>
		</dd>

		<dt>{@link
		com.hp.it.spf.xa.misc.portal.Consts#KEY_LAST_CHANGE_DATE}</dt>
		<dd>
		<p>When you use this argument with an authenticated user, it
		returns the date and time of the most recent change to any of the
		profile attributes in the user account. This is taken from the HP
		Passport or HP Enterprise Directory information for the user
		(depending on whether the user logged-in via HPP or the &#64;HP
		employee portal).</p>
		<p>For an anonymous user, this is a null object.</p>
		<p><i>Returns type:</i> {@link java.util.Date}</p>
		</dd>

		<dt>{@link
		com.hp.it.spf.xa.misc.portal.Consts#KEY_LAST_LOGIN_DATE}</dt>
		<dd>
		<p>When you use this argument with an authenticated user, it
		returns the date and time of the most recent successful authentication
		for the user account. This is taken from the HP Passport or HP
		Enterprise Directory information for the user (depending on whether
		the user logged-in via HPP or the &#64;HP employee portal).</p>
		<p>For an anonymous user, this is a null object.</p>
		<p><i>Returns type:</i> {@link java.util.Date}</p>
		</dd>

		<dt>{@link com.hp.it.spf.xa.misc.portal.Consts#KEY_LAST_NAME}</dt>
		<dd>
		<p>When you use this argument with an authenticated user, it
		returns the last (ie family or surname) person name for the user, as
		taken from the HP Passport or HP Enterprise Directory information for
		the user (depending on whether the user logged-in via HPP or the
		&#64;HP employee portal).</p>
		<p>For an anonymous user, this returns null</p>

		<p><i>Returns type:</i> {@link java.lang.String}</p>
		</dd>

		<dt>{@link com.hp.it.spf.xa.misc.portal.Consts#KEY_MAIL_STOP}</dt>
		<dd>
		<p>When you use this argument with an authenticated user, it
		returns the "mail stop" field from the postal address on record for
		the user. This is taken from the HP Passport business contact data, or
		the or HP Enterprise Directory information for the user (depending on
		whether the user logged-in via HPP or the &#64;HP employee portal).</p>
		<p>For an anonymous user, this returns null.</p>
		<p><i>Returns type:</i> {@link java.lang.String}</p>
		</dd>

		<dt>{@link com.hp.it.spf.xa.misc.portal.Consts#KEY_PHONE_NUMBER}</dt>
		<dd>
		<p>When you use this argument with an authenticated user, it
		returns the telephone number on record for the user. This is taken
		from the HP Passport business contact data, or the HP Enterprise
		Directory information for the user (depending on whether the user
		logged-in via HPP or the &#64;HP employee portal). Whether the
		telephone number already includes international dialing information
		depends on those systems.</p>
		<p>For an anonymous user, this returns null.</p>
		<p><i>Returns type:</i> {@link java.lang.String}</p>
		</dd>

		<dt>{@link
		com.hp.it.spf.xa.misc.portal.Consts#KEY_PHONE_NUMBER_EXT}</dt>
		<dd>
		<p>When you use this argument with an authenticated user, it
		returns the telephone extension on record for the user. This is taken
		from the HP Passport business contact data, or the HP Enterprise
		Directory information for the user (depending on whether the user
		logged-in via HPP or the &#64;HP employee portal).</p>
		<p>For an anonymous user, this returns null.</p>
		<p><i>Returns type:</i> {@link java.lang.String}</p>
		</dd>

		<dt>{@link com.hp.it.spf.xa.misc.portal.Consts#KEY_PHONE_PREF}</dt>
		<dd>
		<p>When you use this argument with an authenticated HP Passport
		user, it returns the user's opt-in preference for telephone contact
		from HP. A value of <code>Y</code> means the user is willing to be
		contacted via telephone. Any other value (eg, <code>N</code>) means
		the user wishes not to be contacted by telephone.</p>
		<p>For &#64;HP and anonymous users, this returns null.</p>
		<p><i>Returns type:</i> {@link java.lang.String}</p>
		</dd>

		<dt>{@link com.hp.it.spf.xa.misc.portal.Consts#KEY_POSTAL_PREF}</dt>
		<dd>
		<p>When you use this argument with an authenticated HP Passport
		user, it returns the user's opt-in preference for postal mail contact
		from HP. A value of <code>Y</code> means the user is willing to be
		contacted via postal mail. Any other value (eg, <code>N</code>) means
		the user wishes not to be contacted by postal mail.</p>
		<p>For &#64;HP and anonymous users, this returns null.</p>
		<p><i>Returns type:</i> {@link java.lang.String}</p>
		</dd>

		<dt>{@link com.hp.it.spf.xa.misc.portal.Consts#KEY_PROFILE_ID}</dt>
		<dd>
		<p>When you use this argument with an authenticated user, <code>Utils.getUserProperty</code>
		returns the internal ID (called the <i>profile ID</i>) for the user.
		This is an internal principal for the user, not known to the user,
		which is both unique to the user account and static over time. This is
		an ASCII string, but its exact format is internal and differs for HPP
		and &#64;HP users accounts.</p>

		<p>For an anonymous user, this is a non-null, non-blank, reserved
		ASCII string indicating the kind of default user profile that the user
		has been assigned. It should not be considered user-visible or unique.</p>

		<p><i>Returns type:</i> {@link java.lang.String}</p>
		<dt>{@link
		com.hp.it.spf.xa.misc.portal.Consts#KEY_SECURITY_LEVEL}</dt>
		<dd>
		<p>When you use this argument with an authenticated HP Passport
		user, it returns the user's HPP security level. This is an integer
		indicating the level of authentication stringency applied by HPP when
		validating the user's credentials. The lower the number, the lesser
		the security constraints imposed (eg password complexity, password
		expiry policy, etc).</p>
		<p>When you use this argument with an authenticated &#64;HP user,
		it returns the user's &#64;HP security level. This also is an integer,
		corresponding to the kind of login which the user used (SEA or
		DigitalBadge).</p>
		<p>For anonymous users and &#64;HP users, this returns null.</p>
		<p><i>Returns type:</i> {@link java.lang.Integer}</p>
		</dd>

		<dt>{@link com.hp.it.spf.xa.misc.portal.Consts#KEY_STATE}</dt>
		<dd>
		<p>When you use this argument with an authenticated user, it
		returns the "state or province" field from the postal address on
		record for the user. This is taken from the HP Passport business
		contact data, or the HP Enterprise Directory information for the user
		(depending on whether the user logged-in via HPP or the &#64;HP
		employee portal).</p>
		<p>For an anonymous user, this returns null.</p>
		<p><i>Returns type:</i> {@link java.lang.String}</p>
		</dd>

		<dt>{@link com.hp.it.spf.xa.misc.portal.Consts#KEY_STREET}</dt>
		<dd>
		<p>When you use this argument with an authenticated user, it
		returns the "street" field from the postal address on record for the
		user. This is taken from the HP Passport business contact data, or the
		HP Enterprise Directory information for the user (depending on whether
		the user logged-in via HPP or the &#64;HP employee portal).</p>
		<p>For an anonymous user, this returns null.</p>
		<p><i>Returns type:</i> {@link java.lang.String}</p>
		</dd>

		<dt>{@link com.hp.it.spf.xa.misc.portal.Consts#KEY_TIMEZONE}</dt>
		<dd>
		<p>When you use this argument with an authenticated user, it
		returns the timezone for the user, as taken from the HP Passport
		business contact data, or the HP Enterprise Directory information for
		the user (depending on whether the user logged-in via HPP or the
		&#64;HP employee portal).</p>
		<p>For an anonymous user, this is the timezone of record for the
		default profile the user has been assigned, based on their current
		resolved locale (see the discussion about <a
			href="#i18n.other.locale.get">getting the locale</a>, for how the
		locale is determined).</p>

		<blockquote>
		<p><b>Note:</b> This is just a reasonable default timezone for the
		locale, based primarily on the country in the locale (if any), and the
		language in the locale if the country is generic. For example, the
		Japan timezone is returned for any Japan-country locale, or any
		Japanese-language locale with an unrecognized (or generic) country.
		Many locales span multiple timezones, so the SPF just assigns one of
		them by default in that case. SPF defaults to GMT if it does not
		recognize the locale for this purpose. The mapping between locale and
		timezone returned by the SPF for an anonymous user is not published
		and may change over time.</p>
		</blockquote>

		<p><i>Returns type:</i> {@link java.lang.String} which is a valid
		{@link java.util.TimeZone} ID string from which you can build a <code>TimeZone</code>
		object</p>
		</dd>

		<dt>{@link com.hp.it.spf.xa.misc.portal.Consts#KEY_USER_NAME}</dt>
		<dd>
		<p>When you use this argument with an authenticated user, <code>Utils.getUserProperty</code>
		returns the ID which the user used to login to HP Passport (or, in the
		case of a user accessing SPF via &#64;HP, this is the HP SEA). This
		user ID is unique, but please note that it may change over time, since
		both HP Passport and HP ED allow it to change.</p>

		<p>For an anonymous user, this is a non-null, non-blank, reserved
		ASCII string indicating the kind of default user profile that the user
		has been assigned. It should not be considered user-visible or unique.</p>

		<p><i>Returns type:</i> {@link java.lang.String}</p>
		</dd>

		<dt>{@link com.hp.it.spf.xa.misc.portal.Consts#KEY_ZIP}</dt>
		<dd>
		<p>When you use this argument with an authenticated user, it
		returns the "postal code" field from the postal address on record for
		the user. This is taken from the HP Passport business contact data, or
		the HP Enterprise Directory information for the user (depending on
		whether the user logged-in via HPP or the &#64;HP employee portal).</p>
		<p>For an anonymous user, this is a null or blank string.</p>
		<p><i>Returns type:</i> {@link java.lang.String}</p>
		</dd>

	</dl>
</ul>
<blockquote>
<p><b>Note:</b> The above are just the core properties. The extended
properties include other business contact and home contact data elements
from HP Passport, as well as custom properties from Persona or UPS.
Their property names are not defined here. SPF will relay them through
if they are encountered, however, and you can access them by passing the
string literal property name to the same <code>Utils.getUserProperty</code>
API. All are returned as type {@link java.lang.String}.</p>
</blockquote>

<p>For example, here is how we can use <code>Utils.getUserProperty</code>,
along with the <a href="#overview.other.spf.common">SPF common
utilities</a> {@link
com.hp.it.spf.xa.i18n.portal.I18nUtility#getUserDisplayName(String,String,Locale)}
method, to get the full name for the user (in customary order of given
and family name). In this example, <code>context</code> is the Vignette
<code>PortalContext</code> object:</p>

<blockquote><pre>
import com.hp.it.spf.xa.i18n.portal.I18nUtility;
import com.hp.it.spf.xa.misc.portal.Utils;
import com.hp.it.spf.xa.misc.portal.Consts;
...
String fn = (String) Utils.getUserProperty(request, Consts.KEY_FIRST_NAME);
String ln = (String) Utils.getUserProperty(request, Consts.KEY_LAST_NAME);
String fullName = I18nUtility.getUserDisplayName(fn, ln, request.getLocale());
...
// Tip: if you are going to display this fullName in the UI, you should also
// escape it in case for some reason there are HTML metacharacters in it (eg
// an XSS attack):
String escapedFullName = Utils.escapeXml(fullName);
</pre></blockquote>

<a name="portal.user.groups">
<h4>5.2.3. Accessing user groups (<code>Utils.getGroups</code>, <code>Utils.isUserInGroup</code>)</h4>
</a>

<p>Use these methods to access and test the user's security groups
(see <b>Background</b> below for more information about groups). These
methods work for anonymous as well as authenticated users.</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.misc.portal.Utils#getGroups(PortalContext)}</dt>
	<dd>
	<p>Use this method to obtain an array of names of the security
	groups to which the user belongs. The method takes the current Vignette
	<code>PortalContext</code> object for the user. For example (where <code>context</code>
	is the current <code>PortalContext</code> object):</p>

	<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
String[] groups = Utils.getGroups(request);
</pre></blockquote>
	</dd>

	<dt>{@link
	com.hp.it.spf.xa.misc.portal.Utils#isUserInGroup(PortalContext,String)}</dt>
	<dd>
	<p>Use this method to check whether the the user belongs to a
	certain security group. The method takes the current Vignette <code>PortalContext</code>
	object for the user, as well as a name (string) for the group to check.
	For example, to check if the user is in the <code>ABC</code> group (and
	where <code>context</code> is the current <code>PortalContext</code>
	object):</p>

	<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
if (Utils.isUserInGroup(request, "ABC")) {
    // user is in the group
    ...
} else {
    // user is not in the group
    ...
}
</pre></blockquote>
	</dd>
</dl>

<p>Please see the method documentation for more information.</p>

<p><b>Background:</b> The SPF has 2 related concepts for
authorization: groups (visible to both portal components and portlets)
and roles (visible to portlets only). Groups are portal-level constructs
and are not JSR portlet standard; roles are portlet-level constructs
which are JSR-standard. The SPF portal both forwards the user's groups
as part of the {@link javax.portlet.PortletRequest}, and maps the groups
into roles which are likewise part of the <code>PortletRequest</code>.
The group-to-role mapping is specified when provisioning the portlet
inside the portal. In SPF, groups themselves are generally mapped from
other characteristics, either in the portal itself, or in UGS. Both
groups and roles can exist apart from authentication; ie anonymous users
can still be in groups/roles. This SPF authorization design is
documented elsewhere.</p>

<p>The actual groups will vary by application and over time. The SPF
core framework defines the following groups, but applications will add
to them.</p>

<dl>
	<dt>
	<p><b><u>Authentication Type Groups:</u></b></p>
	</dt>
	<dd>
	<p><b>Note:</b> Only authenticated users are members of these
	groups. Anonymous users will not be members of these groups until they
	login.</p>
	<dl>
		<dt><code>{@link
		com.hp.it.spf.xa.misc.portal.Consts#GROUP_AUTH_TYPE_ATHP}</code></dt>
		<dd>
		<p>Indicates the user is a member of the &#64;HP employee portal,
		not HP Passport. This group indicates the user is accessing via the HP
		Intranet and the &#64;HP authentication system.</p>
		</dd>

		<dt><code>{@link
		com.hp.it.spf.xa.misc.portal.Consts#GROUP_AUTH_TYPE_HPP}</code></dt>
		<dd>
		<p>Indicates the user is a member of <i>standard</i> (not
		federated) HP Passport. This group indicates the user is accessing
		through the public (ie HPP) authentication system, but the current
		portal site, and the HPP policies, have not been enabled for
		user-identity federation with a 3rd-party identity provider. (User
		identity federation is not used with most SPF-based portal sites at
		this time. You can read a little more about it below, in the section
		about <a href="#portal.request.fed">site federation status.</a>)</p>
		</dd>

		<dt><code>{@link
		com.hp.it.spf.xa.misc.portal.Consts#GROUP_AUTH_TYPE_FED}</code></dt>
		<dd>
		<p><i>This group is uncommon in most SPF portal applications.</i>
		It indicates the user is a member of <i>federated</i> (not standard)
		HP Passport. This group indicates the user is accessing through the
		public (ie HPP) authentication system, which has been setup (along
		with the portal site) for user-identity federation with a 3rd-party
		identity provider. (User identity federation is not used with most
		SPF-based portal sites at this time. You can read a little more about
		it below, in the section about <a href="#portal.request.fed">site
		federation status.</a>)</p>
		</dd>
	</dl>
	</dd>
	<dt>
	<p><b><u>Authentication Status Groups:</u></b></p>
	</dt>
	<dd>
	<dl>
		<dt><code>{@link
		com.hp.it.spf.xa.misc.portal.Consts#GROUP_AUTH_STATUS_AUTHENTICATED}</code></dt>
		<dd>
		<p>Indicates the user is currently logged-in (whether via HP
		Passport or HP Enterprise Directory is not indicated; check the
		access-type groups).</p>
		</dd>

		<dt><code>{@link
		com.hp.it.spf.xa.misc.portal.Consts#GROUP_AUTH_STATUS_ANONYMOUS}</code></dt>
		<dd>
		<p>Indicates the user is currently <b>not</b> logged-in (whether
		via HP Passport or HP Enterprise Directory is not indicated; check the
		access-type groups).</p>
		</dd>
	</dl>
	<p><b>Note:</b> These groups are mutually-exclusive. They will
	present consistently with the results of the <a
		href="#portal.user.loginStatus"><code>Utils.isAuthenticatedUser</code>
	method</a> (see above). That is, when <code>Utils.isAuthenticatedUser</code>
	returns true, the user will also be a member of the <code>{@link
	com.hp.it.spf.xa.misc.portal.Consts#GROUP_AUTH_STATUS_AUTHENTICATED}</code>
	group; and vice-versa.</p>
	</dd>
	<dt>
	<p><b><u>Locale Groups:</u></b></p>
	</dt>
	<dd>
	<p><b>Note:</b> All SPF users (whether authenticated or anonymous)
	are automatically assigned by the SPF into their appropriate locale
	groups.</p>
	<dl>
		<dt><code>{@link
		com.hp.it.spf.xa.misc.portal.Consts#GROUP_LOCALE_COUNTRY_PREFIX} + "<i>&lt;country-code&gt;</i>"</code></dt>
		<dd>
		<p>Indicates the user should be considered a member of the group
		for the particular country. This is based on the locale resolved for
		the user (ie, this is the locale returned by <a
			href="#i18n.other.locale.get"><code>I18nUtility.getLocale</code></a>).
		The <code><i>&lt;country-code&gt;</i></code> is the uppercase <a
			href="http://www.iso.org/iso/country_codes/iso_3166_code_lists/english_country_names_and_code_elements.htm">ISO
		3166-1</a> country code. Note that this may, or may not, be the same
		country as the user's registered country in SiteMinder (eg, the <code>residentCountryCode</code>
		attribute of the core HPP profile).</p>
		<p>For example, <code>Consts.GROUP_LOCALE_COUNTRY_PREFIX +
		"BR"</code> for a user with any Brazil locale; <code>Consts.GROUP_LOCALE_COUNTRY_PREFIX
		+ "GB"</code> for a user with any United Kingdom locale; etc.</p>
		<blockquote>
		<p><b>Note:</b> When the user's resolved locale does not include a
		country (ie a generic locale like French), the user will not be
		assigned into any such group.</p>
		</blockquote>
		</dd>

		<dt><code>{@link
		com.hp.it.spf.xa.misc.portal.Consts#GROUP_LOCALE_LANGUAGE_PREFIX} + "<i>&lt;language-code&gt;</i>"</code></dt>
		<dd>
		<p>Indicates the user should be considered a member of the group
		for the particular language. This is based on the locale resolved for
		the user (ie this is the locale returned by <a
			href="#i18n.other.locale.get"><code>I18nUtility.getLocale</code></a>).
		The <code><i>&lt;language-code&gt;</i></code> is the uppercase <a
			href="http://www.loc.gov/standards/iso639-2/php/English_list.php">ISO
		639-1</a> language code. Note that this may, or may not, be the same
		language as the user's registered language in SiteMinder (eg, the <code>langCode</code>
		attribute of the core HPP profile).</p>
		<p>For example, <code>Consts.GROUP_LOCALE_LANGUAGE_PREFIX +
		"ZH"</code> for a user with any Chinese-language locale; <code>Consts.GROUP_LOCALE_LANGUAGE_PREFIX
		+ "RU"</code> for a user with any Russian-language locale; etc.</p>
		</dd>
	</dl>
	</dd>
</dl>

<hr>

<a name="portal.request.get">
<h3>5.3. Accessing portal request data</h3>
</a>

<p>The native Vignette API's (documented in the <a
	href="#overview.other.vignette.devguide">Vignette Portal
Developer's Guide</a>) are usually adequate for accessing portal request
data, including the current portal site, secondary page or style,
navigation item, etc. Most of those operations start off with the
Vignette <code>PortalContext</code> object, with which Vignette provides
your portal component. However the SPF-provided {@link
com.hp.it.spf.xa.misc.portal.Utils} class provides the following helpful
supplemental methods.</p>

<blockquote>
<p><b>Note:</b> Many of the following operations take the current <code>HttpServletRequest</code>.
Remember that you can get your current <code>HttpServletRequest</code>
from the Vignette <code>PortalContext</code>, using either <code>PortalContext.getHttpServletRequest()</code>
or <code>PortalContext.getPortalRequest().getRequest()</code>.</p>
</blockquote>

<a name="portal.request.site.current">
<h4>5.3.1. Accessing information about the current portal site (<code>Utils.getSiteDNS</code>,
<code>Utils.getSiteURL</code>)</h4>
</a>

<blockquote>
<p><b>Note:</b> If you are a developer of the SPF framework, working
on code that may execute under the core <code>spf</code> portal site,
please see the next section about <a
	href="#portal.request.site.effective">getting the effective site</a>
instead.</p>
</blockquote>

<ul>
	<li>
	<p>To get the current Vignette <code>Site</code> object, use
	standard Vignette API's like <code>PortalContext.getCurrentSite()</code>.</p>
	</li>
	<li>
	<p>To get the current site name (ie what Vignette calls the "site
	DNS name") you can always use standard Vignette API's like <code>PortalContext.getCurrentSite().getDNSName()</code>.
	These APIs obtain the site name from the Vignette database. If you want
	to get the site name from the current URL instead (where, by Vignette
	convention, the site name is contained in the URL path after <code>/portal/site/</code>),
	use {@link
	com.hp.it.spf.xa.misc.portal.Utils#getSiteDNS(HttpServletRequest)}. For
	example (where <code>context</code> is the <code>PortalContext</code>
	object):</p>

	<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
String siteName = Utils.getSiteDNS(context.getHttpServletRequest());
</pre></blockquote>
	</p>
	</li>
	<li>
	<p>To get server-relative URI/URL information about the current
	portal site, you can use standard Vignette API's like <code>PortalContext.getCurrentBasePortalURI()</code>.
	However, if you need to build a full URL for an arbitrary page in the
	current portal site (or another portal site under the same Vignette
	server), including the scheme, host, port and site-relative "friendly
	URI" for the page, the various <code>Utils.getSiteURL</code> methods
	will be handy:</p>

	<blockquote>
	<p><b>Note:</b> The SPF portal utilities do not provide a way to
	build a URL which includes portlet information. Use the <code>PortalURL</code>
	family of classes and interfaces in the <a
		href="#overview.other.spf.common">SPF common utilities</a> to do that.
	</p>
	</blockquote>

	<dl>
		<dt>{@link
		com.hp.it.spf.xa.misc.portal.Utils#getSiteURL(HttpServletRequest)}</dt>
		<dd>
		<p>Pass the current <code>HttpServletRequest</code> to this
		method, and it will return the full URL for the home page of the
		current portal site. This includes the same scheme (HTTP or HTTPS),
		hostname and port used in the current request. For example, when a
		request to the <code>my_site</code> portal site used HTTP (port 80) at
		<code>my_server.hp.com</code>, the following code would return <code>http://my_server.hp.com/portal/site/my_site/</code>:</p>
		<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
String siteUrl = Utils.getSiteURL(context.getHttpServletRequest());
	</pre></blockquote>
		</dd>

		<dt>{@link
		com.hp.it.spf.xa.misc.portal.Utils#getSiteURL(HttpServletRequest,String)}</dt>
		<dd>
		<p>Use this method to get a full URL for an arbitrary page at the
		current portal site (or another portal site under the same Vignette
		server). This includes the same scheme (HTTP or HTTPS), hostname and
		port used in the current request. The string parameter is a
		site-relative URI (eg navigation item friendly URI) for the desired
		page. If it starts with <code>/</code> it is assumed to be relative to
		the current portal site (the same one used in the current request). If
		not, then the friendly URI is assumed to start with the desired site
		name.</p>
		<p>For example, when a request to the <code>my_site</code> portal
		site used HTTPS (at non-standard port 444) at <code>my_server.hp.com</code>,
		the following code would return <code>https://my_server.hp.com:444/portal/site/my_site/some/page</code>:</p>
		<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
String siteUrl = Utils.getSiteURL(context.getHttpServletRequest(), "/some/page");
	</pre></blockquote>
		<p>The following code would return the same URL, but for the <code>other_site</code>
		portal site instead (<code>https://my_server.hp.com:444/portal/site/other_site/some/page</code>):</p>
		<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
String siteUrl = Utils.getSiteURL(context.getHttpServletRequest(), "other_site/some/page");
	</pre></blockquote>
		<p>Note that your given URI may include a query string - this
		would return <code>https://my_server.hp.com:444/portal/site/other_site/some/page?key=value</code>:</p>
		<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
String siteUrl = Utils.getSiteURL(context.getHttpServletRequest(), "other_site/some/page?key=value");
	</pre></blockquote>
		</dd>
		<dt>{@link
		com.hp.it.spf.xa.misc.portal.Utils#getSiteURL(HttpServletRequest,Boolean,String,int,String)}</dt>
		<dd>
		<p>This is like the previous method, except the additional
		parameters let you build a URL containing a hostname, scheme and/or
		port different than what was used in the current request. The {@link
		java.lang.Boolean} parameter indicates whether to put HTTP or HTTPS
		into the URL (<code>true</code> means HTTPS; the default is HTTP). The
		extra string parameter is the hostname to put into the URL (if blank
		or null, the default is the one used in the current request). And the
		integer parameter is the port number (if zero or negative, the default
		is the one used in the current request - in any case, if the port is
		the standard port for the scheme, it is omitted from the returned
		URL).</p>
		<p>For example, the following returns a URL for the current portal
		site home page, forcing it to use HTTPS even if that is not what was
		used in the current request:</p>
		<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
String siteUrl = Utils.getSiteURL(context.getHttpServletRequest(), new Boolean(true), 
                                  null, -1, null);
	</pre></blockquote>
		<p>As another example, the following returns a URL for <code>/some/page</code>
		at some <code>other_site</code> portal site on some <code>other_server.hp.com</code>
		host. The scheme in this example is forced to HTTP (at non-standard
		port 8080), resulting in a URL like this: <code>http://other_server.hp.com:8080/portal/site/other_site/some/page</code></p>
		<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
String siteUrl = Utils.getSiteURL(context.getHttpServletRequest(), new Boolean(false),
                                  "other_server.hp.com", 8080, "other_site/some/page");
	</pre></blockquote>
		<p>The given URI may include a query string, as with the {@link
		com.hp.it.spf.xa.misc.portal.Utils#getSiteURL(HttpServletRequest,String)}
		method (see above).</p>
		</dd>
	</dl>
	</li>
</ul>

<p>Please see the method documentation for more information.</p>

<a name="portal.request.site.effective">
<h4>5.3.2. Accessing information about the effective portal site (<code>Utils.getEffectiveSite</code>,
<code>Utils.getEffectiveSiteDNS</code>, <code>Utils.getEffectiveSiteURL</code>)</h4>
</a>

<blockquote>
<p><b>Note:</b> Generally, this section is only of interest to
developers of the SPF framework, working on code that may execute under
the core <code>spf</code> portal site.</p>
</blockquote>

<p>Shared Portal Framework includes a portal site, with "DNS name" <code>spf</code>,
which is responsible for performing a number of core functionalities. If
you will be developing SPF portal artifacts which may execute within the
context of the <code>spf</code> portal site, you may sometimes need to
get the <i>effective site</i> instead of the current site. The effective
site is the portal site on whose behalf the <code>spf</code> site is
doing certain processing. The "DNS name" of the effective site is passed
in a query string on the <code>spf</code> portal site URL; the name of
the query parameter is given by the {@link
com.hp.it.spf.xa.misc.portal.Consts#PARAM_EFFECTIVE_SITE} constant (<code>spfSite</code>
at this time of writing).</p>

<p>For example, logout handling: since SiteMinder can register only
one logout URL for any server, multiple portal sites in the same server
which need to use the local logout URL must all share the same one. So
the SPF logout secondary page under the <code>spf</code> portal site is
registered with SiteMinder as the local logout URL, and other portal
sites which need to use local logout (instead of linking to logout on
HPP or @HP, for various reasons) can link to it and identify themselves
as the "effective" site within the link: eg <code>http://my_server.hp.com/portal/site/spf/template.SPF_LOGOUT/?spfSite=my_site</code></p>

<p>Note that by default (eg when no valid effective site is present
in the URL, or when the current portal site is not <code>spf</code>) the
effective site is considered to be the current site. The following
methods revert to the current site in that case.</p>

<ul>
	<li>
	<p>To get the effective site, use {@link
	com.hp.it.spf.xa.misc.portal.Utils#getEffectiveSite(HttpServletRequest)}.
	This returns the Vignette <code>Site</code> object for the effective
	site (ie the one whose "DNS name" is listed in the <code>spfSite</code>
	query string on the current <code>spf</code> portal site URL). If the
	current request has no valid <code>spfSite</code> query string, or is
	not targeted at the <code>spf</code> portal site, the method returns
	just the Vignette <code>Site</code> object for the current site.</p>
	<p>For example (where <code>context</code> is the current Vignette
	<code>PortalContext</code> object):</p>
	<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
import com.epicentric.site.Site;
...
Site effectiveSite = Utils.getEffectiveSite(context.getHttpServletRequest());
	</pre></blockquote>
	</li>
	<li>
	<p>To get the site name (ie what Vignette calls the "DNS name") for
	the effective site, you can use {@link
	com.hp.it.spf.xa.misc.portal.Utils#getEffectiveSiteDNS(HttpServletRequest)}.
	When the current request has no valid <code>spfSite</code> query
	string, or is not targeted at the <code>spf</code> portal site, the
	method just returns the current site name (ie same as {@link
	com.hp.it.spf.xa.misc.portal.Utils#getSiteDNS(HttpServletRequest)}).
	For example (where <code>context</code> is the <code>PortalContext</code>
	object):</p>

	<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
String effectiveSiteName = Utils.getEffectiveSiteDNS(context.getHttpServletRequest());
</pre></blockquote>
	</li>
	<li>
	<p>To get full URL's for an arbitrary page in the current portal
	site (or another portal site under the same Vignette server), including
	the scheme, host, port and site-relative "friendly URI" for the page,
	use one of the <code>Utils.getEffectiveSiteURL</code> methods.</p>
	<blockquote>
	<p><b>Note:</b> The SPF portal utilities do not provide a way to
	build a URL which includes portlet information. Use the <code>PortalURL</code>
	family of classes and interfaces in the <a
		href="#overview.other.spf.common">SPF common utilities</a> to do that.
	</p>
	</blockquote>
	<dl>
		<dt>{@link
		com.hp.it.spf.xa.misc.portal.Utils#getEffectiveSiteURL(HttpServletRequest)}</dt>
		<dd>
		<p>Pass the current <code>HttpServletRequest</code> to this
		method, and it will return the full URL for the home page of the
		effective portal site. This includes the same scheme (HTTP or HTTPS),
		hostname and port used in the current request. If no valid effective
		site has been indicated in the <code>spfSite</code> query string, or
		the current request is not targeted at the <code>spf</code> site, then
		this method assumes the current site and behaves the same as {@link
		com.hp.it.spf.xa.misc.portal.Utils#getSiteURL(HttpServletRequest)}.</p>
		<p>For example, when a request to the <code>spf</code> portal site
		used HTTP (port 80) at <code>my_server.hp.com</code>, and included <code>spfSite=my_site</code>
		in the query string, the following code would return <code>http://my_server.hp.com/portal/site/my_site/</code>:</p>
		<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
String effectiveSiteUrl = Utils.getEffectiveSiteURL(context.getHttpServletRequest());
	</pre></blockquote>
		</dd>
		<dt>{@link
		com.hp.it.spf.xa.misc.portal.Utils#getEffectiveSiteURL(HttpServletRequest,String)}</dt>
		<dd>
		<p>Use this method to get a full URL for an arbitrary page at the
		effective portal site (or another portal site under the same Vignette
		server). This includes the same scheme (HTTP or HTTPS), hostname and
		port used in the current request. The string parameter is a
		site-relative URI (eg navigation item friendly URI) for the desired
		page. If it starts with <code>/</code> it is assumed to be relative to
		the effective portal site. If not, then the friendly URI is assumed to
		start with the desired site name. If no valid effective site has been
		indicated in the <code>spfSite</code> query string, or the current
		request is not targeted at the <code>spf</code> site, then this method
		assumes the current site and behaves the same as {@link
		com.hp.it.spf.xa.misc.portal.Utils#getSiteURL(HttpServletRequest,String)}.</p>
		<p>For example, when a request to the <code>spf</code> portal site
		used HTTPS (at non-standard port 444) at <code>my_server.hp.com</code>,
		and referred to <code>spfSite=my_site</code> in the query string, the
		following code would return <code>https://my_server.hp.com:444/portal/site/my_site/some/page</code>:</p>
		<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
String effectiveSiteUrl = Utils.getEffectiveSiteURL(context.getHttpServletRequest(),
                                                    "/some/page");
	</pre></blockquote>
		<p>The following code would return the same URL, but for the <code>other_site</code>
		portal site instead (<code>https://my_server.hp.com:444/portal/site/other_site/some/page</code>):</p>
		<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
String effectiveSiteUrl = Utils.getEffectiveSiteURL(context.getHttpServletRequest(),
                                                    "other_site/some/page");
	</pre></blockquote>
		<p>Note that your given URI may include a query string - this
		would return <code>https://my_server.hp.com:444/portal/site/other_site/some/page?key=value</code>:</p>
		<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
String effectiveSiteUrl = Utils.getEffectiveSiteURL(context.getHttpServletRequest(),
                                                    "other_site/some/page?key=value");
	</pre></blockquote>
		</dd>
		<dt>{@link
		com.hp.it.spf.xa.misc.portal.Utils#getEffectiveSiteURL(HttpServletRequest,Boolean,String,int,String)}</dt>
		<dd>
		<p>This is like the previous method, except the additional
		parameters let you build a URL containing a hostname, scheme and/or
		port different than what was used in the current request. The {@link
		java.lang.Boolean} parameter indicates whether to put HTTP or HTTPS
		into the URL (<code>true</code> means HTTPS; the default is HTTP). The
		extra string parameter is the hostname to put into the URL (if blank
		or null, the default is the one used in the current request). And the
		integer parameter is the port number (if zero or negative, the default
		is the one used in the current request - in any case, if the port is
		the standard port for the scheme, it is omitted from the returned
		URL).</p>
		<p>For example, the following returns a URL for the effective
		portal site home page, forcing it to use HTTPS even if that is not
		what was used in the current request:</p>
		<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
String effectiveSiteUrl = Utils.getEffectiveSiteURL(context.getHttpServletRequest(),
                                                    new Boolean(true), null, -1, null);
	</pre></blockquote>
		<p>As another example, the following returns a URL for <code>/some/page</code>
		at some <code>other_site</code> portal site on some <code>other_server.hp.com</code>
		host. The scheme in this example is forced to HTTP (at non-standard
		port 8080), resulting in a URL like this: <code>http://other_server.hp.com:8080/portal/site/other_site/some/page</code></p>
		<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
String effectiveSiteUrl = Utils.getEffectiveSiteURL(context.getHttpServletRequest(),
                                                    new Boolean(false), "other_server.hp.com",
                                                    8080, "other_site/some/page");
	</pre></blockquote>
		<p>The given URI may include a query string, as with the {@link
		com.hp.it.spf.xa.misc.portal.Utils#getEffectiveSiteURL(HttpServletRequest,String)}
		method (see above).</p>
		</dd>
	</dl>
	</li>
</ul>

<a name="portal.request.url">
<h4>5.3.3. Accessing the portal request URL (<code>Utils.getRequestURL</code>)</h4>
</a>

<p>You can reconstruct the original URL for the current request
using the {@link
com.hp.it.spf.xa.misc.portal.Utils#getRequestURL(HttpServletRequest)}
method. Just pass the current <code>HttpServletRequest</code> object:</p>

<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
String requestURL = Utils.getRequestURL(context.getHttpServletRequest());
</pre></blockquote>

<p>You can also get the original request URL with a modified scheme
(HTTP or HTTPS), hostname and/or port. Use the {@link
com.hp.it.spf.xa.misc.portal.Utils#getRequestURL(HttpServletRequest,Boolean,String,int)}
method. The {@link java.lang.Boolean} parameter indicates whether to put
HTTP or HTTPS into the URL (<code>true</code> means HTTPS; the default
is HTTP). The string parameter is the hostname to put into the URL (if
blank or null, the default is the one used in the current request). And
the integer parameter is the port number (if zero or negative, the
default is the one used in the current request - in any case, if the
port is the standard port for the scheme, it is omitted from the
returned URL).</p>
<p>For example, this gets an HTTPS version of the original URL for
the current request:</p>
<blockquote><pre>
import com.hp.it.spf.xa.misc.portal.Utils;
...
String requestURL = Utils.getRequestURL(context.getHttpServletRequest(), 
                                        new Boolean(true), null, -1);
</pre></blockquote>

<blockquote>
<p><b>Note:</b> Both of the above methods build a query string
containing all of the request parameters (properly URL-encoded) that
were present in the current request. With a GET request, this is
basically a copy of the original query string (though the parameters may
be in a different order). With a POST request, this is a query string
built out of the form parameters that were in the current request body.
</p>
</blockquote>

<a name="portal.request.fed">
<h4>5.3.4. Accessing site federation status (<code>Utils.isFederatedSite</code>)</h4>
</a>

<blockquote>
<p><b>Note:</b> This section is only relevant to portal sites
dealing in user identity federation. This is uncommon at this time; most
portal site developers can ignore this section.</p>
</blockquote>

<p>Shared Portal Framework supports <i>user identity federation</i>
("federation" for short) with HP Passport. Normally HP Passport is the
user identity provider - the master repository for the user identity, at
which the user registers, logs-in, logs-out, etc. With federation,
though, HPP defers the role of user identity provider to a 3rd party.
The 3rd-party system provides the master repository for the user
identity, as well as typical end-user-facing identity services around
that, like registration, login, and logout. Then through a secure
industry-standard protocol like SAML (Security Assertion Markup
Language) HPP synchronizes with the 3rd-party identity provider,
replicating the user attributes into HPP and automatically booting an
HPP SiteMinder session off them. The end result is that the user has
single-signon from their identity provider to HPP, and, consequently,
single-signon to any HPP-integrated systems like portal sites based on
Shared Portal Framework.</p>

<p>A full discussion of federation is beyond the scope of this
document. And federation is not commonly used with SPF at this time.
However the framework does support it, strictly on a site-by-site basis;
meaning that in SPF any given portal site can use HPP on a standard,
non-federated basis (the usual <i>modus operandi</i>); or on a federated
basis (but not both). If you are writing portal components that need to
run in both federated and non-federated portal sites, therefore it can
sometimes be useful (even necessary) to know whether the current portal
site is federated or not. This is where the <code>Utils.isFederatedSite</code>
methods are helpful.</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.misc.portal.Utils#isFederatedSite(HttpServletRequest)}</dt>
	<dd>
	<p>Pass the current <code>HttpServletRequest</code> object to this
	method, and it will return <code>true</code> if the current portal site
	is known by SPF to be a federated site, and <code>false</code>
	otherwise.</p>
	<blockquote>
	<p><b>Note:</b> There is a close relationship between this method
	and the <b>access type groups</b> discussed earlier, in the section
	about <a href="#portal.user.groups">user groups</a>. When <code>isFederatedSite(HttpServletRequest)</code>
	returns true, the user will always be a member of the federation group
	(named by {@link
	com.hp.it.spf.xa.misc.portal.Consts#GROUP_AUTH_TYPE_FED}). And when it
	returns false, the user will always be a member of the standard HPP
	group or @HP group.</p>
	</blockquote>
	</dd>
	<dt>{@link
	com.hp.it.spf.xa.misc.portal.Utils#isFederatedSite(String)}</dt>
	<dd>
	<p>Pass any Vignette "site DNS name" to this method, and it will do
	likewise.</p>
	</dd>
</dl>

<p><b>Note:</b> Ultimately whether a site is actually federated or
not depends on how it has been integrated with HP Passport. There are
many steps involved, but almost all of them are on the HPP side, and
beyond the scope of this document. In the SPF portal (Vignette)
environment, the only step is to declare the site to be federated in the
<code>site_federation.properties</code> file. This step informs the SPF
portal runtime that federation is used with that site. It is this
declaration which the above predicates simply report; SPF otherwise has
no direct knowledge of whether the site has been setup for federation in
HPP.</p>

<p>The <code>site_federation.properties</code> file is a
configuration file on each Vignette portal machine, stored in a
directory on the portal classpath - typically the <i>global
resources</i> directory, <code>/opt/sasuapps/sp/global_resources</code>
(though in a sandbox, it may be in a different location). The format of
the file is very simple:</p>
<blockquote><pre>
<i>&lt;site-name&gt;</i> = yes
</pre></blockquote>
<p>where the <code><i>&lt;site-name&gt;</i></code> is the Vignette
"site DNS name" for your portal site (this is the string which appears
in your portal site URL, <code>http://.../portal/site/<i>&lt;site-name&gt;</i></code>).</p>
<p>For example, the following declares the <code>example</code>
portal site to be a federated site:</p>
<blockquote><pre>
example = yes
</pre></blockquote>
<p>Changes to the file, once saved, take effect within 15 minutes,
or upon a portal server restart (whichever comes first).</p>
<blockquote>
<p><b>Note:</b> Outside of the sandbox environment, only authorized
SPF server administrators have access to <code>site_federation.properties</code>.
You may need to make a request to the SPF support team to setup <code>site_federation.properties</code>
for you.</p>
</blockquote>

<hr>

<a name="error">
<h2>6. Error Handling</h2>
</a>

<p>For error handling in your portal components, you will generally
rely on the core technologies provided by Vignette Portal and J2EE/Java.
However the Shared Portal Framework does provide some extensions to
assist with your error handling. This chapter describes those
extensions.</p>

<hr>

<a name="error.system">
<h3>6.1. Handling system errors</code></h3>
</a>

<p><i>System errors</i> are unrecoverable error conditions in
framework or application business logic, which in normal use should
never happen, and for which the only recourse in the user interface is
to display a service-unavailable error. Shared Portal Framework provides
a secondary page for rendering system errors (<code>spf-system-error-secondarypage</code>)
and also provides a utility for transfering control to that secondary
page when needed (<code>ExceptionUtil.redirectSystemErrorPage</code>).</p>

<a name="error.system.page">
<h4>6.1.1. The system error page (<code>spf-system-error-secondarypage</code>)</h4>
</a>

<p>Shared Portal Framework comes with a general-purpose system error
page, to which you can transfer control whenever an unrecoverable
internal error is encountered. (The Vignette portal and SPF themselves
will vector into this page if they encounter internal system errors.)
The page is one of the SPF provided portal components: a secondary page
named <b>Shared Portal Framework - System Error Page</b> (component ID:
<code>spf-system-error-secondarypage</code>), which is an instance of
the Vignette-standard <b>Error Page</b> secondary page type.</p>

<p>As an instance of <b>Error Page</b>, when you configure your
portal site (in Vignette Site Console) you can select <b>Shared
Portal Framework - System Error Page</b> for that secondary page type. Then
whenever a system error occurs in Vignette Portal, or in the SPF
extensions to Vignette, or whenever you <a href="#error.system.redirect">redirect
to the system error page</a> yourself (ie from your portal component), that
<code>spf-system-error-secondarypage</code> will be the one which
renders.</p>

<p>The SPF system error secondary page is part of the SPF portal
components, provided by the SPF team in every SPF environment (including
sandboxes). To configure Vignette to use the SPF system error secondary
page:</p>

<ol>
	<li>
	<p>The SPF system error secondary page must have been configured as
	the default secondary page to use for the Vignette-standard system
	error secondary page type. In the Vignette server console, go to <b>Server
	Settings &gt; Server Defaults &gt; Site &amp; Appearance &gt; Default
	Secondary Pages</b>, and for the <b>Error Page</b> secondary page type,
	choose <b>Shared Portal Framework - System Error Page</b>. (In most
	cases, this will already have been done for you during SPF server
	setup.)</p>
	</li>
	<li>
	<p>The SPF system error secondary page must have been shared to
	your portal site. In the Vignette server console, go to <b>Components
	&gt; Pages &gt; Secondary Page List</b>, checkmark the <b>Shared Portal
	Framework - System Error Page</b>, and <b>Share to...</b>. This should
	already have been done for you when your portal site was first setup.
	(It should not be necessary to share the secondary page type to your
	site, just the secondary page.)</p>
	</li>
	<li>
	<p>Finally, in your portal site, you must apply your site's grid
	and theme to the secondary page, and again make sure that the secondary
	page is configured to be used for that secondary page type. In the
	Vignette site console for your site, go to <b>Site Settings &gt;
	Appearance &gt; Secondary Pages</b> to do this.</p>
	</li>
	<li>
	<p>Done - no further configuration or customization is needed.</p>
	</li>
</ol>

<p>The SPF system error secondary page comes with its own default
error messaging, including localizations for all HP.com standard
locales. It looks like this, in English.</p>

<blockquote>
<p><b>Note:</b> This illustration is taken from the HP Support
Center, an SPF-based portal site, so its header and footer are specific
to the HPSC. These are marked below in <font color="red">red</font>;
your header and footer will vary depending on what grid and theme you
applied (above) to the secondary page. The secondary page content itself
is marked below as well in <font color="red">red</font>; this is the
default content, which you can override if desired when <a
	href="#error.system.redirect">redirecting to the system error page</a>.</p>
</blockquote>

<img
	src="com/hp/it/spf/xa/exception/portal/doc-files/spfSystemErrorSecondaryPage.jpg">

<p>The Vignette-standard template friendly ID for a system error
page, <code>template.ERROR</code>, invokes the SPF system error
secondary page once it has been configured against your portal site. In
other words, once configured against your portal site as above, you can
deliberately invoke the page with the URL <code>http://.../portal/site/<i>&lt;your-site&gt;</i>/template.ERROR</code>.
(Vignette and the Shared Portal Framework will automatically redirect to
that URL when encountering system error conditions of their own). For a
convenient utility method letting you redirect to the system error page,
and optionally override the default error content of the page, see <a
	href="#error.system.redirect">below</a>.</p>

<a name="error.system.redirect">
<h4>6.1.2. Redirecting to the system error page (<code>ExceptionUtil.redirectSystemErrorPage</code>)</h4>
</a>

<p>{@link com.hp.it.spf.xa.exception.portal.ExceptionUtil} is a
utility class providing commonly-used error-handling routines. The <code>ExceptionUtil.redirectSystemErrorPage</code>
methods let you transfer control from an <i>action class</i> in your
portal component to the SPF system error secondary page discussed <a
	href="#error.system.page">above</a>.</p>

<blockquote>
<p><b>Note:</b> The <code>ExceptionUtil.redirectSystemErrorPage</code>
methods do not themselves actually transfer control to the SPF system
error secondary page. Rather they make a redirect object (a Vignette <code>PortalURI</code>
representing an external redirect) and return it to you. It is then up
to you to act on that. In an action class' main <code>execute</code>
method, this is done by simply returning the <code>PortalURI</code>.
(This is the standard way in the Vignette programming model to generate
a redirect: by creating a <code>PortalURI</code> for the redirect and
returning it from your action class' <code>execute</code> method. So <code>ExceptionUtil.redirectSystemErrorPage</code>
will build the <code>PortalURI</code> for you, but then it is up to you
to return it.)</p>
</blockquote>

<p>The following methods are available:</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.exception.portal.ExceptionUtil#redirectSystemErrorPage(PortalContext,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.exception.portal.ExceptionUtil#redirectSystemErrorPage(PortalContext,String,String,String)}</dt>
</dl>

<p>Arguments are:</p>

<ul>
	<li>
	<p>The current Vignette <code>PortalContext</code> object.</p>
	</li>

	<li>
	<p>Three strings:</p>
	<ul>
		<li>
		<p>An <i>error code</i> - this will be displayed by the SPF system
		error secondary page in the "(Error: <i>&lt;error-code&gt;</i>)" line.
		The default is <code>portappl-internal_error</code>. This can be
		whatever you like, but generally is recommended to be a short unique
		string.</p>
		</li>
		<li>
		<p>An <i>error message</i> - this will be displayed by the SPF
		system error secondary page in between the error title and code. You
		should pass a value that is already localized. The default is (in
		English): <code>The service or information you requested is not
		available at this time.&lt;br/&gt;Please try again later.</code></p>
		</li>
		<li>
		<p>An <i>error title</i> - this will be displayed by the SPF
		system error secondary page above the error message. You should pass a
		value that is already localized. The default is (in English): <code>Could
		not open page</code>.</p>
		</li>
	</ul>
	<p>See the illustration of the SPF system error secondary page <a
		href="#error.system.page">above</a>.</p>
	</li>
</ul>

<p>For example, in the <code>execute</code> method of <code>MyAction</code>,
a concrete subclass of the Vignette <code>BaseAction</code> class:</p>

<blockquote><pre>
import com.vignette.portal.website.enduser.components.BaseAction;
import com.vignette.portal.website.enduser.PortalContext;
import com.hp.it.spf.xa.exception.portal.ExceptionUtil;
...
public class MyAction extends BaseAction {
   ...
   public PortalURI execute(PortalContext portalContext) {
      ...
      try {
         ...
      } catch (Exception e) {
         // unexpected exception occurred - redirect to system error page
         return ExceptionUtil.redirectSystemErrorPage(portalContext,
                                                      "myService-43565");
      }
      ...
   }
   ...
}
</pre></blockquote>

<hr>

<a name="error.auth">
<h3>6.2. Handling authorization errors</code></h3>
</a>

<p><i>Authorization errors</i> are situations where the user is not
permitted to proceed with a requested action, for which the recourse in
the user interface is to display an access-denied error. Shared Portal
Framework provides a secondary page for rendering authorization errors (<code>spf-auth-error-secondarypage</code>).
For example, SiteMinder (both HPP and @HP) can be configured to invoke
that page a group membership check you have configured on a protected
page fails. SPF also provides a utility for transfering control
explicitly to that secondary page when needed (<code>ExceptionUtil.redirectAuthErrorPage</code>).</p>

<a name="error.auth.page">
<h4>6.2.1. The authorization error page (<code>spf-auth-error-secondarypage</code>)</h4>
</a>

<p>Shared Portal Framework comes with a general-purpose
authorization-error page, to which you can transfer control whenever an
authorization error is encountered. For example, you can configure
SiteMinder (HPP and/or @HP) to redirect to this page when a
group-membership check for access by the user to a particular protected
resource in your portal site fails.</p>

<p>The authorization error page is part of the SPF provided portal
components. It comprises a secondary page named <b>Shared Portal
Framework - Authorization Error Page</b> (component ID: <code>spf-auth-error-secondarypage</code>),
and a secondary page type named likewise (component ID: <code>spf-auth-error-secondarypagetype</code>)
of which the secondary page is an instance.</p>

<p>When you configure your portal site (in Vignette Site Console)
you can select <b>Shared Portal Framework - Authorization Error Page</b>
for that secondary page type. Then whenever an authorization error
occurs in SiteMinder (assuming you configured a policy in SiteMinder to
use this page), or whenever you <a href="#error.auth.redirect">redirect
to the authorization error page</a> yourself (ie from your portal
component), that <code>spf-auth-error-secondarypage</code> will be the
one which renders.</p>

<p>The SPF authorization error page is part of the SPF portal
components, provided by the SPF team in every SPF environment (including
sandboxes). To configure Vignette to use the SPF authorization error
page:</p>

<ol>
	<li>
	<p>The SPF authorization error secondary page must have been
	configured as the default secondary page to use for the SPF
	authorization error secondary page type. In the Vignette server
	console, go to <b>Server Settings &gt; Server Defaults &gt; Site
	&amp; Appearance &gt; Default Secondary Pages</b>, and for the <b>Shared
	Portal Framework - Authorization Error Page</b> secondary page type, choose
	<b>Shared Portal Framework - Authorization Error Page</b>. (In most
	cases, this will already have been done for you during SPF server
	setup.)</p>
	</li>
	<li>
	<p>The SPF authorization error secondary page must have been shared
	to your portal site. In the Vignette server console, go to <b>Components
	&gt; Pages &gt; Secondary Page List</b>, checkmark the <b>Shared Portal
	Framework - Authorization Error Page</b>, and <b>Share to...</b>. This
	should already have been done for you when your portal site was first
	setup. (It should not be necessary to share the secondary page type to
	your site, just the secondary page.)</p>
	</li>
	<li>
	<p>Finally, in your portal site, you must apply your site's grid
	and theme to the secondary page, and again make sure that the secondary
	page is configured to be used for that secondary page type. In the
	Vignette site console for your site, go to <b>Site Settings &gt;
	Appearance &gt; Secondary Pages</b> to do this.</p>
	</li>
	<li>
	<p>Done - no further configuration or customization is needed.</p>
	</li>
</ol>

<p>The SPF authorization error secondary page comes with its own
default error messaging, including localizations for all HP.com standard
locales. It looks like this, in English.</p>

<blockquote>
<p><b>Note:</b> This illustration is taken from the HP Support
Center, an SPF-based portal site, so its header and footer are specific
to the HPSC. These are marked below in <font color="red">red</font>;
your header and footer will vary depending on what grid and theme you
applied (above) to the secondary page. The secondary page content itself
is marked below as well in <font color="red">red</font>; this is the
default content, which you can override if desired when <a
	href="#error.auth.redirect">redirecting to the authorization error
page</a>.</p>
</blockquote>

<img
	src="com/hp/it/spf/xa/exception/portal/doc-files/spfAuthErrorSecondaryPage.jpg">

<p>The SPF template friendly ID for an authorization error page, <code>template.PUBLIC_SPF_AUTH_ERROR</code>,
invokes the SPF authorization error secondary page once it has been
configured against your portal site. In other words, once configured
against your portal site as above, you can deliberately invoke the page
with the URL <code>http://.../portal/site/<i>&lt;your-site&gt;</i>/template.PUBLIC_SPF_AUTH_ERROR</code>
- for example, by <a href="#error.auth.redirect">redirecting from
another portal component</a> - or SiteMinder can invoke it, by configuring
SiteMinder to use that URL when a group-membership check fails.</p>

<a name="error.auth.redirect">
<h4>6.2.2. Redirecting to the authorization error page (<code>ExceptionUtil.redirectAuthErrorPage</code>)</h4>
</a>

<p>{@link com.hp.it.spf.xa.exception.portal.ExceptionUtil} is a
utility class providing commonly-used error-handling routines. The <code>ExceptionUtil.redirectAuthErrorPage</code>
methods let you transfer control from an <i>action class</i> in your
portal component to the SPF authorization error secondary page discussed
<a href="#error.auth.page">above</a>.</p>

<blockquote>
<p><b>Note:</b> The <code>ExceptionUtil.redirectAuthErrorPage</code>
methods do not themselves actually transfer control to the SPF system
error secondary page. Rather they make a redirect object (a Vignette <code>PortalURI</code>
representing an external redirect) and return it to you. It is then up
to you to act on that. In an action class' main <code>execute</code>
method, this is done by simply returning the <code>PortalURI</code>.
(This is the standard way in the Vignette programming model to generate
a redirect: by creating a <code>PortalURI</code> for the redirect and
returning it from your action class' <code>execute</code> method. So <code>ExceptionUtil.redirectAuthErrorPage</code>
will build the <code>PortalURI</code> for you, but then it is up to you
to return it.)</p>
</blockquote>

<p>The following methods are available:</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.exception.portal.ExceptionUtil#redirectAuthErrorPage(PortalContext,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.exception.portal.ExceptionUtil#redirectAuthErrorPage(PortalContext,String,String,String)}</dt>
</dl>

<p>Arguments are:</p>

<ul>
	<li>
	<p>The current Vignette <code>PortalContext</code> object.</p>
	</li>

	<li>
	<p>Three strings:</p>
	<ul>
		<li>
		<p>An <i>error code</i> - this will be displayed by the SPF
		authorization error secondary page in the "(Error: <i>&lt;error-code&gt;</i>)"
		line. The default is <code>portappl-authorization_error</code>. This
		can be whatever you like, but generally is recommended to be a short
		unique string.</p>
		</li>
		<li>
		<p>An <i>error message</i> - this will be displayed by the SPF
		authorization error secondary page in between the error title and
		code. You should pass a value that is already localized. The default
		is (in English): <code>You do not have proper authorization to
		access this page.&lt;br/&gt;If you believe you have received this
		message in error, please contact the support team for this Web site.</code></p>
		</li>
		<li>
		<p>An <i>error title</i> - this will be displayed by the SPF
		authorization error secondary page above the error message. You should
		pass a value that is already localized. The default is (in English): <code>Authorization
		error</code>.</p>
		</li>
	</ul>
	<p>See the illustration of the SPF authorization error secondary
	page <a href="#error.auth.page">above</a>.</p>
	</li>
</ul>

<p>For example, in the <code>execute</code> method of <code>MyAction</code>,
a concrete subclass of the Vignette <code>BaseAction</code> class:</p>

<blockquote><pre>
import com.vignette.portal.website.enduser.components.BaseAction;
import com.vignette.portal.website.enduser.PortalContext;
import com.hp.it.spf.xa.exception.portal.ExceptionUtil;
import com.hp.it.spf.xa.misc.portal.Utils;
...
public class MyAction extends BaseAction {
   ...
   public PortalURI execute(PortalContext portalContext) {
      ...
      if (!Utils.isUserInGroup(portalContext, "MY_GROUP") {
         // user not allowed - redirect to authorization error page
         return ExceptionUtil.redirectAuthErrorPage(portalContext,
                                                    "myService-93829");
      }
      ...
   }
   ...
}
</pre></blockquote>

<a name="properties">
<h2>7. Configuration File Management</h2>
</a>

<p>It is not uncommon for Java applications to have configuration
properties stored in Java {@link java.util.Properties} files, XML files,
or other formats. This chapter describes an SPF portal utilities class,
{@link
com.hp.it.spf.xa.properties.portal.PropertyResourceBundleManager}, which
we recommend for accessing <b>property</b> files from your runtime code.</p>

<blockquote>
<p><b>Note:</b> Message properties are not the topic of this
chapter. See the <a href="#i18n">Internationalization</a> chapter in
this guide for that.</p>

<p><b>Note:</b> Configuration file management is also discussed in
the <a href="../../../common/spf-common-utilities/apidocs/" target="_blank">SPF
Common Utilities Developer's Guide</a> from the standpoint of both Vignette
portal components and portlet applications. Please familiarize yourself
with that content.</p>
</blockquote>

<hr>

<a name="properties.propertyResourceBundleManager">
<h3>7.1. Accessing your property files (<code>PropertyResourceBundleManager</code>)</h3>
</a>

<p>For configuration files which adhere to the Java standard {@link
java.util.Properties} format, the SPF portal utilities provide a helpful
management class called {@link
com.hp.it.spf.xa.properties.portal.PropertyResourceBundleManager}. It is
a portal-specific subclass of a common <code>PropertyResourceBundleManager</code>
class offered in the SPF common utilities (see the <a
	href="../../../common/spf-common-utilities/apidocs/" target="_blank">SPF
Common Utilities Developer's Guide</a> for more information on that one).
Although you can use either class in your portal component code, the
portal-specific {@link
com.hp.it.spf.xa.properties.portal.PropertyResourceBundleManager} is
better for Vignette component developers: it supports all the
functionality of the parent, while giving you the additional option of
loading your property bundles from support files in the current Vignette
component.</p>

The features of this class are:
</p>

<ul>
	<li>Loads property files from your current portal component's
	support files, and if they are not found there, then from anywhere in
	the classpath, both <i>internal resources</i> and <i>external
	resources</i> (just like the common parent class).</li>
	<li>Maintains a hot-reloadable in-memory cache of your properties
	just like the common parent class. Each time you call <code>PropertyResourceBundleManager</code>
	it returns refreshed values if the file on disk has changed (or been
	removed) and the cache has expired. So administrators can change your
	application properties without having to restart. The cache lifetime is
	configurable with <a href="#properties.config"><code>propertyresourcebundlemanager.properties</code></a>.</li>
	<li>Optionally lets you localize your property files so you can
	apply a different configuration for users with different locales.</li>
	<li>Logs a warning if your file was not found or could not be
	opened or read (the exception is logged too), using Apache commons
	logging (so the log message goes into the Vignette log).</li>
</ul>

<a name="properties.propertyResourceBundleManager.getBundle">
<h4>7.1.1. Getting a bundle of properties (<code>PropertyResourceBundleManager.getBundle</code>)</h4>
</a>

<p>Use these methods to get back a Java {@link
java.util.ResourceBundle} containing all the properties in your
configuration file. For performance this uses an in-memory cache of your
properties, which is automatically refreshed from disk if the file
changed and the cache has expired. (If it is removed on disk, the cache
is automatically dropped too.) The cache lifetime is configurable with <a
	href="#properties.config"><code>propertyresourcebundlemanager.properties</code></a>
(see).</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.properties.portal.PropertyResourceBundleManager#getBundle(PortalContext,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.properties.portal.PropertyResourceBundleManager#getBundle(PortalContext,String,Locale)}</dt>
	<dd>
	<p>The arguments are:</p>
	<ul>
		<li>
		<p>The current Vignette <code>PortalContext</code> object.</p>
		</li>

		<li>
		<p>The string name of your properties file. The file must be in
		Java {@link java.util.Properties} format, with an extension of <code>.properties</code>.
		It can be a secondary support file in your current portal component;
		or it can be an internal or external resource file (in which case you
		can put it anywhere the current thread context classloader would find
		it). (For a support file, it would go into the root of your component
		CAR, for example. For an internal resource, it could go into your <code>/WEB-INF/classes</code>,
		for example. For an external resource, it could go into your <i>global
		resource folder</i>.) If your file cannot be found or is unloadable, a
		warning message is logged to the Vignette log, and the method returns
		null.</p>
		</li>

		<li>
		<p>An optional {@link java.util.Locale} for finding a
		best-candidate localized version of your properties file. If you
		provide this locale, then your filename string is treated as a base
		name for a resource bundle of localized files; the method then uses
		the Java standard {@link java.util.ResourceBundle} search sequence to
		look for the best-fitting file in the bundle for your locale's
		language, country, and variant.</p>

		<p>As usual with <code>ResourceBundle</code>, your files must all
		share the same base name, and be tagged with locale like this:</p>

		<blockquote><pre>
my_config.properties         &lt;-- the base file
my_config_ja.properties      &lt;-- the same file with property values for Japanese
my_config_zh_CN.properties   &lt;-- the same file with property values for China - Chinese
my_config_zh_TW.properties   &lt;-- the same file with property values for for Taiwan - Chinese
		</pre></blockquote>

		<blockquote>
		<p><b>Note:</b> Although you can load your message properties this
		way, the Shared Portal Framework gives you better ways to get your
		messages. See the <a href="#i18n">Internationalization</a> chapter.
		The {@link
		com.hp.it.spf.xa.properties.portal.PropertyResourceBundleManager#getBundle(String,Locale)}
		method is really intended for configuration properties whose values
		vary by locale, rather than for message properties.</p>
		</blockquote>
	</ul>
	<p>For example, to get a <code>ResourceBundle</code> for the <code>my_config.properties</code>
	file (where <code>context</code> is the current request's <code>PortalContext</code>
	object):</p>
	<blockquote><pre>
import com.hp.it.spf.xa.properties.portal.PropertyResourceBundleManager;
...
ResourceBundle properties = PropertyResourceBundleManager.getBundle(context, "my_config");
if (properties == null) {
... // properties failed to load
}
</pre></blockquote>
	<p>Notice that the given filename does not need to include the <code>.properties</code>
	extension; it is assumed (but you can provide it if you want). In the
	following example, we get the values for Japan for these properties:</p>
	<blockquote><pre>
import com.hp.it.spf.xa.properties.portal.PropertyResourceBundleManager;
...
ResourceBundle properties = PropertyResourceBundleManager.getBundle(context, "my_config", Locale.JAPAN);
if (properties == null) {
... // properties failed to load
}
</pre></blockquote>
	</dd>
</dl>

<p>Please see the method documentation for more information.</p>

<a name="properties.propertyResourceBundleManager.getString">
<h4>7.1.2. Getting a single property (<code>PropertyResourceBundleManager.getString</code>)</h4>
</a>

<p>If you just need to get a single property, you can use these
methods as a shortcut. They are equivalent to using <a
	href="#properties.propertyResourceBundleManager.getBundle"><code>PropertyResourceBundleManager.getBundle</code></a>,
and then getting the property value from {@link
java.util.ResourceBundle#getString(String)}.</p>

<dl>
	<dt>{@link
	com.hp.it.spf.xa.properties.portal.PropertyResourceBundleManager#getString(PortalContext,String,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.properties.portal.PropertyResourceBundleManager#getString(PortalContext,String,String,String)}</dt>
	<dd>
	<p>The arguments are:</p>
	<ul>
		<li>
		<p>The current Vignette <code>PortalContext</code> object.</p>
		</li>
		<li>
		<p>The name of the properties file. This is the first string. For
		more on this argument, see the <a
			href="#properties.propertyResourceBundleManager.getBundle"><code>PropertyResourceBundleManager.getBundle</code></a>
		discussion above.</p>
		</li>
		<li>
		<p>The property key to retrieve. This is the second string.</p>
		</li>
		<li>
		<p>An optional default value to return if the properties file
		cannot be found or loaded, or if the property key is not found in that
		file. If you don't provide a default value, then null is returned in
		those cases.</p>
		</li>
	</ul>
	</dd>

	<dt>{@link
	com.hp.it.spf.xa.properties.portal.PropertyResourceBundleManager#getString(PortalContext,String,Locale,String)}</dt>
	<dt>{@link
	com.hp.it.spf.xa.properties.portal.PropertyResourceBundleManager#getString(PortalContext,String,Locale,String,String)}</dt>
	<dd>
	<p>The arguments are the same as the string-argument methods above,
	except here you can pass a {@link java.util.Locale} as well. The
	best-fit localized version of your properties file will be used as the
	source for the returned property value. For more on this argument, see
	the <a href="#properties.propertyResourceBundleManager.getBundle"><code>PropertyResourceBundleManager.getBundle</code></a>
	discussion above.</p>
	</dd>
</dl>

<p>For example, here we get the value for the <code>id.default</code>
property from the <code>my_config.properties</code> file:</p>
<blockquote><pre>
import com.hp.it.spf.xa.properties.portal.PropertyResourceBundleManager;
...
String defaultID = PropertyResourceBundleManager.getString(context, "my_config", "id.default");
if (defaultID == null) {
... // properties failed to load or key not found
}
</pre></blockquote>

<p>In the following example, we get the <code>id.default</code>
value for Japan, with <code>XYZ</code> returned by default if the
particular property or file cannot be found:</p>

<blockquote><pre>
import com.hp.it.spf.xa.properties.portal.PropertyResourceBundleManager;
...
String defaultID = PropertyResourceBundleManager.getString(context, "my_config", Locale.JAPAN, "id.default", "XYZ");
</pre></blockquote>

<p>Please see the method documentation for more information.</p>

<a name="properties.config">
<h4>7.1.3. Configuring <code>propertyresourcebundlemanager.properties</code>
(optional)</h4>
</a>

<blockquote>
<p><b>Note:</b> You only need to concern yourself with <code>propertyresourcebundlemanager.properties</code>
if you will be <a href="#properties">accessing configuration
properties with <code>PropertyResourceBundleManager</code></a> <b>and</b>
you need to override the default behavior (eg the cache duration).</p>
</blockquote>

<p>The <code>propertyresourcebundlemanager.properties</code> file
lets you configure the behavior of the <code>PropertyResourceBundleManager</code>.
At present, only one configuration item is available.</p>

<dl>
	<dt><code>reload.checkPeriod</code></dt>
	<dd>
	<p>This property is set to an integer (number of seconds) and
	indicates how long the <code>PropertyResourceBundleManager</code>
	in-memory cache should retain the results of a prior file lookup. A <i>positive</i>
	integer means file lookup results will be cached for that many seconds.
	A <i>negative</i> integer means they will be cached forever (until
	restart). Zero disables the cache, so that the filesystem is checked
	each time. The default period is 900 seconds. Caching may improve
	performance of your application under heavy loads.</p>
	<p>For example, to cache for an hour:</p>

	<blockquote><pre>
reload.checkPeriod = 3600
	</pre></blockquote>
	</dd>

</dl>

<p>If you do choose to have a <code>propertyresourcebundlemanager.properties</code>
file, place it anywhere in the classpath of the Vignette portal
application. This is one file you cannot put in your current component's
support files.</p>

<hr>

<a name="history">
<h2>8. Document History</h2>
</a>

<table border="1">
	<tr>
		<th>Version</th>
		<th>Date</th>
		<th>Editor</th>
		<th>Description</th>
	</tr>
	<tr>
		<td>1.0</td>
		<td>September 7 2010</td>
		<td>S. Jorgenson</td>
		<td>Initial published version.</td>
	</tr>
	<tr>
		<td>1.1</td>
		<td>December 3 2010</td>
		<td>S. Jorgenson</td>
		<td>Added <code>{DATE}</code>, <code>{AUTH}</code>, <code>{LANGUAGE-NAME}</code>,
		<code>{COUNTRY-NAME}</code> tokens. Added <code>!</code> operator to
		applicable container tokens like <code>{GROUP}</code>. Corrected
		documentation about authentication type groups, to note they are only
		available to authenticated users.</td>
	</tr>
	<tr>
		<td>1.2</td>
		<td>April 9 2012</td>
		<td>S. Jorgenson</td>
		<td>Added <code>{SECURE}</code> and <code>{UNSECURE}</code> tokens.</td>
	</tr>
	<tr>
		<td>1.3</td>
		<td>September 10 2012</td>
		<td>S. Jorgenson / Ying-Zhi Wu</td>
		<td>Documented new portal subclass of <code>PropertyResourceBundleManager</code>.</td>
	</tr>
	<!-- 
	<tr>
		<td>1.1</td>
		<td>Feb 12 2009</td>
		<td>S. Jorgenson</td>
		<td>
		<ul>
			<li>Added locale groups.</li>
			<li>Corrected global resources folder to conform to actual SASU
			value: <code>/opt/sasuapps/spf/globalResources</code> to <code>/opt/sasuapps/sp/global_resources/</code>
			</li>
			<li>Added defaults for timezone.</li>
		</ul>
		</td>
	</tr>
	-->
</table>
<p></p>

<hr>

<h2>- End -</h2>
</body>
</html>